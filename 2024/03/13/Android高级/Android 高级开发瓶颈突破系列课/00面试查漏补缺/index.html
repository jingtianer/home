<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>00-面试查漏补缺 - Jingtianer</title><link rel="manifest" href="/home/manifest.json"><meta name="application-name" content="Jingtianer"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Jingtianer"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="2024.3.13Handler sendMessage post 有callback的message looper循环执行   sendMessage 发送自定义的message 可以没有callback 可以有what、obj去和接收者传递消息    Message源码（仅public） Message的获取 Handler包装的runnable new Message() obtain()"><meta property="og:type" content="blog"><meta property="og:title" content="00-面试查漏补缺"><meta property="og:url" content="https://jingtianer.github.io/home/2024/03/13/Android%E9%AB%98%E7%BA%A7/Android%20%E9%AB%98%E7%BA%A7%E5%BC%80%E5%8F%91%E7%93%B6%E9%A2%88%E7%AA%81%E7%A0%B4%E7%B3%BB%E5%88%97%E8%AF%BE/00%E9%9D%A2%E8%AF%95%E6%9F%A5%E6%BC%8F%E8%A1%A5%E7%BC%BA/"><meta property="og:site_name" content="Jingtianer"><meta property="og:description" content="2024.3.13Handler sendMessage post 有callback的message looper循环执行   sendMessage 发送自定义的message 可以没有callback 可以有what、obj去和接收者传递消息    Message源码（仅public） Message的获取 Handler包装的runnable new Message() obtain()"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://oss.javaguide.cn/github/javaguide/java/basis/jit-vs-aot.png"><meta property="og:image" content="https://jingtianer.github.io/home/images/activity_lifecycle.png"><meta property="og:image" content="https://developer.android.com/static/images/guide/fragments/fragment-view-lifecycle.png?hl=zh-cn"><meta property="article:published_time" content="2024-03-13T13:15:36.000Z"><meta property="article:modified_time" content="2025-04-15T02:37:55.585Z"><meta property="article:author" content="Meow Meow Liu"><meta property="article:tag" content="Android面试查漏补缺"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://oss.javaguide.cn/github/javaguide/java/basis/jit-vs-aot.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://jingtianer.github.io/home/2024/03/13/Android%E9%AB%98%E7%BA%A7/Android%20%E9%AB%98%E7%BA%A7%E5%BC%80%E5%8F%91%E7%93%B6%E9%A2%88%E7%AA%81%E7%A0%B4%E7%B3%BB%E5%88%97%E8%AF%BE/00%E9%9D%A2%E8%AF%95%E6%9F%A5%E6%BC%8F%E8%A1%A5%E7%BC%BA/"},"headline":"00-面试查漏补缺","image":["https://oss.javaguide.cn/github/javaguide/java/basis/jit-vs-aot.png","https://jingtianer.github.io/home/images/activity_lifecycle.png"],"datePublished":"2024-03-13T13:15:36.000Z","dateModified":"2025-04-15T02:37:55.585Z","author":{"@type":"Person","name":"Meow Meow Liu"},"publisher":{"@type":"Organization","name":"Jingtianer","logo":{"@type":"ImageObject","url":{"text":"Meow!!"}}},"description":"2024.3.13Handler sendMessage post 有callback的message looper循环执行   sendMessage 发送自定义的message 可以没有callback 可以有what、obj去和接收者传递消息    Message源码（仅public） Message的获取 Handler包装的runnable new Message() obtain()"}</script><link rel="canonical" href="https://jingtianer.github.io/home/2024/03/13/Android%E9%AB%98%E7%BA%A7/Android%20%E9%AB%98%E7%BA%A7%E5%BC%80%E5%8F%91%E7%93%B6%E9%A2%88%E7%AA%81%E7%A0%B4%E7%B3%BB%E5%88%97%E8%AF%BE/00%E9%9D%A2%E8%AF%95%E6%9F%A5%E6%BC%8F%E8%A1%A5%E7%BC%BA/"><link rel="alternate" href="/home/atom.xml" title="Jingtianer" type="application/atom+xml"><link rel="icon" href="/home/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/vs.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/home/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const $tabMenu = document.querySelector(`a[href="${location.hash}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(location.hash);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/home/">Meow!!</a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/home/">主页</a><a class="navbar-item" href="/home/archives">归档</a><a class="navbar-item" href="/home/categories">分类</a><a class="navbar-item" href="/home/tags">标签</a><a class="navbar-item" href="/home/about">关于我</a><a class="navbar-item" href="/home/tags/gallery">相册</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/"><i class="fab fa-github"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2024-03-13T13:15:36.000Z" title="2024/3/13 21:15:36">2024-03-13</time>发表</span><span class="level-item"><time dateTime="2025-04-15T02:37:55.585Z" title="2025/4/15 10:37:55">2025-04-15</time>更新</span><span class="level-item"><a class="link-muted" href="/home/categories/Android/">Android</a></span><span class="level-item">28 分钟读完 (大约4152个字)</span></div></div><h1 class="title is-3 is-size-4-mobile">00-面试查漏补缺</h1><div class="content"><h2 id="2024-3-13"><a href="#2024-3-13" class="headerlink" title="2024.3.13"></a>2024.3.13</h2><h3 id="Handler"><a href="#Handler" class="headerlink" title="Handler"></a>Handler</h3><ul>
<li>sendMessage</li>
<li>post<ul>
<li>有callback的message</li>
<li>looper循环执行</li>
</ul>
</li>
<li>sendMessage<ul>
<li>发送自定义的message</li>
<li>可以没有callback</li>
<li>可以有what、obj去和接收者传递消息</li>
</ul>
</li>
</ul>
<h4 id="Message源码（仅public）"><a href="#Message源码（仅public）" class="headerlink" title="Message源码（仅public）"></a>Message源码（仅public）</h4><ul>
<li>Message的获取<ul>
<li>Handler包装的runnable</li>
<li>new Message()</li>
<li>obtain() <strong>推荐</strong>，Message中的recycle方法会回收不用的Message，obtain的时候如果消息池不空，可以服用消息池<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">Message</span> <span class="keyword">implements</span> <span class="title class_">Parcelable</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * User-defined message code so that the recipient can identify</span></span><br><span class="line"><span class="comment">     * what this message is about. Each &#123;<span class="doctag">@link</span> Handler&#125; has its own name-space</span></span><br><span class="line"><span class="comment">     * for message codes, so you do not need to worry about yours conflicting</span></span><br><span class="line"><span class="comment">     * with other handlers.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> what;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * arg1 and arg2 are lower-cost alternatives to using</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@link</span> #setData(Bundle) setData()&#125; if you only need to store a</span></span><br><span class="line"><span class="comment">     * few integer values.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> arg1;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * arg1 and arg2 are lower-cost alternatives to using</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@link</span> #setData(Bundle) setData()&#125; if you only need to store a</span></span><br><span class="line"><span class="comment">     * few integer values.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> arg2;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * An arbitrary object to send to the recipient.  When using</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@link</span> Messenger&#125; to send the message across processes this can only</span></span><br><span class="line"><span class="comment">     * be non-null if it contains a Parcelable of a framework class (not one</span></span><br><span class="line"><span class="comment">     * implemented by the application).   For other data transfer use</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@link</span> #setData&#125;.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;Note that Parcelable objects here are not supported prior to</span></span><br><span class="line"><span class="comment">     * the &#123;<span class="doctag">@link</span> android.os.Build.VERSION_CODES#FROYO&#125; release.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Object obj;</span><br><span class="line">    <span class="meta">@UnsupportedAppUsage</span></span><br><span class="line">    <span class="comment">/*package*/</span> <span class="type">int</span> flags;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The targeted delivery time of this message. The time-base is</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@link</span> SystemClock#uptimeMillis&#125;.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@hide</span> Only for use within the tests.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@UnsupportedAppUsage</span></span><br><span class="line">    <span class="meta">@VisibleForTesting(visibility = VisibleForTesting.Visibility.PACKAGE)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">long</span> when;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/** <span class="doctag">@hide</span> */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Object</span> <span class="variable">sPoolSync</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Return a new Message instance from the global pool. Allows us to</span></span><br><span class="line"><span class="comment">     * avoid allocating new objects in many cases.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Message <span class="title function_">obtain</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (sPoolSync) &#123;</span><br><span class="line">            <span class="keyword">if</span> (sPool != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="type">Message</span> <span class="variable">m</span> <span class="operator">=</span> sPool;</span><br><span class="line">                sPool = m.next;</span><br><span class="line">                m.next = <span class="literal">null</span>;</span><br><span class="line">                m.flags = <span class="number">0</span>; <span class="comment">// clear in-use flag</span></span><br><span class="line">                sPoolSize--;</span><br><span class="line">                <span class="keyword">return</span> m;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Message</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Same as &#123;<span class="doctag">@link</span> #obtain()&#125;, but copies the values of an existing</span></span><br><span class="line"><span class="comment">     * message (including its target) into the new one.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> orig Original message to copy.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> A Message object from the global pool.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Message <span class="title function_">obtain</span><span class="params">(Message orig)</span> &#123;</span><br><span class="line">        <span class="type">Message</span> <span class="variable">m</span> <span class="operator">=</span> obtain();</span><br><span class="line">        m.what = orig.what;</span><br><span class="line">        m.arg1 = orig.arg1;</span><br><span class="line">        m.arg2 = orig.arg2;</span><br><span class="line">        m.obj = orig.obj;</span><br><span class="line">        m.replyTo = orig.replyTo;</span><br><span class="line">        m.sendingUid = orig.sendingUid;</span><br><span class="line">        m.workSourceUid = orig.workSourceUid;</span><br><span class="line">        <span class="keyword">if</span> (orig.data != <span class="literal">null</span>) &#123;</span><br><span class="line">            m.data = <span class="keyword">new</span> <span class="title class_">Bundle</span>(orig.data);</span><br><span class="line">        &#125;</span><br><span class="line">        m.target = orig.target;</span><br><span class="line">        m.callback = orig.callback;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> m;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Same as &#123;<span class="doctag">@link</span> #obtain()&#125;, but sets the value for the &lt;em&gt;target&lt;/em&gt; member on the Message returned.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> h  Handler to assign to the returned Message object&#x27;s &lt;em&gt;target&lt;/em&gt; member.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> A Message object from the global pool.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Message <span class="title function_">obtain</span><span class="params">(Handler h)</span> &#123;</span><br><span class="line">        <span class="type">Message</span> <span class="variable">m</span> <span class="operator">=</span> obtain();</span><br><span class="line">        m.target = h;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> m;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Same as &#123;<span class="doctag">@link</span> #obtain(Handler)&#125;, but assigns a callback Runnable on</span></span><br><span class="line"><span class="comment">     * the Message that is returned.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> h  Handler to assign to the returned Message object&#x27;s &lt;em&gt;target&lt;/em&gt; member.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> callback Runnable that will execute when the message is handled.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> A Message object from the global pool.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Message <span class="title function_">obtain</span><span class="params">(Handler h, Runnable callback)</span> &#123;</span><br><span class="line">        <span class="type">Message</span> <span class="variable">m</span> <span class="operator">=</span> obtain();</span><br><span class="line">        m.target = h;</span><br><span class="line">        m.callback = callback;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> m;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Same as &#123;<span class="doctag">@link</span> #obtain()&#125;, but sets the values for both &lt;em&gt;target&lt;/em&gt; and</span></span><br><span class="line"><span class="comment">     * &lt;em&gt;what&lt;/em&gt; members on the Message.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> h  Value to assign to the &lt;em&gt;target&lt;/em&gt; member.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> what  Value to assign to the &lt;em&gt;what&lt;/em&gt; member.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> A Message object from the global pool.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Message <span class="title function_">obtain</span><span class="params">(Handler h, <span class="type">int</span> what)</span> &#123;</span><br><span class="line">        <span class="type">Message</span> <span class="variable">m</span> <span class="operator">=</span> obtain();</span><br><span class="line">        m.target = h;</span><br><span class="line">        m.what = what;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> m;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Same as &#123;<span class="doctag">@link</span> #obtain()&#125;, but sets the values of the &lt;em&gt;target&lt;/em&gt;, &lt;em&gt;what&lt;/em&gt;, and &lt;em&gt;obj&lt;/em&gt;</span></span><br><span class="line"><span class="comment">     * members.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> h  The &lt;em&gt;target&lt;/em&gt; value to set.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> what  The &lt;em&gt;what&lt;/em&gt; value to set.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> obj  The &lt;em&gt;object&lt;/em&gt; method to set.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>  A Message object from the global pool.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Message <span class="title function_">obtain</span><span class="params">(Handler h, <span class="type">int</span> what, Object obj)</span> &#123;</span><br><span class="line">        <span class="type">Message</span> <span class="variable">m</span> <span class="operator">=</span> obtain();</span><br><span class="line">        m.target = h;</span><br><span class="line">        m.what = what;</span><br><span class="line">        m.obj = obj;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> m;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Same as &#123;<span class="doctag">@link</span> #obtain()&#125;, but sets the values of the &lt;em&gt;target&lt;/em&gt;, &lt;em&gt;what&lt;/em&gt;,</span></span><br><span class="line"><span class="comment">     * &lt;em&gt;arg1&lt;/em&gt;, and &lt;em&gt;arg2&lt;/em&gt; members.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> h  The &lt;em&gt;target&lt;/em&gt; value to set.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> what  The &lt;em&gt;what&lt;/em&gt; value to set.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> arg1  The &lt;em&gt;arg1&lt;/em&gt; value to set.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> arg2  The &lt;em&gt;arg2&lt;/em&gt; value to set.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>  A Message object from the global pool.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Message <span class="title function_">obtain</span><span class="params">(Handler h, <span class="type">int</span> what, <span class="type">int</span> arg1, <span class="type">int</span> arg2)</span> &#123;</span><br><span class="line">        <span class="type">Message</span> <span class="variable">m</span> <span class="operator">=</span> obtain();</span><br><span class="line">        m.target = h;</span><br><span class="line">        m.what = what;</span><br><span class="line">        m.arg1 = arg1;</span><br><span class="line">        m.arg2 = arg2;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> m;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Same as &#123;<span class="doctag">@link</span> #obtain()&#125;, but sets the values of the &lt;em&gt;target&lt;/em&gt;, &lt;em&gt;what&lt;/em&gt;,</span></span><br><span class="line"><span class="comment">     * &lt;em&gt;arg1&lt;/em&gt;, &lt;em&gt;arg2&lt;/em&gt;, and &lt;em&gt;obj&lt;/em&gt; members.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> h  The &lt;em&gt;target&lt;/em&gt; value to set.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> what  The &lt;em&gt;what&lt;/em&gt; value to set.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> arg1  The &lt;em&gt;arg1&lt;/em&gt; value to set.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> arg2  The &lt;em&gt;arg2&lt;/em&gt; value to set.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> obj  The &lt;em&gt;obj&lt;/em&gt; value to set.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>  A Message object from the global pool.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Message <span class="title function_">obtain</span><span class="params">(Handler h, <span class="type">int</span> what,</span></span><br><span class="line"><span class="params">            <span class="type">int</span> arg1, <span class="type">int</span> arg2, Object obj)</span> &#123;</span><br><span class="line">        <span class="type">Message</span> <span class="variable">m</span> <span class="operator">=</span> obtain();</span><br><span class="line">        m.target = h;</span><br><span class="line">        m.what = what;</span><br><span class="line">        m.arg1 = arg1;</span><br><span class="line">        m.arg2 = arg2;</span><br><span class="line">        m.obj = obj;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> m;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** <span class="doctag">@hide</span> */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">updateCheckRecycle</span><span class="params">(<span class="type">int</span> targetSdkVersion)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (targetSdkVersion &lt; Build.VERSION_CODES.LOLLIPOP) &#123;</span><br><span class="line">            gCheckRecycle = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Return a Message instance to the global pool.</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * You MUST NOT touch the Message after calling this function because it has</span></span><br><span class="line"><span class="comment">     * effectively been freed.  It is an error to recycle a message that is currently</span></span><br><span class="line"><span class="comment">     * enqueued or that is in the process of being delivered to a Handler.</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">recycle</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isInUse()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (gCheckRecycle) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;This message cannot be recycled because it &quot;</span></span><br><span class="line">                        + <span class="string">&quot;is still in use.&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        recycleUnchecked();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Return the targeted delivery time of this message, in milliseconds.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">getWhen</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> when;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setTarget</span><span class="params">(Handler target)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.target = target;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Retrieve the &#123;<span class="doctag">@link</span> android.os.Handler Handler&#125; implementation that</span></span><br><span class="line"><span class="comment">     * will receive this message. The object must implement</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@link</span> android.os.Handler#handleMessage(android.os.Message)</span></span><br><span class="line"><span class="comment">     * Handler.handleMessage()&#125;. Each Handler has its own name-space for</span></span><br><span class="line"><span class="comment">     * message codes, so you do not need to</span></span><br><span class="line"><span class="comment">     * worry about yours conflicting with other handlers.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Handler <span class="title function_">getTarget</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> target;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Retrieve callback object that will execute when this message is handled.</span></span><br><span class="line"><span class="comment">     * This object must implement Runnable. This is called by</span></span><br><span class="line"><span class="comment">     * the &lt;em&gt;target&lt;/em&gt; &#123;<span class="doctag">@link</span> Handler&#125; that is receiving this Message to</span></span><br><span class="line"><span class="comment">     * dispatch it.  If</span></span><br><span class="line"><span class="comment">     * not set, the message will be dispatched to the receiving Handler&#x27;s</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@link</span> Handler#handleMessage(Message)&#125;.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Runnable <span class="title function_">getCallback</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> callback;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** <span class="doctag">@hide</span> */</span></span><br><span class="line">    <span class="meta">@UnsupportedAppUsage</span></span><br><span class="line">    <span class="keyword">public</span> Message <span class="title function_">setCallback</span><span class="params">(Runnable r)</span> &#123;</span><br><span class="line">        callback = r;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Obtains a Bundle of arbitrary data associated with this</span></span><br><span class="line"><span class="comment">     * event, lazily creating it if necessary. Set this value by calling</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@link</span> #setData(Bundle)&#125;.  Note that when transferring data across</span></span><br><span class="line"><span class="comment">     * processes via &#123;<span class="doctag">@link</span> Messenger&#125;, you will need to set your ClassLoader</span></span><br><span class="line"><span class="comment">     * on the Bundle via &#123;<span class="doctag">@link</span> Bundle#setClassLoader(ClassLoader)</span></span><br><span class="line"><span class="comment">     * Bundle.setClassLoader()&#125; so that it can instantiate your objects when</span></span><br><span class="line"><span class="comment">     * you retrieve them.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> #peekData()</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> #setData(Bundle)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Bundle <span class="title function_">getData</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (data == <span class="literal">null</span>) &#123;</span><br><span class="line">            data = <span class="keyword">new</span> <span class="title class_">Bundle</span>();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Like getData(), but does not lazily create the Bundle.  A null</span></span><br><span class="line"><span class="comment">     * is returned if the Bundle does not already exist.  See</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@link</span> #getData&#125; for further information on this.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> #getData()</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> #setData(Bundle)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Bundle <span class="title function_">peekData</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Sets a Bundle of arbitrary data values. Use arg1 and arg2 members</span></span><br><span class="line"><span class="comment">     * as a lower cost way to send a few simple integer values, if you can.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> #getData()</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> #peekData()</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setData</span><span class="params">(Bundle data)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.data = data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Chainable setter for &#123;<span class="doctag">@link</span> #what&#125;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@hide</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Message <span class="title function_">setWhat</span><span class="params">(<span class="type">int</span> what)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.what = what;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Sends this Message to the Handler specified by &#123;<span class="doctag">@link</span> #getTarget&#125;.</span></span><br><span class="line"><span class="comment">     * Throws a null pointer exception if this field has not been set.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendToTarget</span><span class="params">()</span> &#123;</span><br><span class="line">        target.sendMessage(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns true if the message is asynchronous, meaning that it is not</span></span><br><span class="line"><span class="comment">     * subject to &#123;<span class="doctag">@link</span> Looper&#125; synchronization barriers.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> True if the message is asynchronous.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> #setAsynchronous(boolean)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isAsynchronous</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (flags &amp; FLAG_ASYNCHRONOUS) != <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Sets whether the message is asynchronous, meaning that it is not</span></span><br><span class="line"><span class="comment">     * subject to &#123;<span class="doctag">@link</span> Looper&#125; synchronization barriers.</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * Certain operations, such as view invalidation, may introduce synchronization</span></span><br><span class="line"><span class="comment">     * barriers into the &#123;<span class="doctag">@link</span> Looper&#125;&#x27;s message queue to prevent subsequent messages</span></span><br><span class="line"><span class="comment">     * from being delivered until some condition is met.  In the case of view invalidation,</span></span><br><span class="line"><span class="comment">     * messages which are posted after a call to &#123;<span class="doctag">@link</span> android.view.View#invalidate&#125;</span></span><br><span class="line"><span class="comment">     * are suspended by means of a synchronization barrier until the next frame is</span></span><br><span class="line"><span class="comment">     * ready to be drawn.  The synchronization barrier ensures that the invalidation</span></span><br><span class="line"><span class="comment">     * request is completely handled before resuming.</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;&lt;p&gt;</span></span><br><span class="line"><span class="comment">     * Asynchronous messages are exempt from synchronization barriers.  They typically</span></span><br><span class="line"><span class="comment">     * represent interrupts, input events, and other signals that must be handled independently</span></span><br><span class="line"><span class="comment">     * even while other work has been suspended.</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;&lt;p&gt;</span></span><br><span class="line"><span class="comment">     * Note that asynchronous messages may be delivered out of order with respect to</span></span><br><span class="line"><span class="comment">     * synchronous messages although they are always delivered in order among themselves.</span></span><br><span class="line"><span class="comment">     * If the relative order of these messages matters then they probably should not be</span></span><br><span class="line"><span class="comment">     * asynchronous in the first place.  Use with caution.</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> async True if the message is asynchronous.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> #isAsynchronous()</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAsynchronous</span><span class="params">(<span class="type">boolean</span> async)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (async) &#123;</span><br><span class="line">            flags |= FLAG_ASYNCHRONOUS;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            flags &amp;= ~FLAG_ASYNCHRONOUS;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** Constructor (but the preferred way to get a Message is to call &#123;<span class="doctag">@link</span> #obtain() Message.obtain()&#125;).</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Message</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h3 id="Looper每次循环在做什么"><a href="#Looper每次循环在做什么" class="headerlink" title="Looper每次循环在做什么"></a>Looper每次循环在做什么</h3><ul>
<li>取消息</li>
<li>分发消息<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SuppressWarnings(&#123;&quot;UnusedTokenOfOriginalCallingIdentity&quot;,</span></span><br><span class="line"><span class="meta">        &quot;ClearIdentityCallNotFollowedByTryFinally&quot;&#125;)</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">loopOnce</span><span class="params">(<span class="keyword">final</span> Looper me,</span></span><br><span class="line"><span class="params">        <span class="keyword">final</span> <span class="type">long</span> ident, <span class="keyword">final</span> <span class="type">int</span> thresholdOverride)</span> &#123;</span><br><span class="line">    <span class="type">Message</span> <span class="variable">msg</span> <span class="operator">=</span> me.mQueue.next(); <span class="comment">// might block</span></span><br><span class="line">    <span class="keyword">if</span> (msg == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// No message indicates that the message queue is quitting.</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    msg.target.dispatchMessage(msg);</span><br><span class="line">    <span class="comment">// 省略部分大概是和observer交互还有打log</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="Handler-dispatchMessage"><a href="#Handler-dispatchMessage" class="headerlink" title="Handler.dispatchMessage"></a>Handler.dispatchMessage</h4><ul>
<li>有callback就执行callback</li>
<li>没有则通过mCallback对象或者子类重写handleMessage分发消息。<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">dispatchMessage</span><span class="params">(<span class="meta">@NonNull</span> Message msg)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (msg.callback != <span class="literal">null</span>) &#123;</span><br><span class="line">        handleCallback(msg);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (mCallback != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (mCallback.handleMessage(msg)) &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        handleMessage(msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="MessageQueue"><a href="#MessageQueue" class="headerlink" title="MessageQueue"></a>MessageQueue</h3><h4 id="enqueue消息的操作"><a href="#enqueue消息的操作" class="headerlink" title="enqueue消息的操作"></a>enqueue消息的操作</h4><ul>
<li>按照when大小入队</li>
<li>如果不是异步消息且队初始为空或队列中消息为异步消息或消息没有target，则wake对方<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">boolean</span> <span class="title function_">enqueueMessage</span><span class="params">(Message msg, <span class="type">long</span> when)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (msg.target == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Message must have a target.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">synchronized</span> (<span class="built_in">this</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (msg.isInUse()) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(msg + <span class="string">&quot; This message is already in use.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        msg.markInUse();</span><br><span class="line">        msg.when = when;</span><br><span class="line">        <span class="type">Message</span> <span class="variable">p</span> <span class="operator">=</span> mMessages;</span><br><span class="line">        <span class="type">boolean</span> needWake;</span><br><span class="line">        <span class="keyword">if</span> (p == <span class="literal">null</span> || when == <span class="number">0</span> || when &lt; p.when) &#123;</span><br><span class="line">            <span class="comment">// New head, wake up the event queue if blocked.</span></span><br><span class="line">            msg.next = p;</span><br><span class="line">            mMessages = msg;</span><br><span class="line">            needWake = mBlocked;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// Inserted within the middle of the queue.  Usually we don&#x27;t have to wake</span></span><br><span class="line">            <span class="comment">// up the event queue unless there is a barrier at the head of the queue</span></span><br><span class="line">            <span class="comment">// and the message is the earliest asynchronous message in the queue.</span></span><br><span class="line">            needWake = mBlocked &amp;&amp; p.target == <span class="literal">null</span> &amp;&amp; msg.isAsynchronous();</span><br><span class="line">            Message prev;</span><br><span class="line">            <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">                prev = p;</span><br><span class="line">                p = p.next;</span><br><span class="line">                <span class="keyword">if</span> (p == <span class="literal">null</span> || when &lt; p.when) &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (needWake &amp;&amp; p.isAsynchronous()) &#123;</span><br><span class="line">                    needWake = <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            msg.next = p; <span class="comment">// invariant: p == prev.next</span></span><br><span class="line">            prev.next = msg;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// We can assume mPtr != 0 because mQuitting is false.</span></span><br><span class="line">        <span class="keyword">if</span> (needWake) &#123;</span><br><span class="line">            nativeWake(mPtr);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>enqueue的时候不是全部检查target不为空了吗？为什么后续还有target为空的消息？<ul>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_44235109/article/details/132765664">Handler 同步屏障&amp;异步消息</a></li>
<li><a target="_blank" rel="noopener" href="http://gityuan.com/2015/12/26/handler-message-framework/">Android消息机制1-Handler(Java层)</a></li>
<li>通过一个方法发送没有target的消息屏障，这样暂时屏蔽同步消息，只取出异步消息</li>
</ul>
</li>
</ul>
<h4 id="取消息的操作"><a href="#取消息的操作" class="headerlink" title="取消息的操作"></a>取消息的操作</h4><ul>
<li>取消息<ul>
<li>如果有消息<ul>
<li>ready了，就返回</li>
<li>没ready，阻塞等着通过nativePollOnce，如果有人enqueue，则会通过nativeWake唤醒</li>
</ul>
</li>
<li>没有消息了<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@UnsupportedAppUsage</span></span><br><span class="line">Message <span class="title function_">next</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">pendingIdleHandlerCount</span> <span class="operator">=</span> -<span class="number">1</span>; <span class="comment">// -1 only during first iteration</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">nextPollTimeoutMillis</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">        <span class="keyword">if</span> (nextPollTimeoutMillis != <span class="number">0</span>) &#123;</span><br><span class="line">            Binder.flushPendingCommands();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        nativePollOnce(ptr, nextPollTimeoutMillis); </span><br><span class="line">        <span class="comment">// 如果消息还没有ready，阻塞等待一段时间</span></span><br><span class="line">        <span class="comment">// nextPollTimeoutMillis的计算在上一次循环，看下面的代码</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">synchronized</span> (<span class="built_in">this</span>) &#123; <span class="comment">// 只有一个线程能拿消息</span></span><br><span class="line">            <span class="comment">// Try to retrieve the next message.  Return if found.</span></span><br><span class="line">            <span class="keyword">final</span> <span class="type">long</span> <span class="variable">now</span> <span class="operator">=</span> SystemClock.uptimeMillis();</span><br><span class="line">            <span class="type">Message</span> <span class="variable">prevMsg</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">            <span class="type">Message</span> <span class="variable">msg</span> <span class="operator">=</span> mMessages;</span><br><span class="line">            <span class="keyword">if</span> (msg != <span class="literal">null</span> &amp;&amp; msg.target == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">// Stalled by a barrier.  Find the next asynchronous message in the queue.</span></span><br><span class="line">                <span class="keyword">do</span> &#123;</span><br><span class="line">                    prevMsg = msg;</span><br><span class="line">                    msg = msg.next;</span><br><span class="line">                &#125; <span class="keyword">while</span> (msg != <span class="literal">null</span> &amp;&amp; !msg.isAsynchronous());</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (msg != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (now &lt; msg.when) &#123;</span><br><span class="line">                    <span class="comment">// Next message is not ready.  Set a timeout to wake up when it is ready.</span></span><br><span class="line">                    nextPollTimeoutMillis = (<span class="type">int</span>) Math.min(msg.when - now, Integer.MAX_VALUE);</span><br><span class="line">                    <span class="comment">// nextPollTimeoutMillis的计算</span></span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">// Got a message.</span></span><br><span class="line">                    mBlocked = <span class="literal">false</span>;</span><br><span class="line">                    <span class="keyword">if</span> (prevMsg != <span class="literal">null</span>) &#123;</span><br><span class="line">                        prevMsg.next = msg.next;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        mMessages = msg.next;</span><br><span class="line">                    &#125;</span><br><span class="line">                    msg.next = <span class="literal">null</span>;</span><br><span class="line">                    <span class="keyword">if</span> (DEBUG) Log.v(TAG, <span class="string">&quot;Returning message: &quot;</span> + msg);</span><br><span class="line">                    msg.markInUse();</span><br><span class="line">                    <span class="keyword">return</span> msg; <span class="comment">// 拿到消息，返回</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// No more messages.</span></span><br><span class="line">                nextPollTimeoutMillis = -<span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h3 id="Handler实战"><a href="#Handler实战" class="headerlink" title="Handler实战"></a>Handler实战</h3><ul>
<li><p>普通进程使用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">LooperThread</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> Handler mHandler;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        Looper.prepare();</span><br><span class="line">        mHandler = <span class="keyword">new</span> <span class="title class_">Handler</span>(Looper.myLooper()) &#123;</span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleMessage</span><span class="params">(Message msg)</span> &#123;</span><br><span class="line">                <span class="comment">//处理即将发送过来的消息</span></span><br><span class="line">                System.out.println(<span class="string">&quot;thread id=&quot;</span>+Thread.currentThread().getId());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        Looper.loop();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 外部开启线程、获取handler，post/sendMessage</span></span><br></pre></td></tr></table></figure></li>
<li><p>HandlerThread</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">HandlerThread</span> <span class="variable">handlerThread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HandlerThread</span>(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">handlerThread.start(); <span class="comment">// 创建HandlerThread</span></span><br><span class="line"><span class="type">Handler</span> <span class="variable">handler</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Handler</span>(handlerThread.getLooper());</span><br><span class="line"><span class="comment">// 拿到HandlerThread的Looper，创建handler</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Looper退出</p>
<ul>
<li>quit : 删除所有消息，包括正在运行的</li>
<li>quitSafely() : 删除未运行的消息</li>
</ul>
</li>
</ul>
<h3 id="AOT和JIT的对比"><a href="#AOT和JIT的对比" class="headerlink" title="AOT和JIT的对比"></a>AOT和JIT的对比</h3><p><img src="https://oss.javaguide.cn/github/javaguide/java/basis/jit-vs-aot.png" alt="AOT和JIT的对比"></p>
<h3 id="System-arraycopy"><a href="#System-arraycopy" class="headerlink" title="System.arraycopy"></a>System.arraycopy</h3><p><a target="_blank" rel="noopener" href="https://www.baeldung.com/java-system-arraycopy-arrays-copyof-performance">Performance of System.arraycopy() vs. Arrays.copyOf()</a></p>
<p>arraycopy是native方法，用c实现的，可能是memcpy等方法实现的，效率因平台而不同</p>
<h2 id="ANR-App-Not-Responding"><a href="#ANR-App-Not-Responding" class="headerlink" title="ANR(App Not Responding)"></a>ANR(App Not Responding)</h2><ul>
<li>哪些场景导致ANR<ul>
<li>Service Timeout:Service在特定的时间内无法处理完成</li>
<li>BroadcastQueue Timeout：BroadcastReceiver在特定时间内无法处理完成</li>
<li>ContentProvider Timeout：内容提供者执行超时</li>
<li>inputDispatching Timeout: 按键或触摸事件在特定时间内无响应。</li>
</ul>
</li>
</ul>
<h3 id="ServiceANR"><a href="#ServiceANR" class="headerlink" title="ServiceANR"></a>ServiceANR</h3><p><code>realStartServiceLocked()</code>-&gt;<code>bumpServiceExecutingLocked()</code>-&gt;<code>scheduleServiceTimeoutLocked()</code></p>
<p>在Service启动过程中，<code>scheduleServiceTimeoutLocked</code>通过native层的handler发送了DelayedMessage</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">scheduleServiceTimeoutLocked</span><span class="params">(ProcessRecord proc)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (proc.executingServices.size() == <span class="number">0</span> || proc.thread == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">Message</span> <span class="variable">msg</span> <span class="operator">=</span> mAm.mHandler.obtainMessage(</span><br><span class="line">            ActivityManagerService.SERVICE_TIMEOUT_MSG);</span><br><span class="line">    msg.obj = proc;</span><br><span class="line">    <span class="comment">// 在serviceDoneExecutingLocked中会remove该SERVICE_TIMEOUT_MSG消息，</span></span><br><span class="line">    <span class="comment">// 当超时后仍没有remove SERVICE_TIMEOUT_MSG消息，则执行ActiveServices. serviceTimeout()方法；</span></span><br><span class="line">    mAm.mHandler.sendMessageDelayed(msg,</span><br><span class="line">            proc.execServicesFg ? SERVICE_TIMEOUT : SERVICE_BACKGROUND_TIMEOUT);</span><br><span class="line">    <span class="comment">// 前台进程中执行Service，SERVICE_TIMEOUT=20s；后台进程中执行Service，SERVICE_BACKGROUND_TIMEOUT=200s</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在Service的OnCreate结束后或启动过程抛出异常，调用<code>serviceDoneExecutingLocked</code>删除消息</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (r.app.executingServices.size() == <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (DEBUG_SERVICE || DEBUG_SERVICE_EXECUTING) Slog.v(TAG_SERVICE_EXECUTING,</span><br><span class="line">                            <span class="string">&quot;No more executingServices of &quot;</span> + r.shortName);</span><br><span class="line">mAm.mHandler.removeMessages(ActivityManagerService.SERVICE_TIMEOUT_MSG, r.app);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>在service的oncreate阶段不要执行过重的任务</p>
</blockquote>
<h3 id="InputDispatchingANR"><a href="#InputDispatchingANR" class="headerlink" title="InputDispatchingANR"></a>InputDispatchingANR</h3><p>在分派输入事件时，InputDispatcher会检查当前是否有聚焦的窗口和应用，获取超时时间，如果当前时间大于超时时间，就弹出ANR</p>
<p>Activity.onCreate执行耗时操作，不管用户如何操作都不会发生ANR，因为输入事件相关监听机制还没有建立起来；InputChannel通道还没有建立</p>
<h3 id="应对方案"><a href="#应对方案" class="headerlink" title="应对方案"></a>应对方案</h3><ul>
<li>耗时操作子线程处理，结束后切回主线程更新ui</li>
</ul>
<h3 id="Logs"><a href="#Logs" class="headerlink" title="Logs"></a>Logs</h3><p>除了主体逻辑，发生ANR时还会输出各种类别的日志：<br>event log：通过检索”am_anr”关键字，可以找到发生ANR的应用<br>main log：通过检索”ANR in “关键字，可以找到ANR的信息，日志的上下文会包含CPU的使用情况<br>dropbox：通过检索”anr”类型，可以找到ANR的信息<br>traces：发生ANR时，各进程的函数调用栈信息</p>
<p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MzIwMTAzMTMxMg==&mid=2649493643&idx=1&sn=34b51d1f61bd2ecaa8fd0a2d39c4d1d1&chksm=8eec9b74b99b126246acc4547597dfe55c836b8f689b2d1a65bdf1ee2054ced2fc070bfa2678&mpshare=1&scene=24&srcid=0116vzNfMMv2dLizhAT8mEYq#rd">看完这篇 Android ANR 分析，就可以和面试官装逼了！</a></p>
<h2 id="Activity-Fragment-Lifecycle"><a href="#Activity-Fragment-Lifecycle" class="headerlink" title="Activity&#x2F;Fragment Lifecycle"></a>Activity&#x2F;Fragment Lifecycle</h2><h3 id="Activity"><a href="#Activity" class="headerlink" title="Activity"></a>Activity</h3><p><img src="/home/./images/activity_lifecycle.png" alt="Activity Lifecycle"></p>
<ul>
<li><p>onSaveInstanceState() 与 onRestoreIntanceState()</p>
<ul>
<li>不属于生命周期</li>
<li>onSaveInstanceState保存临时性的状态</li>
<li>onRestoreIntanceState恢复临时性的状态</li>
<li>调用时机<ul>
<li>异常终止的时候才会调用</li>
<li>资源内存不足导致低优先级的 Activity 被杀死<ul>
<li>高优先级：前台Activity</li>
<li>中优先级：可见且非前台</li>
<li>低优先级：后台Activity</li>
</ul>
</li>
<li>资源相关的系统配置发生改变导致Activity被杀死并重新创建</li>
<li>旋转屏幕</li>
</ul>
</li>
<li>旋转屏幕时<ul>
<li>旧Activity：puase-&gt;onSaveInstanceState-&gt;stop-&gt;destory</li>
<li>新Activity：create-&gt;start-&gt;onRestoreInstanceState-&gt;onresume<ul>
<li>onCreate中也能取到onSaveInstanceState，但是官方建议使用onRestoreInstanceState恢复数据</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>onCreate: 创建中，</p>
</li>
<li><p>onStart：可见但不可交互</p>
</li>
<li><p>onResume：可见可交互</p>
</li>
<li><p>onPause：可见不可交互</p>
<ul>
<li>其他应用需要内存，就会Kill进程，下次回来时，进入onCreate</li>
</ul>
</li>
<li><p>onStop：不可见</p>
<ul>
<li>其他应用需要内存，就会Kill进程，下次回来时，进入onCreate</li>
<li>一般情况下，下次回来时，调用onRestart然后onCreate</li>
</ul>
</li>
<li><p>onDestroy：销毁</p>
</li>
</ul>
<p>其他Activity进入前台，当前Activity就会onPause，onStop。如果手快一点，在当前Activity没有彻底消失时就关闭下一个Activity，就不会进入onStop</p>
<h3 id="Fragment"><a href="#Fragment" class="headerlink" title="Fragment"></a>Fragment</h3><p><img src="https://developer.android.com/static/images/guide/fragments/fragment-view-lifecycle.png?hl=zh-cn" alt="Fragment Lifecycle"></p>
<h3 id="AAR"><a href="#AAR" class="headerlink" title="AAR"></a><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_32452623/article/details/79220522">AAR</a></h3><ul>
<li>也是一种打包的zip文件</li>
<li>远程aar和本地arr</li>
</ul>
<h3 id="R文件"><a href="#R文件" class="headerlink" title="R文件"></a><a target="_blank" rel="noopener" href="https://juejin.cn/post/7289748806438420480#heading-15">R文件</a></h3><ul>
<li>资源id</li>
<li>编译时会生成resources.arsc，包含id到实际值的映射</li>
<li>都是static final，可以被内联<ul>
<li>application module被内联了</li>
</ul>
</li>
<li>部分不是final，是static的<ul>
<li>library module的R文件中的常量没有被内联</li>
<li>aar没有被内联</li>
</ul>
</li>
<li>压缩<ul>
<li>AGP 4.1.0打包时，在release包中已经彻底优化掉R文件</li>
<li>混淆，缩短id等标识符长度</li>
<li>删除不需要的资源</li>
<li>从应用及其库依赖中检测并安全地移除不使用的类、字段、方法和属性</li>
</ul>
</li>
</ul>
<h3 id="HTTP断点续传"><a href="#HTTP断点续传" class="headerlink" title="HTTP断点续传"></a>HTTP断点续传</h3><h3 id="各种生命周期"><a href="#各种生命周期" class="headerlink" title="各种生命周期"></a>各种生命周期</h3><h3 id="sql事务"><a href="#sql事务" class="headerlink" title="sql事务"></a>sql事务</h3><h3 id="view绘制原理"><a href="#view绘制原理" class="headerlink" title="view绘制原理"></a>view绘制原理</h3><h3 id="activity启动模式"><a href="#activity启动模式" class="headerlink" title="activity启动模式"></a>activity启动模式</h3><h3 id="这里的都不太会"><a href="#这里的都不太会" class="headerlink" title="这里的都不太会"></a><a target="_blank" rel="noopener" href="https://www.nowcoder.com/discuss/353156362148454400">这里的都不太会</a></h3><h2 id="2024-3-17美团笔试"><a href="#2024-3-17美团笔试" class="headerlink" title="2024.3.17美团笔试"></a>2024.3.17美团笔试</h2><h3 id="面向对象的各种概念"><a href="#面向对象的各种概念" class="headerlink" title="面向对象的各种概念"></a>面向对象的各种概念</h3><ul>
<li>单一职责</li>
<li>等</li>
</ul>
<h3 id="编译原理相关知识"><a href="#编译原理相关知识" class="headerlink" title="编译原理相关知识"></a>编译原理相关知识</h3><ul>
<li>文法自动机相关知识</li>
<li>等</li>
</ul>
<h2 id="2024-3-19美团二面"><a href="#2024-3-19美团二面" class="headerlink" title="2024.3.19美团二面"></a>2024.3.19美团二面</h2><h2 id="Service生命周期"><a href="#Service生命周期" class="headerlink" title="Service生命周期"></a>Service生命周期</h2><ul>
<li>非绑定式<ul>
<li>-(首次startService)-&gt;onCreate()</li>
<li>-(非首次startService)-&gt;onStartCommand()</li>
<li>-(stopService&#x2F;stopSelf)-&gt;onDestroy()</li>
</ul>
</li>
<li>绑定式<ul>
<li>-(首次bindService)-&gt;onCreate()</li>
<li>-(非首次bindService)-&gt;onBind()</li>
<li>-(unbindService&#x2F;stopSelf)-&gt;onUnbind()-&gt;onDestroy()</li>
</ul>
</li>
</ul>
<h3 id="Activity与Service交互信息"><a href="#Activity与Service交互信息" class="headerlink" title="Activity与Service交互信息"></a>Activity与Service交互信息</h3><ul>
<li>非绑定式<ul>
<li>startService时用Intent传递</li>
</ul>
</li>
<li>绑定式<ul>
<li>创建ServiceConnect对象，获取IBinder</li>
<li>通过IBinder交互</li>
<li>Service中创建对象，继承Binder</li>
</ul>
</li>
</ul>
<h3 id="前台Service"><a href="#前台Service" class="headerlink" title="前台Service"></a>前台Service</h3><ul>
<li>前台服务，一般用来创建notification，且不可移除的通知</li>
<li>onCreate时通过startForeground创建通知</li>
<li>通过stopForeground停止前台服务</li>
</ul>
<h2 id="动态广播的使用"><a href="#动态广播的使用" class="headerlink" title="动态广播的使用"></a>动态广播的使用</h2><h3 id="sendBroadCast"><a href="#sendBroadCast" class="headerlink" title="sendBroadCast"></a>sendBroadCast</h3><h3 id="接受"><a href="#接受" class="headerlink" title="接受"></a>接受</h3><p>创建IntentFilter<br>创建BroadcastReceiver<br>registerReceiver<br>unregistReceiver</p>
<ul>
<li>两个Activity之间传递消息</li>
</ul>
<h2 id="静态广播"><a href="#静态广播" class="headerlink" title="静态广播"></a>静态广播</h2><p>创建接收器<br>在Manifest文件中注册，指定接收器类名和IntentFilter</p>
<ul>
<li>8.0后无法接受隐式广播（intent只指定action）<ul>
<li>intent.setPackage(getPackageName()) &#x2F;&#x2F; 接收方的包名</li>
<li>intent.addFlags(FLAG_RECEIVER_INCLUDE_BACKGROUND)</li>
</ul>
</li>
</ul>
<h2 id="有序广播无序广播"><a href="#有序广播无序广播" class="headerlink" title="有序广播无序广播"></a>有序广播无序广播</h2><ul>
<li>无序广播<ul>
<li>默认就是无序广播</li>
<li>多个接收器同时接受</li>
</ul>
</li>
<li>有序广播<ul>
<li>接收器依照优先级依次接受广播</li>
<li>通过<code>context.sendOrderedBroadcast(intent, permission);</code>发送</li>
<li>intentFilter.setPriority()</li>
<li>sendOrderedBoradcast</li>
<li>在广播接收器中abortBroadcast会截断广播向低优先级的传递</li>
<li>setResultExtras和getResultExtras，上游接收器向下游发送消息</li>
<li>setResultData和getResultData，上游接收器向下游发送消息</li>
</ul>
</li>
</ul>
<h2 id="本地广播全局广播"><a href="#本地广播全局广播" class="headerlink" title="本地广播全局广播"></a>本地广播全局广播</h2><ul>
<li>本地广播：仅在app内部传播<ul>
<li>只能动态注册</li>
<li>LocalBroadCastReceiver（已废弃，需要手动添加依赖）</li>
</ul>
</li>
<li>全局广播：整个系统都能接受<ul>
<li>默认就是全局的</li>
</ul>
</li>
</ul>
<h2 id="Java新技术（kotlin早已支持）"><a href="#Java新技术（kotlin早已支持）" class="headerlink" title="Java新技术（kotlin早已支持）"></a>Java新技术（kotlin早已支持）</h2><ul>
<li>密封类<ul>
<li>规定可以有哪些子类<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">sealed</span> <span class="keyword">class</span> <span class="title class_">Reference</span>&lt;T&gt;</span><br><span class="line">    permits PhantomReference, SoftReference, WeakReference, FinalReference &#123;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h2 id="Hook技术"><a href="#Hook技术" class="headerlink" title="Hook技术"></a>Hook技术</h2><p>通过反射，将某些回调字段设置成一个代理对象，代理字段中对invoke进行hook</p>
<h3 id="Xposed框架"><a href="#Xposed框架" class="headerlink" title="Xposed框架"></a>Xposed框架</h3><p>通过替换&#x2F;system&#x2F;bin&#x2F;app_process程序控制zygote进程，使app_process在启动过程中加载XposedBridge.jar，从而完成对Zygote进程及其创建的Dalvik虚拟机的劫持</p>
<ul>
<li>posed自定义模块开发<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> <span class="keyword">implements</span> <span class="title class_">IXposedHookLoadPackage</span> &#123; </span><br><span class="line">    <span class="meta">@Override</span> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleLoadPackage</span><span class="params">(XC_LoadPackage.LoadPackageParam loadPackageParam)</span> <span class="keyword">throws</span> Throwable &#123; </span><br><span class="line">        <span class="keyword">if</span> (!loadPackageParam.packageName.equals(<span class="string">&quot;com.example.pengchengxiang.inputdemo&quot;</span>)) &#123; </span><br><span class="line">            <span class="keyword">return</span>; </span><br><span class="line">        &#125; </span><br><span class="line"> </span><br><span class="line">        XposedBridge.log(<span class="string">&quot;Loaded app:&quot;</span> + loadPackageParam.packageName); </span><br><span class="line">        <span class="comment">//Hook 类的方法</span></span><br><span class="line">        findAndHookMethod(<span class="string">&quot;className&quot;</span>, loadPackageParam.classLoader, <span class="string">&quot;methodNAme&quot;</span>, String.class, <span class="keyword">new</span> <span class="title class_">XC_MethodHook</span>() &#123; </span><br><span class="line">            <span class="meta">@Override</span> </span><br><span class="line">            <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">beforeHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable &#123; </span><br><span class="line">            &#125; </span><br><span class="line"> </span><br><span class="line">            <span class="meta">@Override</span> </span><br><span class="line">            <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">afterHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable &#123; </span><br><span class="line">            &#125; </span><br><span class="line">        &#125;); </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</div><div class="article-licensing box"><div class="licensing-title"><p>00-面试查漏补缺</p><p><a href="https://jingtianer.github.io/home/2024/03/13/Android高级/Android 高级开发瓶颈突破系列课/00面试查漏补缺/">https://jingtianer.github.io/home/2024/03/13/Android高级/Android 高级开发瓶颈突破系列课/00面试查漏补缺/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>作者</h6><p>Meow Meow Liu</p></div></div><div class="level-item is-narrow"><div><h6>发布于</h6><p>2024-03-13</p></div></div><div class="level-item is-narrow"><div><h6>更新于</h6><p>2025-04-15</p></div></div><div class="level-item is-narrow"><div><h6>许可协议</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/home/tags/Android%E9%9D%A2%E8%AF%95%E6%9F%A5%E6%BC%8F%E8%A1%A5%E7%BC%BA/">Android面试查漏补缺</a></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/home/2024/03/14/LeetCode/LeetCode-%E5%88%B7%E9%A2%98%E6%80%BB%E7%BB%9334/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">LeetCode-34</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/home/2024/03/13/Android%E9%AB%98%E7%BA%A7/Android%20%E9%AB%98%E7%BA%A7%E5%BC%80%E5%8F%91%E7%93%B6%E9%A2%88%E7%AA%81%E7%A0%B4%E7%B3%BB%E5%88%97%E8%AF%BE/00%E9%9D%A2%E8%AF%95%E6%9F%A5%E6%BC%8F%E8%A1%A5%E7%BC%BA2/"><span class="level-item">00-面试查漏补缺</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">评论</h3><div id="comment-container"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.min.js"></script><script>var gitalk = new Gitalk({
            id: "5b4ba331d4fc9a9809acb08ef79bcc05",
            repo: "blog_comment",
            owner: "jingtianer",
            clientID: "f0b13fe8021fcd2efe50",
            clientSecret: "35207c14b34e77c48a3aeee1e94c9da169ffe0c2",
            admin: ["jingtianer"],
            createIssueManually: false,
            distractionFreeMode: false,
            perPage: 20,
            pagerDirection: "last",
            
            
            enableHotKey: true,
            language: "zh-CN",
        })
        gitalk.render('comment-container')</script></div></div></div><!--!--><div class="column column-right is-4-tablet is-4-desktop is-4-widescreen  order-3 is-sticky"><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">目录</h3><ul class="menu-list"><li><a class="level is-mobile" href="#2024-3-13"><span class="level-left"><span class="level-item">1</span><span class="level-item">2024.3.13</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Handler"><span class="level-left"><span class="level-item">1.1</span><span class="level-item">Handler</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Message源码（仅public）"><span class="level-left"><span class="level-item">1.1.1</span><span class="level-item">Message源码（仅public）</span></span></a></li></ul></li><li><a class="level is-mobile" href="#Looper每次循环在做什么"><span class="level-left"><span class="level-item">1.2</span><span class="level-item">Looper每次循环在做什么</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Handler-dispatchMessage"><span class="level-left"><span class="level-item">1.2.1</span><span class="level-item">Handler.dispatchMessage</span></span></a></li></ul></li><li><a class="level is-mobile" href="#MessageQueue"><span class="level-left"><span class="level-item">1.3</span><span class="level-item">MessageQueue</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#enqueue消息的操作"><span class="level-left"><span class="level-item">1.3.1</span><span class="level-item">enqueue消息的操作</span></span></a></li><li><a class="level is-mobile" href="#取消息的操作"><span class="level-left"><span class="level-item">1.3.2</span><span class="level-item">取消息的操作</span></span></a></li></ul></li><li><a class="level is-mobile" href="#Handler实战"><span class="level-left"><span class="level-item">1.4</span><span class="level-item">Handler实战</span></span></a></li><li><a class="level is-mobile" href="#AOT和JIT的对比"><span class="level-left"><span class="level-item">1.5</span><span class="level-item">AOT和JIT的对比</span></span></a></li><li><a class="level is-mobile" href="#System-arraycopy"><span class="level-left"><span class="level-item">1.6</span><span class="level-item">System.arraycopy</span></span></a></li></ul></li><li><a class="level is-mobile" href="#ANR-App-Not-Responding"><span class="level-left"><span class="level-item">2</span><span class="level-item">ANR(App Not Responding)</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#ServiceANR"><span class="level-left"><span class="level-item">2.1</span><span class="level-item">ServiceANR</span></span></a></li><li><a class="level is-mobile" href="#InputDispatchingANR"><span class="level-left"><span class="level-item">2.2</span><span class="level-item">InputDispatchingANR</span></span></a></li><li><a class="level is-mobile" href="#应对方案"><span class="level-left"><span class="level-item">2.3</span><span class="level-item">应对方案</span></span></a></li><li><a class="level is-mobile" href="#Logs"><span class="level-left"><span class="level-item">2.4</span><span class="level-item">Logs</span></span></a></li></ul></li><li><a class="level is-mobile" href="#Activity-Fragment-Lifecycle"><span class="level-left"><span class="level-item">3</span><span class="level-item">Activity/Fragment Lifecycle</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Activity"><span class="level-left"><span class="level-item">3.1</span><span class="level-item">Activity</span></span></a></li><li><a class="level is-mobile" href="#Fragment"><span class="level-left"><span class="level-item">3.2</span><span class="level-item">Fragment</span></span></a></li><li><a class="level is-mobile" href="#AAR"><span class="level-left"><span class="level-item">3.3</span><span class="level-item">AAR</span></span></a></li><li><a class="level is-mobile" href="#R文件"><span class="level-left"><span class="level-item">3.4</span><span class="level-item">R文件</span></span></a></li><li><a class="level is-mobile" href="#HTTP断点续传"><span class="level-left"><span class="level-item">3.5</span><span class="level-item">HTTP断点续传</span></span></a></li><li><a class="level is-mobile" href="#各种生命周期"><span class="level-left"><span class="level-item">3.6</span><span class="level-item">各种生命周期</span></span></a></li><li><a class="level is-mobile" href="#sql事务"><span class="level-left"><span class="level-item">3.7</span><span class="level-item">sql事务</span></span></a></li><li><a class="level is-mobile" href="#view绘制原理"><span class="level-left"><span class="level-item">3.8</span><span class="level-item">view绘制原理</span></span></a></li><li><a class="level is-mobile" href="#activity启动模式"><span class="level-left"><span class="level-item">3.9</span><span class="level-item">activity启动模式</span></span></a></li><li><a class="level is-mobile" href="#这里的都不太会"><span class="level-left"><span class="level-item">3.10</span><span class="level-item">这里的都不太会</span></span></a></li></ul></li><li><a class="level is-mobile" href="#2024-3-17美团笔试"><span class="level-left"><span class="level-item">4</span><span class="level-item">2024.3.17美团笔试</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#面向对象的各种概念"><span class="level-left"><span class="level-item">4.1</span><span class="level-item">面向对象的各种概念</span></span></a></li><li><a class="level is-mobile" href="#编译原理相关知识"><span class="level-left"><span class="level-item">4.2</span><span class="level-item">编译原理相关知识</span></span></a></li></ul></li><li><a class="level is-mobile" href="#2024-3-19美团二面"><span class="level-left"><span class="level-item">5</span><span class="level-item">2024.3.19美团二面</span></span></a></li><li><a class="level is-mobile" href="#Service生命周期"><span class="level-left"><span class="level-item">6</span><span class="level-item">Service生命周期</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Activity与Service交互信息"><span class="level-left"><span class="level-item">6.1</span><span class="level-item">Activity与Service交互信息</span></span></a></li><li><a class="level is-mobile" href="#前台Service"><span class="level-left"><span class="level-item">6.2</span><span class="level-item">前台Service</span></span></a></li></ul></li><li><a class="level is-mobile" href="#动态广播的使用"><span class="level-left"><span class="level-item">7</span><span class="level-item">动态广播的使用</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#sendBroadCast"><span class="level-left"><span class="level-item">7.1</span><span class="level-item">sendBroadCast</span></span></a></li><li><a class="level is-mobile" href="#接受"><span class="level-left"><span class="level-item">7.2</span><span class="level-item">接受</span></span></a></li></ul></li><li><a class="level is-mobile" href="#静态广播"><span class="level-left"><span class="level-item">8</span><span class="level-item">静态广播</span></span></a></li><li><a class="level is-mobile" href="#有序广播无序广播"><span class="level-left"><span class="level-item">9</span><span class="level-item">有序广播无序广播</span></span></a></li><li><a class="level is-mobile" href="#本地广播全局广播"><span class="level-left"><span class="level-item">10</span><span class="level-item">本地广播全局广播</span></span></a></li><li><a class="level is-mobile" href="#Java新技术（kotlin早已支持）"><span class="level-left"><span class="level-item">11</span><span class="level-item">Java新技术（kotlin早已支持）</span></span></a></li><li><a class="level is-mobile" href="#Hook技术"><span class="level-left"><span class="level-item">12</span><span class="level-item">Hook技术</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Xposed框架"><span class="level-left"><span class="level-item">12.1</span><span class="level-item">Xposed框架</span></span></a></li></ul></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/home/js/toc.js" defer></script></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/home/">Meow!!</a><p class="is-size-7"><span>&copy; 2025 Meow Meow Liu</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/home/js/column.js"></script><script src="/home/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/home/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><script type="text/x-mathjax-config">MathJax.Hub.Config({
            'HTML-CSS': {
                matchFontHeight: false
            },
            SVG: {
                matchFontHeight: false
            },
            CommonHTML: {
                matchFontHeight: false
            },
            tex2jax: {
                inlineMath: [
                    ['$','$'],
                    ['\\(','\\)']
                ]
            }
        });</script><script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.9/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script><!--!--><!--!--><!--!--><script src="/home/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/home/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/home/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script><script type="text/javascript" src="/home/js/fairyDustCursor.js"></script><link rel="stylesheet" type="text/css" href="/home/css/textPopup.css"><script type="text/javascript" src="/home/js/textPopup.js"></script><script type="text/javascript" src="/home/js/clickClipBoard.js"></script><script type="module" src="/home/js/mermaidInitializer.js"></script><script src="/home/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/home/live2dw/assets/wanko.model.json"},"display":{"position":"right","width":200,"height":400},"mobile":{"show":true}});</script></body></html>