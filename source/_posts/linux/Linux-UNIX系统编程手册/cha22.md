---
title: cha22.信号:高级特性
date: 2023-5-30 18:05:00
tags: 
    - Linux/UNIX系统编程手册
categories: linux
toc: true
language: zh-CN
---

## 读书笔记

### 核心转储文件
- 特定信号会引发进程创建核心转储文件（工作目录）并终止。

- 核心转储文件(`core`)是内存映像的一个文件，利用调试器可以查看到退出时的代码、数据状态。

- P371展示了不会产生核心转储文件的情况，大致为
  - 没有写权限
  - 存在硬链接大于1的同名文件
  - 目录不存在
  - ulimit等限制为0
  - 二进制程序没有读权限
  - 工作目录的挂载方式为只读
  - set-user/group-ID程序运行者为非文件属主（组）

- /proc/sys/kenel/core_pattern中存储了核心转储文件的命名格式化字符串

### 信号处理、传递特殊情况

- SIGKILL和SIGSTOP的默认行为无法改变，无法阻塞。总是可以使用该信号处理失控进程。
  - 前面读书不认真
  - 信号阻塞即对该信号的传递延后，直到该信号从掩码中移除。
  - 除非是实时信号，否则不对阻塞信号排队，恢复信号后只传递该信号一次

- SIGCONT恢复停止的进程
  - SIGCONT总会恢复运行，不论该信号是否被阻塞或忽略
  - 在停止的进程恢复之前，若有其他进程传递其他信号，则该信号并未被真实传递。（除了sigkill）
  - 收到SIGCONT时，处于等待状态的停止信号将会被丢弃。反过来，收到停止信号后，等待状态的SIGCONT也会被丢弃

- 若由终端产生的信号（SIGHUP SIGINT SIGQUIT SIGTTIN SIGTTOU SIGTSTP）被忽略，则不应该改变其信号处置（处理函数）
  - 这个很难懂，后面34章会讲

### sigkill的力所不能及

进程休眠时，有两种休眠状态
- 可打断(TASK_INTERRUPTIBLE)，ps命令中标记为S。如等待终端输入
- 不可打断(TASK_UNINTERRUPTIBLE)，ps命令中标记为D。如等待磁盘IO完成

在不可打断休眠时，直到脱离这种状态，任何信号（包括sigkill）都不会被传递

如果由于各种BUG导致进程持续不可打断的方式kill，该进程只能通过重启的方式消灭

linux2.6加入了TASK_KILLABLE，类似于不可打断状态，但是可以由致命信号唤醒

### 硬件产生的信号

硬件异常产生的信号一般不设置能正常返回的信号处理器函数，或将其忽略、阻塞。

若返回，将会重复触发异常
若忽略或阻塞，以除0错误为例，此时该如何继续运行呢

一般接受默认行为，或信号处理函数中longjmp或退出（不要正常返回）

### 信号的同步生成和异步生成
信号产生一般是异步的，也就是不确定是否会立刻传递信号
对于
- 硬件产生信号
- raise, kill, killpg向自身发送的信号
是同步产生的，会立刻传递

