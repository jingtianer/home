---
title: 定位感兴趣的BB
date: 2023-2-21 12:15:37
tags: 
    - 组会 
categories: 组会
toc: true
language: zh-CN
---

## BB定位

- 参考两篇论文
  - [1] AmpFuzz: Fuzzing for Amplification DDoS Vulnerabilities
  - [2] Not All Coverage Measurements Are Equal: Fuzzing by Coverage Accounting for Input Prioritization

论文[1]中也是利用cfg定位感兴趣的BB，但是他之研究了DDos放大攻击，论文中将网络相关函数划分为三类
|Class|Functions|
|-|-|
|Source|recv, recvfrom, recvmsg, recvmmsg|
|Sink|send, sendfrom, sendmsg, sendmmsg|
|Blocking|select, pselect, poll, ppoll, epoll_wait, epoll_pwai|


我将代码中被调用的函数中，所有含有recv的函数作为`source`，含有send的函数作为`sink`，含有select、poll的作为`blocking`（先暂时这样，这样是显然有问题的，有些sendxxx, recvxxx可能并不是网络操作，后面手动剔除一下就好了）。

在gitlab的`issue`中搜索cve，查看其调用栈，找到其中易受攻击的函数，作为`vulnerable`，这里暂时没有对cve根据效果进行分类，筛选出DDos放大攻击

再结合论文[2]的coverage accounting，对于每条边`e`，统计其以下参数

- FUNC  : 边`e`的`dest基本块`中含有vulnerable函数调用的个数
- SINK  ：边`e`的`dest基本块`是否满足论文[1]中`sink capable`的定义，满足则为1，否则为0
- BB    ：边`e`的`dest基本块`中包含网络操作的指令条数

> 如果使用论文上严格的对`sink capable`定义，只能找到几个满足的BB

## debug

### 脚本编码声明
- 如果使用gcc，脚本首行需要声明脚本编码，g++则不需要
```python
#coding=UTF-8
```

### Phi node

gcc ssa\phi的介绍：[13.3 Static Single Assignment](https://gcc.gnu.org/onlinedocs/gccint/SSA.html)

> 我的理解是phi_nodes是当在不同分支return不同变量时，为了使return时返回的都是同一个变量
> 语句的处理应该不加phi_node

### inline assembler code
inline asm的介绍：[Extended Asm - Assembler Instructions with C Expression Operands](https://gcc.gnu.org/onlinedocs/gcc/Extended-Asm.html)

> c/c\+\+中可以使用asm关键词，在c/c\+\+代码中嵌入特殊的汇编指令。这种指令可以直接访问c/c\+\+中的变量

## bugs call stack

|cve|call stack|分类|
|-|-|-|
|CVE-2022-3080|https://gitlab.isc.org/isc-projects/bind9/-/issues/3517|断言 isc_assertion_failed()|
|CVE-2022-3736|https://gitlab.isc.org/isc-projects/bind9/-/issues/3622|断言|
|CVE-2022-3924|https://gitlab.isc.org/isc-projects/bind9/-/issues/3619|RUNTIME_CHECK() |
|CVE-2022-2881|https://gitlab.isc.org/isc-projects/bind9/-/issues/3493|buffer exceed|
|CVE-2022-2906|https://gitlab.isc.org/isc-projects/bind9/-/issues/3491|内存泄漏，__interceptor_malloc()|
|CVE-2022-38177|https://gitlab.isc.org/isc-projects/bind9/-/issues/3487|内存泄漏 malloc() CRYPTO_zalloc() BN_MONT_CTX_new() EC_GROUP_set_seed()|
|CVE-2022-1183|https://gitlab.isc.org/isc-projects/bind9/-/issues/3216|断言|
|CVE-2022-0667|https://gitlab.isc.org/isc-projects/bind9/-/issues/3129|断言|
|CVE-2021-25219|https://gitlab.isc.org/isc-projects/bind9/-/issues/2899|dns_name_equal() entry_is_lame() 添加entry的算法是 $ O(n) $ |
|CVE-2021-25218|https://gitlab.isc.org/isc-projects/bind9/-/issues/2856|断言|

在bind9的issue中搜索cve，查看了issue中的调用栈，发现断言和内存操作出现次数最多