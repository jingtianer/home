<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Jingtianer</title>
  
  <subtitle>A cat coder</subtitle>
  <link href="https://jingtianer.github.io/home/atom.xml" rel="self"/>
  
  <link href="https://jingtianer.github.io/home/"/>
  <updated>2025-05-09T06:47:03.189Z</updated>
  <id>https://jingtianer.github.io/home/</id>
  
  <author>
    <name>Meow Meow Liu</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>åŸºç¡€06-ViewGroup</title>
    <link href="https://jingtianer.github.io/home/2025/05/09/Android%E9%AB%98%E7%BA%A7/%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/%E5%9F%BA%E7%A1%8006-ViewGroup/"/>
    <id>https://jingtianer.github.io/home/2025/05/09/Android%E9%AB%98%E7%BA%A7/%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/%E5%9F%BA%E7%A1%8006-ViewGroup/</id>
    <published>2025-05-09T13:15:36.000Z</published>
    <updated>2025-05-09T06:47:03.189Z</updated>
    
    <content type="html"><![CDATA[<h2 id="test"><a href="#test" class="headerlink" title="test"></a>test</h2><pre class="mermaid">graph TD    A[å¼€å§‹] --> B{æ¡ä»¶åˆ¤æ–­}    B -->|æ˜¯| C[æ‰§è¡Œæ“ä½œ]    B -->|å¦| D[ç»“æŸ]</pre>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;test&quot;&gt;&lt;a href=&quot;#test&quot; class=&quot;headerlink&quot; title=&quot;test&quot;&gt;&lt;/a&gt;test&lt;/h2&gt;&lt;pre class=&quot;mermaid&quot;&gt;graph TD
    A[å¼€å§‹] --&gt; B{æ¡ä»¶åˆ¤æ–­}
    B --&gt;|æ˜¯| </summary>
      
    
    
    
    <category term="Android" scheme="https://jingtianer.github.io/home/categories/Android/"/>
    
    <category term="æ‰‹æ’¸Androidæºç " scheme="https://jingtianer.github.io/home/categories/Android/%E6%89%8B%E6%92%B8Android%E6%BA%90%E7%A0%81/"/>
    
    
    <category term="Android-å®˜æ–¹æºç " scheme="https://jingtianer.github.io/home/tags/Android-%E5%AE%98%E6%96%B9%E6%BA%90%E7%A0%81/"/>
    
  </entry>
  
  <entry>
    <title>00-Javaæ•°ç»„éå†æ€§èƒ½å¯¹æ¯”</title>
    <link href="https://jingtianer.github.io/home/2024/09/13/Java%E5%9F%BA%E7%A1%80/00-Java%E6%95%B0%E7%BB%84%E9%81%8D%E5%8E%86%E6%80%A7%E8%83%BD%E5%AF%B9%E6%AF%94/"/>
    <id>https://jingtianer.github.io/home/2024/09/13/Java%E5%9F%BA%E7%A1%80/00-Java%E6%95%B0%E7%BB%84%E9%81%8D%E5%8E%86%E6%80%A7%E8%83%BD%E5%AF%B9%E6%AF%94/</id>
    <published>2024-09-13T13:15:36.000Z</published>
    <updated>2025-04-15T02:37:55.589Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä¸‰ç§éå†æ–¹å¼æ€§èƒ½å¯¹æ¯”"><a href="#ä¸‰ç§éå†æ–¹å¼æ€§èƒ½å¯¹æ¯”" class="headerlink" title="ä¸‰ç§éå†æ–¹å¼æ€§èƒ½å¯¹æ¯”"></a>ä¸‰ç§éå†æ–¹å¼æ€§èƒ½å¯¹æ¯”</h2><ol><li><p>å¾ªç¯ä¸æ•°ç»„çš„<code>length</code>æ¯”è¾ƒ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JavaMain</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> Object[] objs = <span class="keyword">new</span> <span class="title class_">Object</span>[<span class="number">10000000</span>];</span><br><span class="line">    <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">zero</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; objs.length; i++) &#123;</span><br><span class="line">            sum ^= objs[i].hashCode();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sum;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>å°†æ•°ç»„<code>length</code>å­˜åœ¨æ–¹æ³•æ ˆä¸­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JavaMain</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> Object[] objs = <span class="keyword">new</span> <span class="title class_">Object</span>[<span class="number">10000000</span>];</span><br><span class="line">    <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">one</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> objs.length;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">            sum ^= objs[i].hashCode();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sum;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>for-eachå¾ªç¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JavaMain</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> Object[] objs = <span class="keyword">new</span> <span class="title class_">Object</span>[<span class="number">10000000</span>];</span><br><span class="line">    <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">two</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (Object obj : objs) &#123;</span><br><span class="line">            sum ^= obj.hashCode();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sum;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h3 id="æµ‹è¯•é€Ÿåº¦"><a href="#æµ‹è¯•é€Ÿåº¦" class="headerlink" title="æµ‹è¯•é€Ÿåº¦"></a>æµ‹è¯•é€Ÿåº¦</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JavaMain</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> Object[] objs = <span class="keyword">new</span> <span class="title class_">Object</span>[<span class="number">10000000</span>];</span><br><span class="line">    <span class="keyword">static</span> <span class="type">long</span> <span class="title function_">run</span><span class="params">(IntSupplier f)</span> &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">            result = f.getAsInt();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        System.out.println(<span class="string">&quot;result = &quot;</span> + result + <span class="string">&quot;, time = &quot;</span> + (end - start) / <span class="number">1000.0</span>);</span><br><span class="line">        <span class="keyword">return</span>  end - start;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; objs.length; i++) &#123;</span><br><span class="line">            objs[i] = <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">            objs[i].hashCode(); <span class="comment">// é¦–æ¬¡è®¡ç®—hashcodeæ›´æ…¢ï¼Œå…ˆç¼“å­˜</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            <span class="type">long</span> <span class="variable">zeroTime</span> <span class="operator">=</span> run(JavaMain::zero);</span><br><span class="line">            <span class="type">long</span> <span class="variable">oneTime</span> <span class="operator">=</span> run(JavaMain::one);</span><br><span class="line">            <span class="type">long</span> <span class="variable">twoTime</span> <span class="operator">=</span> run(JavaMain::two);</span><br><span class="line">            System.out.printf(<span class="string">&quot;2æ¯”1å¿«: %.2f%%\n&quot;</span>, ((<span class="type">double</span>)oneTime - twoTime) / oneTime * <span class="number">100</span>);</span><br><span class="line">            System.out.printf(<span class="string">&quot;2æ¯”0å¿«: %.2f%%\n&quot;</span>, ((<span class="type">double</span>)zeroTime - twoTime) / zeroTime * <span class="number">100</span>);</span><br><span class="line">            System.out.printf(<span class="string">&quot;1æ¯”0å¿«: %.2f%%\n&quot;</span>, ((<span class="type">double</span>)zeroTime - oneTime) / oneTime * <span class="number">100</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æµ‹è¯•ç»“æœ"><a href="#æµ‹è¯•ç»“æœ" class="headerlink" title="æµ‹è¯•ç»“æœ"></a>æµ‹è¯•ç»“æœ</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">result = 360970567, time = 1.393</span><br><span class="line">result = 360970567, time = 1.174</span><br><span class="line">result = 360970567, time = 0.886</span><br><span class="line">2æ¯”1å¿«: 24.53%</span><br><span class="line">2æ¯”0å¿«: 36.40%</span><br><span class="line">1æ¯”0å¿«: 18.65%</span><br></pre></td></tr></table></figure><h2 id="å¯¹æ¯”å­—èŠ‚ç "><a href="#å¯¹æ¯”å­—èŠ‚ç " class="headerlink" title="å¯¹æ¯”å­—èŠ‚ç "></a>å¯¹æ¯”å­—èŠ‚ç </h2><p>ä½¿ç”¨<code>javap -c</code>æŸ¥çœ‹å­—èŠ‚ğŸ´</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">static int zero();</span><br><span class="line">Code:</span><br><span class="line">    0: iconst_0</span><br><span class="line">    1: istore_0</span><br><span class="line">    2: iconst_0</span><br><span class="line">    3: istore_1</span><br><span class="line">    4: iload_1</span><br><span class="line">    5: getstatic     #7                  // Field objs:[Ljava/lang/Object;</span><br><span class="line">    8: arraylength</span><br><span class="line">    9: if_icmpge     29</span><br><span class="line">    12: iload_0</span><br><span class="line">    13: getstatic     #7                  // Field objs:[Ljava/lang/Object;</span><br><span class="line">    16: iload_1</span><br><span class="line">    17: aaload</span><br><span class="line">    18: invokevirtual #13                 // Method java/lang/Object.hashCode:()I</span><br><span class="line">    21: ixor</span><br><span class="line">    22: istore_0</span><br><span class="line">    23: iinc          1, 1</span><br><span class="line">    26: goto          4</span><br><span class="line">    29: iload_0</span><br><span class="line">    30: ireturn</span><br></pre></td></tr></table></figure><ul><li>æ•°ç»„çš„<code>length</code>å¹¶ä¸æ˜¯ä¸€ä¸ªå­—æ®µï¼Œæ²¡æœ‰é€šè¿‡<code>getfield</code>è·å–</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">static int one();</span><br><span class="line">Code:</span><br><span class="line">    0: iconst_0</span><br><span class="line">    1: istore_0</span><br><span class="line">    2: getstatic     #7                  // Field objs:[Ljava/lang/Object;</span><br><span class="line">    5: arraylength</span><br><span class="line">    6: istore_1</span><br><span class="line">    7: iconst_0</span><br><span class="line">    8: istore_2</span><br><span class="line">    9: iload_2</span><br><span class="line">    10: iload_1</span><br><span class="line">    11: if_icmpge     31</span><br><span class="line">    14: iload_0</span><br><span class="line">    15: getstatic     #7                  // Field objs:[Ljava/lang/Object;</span><br><span class="line">    18: iload_2</span><br><span class="line">    19: aaload</span><br><span class="line">    20: invokevirtual #13                 // Method java/lang/Object.hashCode:()I</span><br><span class="line">    23: ixor</span><br><span class="line">    24: istore_0</span><br><span class="line">    25: iinc          2, 1</span><br><span class="line">    28: goto          9</span><br><span class="line">    31: iload_0</span><br><span class="line">    32: ireturn</span><br></pre></td></tr></table></figure><ul><li>æ¯æ¬¡ä½¿ç”¨<code>arraylength</code>è·å–æ•°ç»„é•¿åº¦ä¼šæ›´æ…¢ï¼Œå…·ä½“<code>arraylength</code>åšäº†ä»€ä¹ˆå¯ä»¥çœ‹è¿™ç¯‡æ–‡ç« <a href="https://blog.csdn.net/scjava/article/details/108219216">JVMæ˜¯å¦‚ä½•å¾—åˆ°æ•°ç»„é•¿åº¦çš„</a></li><li><code>zero</code>å’Œ<code>one</code>å¯¹æ¯”<ul><li><code>zero</code>æ¯æ¬¡å¾ªç¯å‰ï¼Œè¦ä¾æ¬¡æ‰§è¡Œ<code>iload_1</code>, <code>getstatic</code>, <code>arraylength</code>, <code>if_icmpge</code></li><li><code>one</code>æ¯æ¬¡å¾ªç¯å‰ï¼Œè¦ä¾æ¬¡æ‰§è¡Œ<code>iload_2</code>, <code>iload_1</code>, <code>if_icmpge</code></li><li><code>one</code>åªéœ€è¦è™šæ‹Ÿæœºè¯»å–ä¸¤ä¸ªæ“ä½œæ•°è¿›è¡Œæ¯”è¾ƒå°±å¯ä»¥ï¼Œè€Œ<code>zero</code>éœ€è¦é€šè¿‡<code>getstatic</code>è·å–æ•°ç»„å¯¹è±¡ï¼Œ<code>arraylength</code>è·å–é•¿åº¦</li></ul></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">static int two();</span><br><span class="line">Code:</span><br><span class="line">    0: iconst_0</span><br><span class="line">    1: istore_0</span><br><span class="line">    2: getstatic     #7                  // Field objs:[Ljava/lang/Object;</span><br><span class="line">    5: astore_1</span><br><span class="line">    6: aload_1</span><br><span class="line">    7: arraylength</span><br><span class="line">    8: istore_2</span><br><span class="line">    9: iconst_0</span><br><span class="line">    10: istore_3</span><br><span class="line">    11: iload_3</span><br><span class="line">    12: iload_2</span><br><span class="line">    13: if_icmpge     35</span><br><span class="line">    16: aload_1</span><br><span class="line">    17: iload_3</span><br><span class="line">    18: aaload</span><br><span class="line">    19: astore        4</span><br><span class="line">    21: iload_0</span><br><span class="line">    22: aload         4</span><br><span class="line">    24: invokevirtual #13                 // Method java/lang/Object.hashCode:()I</span><br><span class="line">    27: ixor</span><br><span class="line">    28: istore_0</span><br><span class="line">    29: iinc          3, 1</span><br><span class="line">    32: goto          11</span><br><span class="line">    35: iload_0</span><br><span class="line">    36: ireturn</span><br></pre></td></tr></table></figure><ul><li><code>one</code>å’Œ<code>two</code>å¯¹æ¯”<ul><li>åœ¨å¾ªç¯å‰ï¼Œä¸¤è€…éƒ½æ˜¯é€šè¿‡<code>iload</code>è¯»å–æ•°ç»„é•¿åº¦å’Œå½“å‰indexå¯¹æ¯”</li><li>åœ¨å¾ªç¯ä½“ä¸­<ul><li><code>one</code>æ¯æ¬¡éœ€è¦<code>getstatic</code>è·å–æ•°ç»„å¯¹è±¡ï¼Œç„¶åæ ¹æ®åç§»é‡å–å‡ºå¯¹åº”ä½ç½®çš„å¯¹è±¡</li><li><code>two</code>åœ¨å¾ªç¯å¼€å§‹å‰ï¼Œå°±å°†æ•°ç»„å¯¹è±¡å­˜åœ¨æœ¬åœ°æ–¹æ³•æ ˆä¸­ï¼Œä¸éœ€è¦ä½¿ç”¨<code>getstatic</code>æ¥è·å–æ•°ç»„å¯¹è±¡</li></ul></li></ul></li></ul><blockquote><p>å¼ºçƒˆæ€€ç–‘æ˜¯<code>getstatic</code>æ€§èƒ½è¿‡äºæ‹‰èƒ¯ï¼Œå¯¼è‡´ä¸‰è€…å¾ªç¯é€Ÿåº¦å·®å¼‚å¤§</p></blockquote><h2 id="å°†æ•°ç»„å¯¹è±¡ä½œä¸ºå‚æ•°ä¼ é€’åˆ°å‡½æ•°ä¸­"><a href="#å°†æ•°ç»„å¯¹è±¡ä½œä¸ºå‚æ•°ä¼ é€’åˆ°å‡½æ•°ä¸­" class="headerlink" title="å°†æ•°ç»„å¯¹è±¡ä½œä¸ºå‚æ•°ä¼ é€’åˆ°å‡½æ•°ä¸­"></a>å°†æ•°ç»„å¯¹è±¡ä½œä¸ºå‚æ•°ä¼ é€’åˆ°å‡½æ•°ä¸­</h2><h3 id="æµ‹è¯•ä»£ç "><a href="#æµ‹è¯•ä»£ç " class="headerlink" title="æµ‹è¯•ä»£ç "></a>æµ‹è¯•ä»£ç </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JavaMain</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> Object[] objs = <span class="keyword">new</span> <span class="title class_">Object</span>[<span class="number">10000000</span>];</span><br><span class="line">    <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">zero</span><span class="params">(Object[] objs)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; objs.length; i++) &#123;</span><br><span class="line">            sum ^= objs[i].hashCode();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sum;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">one</span><span class="params">(Object[] objs)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> objs.length;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">            sum ^= objs[i].hashCode();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sum;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">two</span><span class="params">(Object[] objs)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (Object obj : objs) &#123;</span><br><span class="line">            sum ^= obj.hashCode();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sum;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="type">long</span> <span class="title function_">run</span><span class="params">(Function&lt;Object[], Integer&gt; f)</span> &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">            result = f.apply(objs);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        System.out.println(<span class="string">&quot;result = &quot;</span> + result + <span class="string">&quot;, time = &quot;</span> + (end - start) / <span class="number">1000.0</span>);</span><br><span class="line">        <span class="keyword">return</span>  end - start;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; objs.length; i++) &#123;</span><br><span class="line">            objs[i] = <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">            objs[i].hashCode();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            <span class="type">long</span> <span class="variable">zeroTime</span> <span class="operator">=</span> run(JavaMain::zero);</span><br><span class="line">            <span class="type">long</span> <span class="variable">oneTime</span> <span class="operator">=</span> run(JavaMain::one);</span><br><span class="line">            <span class="type">long</span> <span class="variable">twoTime</span> <span class="operator">=</span> run(JavaMain::two);</span><br><span class="line">            System.out.printf(<span class="string">&quot;2æ¯”1å¿«: %.2f%%\n&quot;</span>, ((<span class="type">double</span>)oneTime - twoTime) / oneTime * <span class="number">100</span>);</span><br><span class="line">            System.out.printf(<span class="string">&quot;2æ¯”0å¿«: %.2f%%\n&quot;</span>, ((<span class="type">double</span>)zeroTime - twoTime) / zeroTime * <span class="number">100</span>);</span><br><span class="line">            System.out.printf(<span class="string">&quot;1æ¯”0å¿«: %.2f%%\n&quot;</span>, ((<span class="type">double</span>)zeroTime - oneTime) / oneTime * <span class="number">100</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ¯”è¾ƒç»“æœ"><a href="#æ¯”è¾ƒç»“æœ" class="headerlink" title="æ¯”è¾ƒç»“æœ"></a>æ¯”è¾ƒç»“æœ</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">result = 360970567, time = 0.85</span><br><span class="line">result = 360970567, time = 0.871</span><br><span class="line">result = 360970567, time = 0.873</span><br><span class="line">2æ¯”1å¿«: -0.23%</span><br><span class="line">2æ¯”0å¿«: -2.71%</span><br><span class="line">1æ¯”0å¿«: -2.41%</span><br><span class="line">result = 360970567, time = 0.864</span><br><span class="line">result = 360970567, time = 0.847</span><br><span class="line">result = 360970567, time = 0.849</span><br><span class="line">2æ¯”1å¿«: -0.24%</span><br><span class="line">2æ¯”0å¿«: 1.74%</span><br><span class="line">1æ¯”0å¿«: 2.01%</span><br><span class="line">result = 360970567, time = 0.851</span><br><span class="line">result = 360970567, time = 0.849</span><br><span class="line">result = 360970567, time = 0.862</span><br><span class="line">2æ¯”1å¿«: -1.53%</span><br><span class="line">2æ¯”0å¿«: -1.29%</span><br><span class="line">1æ¯”0å¿«: 0.24%</span><br></pre></td></tr></table></figure><blockquote><p>ä¸‰ç§æ–¹æ³•éš¾åˆ†ä¼¯ä»²</p></blockquote><h3 id="å­—èŠ‚ç å¯¹æ¯”"><a href="#å­—èŠ‚ç å¯¹æ¯”" class="headerlink" title="å­—èŠ‚ç å¯¹æ¯”"></a>å­—èŠ‚ç å¯¹æ¯”</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line">Compiled from &quot;JavaMain.java&quot;</span><br><span class="line">public class test.JavaMain &#123;</span><br><span class="line">  static java.lang.Object[] objs;</span><br><span class="line"></span><br><span class="line">  public test.JavaMain();</span><br><span class="line">    Code:</span><br><span class="line">       0: aload_0</span><br><span class="line">       1: invokespecial #1                  // Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span><br><span class="line">       4: return</span><br><span class="line"></span><br><span class="line">  static int zero(java.lang.Object[]);</span><br><span class="line">    Code:</span><br><span class="line">       0: iconst_0</span><br><span class="line">       1: istore_1</span><br><span class="line">       2: iconst_0</span><br><span class="line">       3: istore_2</span><br><span class="line">       4: iload_2</span><br><span class="line">       5: aload_0</span><br><span class="line">       6: arraylength</span><br><span class="line">       7: if_icmpge     25</span><br><span class="line">      10: iload_1</span><br><span class="line">      11: aload_0</span><br><span class="line">      12: iload_2</span><br><span class="line">      13: aaload</span><br><span class="line">      14: invokevirtual #7                  // Method java/lang/Object.hashCode:()I</span><br><span class="line">      17: ixor</span><br><span class="line">      18: istore_1</span><br><span class="line">      19: iinc          2, 1</span><br><span class="line">      22: goto          4</span><br><span class="line">      25: iload_1</span><br><span class="line">      26: ireturn</span><br><span class="line"></span><br><span class="line">  static int one(java.lang.Object[]);</span><br><span class="line">    Code:</span><br><span class="line">       0: iconst_0</span><br><span class="line">       1: istore_1</span><br><span class="line">       2: aload_0</span><br><span class="line">       3: arraylength</span><br><span class="line">       4: istore_2</span><br><span class="line">       5: iconst_0</span><br><span class="line">       6: istore_3</span><br><span class="line">       7: iload_3</span><br><span class="line">       8: iload_2</span><br><span class="line">       9: if_icmpge     27</span><br><span class="line">      12: iload_1</span><br><span class="line">      13: aload_0</span><br><span class="line">      14: iload_3</span><br><span class="line">      15: aaload</span><br><span class="line">      16: invokevirtual #7                  // Method java/lang/Object.hashCode:()I</span><br><span class="line">      19: ixor</span><br><span class="line">      20: istore_1</span><br><span class="line">      21: iinc          3, 1</span><br><span class="line">      24: goto          7</span><br><span class="line">      27: iload_1</span><br><span class="line">      28: ireturn</span><br><span class="line"></span><br><span class="line">  static int two(java.lang.Object[]);</span><br><span class="line">    Code:</span><br><span class="line">       0: iconst_0</span><br><span class="line">       1: istore_1</span><br><span class="line">       2: aload_0</span><br><span class="line">       3: astore_2</span><br><span class="line">       4: aload_2</span><br><span class="line">       5: arraylength</span><br><span class="line">       6: istore_3</span><br><span class="line">       7: iconst_0</span><br><span class="line">       8: istore        4</span><br><span class="line">      10: iload         4</span><br><span class="line">      12: iload_3</span><br><span class="line">      13: if_icmpge     36</span><br><span class="line">      16: aload_2</span><br><span class="line">      17: iload         4</span><br><span class="line">      19: aaload</span><br><span class="line">      20: astore        5</span><br><span class="line">      22: iload_1</span><br><span class="line">      23: aload         5</span><br><span class="line">      25: invokevirtual #7                  // Method java/lang/Object.hashCode:()I</span><br><span class="line">      28: ixor</span><br><span class="line">      29: istore_1</span><br><span class="line">      30: iinc          4, 1</span><br><span class="line">      33: goto          10</span><br><span class="line">      36: iload_1</span><br><span class="line">      37: ireturn</span><br><span class="line"></span><br><span class="line">  static &#123;&#125;;</span><br><span class="line">    Code:</span><br><span class="line">       0: ldc           #77                 // int 10000000</span><br><span class="line">       2: anewarray     #2                  // class java/lang/Object</span><br><span class="line">       5: putstatic     #17                 // Field objs:[Ljava/lang/Object;</span><br><span class="line">       8: return</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ä¸‰è€…åŒºåˆ«ä¸å¤§ï¼Œæ€»ä½“è€—æ—¶åŒºåˆ«ä¹Ÿä¸å¤§ï¼Œå¯è§<code>arraylength</code>æŒ‡ä»¤å¹¶ä¸æ˜¯æ€§èƒ½ç“¶é¢ˆï¼Œè€Œæ˜¯<code>getstatic</code>æœ‰è¾ƒå¤§å½±å“<br>åŒæ ·ï¼Œæˆ‘ä¹Ÿæµ‹è¯•äº†ä¸é€šè¿‡å‡½æ•°å‚æ•°ä¼ é€’ï¼Œè€Œå°†æ•°ç»„å’Œä¸‰ä¸ªæ–¹æ³•æ”¹æˆé<code>static</code>ä¿®é¥°çš„ï¼Œä¸‰è€…å·®å¼‚è¾ƒå¤§ï¼Œå¯è§<code>getField</code>æŒ‡ä»¤çš„æ€§èƒ½å¼€é”€ä¹Ÿè¦æ¯”<code>load</code>å¤§</p></blockquote><h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2><p>åœ¨éå†æ•°ç»„æ—¶ï¼Œä¸è®ºæ˜¯ä½¿ç”¨æ•°ç»„çš„<code>length</code>ï¼Œæå‰å­˜å‚¨æ•°ç»„é•¿åº¦ï¼Œè¿˜æ˜¯ä½¿ç”¨<code>for-each</code>ï¼Œå·®åˆ«ä¸å¤§ï¼Œé‡è¦çš„æ˜¯å…ˆå°†æ•°ç»„å¯¹è±¡æ”¾åˆ°æœ¬åœ°æ–¹æ³•æ ˆï¼Œé¿å…é¢‘ç¹æ‰§è¡Œ<code>getstatic</code>å’Œ<code>getfield</code>æŒ‡ä»¤ï¼Œé€ æˆæ€§èƒ½å½±å“ã€‚</p><p>å’Œå…«è‚¡<a href="https://github.com/francistao/LearningNotes/blob/master/Part1/Android/Android%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.md">å®‰å“æ€§èƒ½ä¼˜åŒ–</a>æ‰€å½’å’çš„åŸå› ç¨æœ‰ä¸åŒã€‚</p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;ä¸‰ç§éå†æ–¹å¼æ€§èƒ½å¯¹æ¯”&quot;&gt;&lt;a href=&quot;#ä¸‰ç§éå†æ–¹å¼æ€§èƒ½å¯¹æ¯”&quot; class=&quot;headerlink&quot; title=&quot;ä¸‰ç§éå†æ–¹å¼æ€§èƒ½å¯¹æ¯”&quot;&gt;&lt;/a&gt;ä¸‰ç§éå†æ–¹å¼æ€§èƒ½å¯¹æ¯”&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;&lt;p&gt;å¾ªç¯ä¸æ•°ç»„çš„&lt;code&gt;length&lt;/code&gt;æ¯”è¾ƒ&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title class_&quot;&gt;JavaMain&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; Object[] objs = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;title class_&quot;&gt;Object&lt;/span&gt;[&lt;span class=&quot;number&quot;&gt;10000000&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;title function_&quot;&gt;zero&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;sum&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;; i &amp;lt; objs.length; i++) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            sum ^= objs[i].hashCode();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; sum;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;å°†æ•°ç»„&lt;code&gt;length&lt;/code&gt;å­˜åœ¨æ–¹æ³•æ ˆä¸­&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title class_&quot;&gt;JavaMain&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; Object[] objs = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;title class_&quot;&gt;Object&lt;/span&gt;[&lt;span class=&quot;number&quot;&gt;10000000&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;title function_&quot;&gt;one&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;sum&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;len&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; objs.length;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;; i &amp;lt; len; i++) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            sum ^= objs[i].hashCode();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; sum;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;for-eachå¾ªç¯&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title class_&quot;&gt;JavaMain&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; Object[] objs = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;title class_&quot;&gt;Object&lt;/span&gt;[&lt;span class=&quot;number&quot;&gt;10000000&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;title function_&quot;&gt;two&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;sum&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (Object obj : objs) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            sum ^= obj.hashCode();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; sum;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&quot;æµ‹è¯•é€Ÿåº¦&quot;&gt;&lt;a href=&quot;#æµ‹è¯•é€Ÿåº¦&quot; class=&quot;headerlink&quot; title=&quot;æµ‹è¯•é€Ÿåº¦&quot;&gt;&lt;/a&gt;æµ‹è¯•é€Ÿåº¦&lt;/h3&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title class_&quot;&gt;JavaMain&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; Object[] objs = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;title class_&quot;&gt;Object&lt;/span&gt;[&lt;span class=&quot;number&quot;&gt;10000000&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;long&lt;/span&gt; &lt;span class=&quot;title function_&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(IntSupplier f)&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;type&quot;&gt;long&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;start&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; System.currentTimeMillis();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;result&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;; i &amp;lt; &lt;span class=&quot;number&quot;&gt;100&lt;/span&gt;; i++) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            result = f.getAsInt();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;type&quot;&gt;long&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;end&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; System.currentTimeMillis();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        System.out.println(&lt;span class=&quot;string&quot;&gt;&amp;quot;result = &amp;quot;&lt;/span&gt; + result + &lt;span class=&quot;string&quot;&gt;&amp;quot;, time = &amp;quot;&lt;/span&gt; + (end - start) / &lt;span class=&quot;number&quot;&gt;1000.0&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;  end - start;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title function_&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(String[] args)&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;; i &amp;lt; objs.length; i++) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            objs[i] = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;title class_&quot;&gt;Object&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            objs[i].hashCode(); &lt;span class=&quot;comment&quot;&gt;// é¦–æ¬¡è®¡ç®—hashcodeæ›´æ…¢ï¼Œå…ˆç¼“å­˜&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;; i &amp;lt; &lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;; i++) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;type&quot;&gt;long&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;zeroTime&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; run(JavaMain::zero);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;type&quot;&gt;long&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;oneTime&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; run(JavaMain::one);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;type&quot;&gt;long&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;twoTime&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; run(JavaMain::two);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            System.out.printf(&lt;span class=&quot;string&quot;&gt;&amp;quot;2æ¯”1å¿«: %.2f%%&#92;n&amp;quot;&lt;/span&gt;, ((&lt;span class=&quot;type&quot;&gt;double&lt;/span&gt;)oneTime - twoTime) / oneTime * &lt;span class=&quot;number&quot;&gt;100&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            System.out.printf(&lt;span class=&quot;string&quot;&gt;&amp;quot;2æ¯”0å¿«: %.2f%%&#92;n&amp;quot;&lt;/span&gt;, ((&lt;span class=&quot;type&quot;&gt;double&lt;/span&gt;)zeroTime - twoTime) / zeroTime * &lt;span class=&quot;number&quot;&gt;100&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            System.out.printf(&lt;span class=&quot;string&quot;&gt;&amp;quot;1æ¯”0å¿«: %.2f%%&#92;n&amp;quot;&lt;/span&gt;, ((&lt;span class=&quot;type&quot;&gt;double&lt;/span&gt;)zeroTime - oneTime) / oneTime * &lt;span class=&quot;number&quot;&gt;100&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&quot;æµ‹è¯•ç»“æœ&quot;&gt;&lt;a href=&quot;#æµ‹è¯•ç»“æœ&quot; class=&quot;headerlink&quot; title=&quot;æµ‹è¯•ç»“æœ&quot;&gt;&lt;/a&gt;æµ‹è¯•ç»“æœ&lt;/h3&gt;&lt;figure class=&quot;highlight text&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;result = 360970567, time = 1.393&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;result = 360970567, time = 1.174&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;result = 360970567, time = 0.886&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2æ¯”1å¿«: 24.53%&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2æ¯”0å¿«: 36.40%&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;1æ¯”0å¿«: 18.65%&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="JavaåŸºç¡€" scheme="https://jingtianer.github.io/home/categories/Java%E5%9F%BA%E7%A1%80/"/>
    
    
    <category term="JavaåŸºç¡€" scheme="https://jingtianer.github.io/home/tags/Java%E5%9F%BA%E7%A1%80/"/>
    
  </entry>
  
  <entry>
    <title>LeetCode-38</title>
    <link href="https://jingtianer.github.io/home/2024/09/09/LeetCode/LeetCode-%E5%88%B7%E9%A2%98%E6%80%BB%E7%BB%9338/"/>
    <id>https://jingtianer.github.io/home/2024/09/09/LeetCode/LeetCode-%E5%88%B7%E9%A2%98%E6%80%BB%E7%BB%9338/</id>
    <published>2024-09-09T03:14:34.000Z</published>
    <updated>2025-04-15T02:37:55.602Z</updated>
    
    <content type="html"><![CDATA[<h2 id="2181-åˆå¹¶é›¶ä¹‹é—´çš„èŠ‚ç‚¹"><a href="#2181-åˆå¹¶é›¶ä¹‹é—´çš„èŠ‚ç‚¹" class="headerlink" title="2181. åˆå¹¶é›¶ä¹‹é—´çš„èŠ‚ç‚¹"></a>2181. åˆå¹¶é›¶ä¹‹é—´çš„èŠ‚ç‚¹</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">ListNode* <span class="title">mergeNodes</span><span class="params">(ListNode* head)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> sum = <span class="number">0</span>;</span><br><span class="line">        ListNode dummy;</span><br><span class="line">        ListNode *move_dummy = &amp;dummy;</span><br><span class="line">        ListNode *move = head;</span><br><span class="line">        <span class="keyword">while</span>(move-&gt;next) &#123;</span><br><span class="line">            sum = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">while</span>(move-&gt;next &amp;&amp; move-&gt;next-&gt;val != <span class="number">0</span>) &#123;</span><br><span class="line">                sum += move-&gt;next-&gt;val;</span><br><span class="line">                move = move-&gt;next;</span><br><span class="line">            &#125;</span><br><span class="line">            move-&gt;val = sum;</span><br><span class="line">            move_dummy-&gt;next = move;</span><br><span class="line">            move_dummy = move_dummy-&gt;next;</span><br><span class="line">            move = move-&gt;next;</span><br><span class="line">            move_dummy-&gt;next = <span class="literal">nullptr</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dummy.next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="977-æœ‰åºæ•°ç»„çš„å¹³æ–¹"><a href="#977-æœ‰åºæ•°ç»„çš„å¹³æ–¹" class="headerlink" title="977. æœ‰åºæ•°ç»„çš„å¹³æ–¹"></a>977. æœ‰åºæ•°ç»„çš„å¹³æ–¹</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">sortedSquares</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> len = nums.<span class="built_in">size</span>();</span><br><span class="line">        <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">merged_array</span><span class="params">(len)</span></span>;</span><br><span class="line">        <span class="type">int</span> i = <span class="number">0</span>, j = len - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> k = len - <span class="number">1</span>; k &gt;= <span class="number">0</span>; k--) &#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">abs</span>(nums[i]) &gt; <span class="built_in">abs</span>(nums[j])) &#123;</span><br><span class="line">                merged_array[k] = nums[i] * nums[i];</span><br><span class="line">                i++;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                merged_array[k] = nums[j] * nums[j];</span><br><span class="line">                j--;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> merged_array;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li>æŒ‰ç…§ç»å¯¹å€¼å½’å¹¶</li><li>åŒæŒ‡é’ˆï¼Œä»å·¦å³ä¸¤ç«¯å¼€å§‹ç§»åŠ¨ï¼Œ</li></ul><h2 id="3174-æ¸…é™¤æ•°å­—"><a href="#3174-æ¸…é™¤æ•°å­—" class="headerlink" title="3174. æ¸…é™¤æ•°å­—"></a>3174. æ¸…é™¤æ•°å­—</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">string <span class="title">clearDigits</span><span class="params">(string s)</span> </span>&#123;</span><br><span class="line">        string res;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">char</span> c : s) &#123;</span><br><span class="line">            <span class="keyword">if</span>(!(c &gt;= <span class="string">&#x27;0&#x27;</span> &amp;&amp; c &lt;= <span class="string">&#x27;9&#x27;</span>)) &#123;</span><br><span class="line">                res.<span class="built_in">push_back</span>(c);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                res.<span class="built_in">pop_back</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li>æ¨¡æ‹Ÿ</li></ul><h2 id="2860-è®©æ‰€æœ‰å­¦ç”Ÿä¿æŒå¼€å¿ƒçš„åˆ†ç»„æ–¹æ³•æ•°"><a href="#2860-è®©æ‰€æœ‰å­¦ç”Ÿä¿æŒå¼€å¿ƒçš„åˆ†ç»„æ–¹æ³•æ•°" class="headerlink" title="2860. è®©æ‰€æœ‰å­¦ç”Ÿä¿æŒå¼€å¿ƒçš„åˆ†ç»„æ–¹æ³•æ•°"></a>2860. è®©æ‰€æœ‰å­¦ç”Ÿä¿æŒå¼€å¿ƒçš„åˆ†ç»„æ–¹æ³•æ•°</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">countWays</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        map&lt;<span class="type">int</span>, <span class="type">int</span>&gt; cnt;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> n : nums) &#123;</span><br><span class="line">            cnt[n]++;</span><br><span class="line">        &#125;</span><br><span class="line">        vector&lt;<span class="type">int</span>&gt; arr;</span><br><span class="line">        <span class="type">int</span> len = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> [num, total] : cnt) &#123;</span><br><span class="line">            arr.<span class="built_in">push_back</span>(num);</span><br><span class="line">            len++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> preSum = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(i &lt; len - <span class="number">1</span>) &#123;</span><br><span class="line">            preSum += cnt[arr[i]];</span><br><span class="line">            <span class="keyword">if</span>(preSum &lt; arr[i+<span class="number">1</span>] &amp;&amp; preSum &gt; arr[i]) &#123;</span><br><span class="line">                ans++;</span><br><span class="line">            &#125;</span><br><span class="line">            i++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans + <span class="number">1</span> + (arr[<span class="number">0</span>] == <span class="number">0</span> ? <span class="number">0</span> : <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h3><ul><li>å‡è®¾é€‰æ‹©äº†ç¬¬iä¸ªå­¦ç”Ÿï¼Œä»–çš„å¼€å¿ƒæ¡ä»¶æ˜¯<code>cnt &gt; nums[i]</code>ï¼Œé‚£ä¹ˆ<ul><li>æ‰€æœ‰æ»¡è¶³<code>nums[j] &lt;= nums[i]</code>çš„å­¦ç”Ÿéƒ½å¿…é¡»è¢«é€‰æ‹©</li><li>å¦‚æœå­˜åœ¨å­¦ç”Ÿ<code>j</code>ï¼Œ<code>nums[j] == nums[i] + 1</code>ï¼Œ<code>nums[k] == nums[j]</code>é‚£ä¹ˆæ»¡è¶³çš„å­¦ç”Ÿkéƒ½å¿…é¡»è¢«é€‰æ‹©</li><li>å…¶ä»–æƒ…å†µéƒ½ä¸éœ€è¦è€ƒè™‘ï¼Œæ˜¯ä¸€å®šæ— æ³•æ»¡è¶³æ¡ä»¶çš„</li></ul></li><li>åªè¦ç»Ÿè®¡æ¯ä¸ªnumå¯¹åº”å¤šå°‘å­¦ç”Ÿï¼ŒæŒ‰ç…§numæ’åºï¼Œ</li><li>å¯¹äºç¬¬iä¸ªnumï¼Œå¦‚æœé€‰æ‹©ä»–ï¼Œä»–ä¹‹å‰çš„å­¦ç”Ÿå¿…é¡»é€‰æ‹©<ul><li>å¦‚æœnum[i+1] &#x3D;&#x3D; num[i] + 1ï¼Œé‚£ä¹ˆæ— æ³•æ»¡è¶³ï¼Œæ˜¯ç©ºé›†</li><li>å¦‚æœnum[i+1] &gt; num[i] + 1ï¼Œé‚£ä¹ˆåªè¦ç´¯è®¡å­¦ç”Ÿè¶³å¤Ÿæ¡ä»¶ï¼Œå°±èƒ½æ»¡è¶³ï¼Œæ»¡è¶³çš„æƒ…æ™¯+1</li></ul></li><li>åˆ©ç”¨å‰ç¼€å’Œï¼Œè®°å½•numä»¥åŠå°äºnumçš„å­¦ç”Ÿæ•°ï¼Œå­¦ç”Ÿæ•°å¤§äºnum</li></ul><h2 id="3176-æ±‚å‡ºæœ€é•¿å¥½å­åºåˆ—-I"><a href="#3176-æ±‚å‡ºæœ€é•¿å¥½å­åºåˆ—-I" class="headerlink" title="3176. æ±‚å‡ºæœ€é•¿å¥½å­åºåˆ— I"></a>3176. æ±‚å‡ºæœ€é•¿å¥½å­åºåˆ— I</h2><h3 id="äºŒç»´dp"><a href="#äºŒç»´dp" class="headerlink" title="äºŒç»´dp"></a>äºŒç»´dp</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">maximumLength</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums, <span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> len = nums.<span class="built_in">size</span>();</span><br><span class="line">        vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; <span class="built_in">dp</span>(len, <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(k + <span class="number">1</span>));</span><br><span class="line">        <span class="type">int</span> maxLen = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">            dp[i][<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; i; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span>(nums[i] == nums[j]) &#123;</span><br><span class="line">                    dp[i][<span class="number">0</span>] = <span class="built_in">max</span>(dp[i][<span class="number">0</span>], dp[j][<span class="number">0</span>] + <span class="number">1</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            maxLen = <span class="built_in">max</span>(maxLen, dp[i][<span class="number">0</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">1</span>; j &lt;= k; j++) &#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> m = <span class="number">0</span>; m &lt; i; m++) &#123;</span><br><span class="line">                    <span class="keyword">if</span>(nums[i] == nums[m]) &#123;</span><br><span class="line">                        dp[i][j] = <span class="built_in">max</span>(dp[i][j], dp[m][j] + <span class="number">1</span>);</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        dp[i][j] = <span class="built_in">max</span>(dp[i][j], dp[m][j - <span class="number">1</span>] + <span class="number">1</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                maxLen = <span class="built_in">max</span>(maxLen, dp[i][j]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> maxLen;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li><code>dp[i][j]</code>ä»£è¡¨åˆ°ç¬¬<code>i</code>ä¸ªæ•°ä¸ºæ­¢ï¼Œæ°å¥½æœ‰<code>j</code>ä¸ªä¸åŒçš„æ•°çš„é•¿åº¦</li><li>è½¬ç§»æ–¹ç¨‹<ul><li>å¦‚æœ<code>nums[i] == nums[m]</code>ï¼Œä¸åŒçš„æ•°ç›¸åŒï¼Œ<code>j</code>ç›¸åŒ, <code>dp[i][j] = max(dp[i][j], dp[m]p[j])</code></li><li>å¦‚æœ<code>nums[i] != nums[m]</code>ï¼Œä¸åŒçš„æ•°ç›¸åŒï¼Œ<code>j</code>ä¸åŒï¼Œç›¸å·®1, <code>dp[i][j] = max(dp[i][j], dp[m][j-1])</code></li></ul></li></ul><h2 id="2552-ç»Ÿè®¡ä¸Šå‡å››å…ƒç»„"><a href="#2552-ç»Ÿè®¡ä¸Šå‡å››å…ƒç»„" class="headerlink" title="2552. ç»Ÿè®¡ä¸Šå‡å››å…ƒç»„"></a>2552. ç»Ÿè®¡ä¸Šå‡å››å…ƒç»„</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">long</span> <span class="type">long</span> <span class="title">countQuadruplets</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="type">long</span> <span class="type">long</span> ans = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> n = nums.<span class="built_in">size</span>();</span><br><span class="line">        vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; <span class="built_in">numsCnt</span>(n, <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(n+<span class="number">1</span>, <span class="number">0</span>));</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = n - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j = n - <span class="number">1</span>; j &gt; i; j--) &#123;</span><br><span class="line">                numsCnt[i][nums[j]]++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">1</span>; j &lt;= n; j++) &#123;</span><br><span class="line">                numsCnt[i][j] += numsCnt[i][j<span class="number">-1</span>];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="type">int</span> smallerThanMe = <span class="number">0</span>;</span><br><span class="line">            <span class="type">int</span> cntOfBiggerAfterMe = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j = i - <span class="number">1</span>; j &gt;= <span class="number">0</span>; j--) &#123;</span><br><span class="line">                <span class="keyword">if</span>(nums[j] &gt; nums[i]) &#123;</span><br><span class="line">                    cntOfBiggerAfterMe += (n - i - <span class="number">1</span>) - numsCnt[i][nums[j]];</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span>(nums[j] &lt; nums[i]) &#123;</span><br><span class="line">                    ans += cntOfBiggerAfterMe;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li>æƒ³ç”¨å•è°ƒé€’å¢æ ˆï¼Œè¿™æ ·æ ˆå†…ä¸¤ä¸ªç›¸é‚»å…ƒç´ ä¹‹é—´éƒ½æ˜¯æ¯”ä¸¤ä¸ªæ•°å¤§çš„ï¼Œåœ¨æ‰¾åˆ°ç¬¬ä¸‰ä¸ªå…ƒç´ åé¢æœ‰å¤šå°‘æ¯”ç¬¬äºŒä¸ªå…ƒç´ å¤§çš„æ•°ï¼Œå°±å¯ä»¥äº†</li><li>è¿™æ ·åªæ¯”æ ˆé¡¶ä¸¤ä¸ªå…ƒç´ ä¼šå¯¼è‡´é—æ¼ï¼Œç›´æ¥æ‰¾<code>nums[i]</code>å‰æ¯”<code>nums[i]</code>å°çš„æ•°<code>nums[j1]</code>ï¼Œå’Œä»–ä»¬ä¹‹é—´æ¯”<code>nums[i]</code>å¤§çš„æ•°<code>nums[j]</code>ï¼Œå†æ‰¾å‡ºæ¯ä¸ªæ•°åœ¨iåæœ‰å¤šå°‘æ¯”<code>nums[j]</code>å¤§çš„æ•°ï¼Œå¯ä»¥ç»Ÿè®¡åˆ°åˆ°æ¯”<code>nums[j1]</code>è¿˜å°çš„æ•°çš„ç»„åˆæƒ…å†µ</li><li><code>numsCnt[i][j]</code>è¡¨ç¤ºåœ¨å¼€åŒºé—´<code>(i, n)</code>ä¸­ï¼Œæœ‰å¤šå°‘æ¯”<code>nums[j]</code>å¤§çš„æ•°</li></ul><h2 id="2555-ä¸¤ä¸ªçº¿æ®µè·å¾—çš„æœ€å¤šå¥–å“"><a href="#2555-ä¸¤ä¸ªçº¿æ®µè·å¾—çš„æœ€å¤šå¥–å“" class="headerlink" title="2555. ä¸¤ä¸ªçº¿æ®µè·å¾—çš„æœ€å¤šå¥–å“"></a>2555. ä¸¤ä¸ªçº¿æ®µè·å¾—çš„æœ€å¤šå¥–å“</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">maximizeWin</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; prizePositions, <span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> n = prizePositions.<span class="built_in">size</span>();</span><br><span class="line">        vector&lt;<span class="type">int</span>&gt; windowSum;</span><br><span class="line">        vector&lt;<span class="type">int</span>&gt; windowStart;</span><br><span class="line">        <span class="type">int</span> prizeCnt = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(i &lt; n) &#123;</span><br><span class="line">            <span class="type">int</span> start = prizePositions[i];</span><br><span class="line">            <span class="type">int</span> end = prizePositions[i] + k;</span><br><span class="line">            <span class="keyword">while</span>(j &lt; n &amp;&amp; prizePositions[j] &lt;= end) &#123;</span><br><span class="line">                j++;</span><br><span class="line">                prizeCnt++;</span><br><span class="line">            &#125;</span><br><span class="line">            windowSum.<span class="built_in">push_back</span>(prizeCnt);</span><br><span class="line">            windowStart.<span class="built_in">push_back</span>(start);</span><br><span class="line">            <span class="keyword">while</span>(i &lt; n &amp;&amp; prizePositions[i] == start) &#123;</span><br><span class="line">                i++;</span><br><span class="line">                prizeCnt--;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> windowSize = windowSum.<span class="built_in">size</span>();</span><br><span class="line">        <span class="type">int</span> curMaxTail = windowSum[windowSize - <span class="number">1</span>];</span><br><span class="line">        <span class="type">int</span> curMaxStart = windowStart[windowSize - <span class="number">1</span>];</span><br><span class="line">        <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">maxTail</span><span class="params">(windowSize)</span></span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = windowSize - <span class="number">2</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">            maxTail[i] = curMaxTail;</span><br><span class="line">            <span class="keyword">if</span>(windowSum[i] &gt; curMaxTail) &#123;</span><br><span class="line">                curMaxTail = windowSum[i];</span><br><span class="line">                curMaxStart = windowStart[i];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line">        j = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; windowSize; i++) &#123;</span><br><span class="line">            <span class="keyword">while</span>(j &lt; windowSize &amp;&amp; windowStart[i] + k &gt;= windowStart[j]) &#123;</span><br><span class="line">                j++;</span><br><span class="line">            &#125;</span><br><span class="line">            j--;</span><br><span class="line">            <span class="keyword">if</span>(j &lt; n) ans = <span class="built_in">max</span>(ans, windowSum[i] + maxTail[j]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li>è™½ç„¶ä¸¤ä¸ªçº¿æ®µå¯ä»¥é‡å ï¼Œä½†æ˜¯é‡å éƒ¨åˆ†çš„å¥–å“ä¸èƒ½é‡å¤æ‹¿ï¼Œæ‰€ä»¥é—®é¢˜å°±å˜æˆäº†é•¿åº¦æœ€é•¿ä¸ºkçš„æƒ…å†µä¸‹ï¼Œä¸æƒ³äº¤çš„ä¸¤ä¸ªçº¿æ®µå†…ç¤¼ç‰©æ€»æ•°å’Œæœ€å¤§çš„æƒ…å†µ</li><li>æ‰¾å‡ºæ‰€æœ‰é•¿åº¦ä¸ºkçš„çº¿æ®µçš„ç¤¼ç‰©æ•°ï¼ˆ<code>start</code>ç›¸åŒçš„ä¸é‡å¤è®°å½•ï¼‰ï¼Œè®°å½•åœ¨<code>windowSum</code>ä¸­ï¼Œç”¨<code>windowStart</code>è®°å½•åŒºé—´çš„èµ·ç‚¹</li><li>ç”¨<code>maxTail[i]</code>è®°å½•èµ·å§‹ç‚¹ä¸º<code>windowStart[i]</code>çš„çº¿æ®µåæ–¹ï¼Œç¤¼ç‰©å¤šçš„çº¿æ®µçš„ç¤¼ç‰©ä¸ªæ•°</li><li>æœ€åå¯¹äºæ¯ä¸€ä¸ªçº¿æ®µï¼ŒåŒæŒ‡é’ˆæ‰¾åˆ°ä¸é‡å çš„ä¸‹ä¸€ä¸ªçº¿æ®µåŠå…¶åé¢çš„æœ€å¤§ç¤¼ç‰©æ•°ï¼ŒåŠ èµ·æ¥ï¼Œæ±‚æœ€å¤§å€¼</li></ul><h2 id="2332-åä¸Šå…¬äº¤çš„æœ€æ™šæ—¶é—´"><a href="#2332-åä¸Šå…¬äº¤çš„æœ€æ™šæ—¶é—´" class="headerlink" title="2332. åä¸Šå…¬äº¤çš„æœ€æ™šæ—¶é—´"></a>2332. åä¸Šå…¬äº¤çš„æœ€æ™šæ—¶é—´</h2><h3 id="äºŒåˆ†"><a href="#äºŒåˆ†" class="headerlink" title="äºŒåˆ†"></a>äºŒåˆ†</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">latestTimeCatchTheBus</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; buses, vector&lt;<span class="type">int</span>&gt;&amp; passengers, <span class="type">int</span> capacity)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">sort</span>(buses.<span class="built_in">begin</span>(), buses.<span class="built_in">end</span>());</span><br><span class="line">        <span class="built_in">sort</span>(passengers.<span class="built_in">begin</span>(), passengers.<span class="built_in">end</span>());</span><br><span class="line">        <span class="type">int</span> busNum = buses.<span class="built_in">size</span>();</span><br><span class="line">        <span class="type">int</span> passengersNum = passengers.<span class="built_in">size</span>();</span><br><span class="line">        <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">insertPoints</span><span class="params">(passengersNum)</span></span>;</span><br><span class="line">        insertPoints[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt; passengersNum; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(passengers[i] - passengers[i - <span class="number">1</span>] &gt; <span class="number">1</span>) &#123;</span><br><span class="line">                insertPoints[i] = i; <span class="comment">// ä¸å’Œå‰ä¸€ä¸ªè¿å·ï¼Œæ›´æ–°æœ€æ™šä¸Šè½¦ä½ç½®</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                insertPoints[i] = insertPoints[i - <span class="number">1</span>]; <span class="comment">// ä¸Šè½¦æ—¶é—´ä¸èƒ½å’Œåˆ«äººé‡å¤ï¼Œå¦‚æœè¿å·ï¼Œæ‰¾åˆ°å‰é¢ç¬¬ä¸€ä¸ªä¸è¿å·çš„ä½ç½®</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> lastestTime = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> j = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(; i &lt; busNum &amp;&amp; j &lt; passengersNum; i++) &#123; <span class="comment">// éå†å…¬äº¤è½¦</span></span><br><span class="line">            <span class="type">int</span> firstCantGetOn = <span class="built_in">upper_bound</span>(passengers.<span class="built_in">begin</span>() + j, passengers.<span class="built_in">end</span>(), buses[i]) - passengers.<span class="built_in">begin</span>(); <span class="comment">// äºŒåˆ†æ‰¾åˆ°ç¬¬ä¸€ä¸ªï¼Œæ—¶é—´ä¸Šæ— æ³•ä¸Šè½¦çš„äºº</span></span><br><span class="line">            <span class="type">int</span> getOnCnt = <span class="built_in">min</span>(firstCantGetOn - j, capacity);</span><br><span class="line">            <span class="keyword">if</span>(getOnCnt == <span class="number">0</span> &amp;&amp; capacity &gt; <span class="number">0</span>) &#123; <span class="comment">// å¦‚æœæ²¡æœ‰äººèƒ½ä¸Šï¼Œä¸”è½¦å®¹é‡å¤§äº0</span></span><br><span class="line">                lastestTime = buses[i]; <span class="comment">// æœ€æ™šå°±æ˜¯å…¬äº¤è½¦åˆ°ç«™æ—¶é—´</span></span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>(getOnCnt &lt; capacity &amp;&amp; buses[i] - passengers[j + getOnCnt - <span class="number">1</span>] &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="comment">// å¦‚æœä¸Šè½¦æ•°é‡å°äºå®¹é‡ï¼Œæœ€æ™šå¯ä»¥åœ¨å‘è½¦å‰åˆ°è¾¾ï¼Œä¸”æœ€åä¸€ä¸ªäººä¸æ˜¯åœ¨å‘è½¦æ—¶åˆ°è¾¾</span></span><br><span class="line">                lastestTime = buses[i];</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>(insertPoints[j + getOnCnt - <span class="number">1</span>] &gt;= j) &#123;</span><br><span class="line">                <span class="comment">// å¦‚æœå‰ä¸€ä¸ªå¯æ’å…¥ç‚¹åœ¨jæˆ–å…¶ä¹‹åï¼Œä¹Ÿå°±æ˜¯è¿™æ‰¹äººä¸­æœ‰æ’å…¥ç‚¹</span></span><br><span class="line">                lastestTime = passengers[insertPoints[j + getOnCnt - <span class="number">1</span>]] - <span class="number">1</span>;</span><br><span class="line">            &#125; <span class="comment">// else: æ²¡æœ‰æ’å…¥ç‚¹ï¼Œæ— æ³•ä¸Šè½¦ï¼Œä»€ä¹ˆéƒ½ä¸åš</span></span><br><span class="line">            j += getOnCnt;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(i &lt; busNum) &#123;</span><br><span class="line">            <span class="keyword">return</span> buses.<span class="built_in">back</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> lastestTime;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="1184-å…¬äº¤ç«™é—´çš„è·ç¦»"><a href="#1184-å…¬äº¤ç«™é—´çš„è·ç¦»" class="headerlink" title="1184. å…¬äº¤ç«™é—´çš„è·ç¦»"></a>1184. å…¬äº¤ç«™é—´çš„è·ç¦»</h2><h3 id="dijkstra"><a href="#dijkstra" class="headerlink" title="dijkstra"></a>dijkstra</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">distanceBetweenBusStops</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; distance, <span class="type">int</span> start, <span class="type">int</span> destination)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> n = distance.<span class="built_in">size</span>();</span><br><span class="line">        <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">dis</span><span class="params">(n, INT_MAX / <span class="number">2</span>)</span></span>;</span><br><span class="line">        dis[start] = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="function">vector&lt;<span class="type">bool</span>&gt; <span class="title">visited</span><span class="params">(n, <span class="literal">false</span>)</span></span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="type">int</span> firstClosestAndNotVisited = <span class="number">-1</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; n; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span>(!visited[j] &amp;&amp; (firstClosestAndNotVisited == <span class="number">-1</span> || dis[j] &lt; dis[firstClosestAndNotVisited])) &#123;</span><br><span class="line">                    firstClosestAndNotVisited = j;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">int</span> next = firstClosestAndNotVisited;</span><br><span class="line">            visited[next] = <span class="literal">true</span>;</span><br><span class="line">            dis[(next + <span class="number">1</span>) % n] = <span class="built_in">min</span>(dis[(next + <span class="number">1</span>) % n], distance[next] + dis[next]);</span><br><span class="line">            dis[(next - <span class="number">1</span> + n) % n] = <span class="built_in">min</span>(dis[(next - <span class="number">1</span> + n) % n], distance[(next - <span class="number">1</span> + n) % n] + dis[next]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dis[destination];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="ä¸€æ¬¡éå†"><a href="#ä¸€æ¬¡éå†" class="headerlink" title="ä¸€æ¬¡éå†"></a>ä¸€æ¬¡éå†</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">distanceBetweenBusStops</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; distance, <span class="type">int</span> start, <span class="type">int</span> destination)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> n = distance.<span class="built_in">size</span>();</span><br><span class="line">        <span class="type">int</span> counterClockWiseSum = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> clockWiseSum = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(start &gt; destination) &#123;</span><br><span class="line">            <span class="built_in">swap</span>(start, destination);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; start; i++) &#123;</span><br><span class="line">            counterClockWiseSum += distance[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = start; i &lt; destination; i++) &#123;</span><br><span class="line">            clockWiseSum += distance[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = destination; i &lt; n; i++) &#123;</span><br><span class="line">            counterClockWiseSum += distance[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">min</span>(clockWiseSum, counterClockWiseSum);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>ç”±äºåªæœ‰ä¸¤ä¸ªè·¯å¾„åˆ°è¾¾destinationï¼Œåªè¦è®¡ç®—é¡ºæ—¶é’ˆå’Œé€†æ—¶é’ˆçš„æ€»å’Œï¼Œå–æœ€å°å€¼å°±å¥½</p></blockquote><h2 id="2848-ä¸è½¦ç›¸äº¤çš„ç‚¹"><a href="#2848-ä¸è½¦ç›¸äº¤çš„ç‚¹" class="headerlink" title="2848. ä¸è½¦ç›¸äº¤çš„ç‚¹"></a>2848. ä¸è½¦ç›¸äº¤çš„ç‚¹</h2><h3 id="å·®åˆ†æ•°ç»„"><a href="#å·®åˆ†æ•°ç»„" class="headerlink" title="å·®åˆ†æ•°ç»„"></a>å·®åˆ†æ•°ç»„</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">numberOfPoints</span><span class="params">(vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> n = nums.<span class="built_in">size</span>();</span><br><span class="line">        <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">diff</span><span class="params">(<span class="number">102</span>)</span></span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            diff[nums[i][<span class="number">0</span>]]++;</span><br><span class="line">            diff[nums[i][<span class="number">1</span>] + <span class="number">1</span>]--;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> curVal = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> cnt = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">100</span>; i++) &#123;</span><br><span class="line">            curVal += diff[i];</span><br><span class="line">            <span class="keyword">if</span>(curVal &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                cnt++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> cnt;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="æ’åºè´ªå¿ƒ"><a href="#æ’åºè´ªå¿ƒ" class="headerlink" title="æ’åºè´ªå¿ƒ"></a>æ’åºè´ªå¿ƒ</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">numberOfPoints</span><span class="params">(vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> n = nums.<span class="built_in">size</span>();</span><br><span class="line">        <span class="built_in">sort</span>(nums.<span class="built_in">begin</span>(), nums.<span class="built_in">end</span>(), [](vector&lt;<span class="type">int</span>&gt;&amp; a, vector&lt;<span class="type">int</span>&gt;&amp; b)&#123; <span class="keyword">return</span> a[<span class="number">0</span>] &lt; b[<span class="number">0</span>]; &#125;);</span><br><span class="line">        <span class="type">int</span> curStart = nums[<span class="number">0</span>][<span class="number">0</span>], curEnd = nums[<span class="number">0</span>][<span class="number">1</span>];</span><br><span class="line">        <span class="type">int</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> cnt = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(nums[i][<span class="number">0</span>] &gt; curEnd) &#123;</span><br><span class="line">                cnt += curEnd - curStart + <span class="number">1</span>;</span><br><span class="line">                curStart = nums[i][<span class="number">0</span>];</span><br><span class="line">                curEnd = nums[i][<span class="number">1</span>];</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                curEnd = <span class="built_in">max</span>(curEnd, nums[i][<span class="number">1</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> cnt + (curEnd - curStart + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;2181-åˆå¹¶é›¶ä¹‹é—´çš„èŠ‚ç‚¹&quot;&gt;&lt;a href=&quot;#2181-åˆå¹¶é›¶ä¹‹é—´çš„èŠ‚ç‚¹&quot; class=&quot;headerlink&quot; title=&quot;2181. åˆå¹¶é›¶ä¹‹é—´çš„èŠ‚ç‚¹&quot;&gt;&lt;/a&gt;2181. åˆå¹¶é›¶ä¹‹é—´çš„èŠ‚ç‚¹&lt;/h2&gt;&lt;figure class=&quot;highlight c++&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title class_&quot;&gt;Solution&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;ListNode* &lt;span class=&quot;title&quot;&gt;mergeNodes&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(ListNode* head)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; sum = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ListNode dummy;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ListNode *move_dummy = &amp;amp;dummy;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ListNode *move = head;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;while&lt;/span&gt;(move-&amp;gt;next) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            sum = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;while&lt;/span&gt;(move-&amp;gt;next &amp;amp;&amp;amp; move-&amp;gt;next-&amp;gt;val != &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                sum += move-&amp;gt;next-&amp;gt;val;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                move = move-&amp;gt;next;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            move-&amp;gt;val = sum;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            move_dummy-&amp;gt;next = move;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            move_dummy = move_dummy-&amp;gt;next;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            move = move-&amp;gt;next;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            move_dummy-&amp;gt;next = &lt;span class=&quot;literal&quot;&gt;nullptr&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; dummy.next;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h2 id=&quot;977-æœ‰åºæ•°ç»„çš„å¹³æ–¹&quot;&gt;&lt;a href=&quot;#977-æœ‰åºæ•°ç»„çš„å¹³æ–¹&quot; class=&quot;headerlink&quot; title=&quot;977. æœ‰åºæ•°ç»„çš„å¹³æ–¹&quot;&gt;&lt;/a&gt;977. æœ‰åºæ•°ç»„çš„å¹³æ–¹&lt;/h2&gt;&lt;figure class=&quot;highlight c++&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title class_&quot;&gt;Solution&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;vector&amp;lt;&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt;&amp;gt; &lt;span class=&quot;title&quot;&gt;sortedSquares&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(vector&amp;lt;&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt;&amp;gt;&amp;amp; nums)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; len = nums.&lt;span class=&quot;built_in&quot;&gt;size&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;function&quot;&gt;vector&amp;lt;&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt;&amp;gt; &lt;span class=&quot;title&quot;&gt;merged_array&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(len)&lt;/span&gt;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; i = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, j = len - &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; k = len - &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;; k &amp;gt;= &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;; k--) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(&lt;span class=&quot;built_in&quot;&gt;abs&lt;/span&gt;(nums[i]) &amp;gt; &lt;span class=&quot;built_in&quot;&gt;abs&lt;/span&gt;(nums[j])) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                merged_array[k] = nums[i] * nums[i];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                i++;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                merged_array[k] = nums[j] * nums[j];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                j--;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; merged_array;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;ul&gt;
&lt;li&gt;æŒ‰ç…§ç»å¯¹å€¼å½’å¹¶&lt;/li&gt;
&lt;li&gt;åŒæŒ‡é’ˆï¼Œä»å·¦å³ä¸¤ç«¯å¼€å§‹ç§»åŠ¨ï¼Œ&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;3174-æ¸…é™¤æ•°å­—&quot;&gt;&lt;a href=&quot;#3174-æ¸…é™¤æ•°å­—&quot; class=&quot;headerlink&quot; title=&quot;3174. æ¸…é™¤æ•°å­—&quot;&gt;&lt;/a&gt;3174. æ¸…é™¤æ•°å­—&lt;/h2&gt;</summary>
    
    
    
    <category term="LeetCode" scheme="https://jingtianer.github.io/home/categories/LeetCode/"/>
    
    <category term="ç®—æ³•" scheme="https://jingtianer.github.io/home/categories/LeetCode/%E7%AE%97%E6%B3%95/"/>
    
    
    <category term="LeetCode" scheme="https://jingtianer.github.io/home/tags/LeetCode/"/>
    
    <category term="ç®—æ³•" scheme="https://jingtianer.github.io/home/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>ç‰›å®¢åˆ·é¢˜-2</title>
    <link href="https://jingtianer.github.io/home/2024/09/03/%E7%89%9B%E5%AE%A2/%E7%89%9B%E5%AE%A2%E5%88%B7%E9%A2%98-2/"/>
    <id>https://jingtianer.github.io/home/2024/09/03/%E7%89%9B%E5%AE%A2/%E7%89%9B%E5%AE%A2%E5%88%B7%E9%A2%98-2/</id>
    <published>2024-09-03T13:15:36.000Z</published>
    <updated>2025-04-15T02:37:55.628Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-å°ç¾çš„å¹³è¡¡çŸ©é˜µ"><a href="#1-å°ç¾çš„å¹³è¡¡çŸ©é˜µ" class="headerlink" title="1.å°ç¾çš„å¹³è¡¡çŸ©é˜µ"></a>1.å°ç¾çš„å¹³è¡¡çŸ©é˜µ</h2><div data-v-5e687804="" class="" data-v-368446cc=""><div data-v-55713a8e="" data-v-5e687804="" class="tw-mb-5"><!---->  <div data-v-2b881dd3="" data-v-55713a8e="" class="question-info question-info"><div data-v-2b881dd3="" class="codingTitleClass tw-flex"><div data-v-2b881dd3="" class="tw-mr-1 tw-h-7 tw-leading-7">1.</div> <div data-v-2b881dd3="" class="commonPaperHtml tw-flex-1 tw-w-0">å°ç¾çš„å¹³è¡¡çŸ©é˜µ</div></div> <div data-v-2b881dd3="" class="commonPaperHtml codingContentClass">å°ç¾æ‹¿åˆ°äº†ä¸€ä¸ª<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi><mo>âˆ—</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">n*n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.46528em;vertical-align:0em;"></span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">n</span></span></span></span>çš„çŸ©é˜µï¼Œå…¶ä¸­æ¯ä¸ªå…ƒç´ æ˜¯ 0 æˆ–è€… 1ã€‚<br>å°ç¾è®¤ä¸ºä¸€ä¸ªçŸ©å½¢åŒºåŸŸæ˜¯å®Œç¾çš„ï¼Œå½“ä¸”ä»…å½“è¯¥åŒºåŸŸå†… 0 çš„æ•°é‡æ°å¥½ç­‰äº 1 çš„æ•°é‡ã€‚<br>ç°åœ¨ï¼Œå°ç¾å¸Œæœ›ä½ å›ç­”æœ‰å¤šå°‘ä¸ª<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi><mo>âˆ—</mo><mi>i</mi></mrow><annotation encoding="application/x-tex">i*i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathdefault">i</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathdefault">i</span></span></span></span>çš„å®Œç¾çŸ©å½¢åŒºåŸŸã€‚ä½ éœ€è¦å›ç­”<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn><mo>â‰¤</mo><mi>i</mi><mo>â‰¤</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">1\leq i \leq n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.78041em;vertical-align:-0.13597em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.79549em;vertical-align:-0.13597em;"></span><span class="mord mathdefault">i</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">n</span></span></span></span>çš„æ‰€æœ‰ç­”æ¡ˆã€‚</div></div></div> <div data-v-5e687804="" class="description-wrap tw-mt-3"><div data-v-5e687804="">æ—¶é—´é™åˆ¶ï¼šC/C++ 1ç§’ï¼Œå…¶ä»–è¯­è¨€2ç§’</div> <div data-v-5e687804="" class="tw-mt-2">ç©ºé—´é™åˆ¶ï¼šC/C++ 256Mï¼Œå…¶ä»–è¯­è¨€512M</div></div> <div data-v-5e687804="" class="item-title">è¾“å…¥æè¿°ï¼š</div> <pre data-v-5e687804="" class="description-wrap tw-whitespace-pre-wrap tw-break-all">ç¬¬ä¸€è¡Œè¾“å…¥ä¸€ä¸ªæ­£æ•´æ•°<img src="https://hr.nowcoder.com/equation?tex=n" alt="n">ï¼Œä»£è¡¨çŸ©é˜µå¤§å°ã€‚<br>æ¥ä¸‹æ¥çš„<img src="https://hr.nowcoder.com/equation?tex=n" alt="n">è¡Œï¼Œæ¯è¡Œè¾“å…¥ä¸€ä¸ªé•¿åº¦ä¸º<img src="https://hr.nowcoder.com/equation?tex=n" alt="n">çš„ 01 ä¸²ï¼Œç”¨æ¥è¡¨ç¤ºçŸ©é˜µã€‚<br><img src="https://hr.nowcoder.com/equation?tex=1%5Cleq%20n%20%5Cleq%20200" alt="1\leq n \leq 200"></pre> <div data-v-5e687804="" class="item-title">è¾“å‡ºæè¿°ï¼š</div> <pre data-v-5e687804="" class="description-wrap tw-whitespace-pre-wrap tw-break-all">è¾“å‡º<img src="https://hr.nowcoder.com/equation?tex=n" alt="n">è¡Œï¼Œç¬¬<img src="https://hr.nowcoder.com/equation?tex=i" alt="i">è¡Œè¾“å‡º<img src="https://hr.nowcoder.com/equation?tex=i*i" alt="i*i">çš„å®Œç¾çŸ©å½¢åŒºåŸŸçš„æ•°é‡ã€‚</pre> <div data-v-5e687804=""><div data-v-5e687804="" class="item-title">ç¤ºä¾‹1</div> <div data-v-5e687804="" class="description-wrap"><div data-v-5e687804="" class="tw-flex tw-items-start tw-flex-wrap"><span data-v-5e687804="" class="tw-flex-shrink-0">è¾“å…¥ä¾‹å­ï¼š</span> <pre data-v-5e687804="" class="tw-whitespace-pre-wrap tw-break-all">41010010111000011</pre></div> <div data-v-5e687804="" class="tw-mt-2 tw-flex tw-items-start tw-flex-wrap"><span data-v-5e687804="" class="tw-flex-shrink-0">è¾“å‡ºä¾‹å­ï¼š</span> <pre data-v-5e687804="" class="tw-whitespace-pre-wrap tw-break-all">0701</pre></div> <!----></div></div> <!----></div><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; <span class="built_in">preSum</span>(n, <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(n+<span class="number">1</span>));</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        string s;</span><br><span class="line">        cin &gt;&gt; s;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; n; j++) &#123;</span><br><span class="line">            preSum[i][j+<span class="number">1</span>] = preSum[i][j] + (s[j] - <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> window = <span class="number">1</span>; window &lt;= n; window++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(window &amp; <span class="number">1</span>) &#123;</span><br><span class="line">            cout &lt;&lt; <span class="string">&quot;0\n&quot;</span>;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> perfect = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt;= n - window; j++) &#123;</span><br><span class="line">            <span class="type">int</span> sum = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; window; i++) &#123;</span><br><span class="line">                sum += preSum[i][window + j] - preSum[i][j];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(sum * <span class="number">2</span> == window * window) &#123;</span><br><span class="line">                perfect++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i = window; i &lt; n; i++) &#123;</span><br><span class="line">                sum -= preSum[i - window][window + j] - preSum[i - window][j];</span><br><span class="line">                sum += preSum[i][window + j] - preSum[i][j];</span><br><span class="line">                <span class="keyword">if</span>(sum * <span class="number">2</span> == window * window) &#123;</span><br><span class="line">                    perfect++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        cout &lt;&lt; perfect &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-å°ç¾çš„æ•°ç»„è¯¢é—®"><a href="#2-å°ç¾çš„æ•°ç»„è¯¢é—®" class="headerlink" title="2.å°ç¾çš„æ•°ç»„è¯¢é—®"></a>2.å°ç¾çš„æ•°ç»„è¯¢é—®</h2><div data-v-5e687804="" class="" data-v-368446cc=""><div data-v-55713a8e="" data-v-5e687804="" class="tw-mb-5"><!---->  <div data-v-2b881dd3="" data-v-55713a8e="" class="question-info question-info"><div data-v-2b881dd3="" class="codingTitleClass tw-flex"><div data-v-2b881dd3="" class="tw-mr-1 tw-h-7 tw-leading-7">2.</div> <div data-v-2b881dd3="" class="commonPaperHtml tw-flex-1 tw-w-0">å°ç¾çš„æ•°ç»„è¯¢é—®</div></div> <div data-v-2b881dd3="" class="commonPaperHtml codingContentClass">å°ç¾æ‹¿åˆ°äº†ä¸€ä¸ªç”±æ­£æ•´æ•°ç»„æˆçš„æ•°ç»„ï¼Œä½†å…¶ä¸­æœ‰ä¸€äº›å…ƒç´ æ˜¯æœªçŸ¥çš„ï¼ˆç”¨ 0 æ¥è¡¨ç¤ºï¼‰ã€‚<br>ç°åœ¨å°ç¾æƒ³çŸ¥é“ï¼Œå¦‚æœé‚£äº›æœªçŸ¥çš„å…ƒç´ åœ¨åŒºé—´<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo stretchy="false">[</mo><mi>l</mi><mo separator="true">,</mo><mi>r</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[l,r]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mclose">]</span></span></span></span>èŒƒå›´å†…éšæœºå–å€¼çš„è¯ï¼Œæ•°ç»„æ‰€æœ‰å…ƒç´ ä¹‹å’Œçš„æœ€å°å€¼å’Œæœ€å¤§å€¼åˆ†åˆ«æ˜¯å¤šå°‘ï¼Ÿ<br>å…±æœ‰<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>q</mi></mrow><annotation encoding="application/x-tex">q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">q</span></span></span></span>æ¬¡è¯¢é—®ã€‚</div></div></div> <div data-v-5e687804="" class="description-wrap tw-mt-3"><div data-v-5e687804="">æ—¶é—´é™åˆ¶ï¼šC/C++ 1ç§’ï¼Œå…¶ä»–è¯­è¨€2ç§’</div> <div data-v-5e687804="" class="tw-mt-2">ç©ºé—´é™åˆ¶ï¼šC/C++ 256Mï¼Œå…¶ä»–è¯­è¨€512M</div></div> <div data-v-5e687804="" class="item-title">è¾“å…¥æè¿°ï¼š</div> <pre data-v-5e687804="" class="description-wrap tw-whitespace-pre-wrap tw-break-all">ç¬¬ä¸€è¡Œè¾“å…¥ä¸¤ä¸ªæ­£æ•´æ•°<img src="https://hr.nowcoder.com/equation?tex=n%2Cq" alt="n,q">ï¼Œä»£è¡¨æ•°ç»„å¤§å°å’Œè¯¢é—®æ¬¡æ•°ã€‚<br>ç¬¬äºŒè¡Œè¾“å…¥<img src="https://hr.nowcoder.com/equation?tex=n" alt="n">ä¸ªæ•´æ•°<img src="https://hr.nowcoder.com/equation?tex=a_i" alt="a_i">ï¼Œå…¶ä¸­å¦‚æœè¾“å…¥çš„<img src="https://hr.nowcoder.com/equation?tex=a_i" alt="a_i">ä¸º 0ï¼Œé‚£ä¹ˆè¯´æ˜<img src="https://hr.nowcoder.com/equation?tex=a_i" alt="a_i">æ˜¯æœªçŸ¥çš„ã€‚<br>æ¥ä¸‹æ¥çš„<img src="https://hr.nowcoder.com/equation?tex=q" alt="q">è¡Œï¼Œæ¯è¡Œè¾“å…¥ä¸¤ä¸ªæ­£æ•´æ•° <img src="https://hr.nowcoder.com/equation?tex=l%2Cr" alt="l,r">ï¼Œä»£è¡¨ä¸€æ¬¡è¯¢é—®ã€‚<br><img src="https://hr.nowcoder.com/equation?tex=1%5Cleq%20n%2Cq%20%5Cleq%2010%5E5" alt="1\leq n,q \leq 10^5"><br><img src="https://hr.nowcoder.com/equation?tex=0%20%5Cleq%20a_i%20%5Cleq%2010%5E9" alt="0 \leq a_i \leq 10^9"><br><img src="https://hr.nowcoder.com/equation?tex=1%5Cleq%20l%20%5Cleq%20r%20%5Cleq%2010%5E9" alt="1\leq l \leq r \leq 10^9"></pre> <div data-v-5e687804="" class="item-title">è¾“å‡ºæè¿°ï¼š</div> <pre data-v-5e687804="" class="description-wrap tw-whitespace-pre-wrap tw-break-all">è¾“å‡º<img src="https://hr.nowcoder.com/equation?tex=q" alt="q">è¡Œï¼Œæ¯è¡Œè¾“å‡ºä¸¤ä¸ªæ­£æ•´æ•°ï¼Œä»£è¡¨æ‰€æœ‰å…ƒç´ ä¹‹å’Œçš„æœ€å°å€¼å’Œæœ€å¤§å€¼ã€‚</pre> <div data-v-5e687804=""><div data-v-5e687804="" class="item-title">ç¤ºä¾‹1</div> <div data-v-5e687804="" class="description-wrap"><div data-v-5e687804="" class="tw-flex tw-items-start tw-flex-wrap"><span data-v-5e687804="" class="tw-flex-shrink-0">è¾“å…¥ä¾‹å­ï¼š</span> <pre data-v-5e687804="" class="tw-whitespace-pre-wrap tw-break-all">3 21 0 31 24 4</pre></div> <div data-v-5e687804="" class="tw-mt-2 tw-flex tw-items-start tw-flex-wrap"><span data-v-5e687804="" class="tw-flex-shrink-0">è¾“å‡ºä¾‹å­ï¼š</span> <pre data-v-5e687804="" class="tw-whitespace-pre-wrap tw-break-all">5 68 8</pre></div> <div data-v-5e687804="" class="tw-mt-2 tw-flex tw-items-start tw-flex-wrap"><span data-v-5e687804="" class="tw-flex-shrink-0">ä¾‹å­è¯´æ˜ï¼š</span> <pre data-v-5e687804="" class="example-desc tw-break-all tw-whitespace-pre-wrap">åªæœ‰ç¬¬äºŒä¸ªå…ƒç´ æ˜¯æœªçŸ¥çš„ã€‚<br>ç¬¬ä¸€æ¬¡è¯¢é—®ï¼Œæ•°ç»„æœ€å°çš„å’Œæ˜¯ 1+1+3=5ï¼Œæœ€å¤§çš„å’Œæ˜¯ 1+2+3=6ã€‚<br>ç¬¬äºŒæ¬¡è¯¢é—®ï¼Œæ˜¾ç„¶æ•°ç»„çš„å…ƒç´ å’Œå¿…ç„¶ä¸º 8ã€‚<br><div><br></div></pre></div></div></div> <!----></div><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> n, q;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; q;</span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> sum = <span class="number">0</span>;</span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> zeroCnt = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="type">int</span> ai;</span><br><span class="line">        cin &gt;&gt; ai;</span><br><span class="line">        zeroCnt += (ai == <span class="number">0</span> ? <span class="number">1</span> : <span class="number">0</span>);</span><br><span class="line">        sum += ai;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; q; i++) &#123;</span><br><span class="line">        <span class="type">int</span> l, r;</span><br><span class="line">        cin &gt;&gt; l &gt;&gt; r;</span><br><span class="line">        cout &lt;&lt; sum + zeroCnt*l &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; sum + zeroCnt*r &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-å°ç¾çš„-MT"><a href="#3-å°ç¾çš„-MT" class="headerlink" title="3.å°ç¾çš„ MT"></a>3.å°ç¾çš„ MT</h2><div data-v-5e687804="" class="" data-v-368446cc=""><div data-v-55713a8e="" data-v-5e687804="" class="tw-mb-5"><!---->  <div data-v-2b881dd3="" data-v-55713a8e="" class="question-info question-info"><div data-v-2b881dd3="" class="codingTitleClass tw-flex"><div data-v-2b881dd3="" class="tw-mr-1 tw-h-7 tw-leading-7">3.</div> <div data-v-2b881dd3="" class="commonPaperHtml tw-flex-1 tw-w-0">å°ç¾çš„ MT</div></div> <div data-v-2b881dd3="" class="commonPaperHtml codingContentClass">MT æ˜¯ç¾å›¢çš„ç¼©å†™ï¼Œå› æ­¤å°ç¾å¾ˆå–œæ¬¢è¿™ä¸¤ä¸ªå­—æ¯ã€‚<br>ç°åœ¨å°ç¾æ‹¿åˆ°äº†ä¸€ä¸ªä»…ç”±å¤§å†™å­—æ¯ç»„æˆå­—ç¬¦ä¸²ï¼Œå¥¹å¯ä»¥æœ€å¤šæ“ä½œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span></span></span></span>æ¬¡ï¼Œæ¯æ¬¡å¯ä»¥ä¿®æ”¹ä»»æ„ä¸€ä¸ªå­—ç¬¦ã€‚å°ç¾æƒ³çŸ¥é“ï¼Œæ“ä½œç»“æŸåæœ€å¤šå…±æœ‰å¤šå°‘ä¸ª'M'å’Œ'T'å­—ç¬¦ï¼Ÿ</div></div></div> <div data-v-5e687804="" class="description-wrap tw-mt-3"><div data-v-5e687804="">æ—¶é—´é™åˆ¶ï¼šC/C++ 1ç§’ï¼Œå…¶ä»–è¯­è¨€2ç§’</div> <div data-v-5e687804="" class="tw-mt-2">ç©ºé—´é™åˆ¶ï¼šC/C++ 256Mï¼Œå…¶ä»–è¯­è¨€512M</div></div> <div data-v-5e687804="" class="item-title">è¾“å…¥æè¿°ï¼š</div> <pre data-v-5e687804="" class="description-wrap tw-whitespace-pre-wrap tw-break-all">ç¬¬ä¸€è¡Œè¾“å…¥ä¸¤ä¸ªæ­£æ•´æ•°<img src="https://hr.nowcoder.com/equation?tex=n%2Ck" alt="n,k">ï¼Œä»£è¡¨å­—ç¬¦ä¸²é•¿åº¦å’Œæ“ä½œæ¬¡æ•°ã€‚<br>ç¬¬äºŒè¡Œè¾“å…¥ä¸€ä¸ªé•¿åº¦ä¸º<img src="https://hr.nowcoder.com/equation?tex=n" alt="n">çš„ã€ä»…ç”±å¤§å†™å­—æ¯ç»„æˆçš„å­—ç¬¦ä¸²ã€‚<br><img src="https://hr.nowcoder.com/equation?tex=1%5Cleq%20k%20%5Cleq%20n%20%5Cleq%2010%5E5" alt="1\leq k \leq n \leq 10^5"></pre> <div data-v-5e687804="" class="item-title">è¾“å‡ºæè¿°ï¼š</div> <pre data-v-5e687804="" class="description-wrap tw-whitespace-pre-wrap tw-break-all">è¾“å‡º<span>æ“ä½œç»“æŸåæœ€å¤šå…±æœ‰å¤šå°‘ä¸ª'M'å’Œ'T'å­—ç¬¦ã€‚</span></pre> <div data-v-5e687804=""><div data-v-5e687804="" class="item-title">ç¤ºä¾‹1</div> <div data-v-5e687804="" class="description-wrap"><div data-v-5e687804="" class="tw-flex tw-items-start tw-flex-wrap"><span data-v-5e687804="" class="tw-flex-shrink-0">è¾“å…¥ä¾‹å­ï¼š</span> <pre data-v-5e687804="" class="tw-whitespace-pre-wrap tw-break-all">5 2MTUAN</pre></div> <div data-v-5e687804="" class="tw-mt-2 tw-flex tw-items-start tw-flex-wrap"><span data-v-5e687804="" class="tw-flex-shrink-0">è¾“å‡ºä¾‹å­ï¼š</span> <pre data-v-5e687804="" class="tw-whitespace-pre-wrap tw-break-all">4</pre></div> <div data-v-5e687804="" class="tw-mt-2 tw-flex tw-items-start tw-flex-wrap"><span data-v-5e687804="" class="tw-flex-shrink-0">ä¾‹å­è¯´æ˜ï¼š</span> <pre data-v-5e687804="" class="example-desc tw-break-all tw-whitespace-pre-wrap">ä¿®æ”¹ç¬¬ä¸‰ä¸ªå’Œç¬¬äº”ä¸ªå­—ç¬¦ï¼Œå½¢æˆçš„å­—ç¬¦ä¸²ä¸º MTTAMï¼Œè¿™æ ·å…±æœ‰ 4 ä¸ª'M'å’Œ'T'ã€‚</pre></div></div></div> <!----></div><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> n, k;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; k;</span><br><span class="line">    <span class="type">int</span> cnt = <span class="number">0</span>;</span><br><span class="line">    cin.<span class="built_in">get</span>();</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="type">char</span> c = cin.<span class="built_in">get</span>();</span><br><span class="line">        <span class="keyword">if</span>(c != <span class="string">&#x27;M&#x27;</span> &amp;&amp; c != <span class="string">&#x27;T&#x27;</span>) cnt++;</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt;  n - cnt + <span class="built_in">min</span>(k, cnt) &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 64 ä½è¾“å‡ºè¯·ç”¨ printf(&quot;%lld&quot;)</span></span><br></pre></td></tr></table></figure><h2 id="4-å°ç¾çš„æœ‹å‹å…³ç³»"><a href="#4-å°ç¾çš„æœ‹å‹å…³ç³»" class="headerlink" title="4. å°ç¾çš„æœ‹å‹å…³ç³»"></a>4. å°ç¾çš„æœ‹å‹å…³ç³»</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UnionSet</span> &#123;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; array;</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">UnionSet</span>(vector&lt;set&lt;<span class="type">int</span>&gt;&gt; graph, <span class="type">int</span> n): <span class="built_in">array</span>(n) &#123;</span><br><span class="line">        <span class="built_in">iota</span>(array.<span class="built_in">begin</span>(), array.<span class="built_in">end</span>(), <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> u = <span class="number">0</span>; u &lt; n; u++) &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> v : graph[u]) &#123;</span><br><span class="line">                <span class="built_in">Union</span>(u, v);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">UnionSet</span>(<span class="type">const</span> vector&lt;set&lt;<span class="type">int</span>&gt;&gt;&amp; graph): <span class="built_in">UnionSet</span>(graph, graph.<span class="built_in">size</span>()) &#123;&#125;</span><br><span class="line">    <span class="built_in">UnionSet</span>(<span class="type">int</span> n): <span class="built_in">array</span>(n) &#123;</span><br><span class="line">        <span class="built_in">iota</span>(array.<span class="built_in">begin</span>(), array.<span class="built_in">end</span>(), <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">Find</span><span class="params">(<span class="type">int</span> u)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> u == array[u] ? u : (array[u] = <span class="built_in">Find</span>(array[u]));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">Union</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> v)</span> </span>&#123;</span><br><span class="line">        array[<span class="built_in">Find</span>(u)] = <span class="built_in">Find</span>(v);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">Query</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> v)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Find</span>(u) == <span class="built_in">Find</span>(v);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> n, m, q;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m &gt;&gt; q;</span><br><span class="line">    vector&lt;set&lt;<span class="type">int</span>&gt;&gt; <span class="built_in">graph</span>(n);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">        <span class="type">int</span> u, v;</span><br><span class="line">        cin &gt;&gt; u &gt;&gt; v;</span><br><span class="line">        u--;</span><br><span class="line">        v--;</span><br><span class="line">        graph[u].<span class="built_in">insert</span>(v);</span><br><span class="line">        graph[v].<span class="built_in">insert</span>(u);</span><br><span class="line">    &#125;</span><br><span class="line">    vector&lt;tuple&lt;<span class="type">int</span>, <span class="type">int</span>, <span class="type">int</span>&gt;&gt; ops;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; q; i++) &#123;</span><br><span class="line">        <span class="type">int</span> op, u, v;</span><br><span class="line">        cin &gt;&gt; op &gt;&gt; u &gt;&gt; v;</span><br><span class="line">        u--;</span><br><span class="line">        v--;</span><br><span class="line">        ops.<span class="built_in">emplace_back</span>(op, u, v);</span><br><span class="line">        <span class="keyword">if</span>(op == <span class="number">1</span>) &#123;</span><br><span class="line">            graph[u].<span class="built_in">erase</span>(v);</span><br><span class="line">            graph[v].<span class="built_in">erase</span>(u);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">UnionSet <span class="title">unionSet</span><span class="params">(graph, n)</span></span>;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; ans;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> ite = ops.<span class="built_in">rbegin</span>(); ite != ops.<span class="built_in">rend</span>(); ite++) &#123;</span><br><span class="line">        <span class="keyword">auto</span> [op, u, v] = *ite;</span><br><span class="line">        <span class="keyword">if</span>(op == <span class="number">1</span>) &#123;</span><br><span class="line">            unionSet.<span class="built_in">Union</span>(u, v);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(op == <span class="number">2</span>) &#123;</span><br><span class="line">            ans.<span class="built_in">push_back</span>(unionSet.<span class="built_in">Query</span>(u, v));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> ite = ans.<span class="built_in">rbegin</span>(); ite != ans.<span class="built_in">rend</span>(); ite++) &#123;</span><br><span class="line">        cout &lt;&lt; (*ite ? <span class="string">&quot;Yes\n&quot;</span> : <span class="string">&quot;No\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>åå‘å¹¶æŸ¥é›†ï¼Œå€’ç€è®¡ç®—ç­”æ¡ˆ</li><li>å…ˆæŠŠè¦åˆ é™¤çš„å…³ç³»å…¨éƒ¨åˆ é™¤ï¼Œç„¶åå€’åºå°†åˆ é™¤çš„å…³ç³»è¿˜åŸ</li></ul><h2 id="5-å°ç¾çš„åŒºé—´åˆ é™¤"><a href="#5-å°ç¾çš„åŒºé—´åˆ é™¤" class="headerlink" title="5 å°ç¾çš„åŒºé—´åˆ é™¤"></a>5 å°ç¾çš„åŒºé—´åˆ é™¤</h2><div class="left" data-v-368446cc=""><div data-v-5e687804="" data-v-368446cc="" class=""><div class="tw-mb-5" data-v-55713a8e="" data-v-5e687804=""><!---->  <div class="question-info question-info" data-v-2b881dd3="" data-v-55713a8e=""><div class="codingTitleClass tw-flex" data-v-2b881dd3=""><div class="tw-mr-1 tw-h-7 tw-leading-7" data-v-2b881dd3="">5.</div> <div class="commonPaperHtml tw-flex-1 tw-w-0" data-v-2b881dd3="">å°ç¾çš„åŒºé—´åˆ é™¤</div></div> <div data-v-2b881dd3="" class="commonPaperHtml codingContentClass">å°ç¾æ‹¿åˆ°äº†ä¸€ä¸ªå¤§å°ä¸º<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">n</span></span></span></span>çš„æ•°ç»„ï¼Œå¥¹å¸Œæœ›åˆ é™¤ä¸€ä¸ªåŒºé—´åï¼Œä½¿å¾—å‰©ä½™æ‰€æœ‰å…ƒç´ çš„ä¹˜ç§¯æœ«å°¾è‡³å°‘æœ‰<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span></span></span></span>ä¸ª 0ã€‚å°ç¾æƒ³çŸ¥é“ï¼Œä¸€å…±æœ‰å¤šå°‘ç§ä¸åŒçš„åˆ é™¤æ–¹æ¡ˆï¼Ÿ</div></div></div> <div class="description-wrap tw-mt-3" data-v-5e687804=""><div data-v-5e687804="">æ—¶é—´é™åˆ¶ï¼šC/C++ 1ç§’ï¼Œå…¶ä»–è¯­è¨€2ç§’</div> <div class="tw-mt-2" data-v-5e687804="">ç©ºé—´é™åˆ¶ï¼šC/C++ 256Mï¼Œå…¶ä»–è¯­è¨€512M</div></div> <div class="item-title" data-v-5e687804="">è¾“å…¥æè¿°ï¼š</div> <pre class="description-wrap tw-whitespace-pre-wrap tw-break-all" data-v-5e687804="">ç¬¬ä¸€è¡Œè¾“å…¥ä¸¤ä¸ªæ­£æ•´æ•°<img src="https://hr.nowcoder.com/equation?tex=n%2Ck" alt="n,k">ã€‚<br>ç¬¬äºŒè¡Œè¾“å…¥<img src="https://hr.nowcoder.com/equation?tex=n" alt="n">ä¸ªæ­£æ•´æ•°<img src="https://hr.nowcoder.com/equation?tex=a_i" alt="a_i">ï¼Œä»£è¡¨å°ç¾æ‹¿åˆ°çš„æ•°ç»„ã€‚<br><img src="https://hr.nowcoder.com/equation?tex=1%5Cleq%20n%2Ck%20%5Cleq%2010%5E5" alt="1\leq n,k \leq 10^5"><br><img src="https://hr.nowcoder.com/equation?tex=1%5Cleq%20a_i%20%5Cleq%2010%5E9" alt="1\leq a_i \leq 10^9"></pre> <div class="item-title" data-v-5e687804="">è¾“å‡ºæè¿°ï¼š</div> <pre class="description-wrap tw-whitespace-pre-wrap tw-break-all" data-v-5e687804="">ä¸€ä¸ªæ•´æ•°ï¼Œä»£è¡¨åˆ é™¤çš„æ–¹æ¡ˆæ•°ã€‚</pre> <div data-v-5e687804=""><div class="item-title" data-v-5e687804="">ç¤ºä¾‹1</div> <div class="description-wrap" data-v-5e687804=""><div class="tw-flex tw-items-start tw-flex-wrap" data-v-5e687804=""><span class="tw-flex-shrink-0" data-v-5e687804="">è¾“å…¥ä¾‹å­ï¼š</span> <pre class="tw-whitespace-pre-wrap tw-break-all" data-v-5e687804="">5 22 5 3 4 20</pre></div> <div class="tw-mt-2 tw-flex tw-items-start tw-flex-wrap" data-v-5e687804=""><span class="tw-flex-shrink-0" data-v-5e687804="">è¾“å‡ºä¾‹å­ï¼š</span> <pre class="tw-whitespace-pre-wrap tw-break-all" data-v-5e687804="">4</pre></div> <div class="tw-mt-2 tw-flex tw-items-start tw-flex-wrap" data-v-5e687804=""><span class="tw-flex-shrink-0" data-v-5e687804="">ä¾‹å­è¯´æ˜ï¼š</span> <pre class="example-desc tw-break-all tw-whitespace-pre-wrap" data-v-5e687804="">ç¬¬ä¸€ä¸ªæ–¹æ¡ˆï¼Œåˆ é™¤[3]ã€‚<br>ç¬¬äºŒä¸ªæ–¹æ¡ˆï¼Œåˆ é™¤[4]ã€‚<br>ç¬¬ä¸‰ä¸ªæ–¹æ¡ˆï¼Œåˆ é™¤[3,4]ã€‚<br>ç¬¬å››ä¸ªæ–¹æ¡ˆï¼Œåˆ é™¤[2]ã€‚<br></pre></div></div></div> <!----></div></div><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">cntOfFact</span><span class="params">(<span class="type">long</span> <span class="type">long</span> n, <span class="type">long</span> <span class="type">long</span> fact)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> cnt = <span class="number">0</span>;</span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> facts[<span class="number">32</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="type">int</span> base = <span class="number">0</span>;</span><br><span class="line">    facts[<span class="number">0</span>] = fact;</span><br><span class="line">    <span class="keyword">while</span>(facts[base] &lt; n) &#123;</span><br><span class="line">        base++;</span><br><span class="line">        facts[base] = facts[base<span class="number">-1</span>] * facts[base<span class="number">-1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(; base &gt;= <span class="number">0</span>; base--) &#123;</span><br><span class="line">        <span class="keyword">if</span>(n / facts[base] &gt; <span class="number">0</span> &amp;&amp; n % facts[base] == <span class="number">0</span>) &#123;</span><br><span class="line">            cnt += <span class="number">1</span> &lt;&lt; base;</span><br><span class="line">            n /= facts[base];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> cnt;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> n, k;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; k;</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">arr</span><span class="params">(n)</span></span>;</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">cntOf2</span><span class="params">(n+<span class="number">1</span>)</span>, <span class="title">cntOf5</span><span class="params">(n+<span class="number">1</span>)</span></span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        cin &gt;&gt; arr[i];</span><br><span class="line">        cntOf2[i+<span class="number">1</span>] = <span class="built_in">cntOfFact</span>(arr[i], <span class="number">2</span>) + cntOf2[i];</span><br><span class="line">        cntOf5[i+<span class="number">1</span>] = <span class="built_in">cntOfFact</span>(arr[i], <span class="number">5</span>) + cntOf5[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> canDelete2 = cntOf2[n] - k;</span><br><span class="line">    <span class="type">int</span> canDelete5 = cntOf5[n] - k;</span><br><span class="line">    <span class="type">int</span> start = <span class="number">0</span>;</span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> end = <span class="number">1</span>; end &lt;= n; end++) &#123;</span><br><span class="line">        <span class="keyword">while</span>(start &lt; end &amp;&amp; (cntOf2[end] - cntOf2[start] &gt; canDelete2 || cntOf5[end] - cntOf5[start] &gt; canDelete5)) &#123;</span><br><span class="line">            start++;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        ans += end - start;</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; ans &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 64 ä½è¾“å‡ºè¯·ç”¨ printf(&quot;%lld&quot;)</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;1-å°ç¾çš„å¹³è¡¡çŸ©é˜µ&quot;&gt;&lt;a href=&quot;#1-å°ç¾çš„å¹³è¡¡çŸ©é˜µ&quot; class=&quot;headerlink&quot; title=&quot;1.å°ç¾çš„å¹³è¡¡çŸ©é˜µ&quot;&gt;&lt;/a&gt;1.å°ç¾çš„å¹³è¡¡çŸ©é˜µ&lt;/h2&gt;&lt;div data-v-5e687804 class data-v-368446cc&gt;&lt;div data-v-55713a8e data-v-5e687804 class=&quot;tw-mb-5&quot;&gt;&lt;!----&gt;  &lt;div data-v-2b881dd3 data-v-55713a8e class=&quot;question-info question-info&quot;&gt;&lt;div data-v-2b881dd3 class=&quot;codingTitleClass tw-flex&quot;&gt;&lt;div data-v-2b881dd3 class=&quot;tw-mr-1 tw-h-7 tw-leading-7&quot;&gt;1.&lt;/div&gt; &lt;div data-v-2b881dd3 class=&quot;commonPaperHtml tw-flex-1 tw-w-0&quot;&gt;å°ç¾çš„å¹³è¡¡çŸ©é˜µ&lt;/div&gt;&lt;/div&gt; &lt;div data-v-2b881dd3 class=&quot;commonPaperHtml codingContentClass&quot;&gt;å°ç¾æ‹¿åˆ°äº†ä¸€ä¸ª&lt;span class=&quot;katex&quot;&gt;&lt;span class=&quot;katex-mathml&quot;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo&gt;âˆ—&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;annotation encoding=&quot;application/x-tex&quot;&gt;n*n&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&quot;katex-html&quot; aria-hidden=&quot;true&quot;&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:0.46528em;vertical-align:0em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord mathdefault&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:0.2222222222222222em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mbin&quot;&gt;âˆ—&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:0.2222222222222222em;&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:0.43056em;vertical-align:0em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord mathdefault&quot;&gt;n&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;çš„çŸ©é˜µï¼Œå…¶ä¸­æ¯ä¸ªå…ƒç´ æ˜¯ 0 æˆ–è€… 1ã€‚&lt;br&gt;
å°ç¾è®¤ä¸ºä¸€ä¸ªçŸ©å½¢åŒºåŸŸæ˜¯å®Œç¾çš„ï¼Œå½“ä¸”ä»…å½“è¯¥åŒºåŸŸå†… 0 çš„æ•°é‡æ°å¥½ç­‰äº 1 çš„æ•°é‡ã€‚&lt;br&gt;
ç°åœ¨ï¼Œå°ç¾å¸Œæœ›ä½ å›ç­”æœ‰å¤šå°‘ä¸ª&lt;span class=&quot;katex&quot;&gt;&lt;span class=&quot;katex-mathml&quot;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;âˆ—&lt;/mo&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/mrow&gt;&lt;annotation encoding=&quot;application/x-tex&quot;&gt;i*i&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&quot;katex-html&quot; aria-hidden=&quot;true&quot;&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:0.65952em;vertical-align:0em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord mathdefault&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:0.2222222222222222em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mbin&quot;&gt;âˆ—&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:0.2222222222222222em;&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:0.65952em;vertical-align:0em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord mathdefault&quot;&gt;i&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;çš„å®Œç¾çŸ©å½¢åŒºåŸŸã€‚ä½ éœ€è¦å›ç­”&lt;span class=&quot;katex&quot;&gt;&lt;span class=&quot;katex-mathml&quot;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;â‰¤&lt;/mo&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;â‰¤&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;annotation encoding=&quot;application/x-tex&quot;&gt;1&#92;leq i &#92;leq n&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&quot;katex-html&quot; aria-hidden=&quot;true&quot;&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:0.78041em;vertical-align:-0.13597em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:0.2777777777777778em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mrel&quot;&gt;â‰¤&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:0.2777777777777778em;&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:0.79549em;vertical-align:-0.13597em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord mathdefault&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:0.2777777777777778em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mrel&quot;&gt;â‰¤&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:0.2777777777777778em;&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:0.43056em;vertical-align:0em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord mathdefault&quot;&gt;n&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;çš„æ‰€æœ‰ç­”æ¡ˆã€‚&lt;/div&gt;&lt;/div&gt;&lt;/div&gt; &lt;div data-v-5e687804 class=&quot;description-wrap tw-mt-3&quot;&gt;&lt;div data-v-5e687804&gt;æ—¶é—´é™åˆ¶ï¼šC/C++ 1ç§’ï¼Œå…¶ä»–è¯­è¨€2ç§’&lt;/div&gt; &lt;div data-v-5e687804 class=&quot;tw-mt-2&quot;&gt;ç©ºé—´é™åˆ¶ï¼šC/C++ 256Mï¼Œå…¶ä»–è¯­è¨€512M&lt;/div&gt;&lt;/div&gt; &lt;div data-v-5e687804 class=&quot;item-title&quot;&gt;è¾“å…¥æè¿°ï¼š&lt;/div&gt; &lt;pre data-v-5e687804 class=&quot;description-wrap tw-whitespace-pre-wrap tw-break-all&quot;&gt;ç¬¬ä¸€è¡Œè¾“å…¥ä¸€ä¸ªæ­£æ•´æ•°&lt;img src=&quot;https://hr.nowcoder.com/equation?tex=n&quot; alt=&quot;n&quot;&gt;ï¼Œä»£è¡¨çŸ©é˜µå¤§å°ã€‚&lt;br&gt;æ¥ä¸‹æ¥çš„&lt;img src=&quot;https://hr.nowcoder.com/equation?tex=n&quot; alt=&quot;n&quot;&gt;è¡Œï¼Œæ¯è¡Œè¾“å…¥ä¸€ä¸ªé•¿åº¦ä¸º&lt;img src=&quot;https://hr.nowcoder.com/equation?tex=n&quot; alt=&quot;n&quot;&gt;çš„ 01 ä¸²ï¼Œç”¨æ¥è¡¨ç¤ºçŸ©é˜µã€‚&lt;br&gt;&lt;img src=&quot;https://hr.nowcoder.com/equation?tex=1%5Cleq%20n%20%5Cleq%20200&quot; alt=&quot;1&#92;leq n &#92;leq 200&quot;&gt;&lt;/pre&gt; &lt;div data-v-5e687804 class=&quot;item-title&quot;&gt;è¾“å‡ºæè¿°ï¼š&lt;/div&gt; &lt;pre data-v-5e687804 class=&quot;description-wrap tw-whitespace-pre-wrap tw-break-all&quot;&gt;è¾“å‡º&lt;img src=&quot;https://hr.nowcoder.com/equation?tex=n&quot; alt=&quot;n&quot;&gt;è¡Œï¼Œç¬¬&lt;img src=&quot;https://hr.nowcoder.com/equation?tex=i&quot; alt=&quot;i&quot;&gt;è¡Œè¾“å‡º&lt;img src=&quot;https://hr.nowcoder.com/equation?tex=i*i&quot; alt=&quot;i*i&quot;&gt;çš„å®Œç¾çŸ©å½¢åŒºåŸŸçš„æ•°é‡ã€‚&lt;/pre&gt; &lt;div data-v-5e687804&gt;&lt;div data-v-5e687804 class=&quot;item-title&quot;&gt;ç¤ºä¾‹1&lt;/div&gt; &lt;div data-v-5e687804 class=&quot;description-wrap&quot;&gt;&lt;div data-v-5e687804 class=&quot;tw-flex tw-items-start tw-flex-wrap&quot;&gt;&lt;span data-v-5e687804 class=&quot;tw-flex-shrink-0&quot;&gt;è¾“å…¥ä¾‹å­ï¼š&lt;/span&gt; &lt;pre data-v-5e687804 class=&quot;tw-whitespace-pre-wrap tw-break-all&quot;&gt;4
1010
0101
1100
0011&lt;/pre&gt;&lt;/div&gt; &lt;div data-v-5e687804 class=&quot;tw-mt-2 tw-flex tw-items-start tw-flex-wrap&quot;&gt;&lt;span data-v-5e687804 class=&quot;tw-flex-shrink-0&quot;&gt;è¾“å‡ºä¾‹å­ï¼š&lt;/span&gt; &lt;pre data-v-5e687804 class=&quot;tw-whitespace-pre-wrap tw-break-all&quot;&gt;0
7
0
1&lt;/pre&gt;&lt;/div&gt; &lt;!----&gt;&lt;/div&gt;&lt;/div&gt; &lt;!----&gt;&lt;/div&gt;

&lt;figure class=&quot;highlight c++&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;keyword&quot;&gt;include&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;lt;iostream&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;keyword&quot;&gt;include&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;lt;vector&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;using&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;namespace&lt;/span&gt; std;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; n;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    cin &amp;gt;&amp;gt; n;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    vector&amp;lt;vector&amp;lt;&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt;&amp;gt;&amp;gt; &lt;span class=&quot;built_in&quot;&gt;preSum&lt;/span&gt;(n, &lt;span class=&quot;built_in&quot;&gt;vector&lt;/span&gt;&amp;lt;&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt;&amp;gt;(n+&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; i = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;; i &amp;lt; n; i++) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        string s;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        cin &amp;gt;&amp;gt; s;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; j = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;; j &amp;lt; n; j++) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            preSum[i][j+&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;] = preSum[i][j] + (s[j] - &lt;span class=&quot;string&quot;&gt;&amp;#x27;0&amp;#x27;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; window = &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;; window &amp;lt;= n; window++) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(window &amp;amp; &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            cout &amp;lt;&amp;lt; &lt;span class=&quot;string&quot;&gt;&amp;quot;0&#92;n&amp;quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;continue&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; perfect = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; j = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;; j &amp;lt;= n - window; j++) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; sum = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; i = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;; i &amp;lt; window; i++) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                sum += preSum[i][window + j] - preSum[i][j];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(sum * &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt; == window * window) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                perfect++;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; i = window; i &amp;lt; n; i++) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                sum -= preSum[i - window][window + j] - preSum[i - window][j];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                sum += preSum[i][window + j] - preSum[i][j];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(sum * &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt; == window * window) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    perfect++;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        cout &amp;lt;&amp;lt; perfect &amp;lt;&amp;lt; &lt;span class=&quot;string&quot;&gt;&amp;quot;&#92;n&amp;quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h2 id=&quot;2-å°ç¾çš„æ•°ç»„è¯¢é—®&quot;&gt;&lt;a href=&quot;#2-å°ç¾çš„æ•°ç»„è¯¢é—®&quot; class=&quot;headerlink&quot; title=&quot;2.å°ç¾çš„æ•°ç»„è¯¢é—®&quot;&gt;&lt;/a&gt;2.å°ç¾çš„æ•°ç»„è¯¢é—®&lt;/h2&gt;&lt;div data-v-5e687804 class data-v-368446cc&gt;&lt;div data-v-55713a8e data-v-5e687804 class=&quot;tw-mb-5&quot;&gt;&lt;!----&gt;  &lt;div data-v-2b881dd3 data-v-55713a8e class=&quot;question-info question-info&quot;&gt;&lt;div data-v-2b881dd3 class=&quot;codingTitleClass tw-flex&quot;&gt;&lt;div data-v-2b881dd3 class=&quot;tw-mr-1 tw-h-7 tw-leading-7&quot;&gt;2.&lt;/div&gt; &lt;div data-v-2b881dd3 class=&quot;commonPaperHtml tw-flex-1 tw-w-0&quot;&gt;å°ç¾çš„æ•°ç»„è¯¢é—®&lt;/div&gt;&lt;/div&gt; &lt;div data-v-2b881dd3 class=&quot;commonPaperHtml codingContentClass&quot;&gt;å°ç¾æ‹¿åˆ°äº†ä¸€ä¸ªç”±æ­£æ•´æ•°ç»„æˆçš„æ•°ç»„ï¼Œä½†å…¶ä¸­æœ‰ä¸€äº›å…ƒç´ æ˜¯æœªçŸ¥çš„ï¼ˆç”¨ 0 æ¥è¡¨ç¤ºï¼‰ã€‚&lt;br&gt;
ç°åœ¨å°ç¾æƒ³çŸ¥é“ï¼Œå¦‚æœé‚£äº›æœªçŸ¥çš„å…ƒç´ åœ¨åŒºé—´&lt;span class=&quot;katex&quot;&gt;&lt;span class=&quot;katex-mathml&quot;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;[&lt;/mo&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mo separator=&quot;true&quot;&gt;,&lt;/mo&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;]&lt;/mo&gt;&lt;/mrow&gt;&lt;annotation encoding=&quot;application/x-tex&quot;&gt;[l,r]&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&quot;katex-html&quot; aria-hidden=&quot;true&quot;&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:1em;vertical-align:-0.25em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mopen&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mord mathdefault&quot; style=&quot;margin-right:0.01968em;&quot;&gt;l&lt;/span&gt;&lt;span class=&quot;mpunct&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:0.16666666666666666em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord mathdefault&quot; style=&quot;margin-right:0.02778em;&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;mclose&quot;&gt;]&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;èŒƒå›´å†…éšæœºå–å€¼çš„è¯ï¼Œæ•°ç»„æ‰€æœ‰å…ƒç´ ä¹‹å’Œçš„æœ€å°å€¼å’Œæœ€å¤§å€¼åˆ†åˆ«æ˜¯å¤šå°‘ï¼Ÿ&lt;br&gt;
å…±æœ‰&lt;span class=&quot;katex&quot;&gt;&lt;span class=&quot;katex-mathml&quot;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;q&lt;/mi&gt;&lt;/mrow&gt;&lt;annotation encoding=&quot;application/x-tex&quot;&gt;q&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&quot;katex-html&quot; aria-hidden=&quot;true&quot;&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:0.625em;vertical-align:-0.19444em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord mathdefault&quot; style=&quot;margin-right:0.03588em;&quot;&gt;q&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;æ¬¡è¯¢é—®ã€‚&lt;/div&gt;&lt;/div&gt;&lt;/div&gt; &lt;div data-v-5e687804 class=&quot;description-wrap tw-mt-3&quot;&gt;&lt;div data-v-5e687804&gt;æ—¶é—´é™åˆ¶ï¼šC/C++ 1ç§’ï¼Œå…¶ä»–è¯­è¨€2ç§’&lt;/div&gt; &lt;div data-v-5e687804 class=&quot;tw-mt-2&quot;&gt;ç©ºé—´é™åˆ¶ï¼šC/C++ 256Mï¼Œå…¶ä»–è¯­è¨€512M&lt;/div&gt;&lt;/div&gt; &lt;div data-v-5e687804 class=&quot;item-title&quot;&gt;è¾“å…¥æè¿°ï¼š&lt;/div&gt; &lt;pre data-v-5e687804 class=&quot;description-wrap tw-whitespace-pre-wrap tw-break-all&quot;&gt;ç¬¬ä¸€è¡Œè¾“å…¥ä¸¤ä¸ªæ­£æ•´æ•°&lt;img src=&quot;https://hr.nowcoder.com/equation?tex=n%2Cq&quot; alt=&quot;n,q&quot;&gt;ï¼Œä»£è¡¨æ•°ç»„å¤§å°å’Œè¯¢é—®æ¬¡æ•°ã€‚&lt;br&gt;ç¬¬äºŒè¡Œè¾“å…¥&lt;img src=&quot;https://hr.nowcoder.com/equation?tex=n&quot; alt=&quot;n&quot;&gt;ä¸ªæ•´æ•°&lt;img src=&quot;https://hr.nowcoder.com/equation?tex=a_i&quot; alt=&quot;a_i&quot;&gt;ï¼Œå…¶ä¸­å¦‚æœè¾“å…¥çš„&lt;img src=&quot;https://hr.nowcoder.com/equation?tex=a_i&quot; alt=&quot;a_i&quot;&gt;ä¸º 0ï¼Œé‚£ä¹ˆè¯´æ˜&lt;img src=&quot;https://hr.nowcoder.com/equation?tex=a_i&quot; alt=&quot;a_i&quot;&gt;æ˜¯æœªçŸ¥çš„ã€‚&lt;br&gt;æ¥ä¸‹æ¥çš„&lt;img src=&quot;https://hr.nowcoder.com/equation?tex=q&quot; alt=&quot;q&quot;&gt;è¡Œï¼Œæ¯è¡Œè¾“å…¥ä¸¤ä¸ªæ­£æ•´æ•° &lt;img src=&quot;https://hr.nowcoder.com/equation?tex=l%2Cr&quot; alt=&quot;l,r&quot;&gt;ï¼Œä»£è¡¨ä¸€æ¬¡è¯¢é—®ã€‚&lt;br&gt;&lt;img src=&quot;https://hr.nowcoder.com/equation?tex=1%5Cleq%20n%2Cq%20%5Cleq%2010%5E5&quot; alt=&quot;1&#92;leq n,q &#92;leq 10^5&quot;&gt;&lt;br&gt;&lt;img src=&quot;https://hr.nowcoder.com/equation?tex=0%20%5Cleq%20a_i%20%5Cleq%2010%5E9&quot; alt=&quot;0 &#92;leq a_i &#92;leq 10^9&quot;&gt;&lt;br&gt;&lt;img src=&quot;https://hr.nowcoder.com/equation?tex=1%5Cleq%20l%20%5Cleq%20r%20%5Cleq%2010%5E9&quot; alt=&quot;1&#92;leq l &#92;leq r &#92;leq 10^9&quot;&gt;&lt;/pre&gt; &lt;div data-v-5e687804 class=&quot;item-title&quot;&gt;è¾“å‡ºæè¿°ï¼š&lt;/div&gt; &lt;pre data-v-5e687804 class=&quot;description-wrap tw-whitespace-pre-wrap tw-break-all&quot;&gt;è¾“å‡º&lt;img src=&quot;https://hr.nowcoder.com/equation?tex=q&quot; alt=&quot;q&quot;&gt;è¡Œï¼Œæ¯è¡Œè¾“å‡ºä¸¤ä¸ªæ­£æ•´æ•°ï¼Œä»£è¡¨æ‰€æœ‰å…ƒç´ ä¹‹å’Œçš„æœ€å°å€¼å’Œæœ€å¤§å€¼ã€‚&lt;/pre&gt; &lt;div data-v-5e687804&gt;&lt;div data-v-5e687804 class=&quot;item-title&quot;&gt;ç¤ºä¾‹1&lt;/div&gt; &lt;div data-v-5e687804 class=&quot;description-wrap&quot;&gt;&lt;div data-v-5e687804 class=&quot;tw-flex tw-items-start tw-flex-wrap&quot;&gt;&lt;span data-v-5e687804 class=&quot;tw-flex-shrink-0&quot;&gt;è¾“å…¥ä¾‹å­ï¼š&lt;/span&gt; &lt;pre data-v-5e687804 class=&quot;tw-whitespace-pre-wrap tw-break-all&quot;&gt;3 2
1 0 3
1 2
4 4&lt;/pre&gt;&lt;/div&gt; &lt;div data-v-5e687804 class=&quot;tw-mt-2 tw-flex tw-items-start tw-flex-wrap&quot;&gt;&lt;span data-v-5e687804 class=&quot;tw-flex-shrink-0&quot;&gt;è¾“å‡ºä¾‹å­ï¼š&lt;/span&gt; &lt;pre data-v-5e687804 class=&quot;tw-whitespace-pre-wrap tw-break-all&quot;&gt;5 6
8 8&lt;/pre&gt;&lt;/div&gt; &lt;div data-v-5e687804 class=&quot;tw-mt-2 tw-flex tw-items-start tw-flex-wrap&quot;&gt;&lt;span data-v-5e687804 class=&quot;tw-flex-shrink-0&quot;&gt;ä¾‹å­è¯´æ˜ï¼š&lt;/span&gt; &lt;pre data-v-5e687804 class=&quot;example-desc tw-break-all tw-whitespace-pre-wrap&quot;&gt;åªæœ‰ç¬¬äºŒä¸ªå…ƒç´ æ˜¯æœªçŸ¥çš„ã€‚&lt;br&gt;ç¬¬ä¸€æ¬¡è¯¢é—®ï¼Œæ•°ç»„æœ€å°çš„å’Œæ˜¯ 1+1+3=5ï¼Œæœ€å¤§çš„å’Œæ˜¯ 1+2+3=6ã€‚&lt;br&gt;ç¬¬äºŒæ¬¡è¯¢é—®ï¼Œæ˜¾ç„¶æ•°ç»„çš„å…ƒç´ å’Œå¿…ç„¶ä¸º 8ã€‚&lt;br&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt; &lt;!----&gt;&lt;/div&gt;

&lt;figure class=&quot;highlight c++&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;keyword&quot;&gt;include&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;lt;iostream&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;using&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;namespace&lt;/span&gt; std;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; n, q;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    cin &amp;gt;&amp;gt; n &amp;gt;&amp;gt; q;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;type&quot;&gt;long&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;long&lt;/span&gt; sum = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;type&quot;&gt;long&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;long&lt;/span&gt; zeroCnt = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; i = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;; i &amp;lt; n; i++) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; ai;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        cin &amp;gt;&amp;gt; ai;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        zeroCnt += (ai == &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt; ? &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt; : &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        sum += ai;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; i = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;; i &amp;lt; q; i++) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; l, r;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        cin &amp;gt;&amp;gt; l &amp;gt;&amp;gt; r;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        cout &amp;lt;&amp;lt; sum + zeroCnt*l &amp;lt;&amp;lt; &lt;span class=&quot;string&quot;&gt;&amp;quot; &amp;quot;&lt;/span&gt; &amp;lt;&amp;lt; sum + zeroCnt*r &amp;lt;&amp;lt; &lt;span class=&quot;string&quot;&gt;&amp;quot;&#92;n&amp;quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="ç‰›å®¢" scheme="https://jingtianer.github.io/home/categories/%E7%89%9B%E5%AE%A2/"/>
    
    <category term="åˆ·é¢˜" scheme="https://jingtianer.github.io/home/categories/%E7%89%9B%E5%AE%A2/%E5%88%B7%E9%A2%98/"/>
    
    
    <category term="ç‰›å®¢" scheme="https://jingtianer.github.io/home/tags/%E7%89%9B%E5%AE%A2/"/>
    
    <category term="åˆ·é¢˜" scheme="https://jingtianer.github.io/home/tags/%E5%88%B7%E9%A2%98/"/>
    
  </entry>
  
  <entry>
    <title>OI KIWI 02-äºŒåˆ†</title>
    <link href="https://jingtianer.github.io/home/2024/09/01/%E7%AE%97%E6%B3%95/OI-KIWI-02-%E4%BA%8C%E5%88%86/"/>
    <id>https://jingtianer.github.io/home/2024/09/01/%E7%AE%97%E6%B3%95/OI-KIWI-02-%E4%BA%8C%E5%88%86/</id>
    <published>2024-09-01T03:14:34.000Z</published>
    <updated>2025-04-15T02:37:55.628Z</updated>
    
    <content type="html"><![CDATA[<h2 id="äºŒåˆ†æŸ¥æ‰¾"><a href="#äºŒåˆ†æŸ¥æ‰¾" class="headerlink" title="äºŒåˆ†æŸ¥æ‰¾"></a>äºŒåˆ†æŸ¥æ‰¾</h2><h3 id="å·¦é—­å³é—­"><a href="#å·¦é—­å³é—­" class="headerlink" title="å·¦é—­å³é—­"></a>å·¦é—­å³é—­</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">binarySearch</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; vec, <span class="type">int</span> target)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> len = vec.<span class="built_in">size</span>();</span><br><span class="line">    <span class="type">int</span> l = <span class="number">0</span>, r = len - <span class="number">1</span>; <span class="comment">// </span></span><br><span class="line">    <span class="keyword">while</span>(l &lt;= r) &#123;</span><br><span class="line">        <span class="type">int</span> mid = (r - l) / <span class="number">2</span> + l;</span><br><span class="line">        <span class="keyword">if</span>(vec[mid] == target) &#123;</span><br><span class="line">            <span class="keyword">return</span> mid;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(vec[mid] &gt; target) &#123;</span><br><span class="line">            r = mid - <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            l = mid + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å·¦é—­å³å¼€"><a href="#å·¦é—­å³å¼€" class="headerlink" title="å·¦é—­å³å¼€"></a>å·¦é—­å³å¼€</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">search</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums, <span class="type">int</span> target)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> len = nums.<span class="built_in">size</span>();</span><br><span class="line">        <span class="type">int</span> l = <span class="number">0</span>, r = len;</span><br><span class="line">        <span class="keyword">while</span>(l &lt; r) &#123;</span><br><span class="line">            <span class="type">int</span> mid = (r - l) / <span class="number">2</span> + l;</span><br><span class="line">            <span class="keyword">if</span>(nums[mid] == target) &#123;</span><br><span class="line">                <span class="keyword">return</span> mid;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>(nums[mid] &gt; target) &#123;</span><br><span class="line">                r = mid;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                l = mid + <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><ul><li>lå’Œrä»£è¡¨åŒºé—´ï¼Œå½“åŒºé—´å†…æ²¡æœ‰å…ƒç´ æ—¶æŸ¥æ‰¾ç»“æŸ<ul><li>å¯¹äºé—­åŒºé—´ï¼Œæ˜¯l &gt; r, æ‰€ä»¥å¾ªç¯æ¡ä»¶æ˜¯ l &lt;&#x3D; r</li><li>å¯¹äºå·¦é—­å³å¼€åŒºé—´ï¼Œæ˜¯l &gt;&#x3D; r, æ‰€ä»¥å¾ªç¯æ¡ä»¶æ˜¯ l &lt; r</li></ul></li><li>åŒºé—´å·¦&#x2F;å³è¾¹ç•Œç§»åŠ¨ï¼Œç§»åŠ¨åˆ°æœ€å°çš„æŸ¥æ‰¾åŒºé—´ï¼Œä¹Ÿå°±æ˜¯åŒºé—´ä¸åŒ…æ‹¬å¦ä¸€åŠåŒºé—´å’Œå½“å‰midå€¼<ul><li>å¯¹äºé—­åŒºé—´ï¼Œr &#x3D; mid - 1ï¼Œä¸åŒ…æ‹¬å½“å‰midå€¼<code>[l, mid - 1]</code></li><li>å¯¹äºå·¦é—­å³å¼€åŒºé—´ï¼Œr &#x3D; midï¼Œä¸åŒ…æ‹¬å½“å‰midå€¼<code>[l, mid)</code></li></ul></li></ul><h2 id="å·¦ä¾§è¾¹ç•Œ"><a href="#å·¦ä¾§è¾¹ç•Œ" class="headerlink" title="å·¦ä¾§è¾¹ç•Œ"></a>å·¦ä¾§è¾¹ç•Œ</h2><h3 id="é—­åŒºé—´"><a href="#é—­åŒºé—´" class="headerlink" title="é—­åŒºé—´"></a>é—­åŒºé—´</h3><p>å¦‚æœtargetåœ¨vecä¸­ï¼Œåˆ™æ‰¾åˆ°æœ€åä¸€ä¸ªtargetçš„ä¸‹æ ‡<br>å¦‚æœtargetä¸åœ¨vecä¸­ï¼Œåˆ™æ‰¾åˆ°targetåº”è¯¥æ’å…¥åœ¨å“ªä¸ªå…ƒç´ åé¢</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">binarySearch</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; vec, <span class="type">int</span> target)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> len = vec.<span class="built_in">size</span>();</span><br><span class="line">    <span class="type">int</span> l = <span class="number">0</span>, r = len - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(l &lt;= r) &#123;</span><br><span class="line">        <span class="type">int</span> mid = (r - l) / <span class="number">2</span> + l;</span><br><span class="line">        <span class="keyword">if</span>(vec[mid] == target) &#123;</span><br><span class="line">            l = mid - <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(vec[mid] &gt; target) &#123;</span><br><span class="line">            r = mid - <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            l = mid + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> l;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>mid !&#x3D; targetçš„æƒ…å†µï¼Œæ­£å¸¸äºŒåˆ†æŸ¥æ‰¾</li><li>mid &#x3D;&#x3D; targetï¼Œ æ‰¾targetçš„å‰é©±ï¼Œæ‰€ä»¥l &#x3D; mid - 1ï¼ˆä¸ºå•¥ä¸æ˜¯midï¼‰</li></ul>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;äºŒåˆ†æŸ¥æ‰¾&quot;&gt;&lt;a href=&quot;#äºŒåˆ†æŸ¥æ‰¾&quot; class=&quot;headerlink&quot; title=&quot;äºŒåˆ†æŸ¥æ‰¾&quot;&gt;&lt;/a&gt;äºŒåˆ†æŸ¥æ‰¾&lt;/h2&gt;&lt;h3 id=&quot;å·¦é—­å³é—­&quot;&gt;&lt;a href=&quot;#å·¦é—­å³é—­&quot; class=&quot;headerlink&quot; title=&quot;å·¦é—­å³é—­&quot;&gt;&lt;/a&gt;å·¦é—­å³é—­&lt;/h3&gt;&lt;figure class=&quot;highlight c++&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;binarySearch&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(vector&amp;lt;&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt;&amp;gt;&amp;amp; vec, &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; target)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; len = vec.&lt;span class=&quot;built_in&quot;&gt;size&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; l = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, r = len - &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;; &lt;span class=&quot;comment&quot;&gt;// &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;while&lt;/span&gt;(l &amp;lt;= r) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; mid = (r - l) / &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt; + l;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(vec[mid] == target) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; mid;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(vec[mid] &amp;gt; target) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            r = mid - &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            l = mid + &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;-1&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&quot;å·¦é—­å³å¼€&quot;&gt;&lt;a href=&quot;#å·¦é—­å³å¼€&quot; class=&quot;headerlink&quot; title=&quot;å·¦é—­å³å¼€&quot;&gt;&lt;/a&gt;å·¦é—­å³å¼€&lt;/h3&gt;&lt;figure class=&quot;highlight c++&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title class_&quot;&gt;Solution&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;search&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(vector&amp;lt;&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt;&amp;gt;&amp;amp; nums, &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; target)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; len = nums.&lt;span class=&quot;built_in&quot;&gt;size&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; l = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, r = len;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;while&lt;/span&gt;(l &amp;lt; r) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; mid = (r - l) / &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt; + l;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(nums[mid] == target) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; mid;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(nums[mid] &amp;gt; target) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                r = mid;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                l = mid + &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;-1&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&quot;æ€»ç»“&quot;&gt;&lt;a href=&quot;#æ€»ç»“&quot; class=&quot;headerlink&quot; title=&quot;æ€»ç»“&quot;&gt;&lt;/a&gt;æ€»ç»“&lt;/h3&gt;</summary>
    
    
    
    <category term="OI KIWI" scheme="https://jingtianer.github.io/home/categories/OI-KIWI/"/>
    
    <category term="ç®—æ³•" scheme="https://jingtianer.github.io/home/categories/OI-KIWI/%E7%AE%97%E6%B3%95/"/>
    
    
    <category term="ç®—æ³•" scheme="https://jingtianer.github.io/home/tags/%E7%AE%97%E6%B3%95/"/>
    
    <category term="OI KIWI" scheme="https://jingtianer.github.io/home/tags/OI-KIWI/"/>
    
  </entry>
  
  <entry>
    <title>LeetCode-37</title>
    <link href="https://jingtianer.github.io/home/2024/08/26/LeetCode/LeetCode-%E5%88%B7%E9%A2%98%E6%80%BB%E7%BB%9337/"/>
    <id>https://jingtianer.github.io/home/2024/08/26/LeetCode/LeetCode-%E5%88%B7%E9%A2%98%E6%80%BB%E7%BB%9337/</id>
    <published>2024-08-26T03:14:34.000Z</published>
    <updated>2025-04-15T02:37:55.602Z</updated>
    
    <content type="html"><![CDATA[<h2 id="698-åˆ’åˆ†ä¸ºkä¸ªç›¸ç­‰çš„å­é›†"><a href="#698-åˆ’åˆ†ä¸ºkä¸ªç›¸ç­‰çš„å­é›†" class="headerlink" title="698. åˆ’åˆ†ä¸ºkä¸ªç›¸ç­‰çš„å­é›†"></a>698. åˆ’åˆ†ä¸ºkä¸ªç›¸ç­‰çš„å­é›†</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Solve</span> &#123;</span><br><span class="line">        vector&lt;<span class="type">int</span>&gt;&amp; nums;</span><br><span class="line">        <span class="type">int</span> k;</span><br><span class="line">        <span class="type">int</span> n;</span><br><span class="line">        vector&lt;<span class="type">int</span>&gt; bucket;</span><br><span class="line">        <span class="type">int</span> target;</span><br><span class="line">        <span class="type">int</span> sum;</span><br><span class="line">        <span class="type">bool</span> canPartition;</span><br><span class="line">        <span class="function"><span class="type">bool</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> index)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(index &gt;= n) &#123; <span class="comment">// æ‰€æœ‰æ•°éƒ½æ”¾è¿›æ¥äº†ï¼Œä¸”æ²¡æœ‰è¶…è¿‡target</span></span><br><span class="line">                <span class="comment">// è¯´æ˜ä¸€å®šå…¨ç­‰äºtarget</span></span><br><span class="line">                <span class="comment">// å¦‚æœæœ‰æ¡¶&lt;target, åˆ™ä¸€å®šæœ‰æ¡¶&gt;targetï¼Œæ‰€ä»¥æ‰€æœ‰æ¡¶ä¸€å®š&gt;=target</span></span><br><span class="line">                <span class="comment">// å¦‚æœæœ‰æ¡¶&gt;target, åˆ™ä¸€å®šæœ‰æ¡¶&lt;targetï¼Œæ‰€ä»¥æ‰€æœ‰æ¡¶ä¸€å®š&lt;=target</span></span><br><span class="line">                <span class="comment">// æ‰€ä»¥æ‰€æœ‰æ¡¶ä¸€å®š==target</span></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; k; i++) &#123;</span><br><span class="line">                <span class="keyword">if</span>(i&gt;<span class="number">0</span> &amp;&amp; bucket[i] == bucket[i<span class="number">-1</span>]) <span class="keyword">continue</span>;</span><br><span class="line">                <span class="keyword">if</span>(bucket[i] + nums[index] &lt;= target) &#123;</span><br><span class="line">                    bucket[i] += nums[index];</span><br><span class="line">                    <span class="keyword">if</span>(<span class="built_in">dfs</span>(index+<span class="number">1</span>)) &#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    bucket[i] -= nums[index];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span>:</span><br><span class="line">        <span class="built_in">Solve</span>(vector&lt;<span class="type">int</span>&gt;&amp; nums, <span class="type">int</span> k):<span class="built_in">nums</span>(nums), <span class="built_in">k</span>(k), <span class="built_in">bucket</span>(k) &#123;</span><br><span class="line">            n = nums.<span class="built_in">size</span>();</span><br><span class="line">            sum = <span class="built_in">accumulate</span>(nums.<span class="built_in">begin</span>(), nums.<span class="built_in">end</span>(), <span class="number">0</span>);</span><br><span class="line">            target = sum / k;</span><br><span class="line">            <span class="built_in">sort</span>(nums.<span class="built_in">begin</span>(), nums.<span class="built_in">end</span>(), <span class="built_in">greater</span>&lt;<span class="type">int</span>&gt;());</span><br><span class="line">            <span class="keyword">if</span>(sum % k != <span class="number">0</span>) &#123;</span><br><span class="line">                canPartition = <span class="literal">false</span>;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            canPartition = <span class="built_in">dfs</span>(<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="type">bool</span> <span class="title">solve</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> canPartition;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">canPartitionKSubsets</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums, <span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Solve</span>(nums, k).<span class="built_in">solve</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ç¡¬æœ</p><h2 id="690-å‘˜å·¥çš„é‡è¦æ€§"><a href="#690-å‘˜å·¥çš„é‡è¦æ€§" class="headerlink" title="690. å‘˜å·¥çš„é‡è¦æ€§"></a>690. å‘˜å·¥çš„é‡è¦æ€§</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">getImportance</span><span class="params">(vector&lt;Employee*&gt; employees, <span class="type">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> len = employees.<span class="built_in">size</span>();</span><br><span class="line">        unordered_map&lt;<span class="type">int</span>, Employee*&gt; id2Node;</span><br><span class="line">        <span class="keyword">for</span>(Employee *employee : employees) &#123;</span><br><span class="line">            id2Node[employee-&gt;id] = employee;</span><br><span class="line">        &#125;</span><br><span class="line">        function&lt;<span class="type">int</span>(<span class="type">int</span>)&gt; dfs = [&amp;](<span class="type">int</span> currentId) &#123;</span><br><span class="line">            Employee *node = id2Node[currentId];</span><br><span class="line">            <span class="type">int</span> ans = node-&gt;importance;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> child : node-&gt;subordinates) &#123;</span><br><span class="line">                ans += <span class="built_in">dfs</span>(child);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> ans;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">dfs</span>(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="699-æ‰è½çš„æ–¹å—"><a href="#699-æ‰è½çš„æ–¹å—" class="headerlink" title="699. æ‰è½çš„æ–¹å—"></a>699. æ‰è½çš„æ–¹å—</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">fallingSquares</span><span class="params">(vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; positions)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> len = positions.<span class="built_in">size</span>();</span><br><span class="line">        <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">height</span><span class="params">(len)</span></span>;</span><br><span class="line">        <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">right</span><span class="params">(len)</span></span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">            right[i] = positions[i][<span class="number">0</span>] + positions[i][<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">            <span class="type">int</span> maxHeight = <span class="number">0</span>;</span><br><span class="line">            <span class="type">int</span> lefti = positions[i][<span class="number">0</span>];</span><br><span class="line">            <span class="type">int</span> righti = right[i];</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; i; j++) &#123;</span><br><span class="line">                <span class="type">int</span> leftj = positions[j][<span class="number">0</span>];</span><br><span class="line">                <span class="type">int</span> rightj = right[j];</span><br><span class="line">                <span class="keyword">if</span>(lefti &gt;= rightj) <span class="keyword">continue</span>;</span><br><span class="line">                <span class="keyword">if</span>(righti &lt;= leftj) <span class="keyword">continue</span>;</span><br><span class="line">                maxHeight = <span class="built_in">max</span>(maxHeight, height[j]);</span><br><span class="line">            &#125;</span><br><span class="line">            height[i] = maxHeight + positions[i][<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt; len; i++) &#123;</span><br><span class="line">            height[i] = <span class="built_in">max</span>(height[i<span class="number">-1</span>], height[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> height;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li>æ•°æ®è§„æ¨¡ç•¥å°ï¼Œç›´æ¥æš´åŠ›</li></ul><h2 id="1186-åˆ é™¤ä¸€æ¬¡å¾—åˆ°å­æ•°ç»„æœ€å¤§å’Œ"><a href="#1186-åˆ é™¤ä¸€æ¬¡å¾—åˆ°å­æ•°ç»„æœ€å¤§å’Œ" class="headerlink" title="1186. åˆ é™¤ä¸€æ¬¡å¾—åˆ°å­æ•°ç»„æœ€å¤§å’Œ"></a>1186. åˆ é™¤ä¸€æ¬¡å¾—åˆ°å­æ•°ç»„æœ€å¤§å’Œ</h2><p>å…ˆäº†è§£<a href="https://www.geeksforgeeks.org/largest-sum-contiguous-subarray/">Maximum Subarray Sum - Kadaneâ€™s Algorithm</a></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">maximumSum</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; arr)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> n = arr.<span class="built_in">size</span>();</span><br><span class="line">        <span class="type">int</span> dp0 = arr[<span class="number">0</span>], dp1 = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> maxx = arr[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt; n; i++) &#123;</span><br><span class="line">            dp1 = <span class="built_in">max</span>(dp1 + arr[i], dp0);</span><br><span class="line">            dp0 = <span class="built_in">max</span>(dp0, <span class="number">0</span>) + arr[i];</span><br><span class="line">            maxx = <span class="built_in">max</span>(maxx, dp0);</span><br><span class="line">            maxx = <span class="built_in">max</span>(maxx, dp1);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> maxx;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="3144-åˆ†å‰²å­—ç¬¦é¢‘ç‡ç›¸ç­‰çš„æœ€å°‘å­å­—ç¬¦ä¸²"><a href="#3144-åˆ†å‰²å­—ç¬¦é¢‘ç‡ç›¸ç­‰çš„æœ€å°‘å­å­—ç¬¦ä¸²" class="headerlink" title="3144. åˆ†å‰²å­—ç¬¦é¢‘ç‡ç›¸ç­‰çš„æœ€å°‘å­å­—ç¬¦ä¸²"></a>3144. åˆ†å‰²å­—ç¬¦é¢‘ç‡ç›¸ç­‰çš„æœ€å°‘å­å­—ç¬¦ä¸²</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">allEqualsExceptZero</span><span class="params">(<span class="type">int</span> *arr, <span class="type">int</span> len)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(len &lt;= <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="type">int</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(i &lt; len &amp;&amp; arr[i] == <span class="number">0</span>) i++;</span><br><span class="line">        <span class="keyword">if</span>(i == len) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="type">const</span> <span class="type">int</span> val = arr[i];</span><br><span class="line">        <span class="keyword">for</span>(; i &lt; len; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="number">0</span> != arr[i] &amp;&amp; val != arr[i]) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">bfs</span><span class="params">(<span class="type">const</span> vector&lt;vector&lt;<span class="type">bool</span>&gt;&gt;&amp; balance, <span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">        queue&lt;<span class="type">int</span>&gt; q;</span><br><span class="line">        q.<span class="built_in">push</span>(<span class="number">0</span>);</span><br><span class="line">        <span class="type">int</span> level = <span class="number">0</span>;</span><br><span class="line">        <span class="function">vector&lt;<span class="type">bool</span>&gt; <span class="title">visited</span><span class="params">(n, <span class="literal">false</span>)</span></span>;</span><br><span class="line">        <span class="keyword">while</span>(!q.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            level++;</span><br><span class="line">            <span class="type">int</span> len = q.<span class="built_in">size</span>();</span><br><span class="line">            <span class="keyword">while</span>(len--) &#123;</span><br><span class="line">                <span class="type">int</span> node = q.<span class="built_in">front</span>();</span><br><span class="line">                q.<span class="built_in">pop</span>();</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> i = node; i &lt; n; i++) &#123;</span><br><span class="line">                    <span class="keyword">if</span>(balance[node][i]) &#123;</span><br><span class="line">                        <span class="keyword">if</span>(i + <span class="number">1</span> == n) &#123;</span><br><span class="line">                            <span class="keyword">return</span> level;</span><br><span class="line">                        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(!visited[i+<span class="number">1</span>]) &#123;</span><br><span class="line">                            q.<span class="built_in">push</span>(i + <span class="number">1</span>);</span><br><span class="line">                            visited[i + <span class="number">1</span>] = <span class="literal">true</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> level;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">minimumSubstringsInPartition</span><span class="params">(string s)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> len = s.<span class="built_in">length</span>();</span><br><span class="line">        vector&lt;vector&lt;<span class="type">bool</span>&gt;&gt; <span class="built_in">balance</span>(len, <span class="built_in">vector</span>&lt;<span class="type">bool</span>&gt;(len, <span class="literal">false</span>));</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">            <span class="type">int</span> charCnt[<span class="number">26</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j = i; j &lt; len; j++) &#123;</span><br><span class="line">                charCnt[s[j] - <span class="string">&#x27;a&#x27;</span>]++;</span><br><span class="line">                balance[i][j] = <span class="built_in">allEqualsExceptZero</span>(charCnt, <span class="number">26</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">bfs</span>(balance, len);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// cout &lt;&lt; minimumSubstringsInPartition(&quot;ababcc&quot;) &lt;&lt; &quot; == 1&quot;&lt;&lt; endl;</span></span><br><span class="line">        <span class="comment">// cout &lt;&lt; minimumSubstringsInPartition(&quot;fabccddg&quot;) &lt;&lt; &quot; == 3&quot; &lt;&lt; endl;</span></span><br><span class="line">        <span class="comment">// cout &lt;&lt; minimumSubstringsInPartition(&quot;abababaccddb&quot;) &lt;&lt; &quot; == 2&quot; &lt;&lt; endl;</span></span><br><span class="line">        cout &lt;&lt; <span class="built_in">minimumSubstringsInPartition</span>(<span class="string">&quot;fabccddg&quot;</span>) &lt;&lt; <span class="string">&quot; == 3&quot;</span> &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li>æ‰¾å‡ºä»»æ„åŒºé—´<code>(i...j)</code>æ˜¯å¦ä¸ºå¹³è¡¡å­—ç¬¦ä¸²ï¼Œä»0å¼€å§‹bfsæœç´¢ï¼Œç›´åˆ°ç¬¬ä¸€ä¸ªè¾¾åˆ°<code>n</code>çš„èŠ‚ç‚¹</li></ul><h2 id="3142-åˆ¤æ–­çŸ©é˜µæ˜¯å¦æ»¡è¶³æ¡ä»¶"><a href="#3142-åˆ¤æ–­çŸ©é˜µæ˜¯å¦æ»¡è¶³æ¡ä»¶" class="headerlink" title="3142. åˆ¤æ–­çŸ©é˜µæ˜¯å¦æ»¡è¶³æ¡ä»¶"></a>3142. åˆ¤æ–­çŸ©é˜µæ˜¯å¦æ»¡è¶³æ¡ä»¶</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">satisfiesConditions</span><span class="params">(vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; grid)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> m = grid.<span class="built_in">size</span>();</span><br><span class="line">        <span class="type">int</span> n = grid[<span class="number">0</span>].<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; m - <span class="number">1</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; n - <span class="number">1</span>; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span>(grid[i][j] != grid[i+<span class="number">1</span>][j] || grid[i][j] == grid[i][j+<span class="number">1</span>]) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; m - <span class="number">1</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(grid[i][n<span class="number">-1</span>] != grid[i+<span class="number">1</span>][n<span class="number">-1</span>]) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; n - <span class="number">1</span>; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(grid[m<span class="number">-1</span>][j] == grid[m<span class="number">-1</span>][j+<span class="number">1</span>]) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>è¿™ç§é¢˜è¯·ä¸€æ¬¡æ€§ç»™è®©æˆ‘ç­”10å¼ </p><h2 id="3144-åˆ†å‰²å­—ç¬¦é¢‘ç‡ç›¸ç­‰çš„æœ€å°‘å­å­—ç¬¦ä¸²-1"><a href="#3144-åˆ†å‰²å­—ç¬¦é¢‘ç‡ç›¸ç­‰çš„æœ€å°‘å­å­—ç¬¦ä¸²-1" class="headerlink" title="3144. åˆ†å‰²å­—ç¬¦é¢‘ç‡ç›¸ç­‰çš„æœ€å°‘å­å­—ç¬¦ä¸²"></a>3144. åˆ†å‰²å­—ç¬¦é¢‘ç‡ç›¸ç­‰çš„æœ€å°‘å­å­—ç¬¦ä¸²</h2><p>è¿™æ¬¡ç”¨dpå“¦</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">allEqualsExceptZero</span><span class="params">(<span class="type">int</span> *arr, <span class="type">int</span> len)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(len &lt;= <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="type">int</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(i &lt; len &amp;&amp; arr[i] == <span class="number">0</span>) i++;</span><br><span class="line">        <span class="keyword">if</span>(i == len) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="type">const</span> <span class="type">int</span> val = arr[i];</span><br><span class="line">        <span class="keyword">for</span>(; i &lt; len; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="number">0</span> != arr[i] &amp;&amp; val != arr[i]) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">minimumSubstringsInPartition</span><span class="params">(string s)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> n = s.<span class="built_in">length</span>();</span><br><span class="line">        vector&lt;vector&lt;<span class="type">bool</span>&gt;&gt; <span class="built_in">isBalance</span>(n, <span class="built_in">vector</span>&lt;<span class="type">bool</span>&gt;(n));</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="type">int</span> charCnt[<span class="number">26</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j = i; j &lt; n; j++) &#123;</span><br><span class="line">                charCnt[s[j] - <span class="string">&#x27;a&#x27;</span>]++;</span><br><span class="line">                isBalance[i][j] = <span class="built_in">allEqualsExceptZero</span>(charCnt, <span class="number">26</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">dp</span><span class="params">(n, INT_MAX)</span></span>;</span><br><span class="line">        dp[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(isBalance[<span class="number">0</span>][i])</span><br><span class="line">                dp[i] = <span class="built_in">min</span>(dp[i], <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">1</span>; j &lt;= i; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span>(isBalance[j][i])</span><br><span class="line">                    dp[i] = <span class="built_in">min</span>(dp[i], dp[j<span class="number">-1</span>] + <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[n<span class="number">-1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="3127-æ„é€ ç›¸åŒé¢œè‰²çš„æ­£æ–¹å½¢"><a href="#3127-æ„é€ ç›¸åŒé¢œè‰²çš„æ­£æ–¹å½¢" class="headerlink" title="3127. æ„é€ ç›¸åŒé¢œè‰²çš„æ­£æ–¹å½¢"></a><a href="https://leetcode.cn/problems/make-a-square-with-the-same-color/description/?envType=daily-question&envId=2024-08-31">3127. æ„é€ ç›¸åŒé¢œè‰²çš„æ­£æ–¹å½¢</a></h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">canMakeSquare</span><span class="params">(vector&lt;vector&lt;<span class="type">char</span>&gt;&gt;&amp; grid)</span> </span>&#123;</span><br><span class="line">        function&lt;<span class="type">int</span>(<span class="type">int</span>, <span class="type">int</span>)&gt; gridValue = [&amp;](<span class="type">int</span> i, <span class="type">int</span> j) &#123;</span><br><span class="line">            <span class="keyword">return</span> grid[i][j] == <span class="string">&#x27;W&#x27;</span> ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">        &#125;;</span><br><span class="line">        function&lt;<span class="type">bool</span>(<span class="type">int</span>, <span class="type">int</span>)&gt; judge = [&amp;](<span class="type">int</span> i, <span class="type">int</span> j) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">2</span> != <span class="built_in">gridValue</span>(i, j) + <span class="built_in">gridValue</span>(i + <span class="number">1</span>, j) + <span class="built_in">gridValue</span>(i, j + <span class="number">1</span>) + <span class="built_in">gridValue</span>(i + <span class="number">1</span>, j + <span class="number">1</span>);</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">judge</span>(<span class="number">0</span>, <span class="number">0</span>) || <span class="built_in">judge</span>(<span class="number">0</span>, <span class="number">1</span>) || <span class="built_in">judge</span>(<span class="number">1</span>, <span class="number">0</span>) || <span class="built_in">judge</span>(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="3153-æ‰€æœ‰æ•°å¯¹ä¸­æ•°ä½å·®ä¹‹å’Œ"><a href="#3153-æ‰€æœ‰æ•°å¯¹ä¸­æ•°ä½å·®ä¹‹å’Œ" class="headerlink" title="3153. æ‰€æœ‰æ•°å¯¹ä¸­æ•°ä½å·®ä¹‹å’Œ"></a><a href="https://leetcode.cn/problems/sum-of-digit-differences-of-all-pairs/description/?envType=daily-question&envId=2024-08-30">3153. æ‰€æœ‰æ•°å¯¹ä¸­æ•°ä½å·®ä¹‹å’Œ</a></h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">long</span> <span class="type">long</span> <span class="title">sumDigitDifferences</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> len = nums.<span class="built_in">size</span>();</span><br><span class="line">        vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; <span class="built_in">digitCnt</span>(<span class="number">10</span>, <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(<span class="number">10</span>)); <span class="comment">// digitCnt[i][j], numsä¸­ç¬¬iä½ä¸ºjçš„æ•°çš„ä¸ªæ•°</span></span><br><span class="line">        <span class="keyword">auto</span> cntDigitNumPerPos = [&amp;]() &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> index = <span class="number">0</span>; index &lt; len; index++) &#123;</span><br><span class="line">                <span class="type">int</span> n = nums[index];</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; n; i++, n /= <span class="number">10</span>) &#123;</span><br><span class="line">                    digitCnt[i][n % <span class="number">10</span>]++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="built_in">cntDigitNumPerPos</span>();</span><br><span class="line">        <span class="keyword">auto</span> cntDiffsAndAdd = [&amp;]() &#123;</span><br><span class="line">            <span class="type">long</span> <span class="type">long</span> diffCnt = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> index = <span class="number">0</span>; index &lt; len; index++) &#123;</span><br><span class="line">                <span class="type">int</span> n = nums[index];</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; n; i++, n /= <span class="number">10</span>) &#123;</span><br><span class="line">                    diffCnt += len - digitCnt[i][n % <span class="number">10</span>]; <span class="comment">// æ•°å‡ºæœ‰å¤šå°‘æ•°å’Œå½“å‰æ•°çš„ç¬¬iä½ä¸åŒ</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> diffCnt;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">cntDiffsAndAdd</span>() / <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="89-æ ¼é›·ç¼–ç "><a href="#89-æ ¼é›·ç¼–ç " class="headerlink" title="89. æ ¼é›·ç¼–ç "></a><a href="https://leetcode.cn/problems/gray-code/description/">89. æ ¼é›·ç¼–ç </a></h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">grayCode</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> len = <span class="number">1</span> &lt;&lt; n;</span><br><span class="line">        <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">ans</span><span class="params">(len)</span></span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt; len; i++) &#123;</span><br><span class="line">            ans[i] = (i &gt;&gt; <span class="number">1</span>) ^ i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="è¯æ˜"><a href="#è¯æ˜" class="headerlink" title="è¯æ˜"></a>è¯æ˜</h3><p>æ¨å¯¼ä¸€ä¸‹å…¬å¼ä¸ºä»€ä¹ˆæ—¶æ­£ç¡®çš„</p><p>è¦è¯æ˜å…¬å¼ $ a_i &#x3D; (i &gt;&gt; 1) \oplus i $ æ˜¯æ ¼é›·ç ï¼Œå°±è¦è¯æ˜ $ a_{i+1} \oplus a_{i} &#x3D; 2^{k_i} $ , å…¶ä¸­ $ k_i $ æ˜¯æ•´æ•°</p><p>è®¾ $ i $çš„äºŒè¿›åˆ¶ä»ä½ä½åˆ°é«˜ä½ç¬¬ä¸€ä¸ª$ 0 $çš„ä½ç½®æ˜¯$ n $, åˆ™ $ i \oplus (i + 1) &#x3D; 2^{n+1} - 1$ï¼ŒåŸå› å‚è€ƒ<a href="https://blog.csdn.net/gengduc/article/details/131425911">äºŒè¿›åˆ¶è‡ªå¢è®¡æ•°å™¨</a>çš„åŸç†</p><p>$ a_{i+1} \oplus a_{i} $<br>$ &#x3D; (i &gt;&gt; 1) \oplus i \oplus ((i + 1) &gt;&gt; 1) \oplus (i + 1) $<br>$ &#x3D; (i \oplus (i + 1)) \oplus ((i \oplus (i + 1)) &gt;&gt; 1)$<br>$ &#x3D; (2^{n+1} - 1) \oplus (2^{n} - 1) $<br>$ &#x3D; 2^{n+1} $</p><h2 id="2708-ä¸€ä¸ªå°ç»„çš„æœ€å¤§å®åŠ›å€¼"><a href="#2708-ä¸€ä¸ªå°ç»„çš„æœ€å¤§å®åŠ›å€¼" class="headerlink" title="2708. ä¸€ä¸ªå°ç»„çš„æœ€å¤§å®åŠ›å€¼"></a>2708. ä¸€ä¸ªå°ç»„çš„æœ€å¤§å®åŠ›å€¼</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">long</span> <span class="type">long</span> <span class="title">maxStrength</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="type">long</span> <span class="type">long</span> ans = <span class="number">1</span>;</span><br><span class="line">        <span class="type">bool</span> has2Neg = <span class="literal">false</span>;</span><br><span class="line">        <span class="type">bool</span> hasPositive = <span class="literal">false</span>;</span><br><span class="line">        <span class="type">bool</span> hasZero = <span class="literal">false</span>;</span><br><span class="line">        <span class="type">long</span> <span class="type">long</span> negProduct = <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> len = nums.<span class="built_in">size</span>();</span><br><span class="line">        <span class="built_in">sort</span>(nums.<span class="built_in">begin</span>(), nums.<span class="built_in">end</span>());</span><br><span class="line">        <span class="type">int</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(i &lt; len &amp;&amp; nums[i] &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            negProduct *= nums[i];</span><br><span class="line">            <span class="keyword">if</span>(negProduct &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                ans *= negProduct;</span><br><span class="line">                negProduct = <span class="number">1</span>;</span><br><span class="line">                has2Neg = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            i++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span>(i &lt; len &amp;&amp; nums[i] &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            hasZero = <span class="literal">true</span>;</span><br><span class="line">            i++;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(i &lt; len)&#123;</span><br><span class="line">            ans *= nums[i];</span><br><span class="line">            i++;</span><br><span class="line">            hasPositive = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> (has2Neg || hasPositive) ? ans :</span><br><span class="line">                (hasZero) ? <span class="number">0</span> : nums[<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li>é™¤äº†0ï¼Œå…¨ä¹˜èµ·æ¥ï¼Œå¦‚æœè´Ÿæ•°æœ‰å¥‡æ•°ä¸ªï¼Œå»æ‰æœ€å¤§çš„è´Ÿæ•°</li><li>å¦‚æœæ²¡æœ‰æ­£æ•°ä¹Ÿæ²¡æœ‰æˆå¯¹çš„è´Ÿæ•°ï¼Œä½†æ˜¯æœ‰0ï¼Œè¿”å›0</li><li>å¦‚æœæ²¡æœ‰æ­£æ•°ä¹Ÿæ²¡æœ‰æˆå¯¹çš„è´Ÿæ•°ï¼Œæ²¡æœ‰0ï¼Œè¿”å›å”¯ä¸€çš„è´Ÿæ•°</li></ul><blockquote><p>æ•°æ®è§„æ¨¡å¥½å°ï¼Œç»™äººä¸€ç§å¾ˆéš¾çš„æ„Ÿè§‰</p></blockquote><h2 id="2024-è€ƒè¯•çš„æœ€å¤§å›°æ‰°åº¦"><a href="#2024-è€ƒè¯•çš„æœ€å¤§å›°æ‰°åº¦" class="headerlink" title="2024. è€ƒè¯•çš„æœ€å¤§å›°æ‰°åº¦"></a>2024. è€ƒè¯•çš„æœ€å¤§å›°æ‰°åº¦</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="type">int</span> _maxConsecutiveAnswers(<span class="type">const</span> string&amp; answerKey, <span class="type">int</span> k) &#123;</span><br><span class="line">        <span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> len = answerKey.<span class="built_in">size</span>();</span><br><span class="line">        <span class="type">int</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(i &lt; len &amp;&amp; k &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">while</span>(i &lt; len &amp;&amp; answerKey[i] == <span class="string">&#x27;T&#x27;</span>) &#123;</span><br><span class="line">                i++;</span><br><span class="line">                ans++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">while</span>(i &lt; len &amp;&amp; k &gt; <span class="number">0</span> &amp;&amp; answerKey[i] == <span class="string">&#x27;F&#x27;</span>) &#123;</span><br><span class="line">                i++;</span><br><span class="line">                k--;</span><br><span class="line">                ans++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> j = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> cur = ans;</span><br><span class="line">        <span class="keyword">while</span>(i &lt; len) &#123;</span><br><span class="line">            <span class="keyword">while</span>(i &lt; len &amp;&amp; answerKey[i] == <span class="string">&#x27;T&#x27;</span>) &#123;</span><br><span class="line">                i++;</span><br><span class="line">                cur++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// cout &lt;&lt; i &lt;&lt; &quot;, &quot; &lt;&lt; ans &lt;&lt; &quot;, &quot; &lt;&lt; cur &lt;&lt; endl;</span></span><br><span class="line">            ans = <span class="built_in">max</span>(ans, cur);</span><br><span class="line">            <span class="keyword">if</span>(i &lt; len &amp;&amp; answerKey[i] == <span class="string">&#x27;F&#x27;</span>) &#123;</span><br><span class="line">                <span class="type">int</span> k = j;</span><br><span class="line">                <span class="keyword">while</span>(k &lt; i &amp;&amp; answerKey[k] == <span class="string">&#x27;T&#x27;</span>) &#123;</span><br><span class="line">                    k++;</span><br><span class="line">                &#125;</span><br><span class="line">                cur = cur - (k - j + <span class="number">1</span>) + <span class="number">1</span>;</span><br><span class="line">                <span class="comment">// cout &lt;&lt; ans &lt;&lt; &quot;, &quot; &lt;&lt; cur &lt;&lt; endl;</span></span><br><span class="line">                ans = <span class="built_in">max</span>(ans, cur);</span><br><span class="line">                j = k + <span class="number">1</span>;</span><br><span class="line">                i++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">maxConsecutiveAnswers</span><span class="params">(string&amp; answerKey, <span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> res = _maxConsecutiveAnswers(answerKey, k);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span>&amp; x : answerKey) &#123;</span><br><span class="line">            x = <span class="string">&#x27;T&#x27;</span> + <span class="string">&#x27;F&#x27;</span> - x;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">max</span>(res, _maxConsecutiveAnswers(answerKey, k));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li>è¦ä¹ˆæŠŠkæ­¥å…¨éƒ½ç”¨åœ¨Tå˜Fä¸Šï¼Œè¦ä¹ˆkæ­¥å…¨éƒ¨æ˜¯Få˜T</li><li>å¯¹äºâ€TTFTTFTTFTTâ€ï¼Œå¯ä»¥ç¿»è¯‘æˆ[2T, 1F, 2T, 1F, 2T, 1F, 2T], å‡è®¾k&#x3D;2ï¼Œæˆ‘ä»¬åªéœ€è¦è€ƒè™‘é€‰å‰ä¸¤ä¸ª1Fæˆ–åä¸¤ä¸ª1Fçš„æƒ…å†µï¼Œå…¶ä»–ä¸è¿ç»­çš„Fçš„ç»„åˆä¸éœ€è¦è€ƒè™‘</li><li>ç»è¿‡ä¸Šé¢çš„åˆ†æï¼Œå¯ä»¥ä½¿ç”¨åŒæŒ‡é’ˆçª—å£<ul><li>å…ˆæŠŠkæ¶ˆè€—å…‰</li><li>æŒ‡é’ˆiæ¯é‡åˆ°ä¸€ä¸ªFï¼Œå‰é¢çš„æŒ‡é’ˆjå°±è¦å‘å‰ç§»åŠ¨ï¼Œæ‰¾åˆ°ä¸€ä¸ªFæŠŠè¿™ä¸ªFå˜æˆTï¼Œç§»åŠ¨å‡ æ­¥ï¼Œå°±å‡å°‘äº†å¤šå°‘ä¸ªTï¼ˆåŒ…æ‹¬jå½“å‰æŒ‡å‘çš„Fï¼Œå·²ç»åœ¨å‰é¢è¢«å˜æˆTäº†ï¼‰</li></ul></li></ul>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;698-åˆ’åˆ†ä¸ºkä¸ªç›¸ç­‰çš„å­é›†&quot;&gt;&lt;a href=&quot;#698-åˆ’åˆ†ä¸ºkä¸ªç›¸ç­‰çš„å­é›†&quot; class=&quot;headerlink&quot; title=&quot;698. åˆ’åˆ†ä¸ºkä¸ªç›¸ç­‰çš„å­é›†&quot;&gt;&lt;/a&gt;698. åˆ’åˆ†ä¸ºkä¸ªç›¸ç­‰çš„å­é›†&lt;/h2&gt;&lt;figure class=&quot;highlight c++&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title class_&quot;&gt;Solution&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title class_&quot;&gt;Solve&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        vector&amp;lt;&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt;&amp;gt;&amp;amp; nums;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; k;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; n;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        vector&amp;lt;&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt;&amp;gt; bucket;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; target;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; sum;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;type&quot;&gt;bool&lt;/span&gt; canPartition;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;type&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;dfs&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; index)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(index &amp;gt;= n) &amp;#123; &lt;span class=&quot;comment&quot;&gt;// æ‰€æœ‰æ•°éƒ½æ”¾è¿›æ¥äº†ï¼Œä¸”æ²¡æœ‰è¶…è¿‡target&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;comment&quot;&gt;// è¯´æ˜ä¸€å®šå…¨ç­‰äºtarget&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;comment&quot;&gt;// å¦‚æœæœ‰æ¡¶&amp;lt;target, åˆ™ä¸€å®šæœ‰æ¡¶&amp;gt;targetï¼Œæ‰€ä»¥æ‰€æœ‰æ¡¶ä¸€å®š&amp;gt;=target&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;comment&quot;&gt;// å¦‚æœæœ‰æ¡¶&amp;gt;target, åˆ™ä¸€å®šæœ‰æ¡¶&amp;lt;targetï¼Œæ‰€ä»¥æ‰€æœ‰æ¡¶ä¸€å®š&amp;lt;=target&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;comment&quot;&gt;// æ‰€ä»¥æ‰€æœ‰æ¡¶ä¸€å®š==target&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; i = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;; i &amp;lt; k; i++) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(i&amp;gt;&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt; &amp;amp;&amp;amp; bucket[i] == bucket[i&lt;span class=&quot;number&quot;&gt;-1&lt;/span&gt;]) &lt;span class=&quot;keyword&quot;&gt;continue&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(bucket[i] + nums[index] &amp;lt;= target) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    bucket[i] += nums[index];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(&lt;span class=&quot;built_in&quot;&gt;dfs&lt;/span&gt;(index+&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    bucket[i] -= nums[index];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;Solve&lt;/span&gt;(vector&amp;lt;&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt;&amp;gt;&amp;amp; nums, &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; k):&lt;span class=&quot;built_in&quot;&gt;nums&lt;/span&gt;(nums), &lt;span class=&quot;built_in&quot;&gt;k&lt;/span&gt;(k), &lt;span class=&quot;built_in&quot;&gt;bucket&lt;/span&gt;(k) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            n = nums.&lt;span class=&quot;built_in&quot;&gt;size&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            sum = &lt;span class=&quot;built_in&quot;&gt;accumulate&lt;/span&gt;(nums.&lt;span class=&quot;built_in&quot;&gt;begin&lt;/span&gt;(), nums.&lt;span class=&quot;built_in&quot;&gt;end&lt;/span&gt;(), &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            target = sum / k;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;built_in&quot;&gt;sort&lt;/span&gt;(nums.&lt;span class=&quot;built_in&quot;&gt;begin&lt;/span&gt;(), nums.&lt;span class=&quot;built_in&quot;&gt;end&lt;/span&gt;(), &lt;span class=&quot;built_in&quot;&gt;greater&lt;/span&gt;&amp;lt;&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt;&amp;gt;());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(sum % k != &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                canPartition = &lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            canPartition = &lt;span class=&quot;built_in&quot;&gt;dfs&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;type&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;solve&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; canPartition;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;type&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;canPartitionKSubsets&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(vector&amp;lt;&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt;&amp;gt;&amp;amp; nums, &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; k)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;Solve&lt;/span&gt;(nums, k).&lt;span class=&quot;built_in&quot;&gt;solve&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;ç¡¬æœ&lt;/p&gt;
&lt;h2 id=&quot;690-å‘˜å·¥çš„é‡è¦æ€§&quot;&gt;&lt;a href=&quot;#690-å‘˜å·¥çš„é‡è¦æ€§&quot; class=&quot;headerlink&quot; title=&quot;690. å‘˜å·¥çš„é‡è¦æ€§&quot;&gt;&lt;/a&gt;690. å‘˜å·¥çš„é‡è¦æ€§&lt;/h2&gt;&lt;figure class=&quot;highlight c++&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title class_&quot;&gt;Solution&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;getImportance&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(vector&amp;lt;Employee*&amp;gt; employees, &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; id)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; len = employees.&lt;span class=&quot;built_in&quot;&gt;size&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        unordered_map&amp;lt;&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt;, Employee*&amp;gt; id2Node;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt;(Employee *employee : employees) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            id2Node[employee-&amp;gt;id] = employee;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        function&amp;lt;&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt;(&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt;)&amp;gt; dfs = [&amp;amp;](&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; currentId) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            Employee *node = id2Node[currentId];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; ans = node-&amp;gt;importance;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; child : node-&amp;gt;subordinates) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                ans += &lt;span class=&quot;built_in&quot;&gt;dfs&lt;/span&gt;(child);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; ans;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;dfs&lt;/span&gt;(id);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h2 id=&quot;699-æ‰è½çš„æ–¹å—&quot;&gt;&lt;a href=&quot;#699-æ‰è½çš„æ–¹å—&quot; class=&quot;headerlink&quot; title=&quot;699. æ‰è½çš„æ–¹å—&quot;&gt;&lt;/a&gt;699. æ‰è½çš„æ–¹å—&lt;/h2&gt;</summary>
    
    
    
    <category term="LeetCode" scheme="https://jingtianer.github.io/home/categories/LeetCode/"/>
    
    <category term="ç®—æ³•" scheme="https://jingtianer.github.io/home/categories/LeetCode/%E7%AE%97%E6%B3%95/"/>
    
    
    <category term="LeetCode" scheme="https://jingtianer.github.io/home/tags/LeetCode/"/>
    
    <category term="ç®—æ³•" scheme="https://jingtianer.github.io/home/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>OI KIWI 01-å€å¢</title>
    <link href="https://jingtianer.github.io/home/2024/08/23/%E7%AE%97%E6%B3%95/OI-KIWI-01-%E5%80%8D%E5%A2%9E/"/>
    <id>https://jingtianer.github.io/home/2024/08/23/%E7%AE%97%E6%B3%95/OI-KIWI-01-%E5%80%8D%E5%A2%9E/</id>
    <published>2024-08-23T03:14:34.000Z</published>
    <updated>2025-04-15T02:37:55.628Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://oi-wiki.org/basic/binary-lifting/">OI KIWI å€å¢</a></p><h2 id="æ€æƒ³"><a href="#æ€æƒ³" class="headerlink" title="æ€æƒ³"></a>æ€æƒ³</h2><p><img src="/home/./images/lifting_alogrithm.jpeg"></p><blockquote><p><a href="https://blog.csdn.net/bei2002315/article/details/126235995">å›¾ç‰‡æ¥æº</a></p></blockquote><h2 id="æŸ¥æ‰¾å°äºlimitçš„æœ€å¤§æ•°å­—"><a href="#æŸ¥æ‰¾å°äºlimitçš„æœ€å¤§æ•°å­—" class="headerlink" title="æŸ¥æ‰¾å°äºlimitçš„æœ€å¤§æ•°å­—"></a>æŸ¥æ‰¾å°äºlimitçš„æœ€å¤§æ•°å­—</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">maxValueInVecSmallerThenLimit</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; vec, <span class="type">int</span> limit)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> n = vec.<span class="built_in">size</span>();</span><br><span class="line">    <span class="type">int</span> l = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> p = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(p) &#123;</span><br><span class="line">        <span class="keyword">if</span>(l + p &lt; n &amp;&amp; vec[l + p] &lt; limit) &#123;</span><br><span class="line">            l += p;</span><br><span class="line">            p &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            p &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> vec[l];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>å’ŒäºŒåˆ†ä¸€æ ·ï¼Œéœ€è¦åœ¨æœ‰åºæ•°ç»„ä¸ŠæŸ¥æ‰¾</p></li><li><p>å¯¹äºæŸ¥æ‰¾åŒºé—´<code>[l, l + p)</code></p><ul><li>å¦‚æœ<code>vec[l+p] &gt;= limit</code>ï¼Œ åˆ™æœ€å¤§å€¼å°±åœ¨<code>[l, l + p)</code>åŒºé—´ä¸Š,ä¸‹ä¸€æ­¥æŸ¥è¯¢<code>[l, l + p / 2)</code></li><li>å¦‚æœ<code>vec[l+p] &lt; limit</code>ï¼Œ åˆ™æœ€å¤§å€¼ä¸åœ¨<code>[l, l + p)</code>åŒºé—´ä¸Š,ä¸‹ä¸€æ­¥æŸ¥è¯¢<code>[l + p, l + 3*p)</code></li><li>å¦‚æœ<code>l+p &gt;= n</code>, åˆ™ç¼©å°æŸ¥æ‰¾èŒƒå›´</li></ul></li><li><p>æˆ‘ä»¬æŠŠä¸Šé¢çš„é€»è¾‘è¿­ä»£ä¸¤æ¬¡</p><ul><li>å¦‚æœ<code>vec[l+p] &gt;= limit</code>ï¼Œ åˆ™æœ€å¤§å€¼å°±åœ¨<code>[l, l + p)</code>åŒºé—´ä¸Š,ä¸‹ä¸€æ­¥æŸ¥è¯¢<code>[l, l + p / 2)</code><ul><li>å¦‚æœ<code>vec[l+p/2] &gt;= limit</code>ï¼Œ åˆ™æœ€å¤§å€¼å°±åœ¨<code>[l, l + p/2)</code>åŒºé—´ä¸Š,ä¸‹ä¸€æ­¥æŸ¥è¯¢<code>[l, l + p / 4)</code></li><li>å¦‚æœ<code>vec[l+p/2] &lt; limit</code>ï¼Œ åˆ™æœ€å¤§å€¼ä¸åœ¨<code>[l, l + p/2)</code>åŒºé—´ä¸Š,ä¸‹ä¸€æ­¥æŸ¥è¯¢<code>[l + p/2, l + p/2 + p)</code></li></ul></li><li>å¦‚æœ<code>vec[l+p] &lt; limit</code>ï¼Œ åˆ™æœ€å¤§å€¼ä¸åœ¨<code>[l, l + p)</code>åŒºé—´ä¸Š,ä¸‹ä¸€æ­¥æŸ¥è¯¢<code>[l + p, l + 3*p)</code><ul><li>å¦‚æœ<code>vec[l+3*p] &gt;= limit</code>ï¼Œ åˆ™æœ€å¤§å€¼å°±åœ¨<code>[l + p, l + 3*p)</code>åŒºé—´ä¸Š,ä¸‹ä¸€æ­¥æŸ¥è¯¢<code>[l + p, l + 2*p)</code></li><li>å¦‚æœ<code>vec[l+3*p] &lt; limit</code>ï¼Œ åˆ™æœ€å¤§å€¼ä¸åœ¨<code>[l + p, l + 3*p)</code>åŒºé—´ä¸Š,ä¸‹ä¸€æ­¥æŸ¥è¯¢<code>[l + 3 * p, l + 7 * p)</code></li></ul></li></ul></li></ul><h2 id="RMQåŒºé—´æœ€å€¼"><a href="#RMQåŒºé—´æœ€å€¼" class="headerlink" title="RMQåŒºé—´æœ€å€¼"></a>RMQåŒºé—´æœ€å€¼</h2><p>Range Maximum&#x2F;Minimum Query</p><h3 id="å•è°ƒæ ˆ"><a href="#å•è°ƒæ ˆ" class="headerlink" title="å•è°ƒæ ˆ"></a>å•è°ƒæ ˆ</h3><p>ç”¨å•è°ƒæ ˆæ‰¾åˆ°ä¸¤ä¸ªæ•°ç»„<code>left</code>å’Œ<code>right</code></p><ul><li><code>left[i]</code>ä»£è¡¨<code>arr[i]</code>åœ¨<code>[left[i], i]</code>çš„åŒºé—´ä¸Šæ˜¯æœ€å°å€¼</li><li><code>right[i]</code>ä»£è¡¨<code>arr[i]</code>åœ¨<code>[i, right[i]]</code>çš„åŒºé—´ä¸Šæ˜¯æœ€å°å€¼</li><li>å¯¹äºä¸€ä¸ªæŸ¥è¯¢<code>[l, r]</code><ul><li>å¦‚æœ<code>left[r] &lt;= l</code>, <code>arr[r]</code>æ˜¯åŒºé—´æœ€å°å€¼</li><li>å¦‚æœ<code>right[l] &gt;= r</code>, <code>arr[l]</code>æ˜¯åŒºé—´æœ€å°å€¼</li><li>å¦åˆ™<code>l = right[l] + 1</code>, <code>r = left[r] - 1</code>ï¼Œç¼©å°æŸ¥æ‰¾èŒƒå›´</li></ul></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">RangeMinimumQuery</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; arr, vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; queries)</span> </span>&#123;</span><br><span class="line">    stack&lt;<span class="type">int</span>&gt; monoStack;</span><br><span class="line">    <span class="type">int</span> len = arr.<span class="built_in">size</span>();</span><br><span class="line">    <span class="type">int</span> res = <span class="number">0</span>;</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">left</span><span class="params">(len)</span>, <span class="title">right</span><span class="params">(len, len - <span class="number">1</span>)</span></span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">        left[i] = right[i] = i;</span><br><span class="line">        <span class="type">int</span> top = <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">while</span>(!monoStack.<span class="built_in">empty</span>() &amp;&amp; arr[monoStack.<span class="built_in">top</span>()] &gt;= arr[i]) &#123;</span><br><span class="line">            top = monoStack.<span class="built_in">top</span>();</span><br><span class="line">            monoStack.<span class="built_in">pop</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(top != <span class="number">-1</span>) left[i] = left[top];</span><br><span class="line">        monoStack.<span class="built_in">push</span>(i);</span><br><span class="line">    &#125;</span><br><span class="line">    monoStack = <span class="built_in">stack</span>&lt;<span class="type">int</span>&gt;();</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = len - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">        <span class="type">int</span> top = <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">while</span>(!monoStack.<span class="built_in">empty</span>() &amp;&amp; arr[monoStack.<span class="built_in">top</span>()] &gt; arr[i]) &#123;</span><br><span class="line">            top = monoStack.<span class="built_in">top</span>();</span><br><span class="line">            monoStack.<span class="built_in">pop</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(top != <span class="number">-1</span>) right[i] = right[top];</span><br><span class="line">        monoStack.<span class="built_in">push</span>(i);</span><br><span class="line">    &#125;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; ans;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">const</span> <span class="keyword">auto</span>&amp; query : queries) &#123;</span><br><span class="line">        <span class="type">int</span> l = query[<span class="number">0</span>], r = query[<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">while</span>(right[l] &lt; r &amp;&amp; left[r] &gt; l) &#123; </span><br><span class="line">            <span class="comment">// æœ‰å¯èƒ½å¾ªç¯n/2æ¬¡ï¼Œé€€åŒ–æˆO(n), å¦‚5,4,3,2,1,2,3,4,5</span></span><br><span class="line">            l = <span class="built_in">min</span>(len - <span class="number">1</span>, right[l] + <span class="number">1</span>);</span><br><span class="line">            r = <span class="built_in">max</span>(<span class="number">0</span>, left[r] - <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        ans.<span class="built_in">push_back</span>(<span class="built_in">min</span>(arr[l], arr[r]));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="STè¡¨"><a href="#STè¡¨" class="headerlink" title="STè¡¨"></a>STè¡¨</h3><p>å‚è€ƒè¿™é‡Œï¼š<a href="https://oi-wiki.org/ds/sparse-table/">https://oi-wiki.org/ds/sparse-table/</a></p><p>é€‚ç”¨èŒƒå›´ï¼šå¯é‡å¤è´¡çŒ®é—®é¢˜</p><ul><li>op(x, x) &#x3D; x, ä¸€ä¸ªæ“ä½œé‡å¤è®¡ç®—ç­‰äºå…¶æœ¬èº«</li><li>æ¯”å¦‚max, min, gcdç­‰æ“ä½œ</li><li>è¿™æ ·å¯ä»¥å…è®¸æˆ‘ä»¬åˆ’åˆ†å­é—®é¢˜æ—¶ï¼Œå³ä½¿å­é—®é¢˜ä¹‹é—´å­˜åœ¨é‡å ï¼Œä¹Ÿå¯ä»¥è·å¾—æ­£ç¡®çš„ç»“æœ</li></ul><p>$ ST[i][j] &#x3D; min(arr[iâ€¦(i + 2^j - 1)]) $ (é—­åŒºé—´)</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">6,5,1,4,6,1,5,3</span></span><br><span class="line"><span class="comment">ç¨€ç–è¡¨</span></span><br><span class="line"><span class="comment">0 1 3 7</span></span><br><span class="line"><span class="comment">0 1 2 3</span></span><br><span class="line"><span class="comment">â€”â€”â€”â€”â€”â€”â€”</span></span><br><span class="line"><span class="comment">6 5 4 1</span></span><br><span class="line"><span class="comment">5 1 1 1</span></span><br><span class="line"><span class="comment">1 1 1 1</span></span><br><span class="line"><span class="comment">4 4 5 1</span></span><br><span class="line"><span class="comment">6 1 1 1</span></span><br><span class="line"><span class="comment">1 1 1 1</span></span><br><span class="line"><span class="comment">5 3 3 3</span></span><br><span class="line"><span class="comment">3 3 3 3</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>å¯è§æ„é€ çš„æ—¶é—´ä¸ºO(nlogn)</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">0...1 1...2 2...3 3...4 4...5 5...6 6...7</span></span><br><span class="line"><span class="comment">0...3 1...4 2...5 3...6 4...7 5...7 6...7</span></span><br><span class="line"><span class="comment">0...7 1...7 2...7 3...7 4...7 5...7 6...7</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">0...2 -&gt; 0...1, 1...2</span></span><br><span class="line"><span class="comment">0...4 -&gt; 0...3, 1...4</span></span><br><span class="line"><span class="comment">0...5 -&gt; 0...3, 2...5</span></span><br><span class="line"><span class="comment">0...6 -&gt; 0...3, 3...6</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>ä¸€ä¸ªæŸ¥è¯¢æœ‰å¯æ‹†æˆåŒä¸€è¡Œçš„ä¸¤ä¸ªå­æ•°ç»„</p><p>å› ä¸º $ ST[i][j] &#x3D; min(arr[iâ€¦(i + 2^j - 1)]) $</p><p>$ start &#x3D; i $ , $end &#x3D; i + 2^j - 1$</p><p>è§£å¾—<br>$j &#x3D; log(end - start + 1)$</p><p>è¦æŸ¥ $ 0 â€¦ 6 $ï¼ŒæŸ¥è¯¢ $ (0, log(6-0+1)) $ &#x3D; $ (0, 2) $ &#x3D; $ 0 â€¦ 3 $<br>ä¸‹é¢æŸ¥ $ 3 â€¦ 6 $ï¼ŒæŸ¥è¯¢ $ (3, 2) $ &#x3D; $ (6 - 2^2 + 1, 2) $<br>å…¬å¼æ˜¯è¿™ä¹ˆæ¥çš„ï¼š<br>$aâ€¦b$ &#x3D; $(a, a + 2^j - 1)$ &#x3D; $(b - 2^j + 1, b)$</p><p>è¦æŸ¥$0 â€¦ 5$ï¼ŒæŸ¥è¯¢$(0, log(5-0+1))$ &#x3D; $(0, 2)$ &#x3D; $0 â€¦ 3$<br>ä¸‹é¢æŸ¥$ 2 â€¦ 5 $, æŸ¥è¯¢$(2, 2)$ &#x3D; $(5 - 2^2 + 1, 2)$<br>ä¹Ÿå°±æ˜¯è¯´ï¼Œè¦æŸ¥è¯¢$ aâ€¦b $<br>ç›¸å½“äº$ min(aâ€¦(a+2^j-1), (b - 2^j + 1)â€¦b) $<br>$ min(ST[a][j], ST[b-2^j+1][j]), j &#x3D; log2(b-a+1)$</p><p>å¦‚ä½•æ„é€ STè¡¨ï¼š<br>$ (i, i + 2^j - 1) &#x3D; (i, i + 2^{j-1} - 1), (i + 2^{j-1}, i + 2^j - 1) $<br>$ ST[i][j] &#x3D; min(ST[i][j-1], ST[i+j][j-1]) $ </p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">RMQ</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; array, vector&lt;pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt;&gt;&amp; query)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> n = array.<span class="built_in">size</span>();</span><br><span class="line">    <span class="type">int</span> log_n = <span class="built_in">log2</span>(n);</span><br><span class="line">    vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; <span class="built_in">ST</span>(n);</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; ans;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        ST[i].<span class="built_in">push_back</span>(array[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// sum[p=1...log2(n)](n-p) = n*log2(n) - (log2(n)+1)*log2(n)/2</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">1</span>; j &lt;= log_n + <span class="number">1</span>; j++) &#123;</span><br><span class="line">        <span class="type">int</span> off = <span class="number">1</span> &lt;&lt; (j - <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i + off &lt; n; i++) &#123; <span class="comment">// n - j</span></span><br><span class="line">            ST[i].<span class="built_in">push_back</span>(<span class="built_in">min</span>(ST[i][j<span class="number">-1</span>], ST[i+off][j<span class="number">-1</span>]));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> [start, end] : query) &#123;</span><br><span class="line">        <span class="type">int</span> pos = <span class="built_in">log2</span>(end - start + <span class="number">1</span>);</span><br><span class="line">        ans.<span class="built_in">push_back</span>(<span class="built_in">min</span>(ST[start][pos], ST[end - (<span class="number">1</span> &lt;&lt; pos) + <span class="number">1</span>][pos]));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å¿«é€Ÿå¹‚"><a href="#å¿«é€Ÿå¹‚" class="headerlink" title="å¿«é€Ÿå¹‚"></a>å¿«é€Ÿå¹‚</h2><p>å¯¹æŒ‡æ•°è¿›è¡ŒäºŒè¿›åˆ¶åˆ†è§£<br>$ n $ &#x3D; 22 &#x3D; 10110 &#x3D; $2^4 + 2^2 + 2^1$<br>$ a^{n} &#x3D; a^{2^4} \times a^{2^2} \times a^{2^1}$</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">fastPow</span><span class="params">(<span class="type">int</span> base, <span class="type">int</span> pow, <span class="type">int</span> mod)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> ans = <span class="number">1</span> % mod; <span class="comment">// æ³¨æ„è¦åœ¨æœ€åˆæˆ–æœ€åå¯¹anså–modï¼Œä»¥åº”å¯¹pow = 0, mod = 1çš„æƒ…å†µ</span></span><br><span class="line">    <span class="keyword">while</span>(pow) &#123;</span><br><span class="line">        <span class="keyword">if</span>(pow &amp; <span class="number">1</span>) ans = (ans * base) % mod;</span><br><span class="line">        base = (base * base) % mod;</span><br><span class="line">        pow &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="LCAæœ€è¿‘å…¬å…±ç¥–å…ˆ"><a href="#LCAæœ€è¿‘å…¬å…±ç¥–å…ˆ" class="headerlink" title="LCAæœ€è¿‘å…¬å…±ç¥–å…ˆ"></a>LCAæœ€è¿‘å…¬å…±ç¥–å…ˆ</h2><h3 id="éå†äºŒå‰æ ‘"><a href="#éå†äºŒå‰æ ‘" class="headerlink" title="éå†äºŒå‰æ ‘"></a>éå†äºŒå‰æ ‘</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">TreeNode* <span class="title">lowestCommonAncestor</span><span class="params">(TreeNode* root, TreeNode* p, TreeNode* q)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!root) <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">        <span class="keyword">if</span>(root == p || root == q) <span class="keyword">return</span> root;</span><br><span class="line">        TreeNode *l = <span class="built_in">lowestCommonAncestor</span>(root-&gt;left, p, q);</span><br><span class="line">        TreeNode *r = <span class="built_in">lowestCommonAncestor</span>(root-&gt;right, p, q);</span><br><span class="line">        <span class="keyword">if</span>(l != <span class="literal">nullptr</span> &amp;&amp; r != <span class="literal">nullptr</span>) <span class="keyword">return</span> root; <span class="comment">// på’Œqåˆ†åˆ«åœ¨å·¦å³å­æ ‘ä¸­æ‰¾åˆ°</span></span><br><span class="line">        <span class="keyword">return</span> l == <span class="literal">nullptr</span> ? r : l;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å¤æ‚åº¦ä¸º$ O(n) $<br>å¯¹äº$m$æ¬¡æŸ¥è¯¢,å¤æ‚åº¦ä¸º$O(m \times n)$</p><h3 id="STè¡¨-1"><a href="#STè¡¨-1" class="headerlink" title="STè¡¨"></a>STè¡¨</h3><p>å½“æŸ¥æ‰¾ä¸¤ä¸ªèŠ‚ç‚¹node0å’Œnode1çš„æœ€è¿‘å…¬å…±ç¥–å…ˆæ—¶</p><ul><li>å¦‚æœnode0å’Œnode1åœ¨åŒä¸€å±‚ï¼Œæ·±åº¦ä¸º<code>d</code><ul><li>å¦‚æœä¸¤ä¸ªèŠ‚ç‚¹åœ¨æ·±åº¦<code>d-k</code>å±‚å¤„çš„ç¥–å…ˆæ˜¯åŒä¸€ä¸ª<ul><li>é‚£ä¹ˆè¯´æ˜æœ€è¿‘å…¬å…±ç¥–å…ˆåœ¨<code>[d-k, d+1]</code></li><li><code>k</code>åå¤§äº†ï¼Œéœ€è¦å‡å°</li></ul></li><li>å¦‚æœä¸¤ä¸ªèŠ‚ç‚¹åœ¨æ·±åº¦<code>d-k</code>å±‚å¤„çš„ç¥–å…ˆä¸æ˜¯åŒä¸€ä¸ª<ul><li>é‚£ä¹ˆè¯´æ˜æœ€è¿‘å…¬å…±ç¥–å…ˆåœ¨<code>[0, d-k]</code></li><li>å°†ä¸¤ä¸ªèŠ‚ç‚¹ç§»åŠ¨åˆ°å„è‡ª<code>d-k</code>å±‚å¤„çš„ç¥–å…ˆå¤„</li></ul></li></ul></li></ul><p>å¦‚æ­¤è¿­ä»£ï¼Œå°±å¯ä»¥å°†åŒºé—´ä¸æ–­ç¼©å°ï¼Œæœ€åå®šä½åˆ°æœ€è¿‘å…¬å…±ç¥–å…ˆ<br>å¦‚æœ<code>k</code>å–å½“å‰æ·±åº¦çš„ä¸€åŠï¼Œå°±å¯ä»¥è¾¾åˆ°<code>log(depth)</code>çš„å¤æ‚åº¦</p><p><code>ST[i][j]</code>è¡¨ç¤ºèŠ‚ç‚¹<code>i</code>å‘ä¸Š<code>2^j</code>å±‚çš„ç¥–å…ˆèŠ‚ç‚¹<br>$ 2^j &lt; depth, j&#x3D;0â€¦floor(log2(depth))$<br>è½¬ç§»æ–¹ç¨‹ä¸º:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ST[i][j] = ST[ST[i][j<span class="number">-1</span>]][j<span class="number">-1</span>]</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå°±ç”¨åˆ°äº†å€å¢çš„æ€æƒ³</p><ul><li>å¦‚æœnode0å’Œnode1åœ¨ä¸åŒä¸€å±‚ï¼Œå¯ä»¥å…ˆå°†æ·±åº¦è¾ƒæ·±çš„èŠ‚ç‚¹å‘ä¸Šç§»åŠ¨<br>å‡è®¾é«˜åº¦å·®ä¸º5&#x3D;101<br>åˆ™<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">node = ST[node][<span class="number">0</span>] <span class="comment">// j = 0, 2^0</span></span><br><span class="line">node = ST[node][<span class="number">2</span>] <span class="comment">// j = 2, 2^2</span></span><br></pre></td></tr></table></figure>å°†é«˜åº¦å·®çš„äºŒè¿›åˆ¶åˆ†è§£ï¼Œå³å¯ä»¥<code>log(dep1 - dep2)</code>çš„å¤æ‚åº¦å°†ä¸¤ä¸ªèŠ‚ç‚¹æ”¾åˆ°åŒä¸€å±‚</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">LCA</span> &#123;</span><br><span class="line">    vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; tree; <span class="comment">// tree[i][j]ä»£è¡¨èŠ‚ç‚¹içš„ç¬¬jä¸ªå­©å­åœ¨treeä¸­çš„ç´¢å¼•</span></span><br><span class="line">    <span class="type">int</span> N; <span class="comment">// èŠ‚ç‚¹æ€»æ•°</span></span><br><span class="line">    vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; ST; <span class="comment">// ST[i][j]è¡¨ç¤ºèŠ‚ç‚¹iå‘ä¸Š2^jå±‚çš„ç¥–å…ˆèŠ‚ç‚¹</span></span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; depth; <span class="comment">// depth[i]ä»£è¡¨èŠ‚ç‚¹çš„æ·±åº¦</span></span><br><span class="line">    <span class="type">int</span> maxDepth = <span class="number">0</span>; <span class="comment">// æ ‘çš„æ·±åº¦</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">dfsInit</span><span class="params">(<span class="type">int</span> root, <span class="type">int</span> dep)</span> </span>&#123;</span><br><span class="line">        depth[root] = dep; <span class="comment">// æ¯ä¸ªèŠ‚ç‚¹çš„æ·±åº¦</span></span><br><span class="line">        maxDepth = <span class="built_in">max</span>(maxDepth, dep);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> child : tree[root]) &#123;</span><br><span class="line">            <span class="built_in">dfsInit</span>(child, dep + <span class="number">1</span>);</span><br><span class="line">            ST[child][<span class="number">0</span>] = root;<span class="comment">// childèŠ‚ç‚¹å‘ä¸Š2^0=1å±‚çš„çˆ¶èŠ‚ç‚¹</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">initST</span><span class="params">()</span> </span>&#123; <span class="comment">// iå‘ä¸Š2^jå±‚çš„çˆ¶èŠ‚ç‚¹ = iå‘ä¸Šå‘ä¸Š2^(j-1)å±‚çˆ¶èŠ‚ç‚¹å†å‘ä¸Š2^(j-1)å±‚çš„çˆ¶èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">1</span>; (<span class="number">1</span> &lt;&lt; j) &lt;= maxDepth; j++) &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; N; i++) &#123;</span><br><span class="line">                ST[i].<span class="built_in">push_back</span>(ST[ST[i][j<span class="number">-1</span>]][j<span class="number">-1</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">LCA</span>(vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; tree, <span class="type">int</span> N): </span><br><span class="line">        <span class="built_in">tree</span>(tree), <span class="built_in">N</span>(N), <span class="built_in">depth</span>(N), <span class="built_in">ST</span>(N, <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(<span class="number">1</span>)) &#123;</span><br><span class="line">        <span class="built_in">dfsInit</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="built_in">initST</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">LCA</span>(vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; tree):<span class="built_in">LCA</span>(tree, tree.<span class="built_in">size</span>()) &#123;&#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">lca</span><span class="params">(<span class="type">int</span> node0, <span class="type">int</span> node1)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(depth[node0] &gt; depth[node1]) &#123;</span><br><span class="line">            <span class="built_in">swap</span>(node0, node1); <span class="comment">// node1ä¸ºæ·±åº¦æ›´æ·±çš„èŠ‚ç‚¹</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> depDiff = depth[node1] - depth[node0];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; depDiff; depDiff &gt;&gt;= <span class="number">1</span>, i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(depDiff &amp; <span class="number">1</span>) &#123;</span><br><span class="line">                node1 = ST[node1][i]; <span class="comment">// å‘ä¸Šç§»åŠ¨node1ï¼Œä¸¤è€…depthç›¸åŒ</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(node1 == node0) <span class="keyword">return</span> node0;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="built_in">log2</span>(maxDepth); i &gt;= <span class="number">0</span>; i--) &#123; <span class="comment">// æ¯æ¬¡å‘ä¸ŠæŸ¥è¯¢çš„æ·±åº¦å‡åŠ</span></span><br><span class="line">            <span class="keyword">if</span>(ST[node0][i] != ST[node1][i]) &#123; <span class="comment">// å‘ä¸Šçš„ç¥–å…ˆèŠ‚ç‚¹ä¸åŒï¼Œç§»åŠ¨åˆ°å„è‡ªç¥–å…ˆèŠ‚ç‚¹ä¸Š</span></span><br><span class="line">                node0 = ST[node0][i];</span><br><span class="line">                node1 = ST[node1][i];</span><br><span class="line">            &#125; <span class="comment">// else å‘ä¸Šçš„ç¥–å…ˆèŠ‚ç‚¹ç›¸åŒï¼Œç»§ç»­å‡å°æ·±åº¦</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ST[node0][<span class="number">0</span>]; <span class="comment">// node0æˆ–node1çš„çˆ¶èŠ‚ç‚¹å°±æ˜¯lca</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li>æ¯æ¬¡æŸ¥è¯¢çš„å¤æ‚åº¦ä¸º<ul><li>$O(log(depth))$</li></ul></li><li>é¢„å¤„ç†çš„æ—¶é—´å¤æ‚åº¦ä¸º<ul><li>$O(log(n \times log(depth)))$</li></ul></li><li>$ m $ æ¬¡æŸ¥è¯¢çš„å¤æ‚åº¦ä¸º<ul><li>$ O((m + n) \times log(depth)) $</li></ul></li></ul>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;a href=&quot;https://oi-wiki.org/basic/binary-lifting/&quot;&gt;OI KIWI å€å¢&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;æ€æƒ³&quot;&gt;&lt;a href=&quot;#æ€æƒ³&quot; class=&quot;headerlink&quot; title=&quot;æ€æƒ³&quot;&gt;&lt;/a&gt;æ€æƒ³&lt;/h2&gt;&lt;p&gt;&lt;img src=&quot;/home/./images/lifting_alogrithm.jpeg&quot;&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://blog.csdn.net/bei2002315/article/details/126235995&quot;&gt;å›¾ç‰‡æ¥æº&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;æŸ¥æ‰¾å°äºlimitçš„æœ€å¤§æ•°å­—&quot;&gt;&lt;a href=&quot;#æŸ¥æ‰¾å°äºlimitçš„æœ€å¤§æ•°å­—&quot; class=&quot;headerlink&quot; title=&quot;æŸ¥æ‰¾å°äºlimitçš„æœ€å¤§æ•°å­—&quot;&gt;&lt;/a&gt;æŸ¥æ‰¾å°äºlimitçš„æœ€å¤§æ•°å­—&lt;/h2&gt;&lt;figure class=&quot;highlight c++&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;maxValueInVecSmallerThenLimit&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(vector&amp;lt;&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt;&amp;gt;&amp;amp; vec, &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; limit)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; n = vec.&lt;span class=&quot;built_in&quot;&gt;size&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; l = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; p = &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;while&lt;/span&gt;(p) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(l + p &amp;lt; n &amp;amp;&amp;amp; vec[l + p] &amp;lt; limit) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            l += p;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            p &amp;lt;&amp;lt;= &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            p &amp;gt;&amp;gt;= &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; vec[l];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="OI KIWI" scheme="https://jingtianer.github.io/home/categories/OI-KIWI/"/>
    
    <category term="ç®—æ³•" scheme="https://jingtianer.github.io/home/categories/OI-KIWI/%E7%AE%97%E6%B3%95/"/>
    
    
    <category term="ç®—æ³•" scheme="https://jingtianer.github.io/home/tags/%E7%AE%97%E6%B3%95/"/>
    
    <category term="OI KIWI" scheme="https://jingtianer.github.io/home/tags/OI-KIWI/"/>
    
  </entry>
  
  <entry>
    <title>LeetCode-36</title>
    <link href="https://jingtianer.github.io/home/2024/08/18/LeetCode/LeetCode-%E5%88%B7%E9%A2%98%E6%80%BB%E7%BB%9336/"/>
    <id>https://jingtianer.github.io/home/2024/08/18/LeetCode/LeetCode-%E5%88%B7%E9%A2%98%E6%80%BB%E7%BB%9336/</id>
    <published>2024-08-18T03:14:34.000Z</published>
    <updated>2025-04-15T02:37:55.602Z</updated>
    
    <content type="html"><![CDATA[<h2 id="551-å­¦ç”Ÿå‡ºå‹¤è®°å½•-I"><a href="#551-å­¦ç”Ÿå‡ºå‹¤è®°å½•-I" class="headerlink" title="551. å­¦ç”Ÿå‡ºå‹¤è®°å½• I"></a><a href="https://leetcode.cn/problems/student-attendance-record-i/description/?envType=daily-question&envId=2024-08-18">551. å­¦ç”Ÿå‡ºå‹¤è®°å½• I</a></h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">checkRecord</span><span class="params">(string s)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> count = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> max_seq_late = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> seq_late = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">char</span> c : s) &#123;</span><br><span class="line">            <span class="keyword">if</span>(c == <span class="string">&#x27;A&#x27;</span>) count++;</span><br><span class="line">            <span class="keyword">if</span>(c == <span class="string">&#x27;L&#x27;</span>) &#123;</span><br><span class="line">                seq_late++;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                max_seq_late = <span class="built_in">max</span>(max_seq_late, seq_late);</span><br><span class="line">                seq_late = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        max_seq_late = <span class="built_in">max</span>(max_seq_late, seq_late);</span><br><span class="line">        <span class="keyword">return</span> count &lt; <span class="number">2</span> &amp;&amp; max_seq_late &lt; <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li>è¿ç»­ç›¸åŒçš„å€¼çš„ä¸ªæ•°</li><li>ç»Ÿè®¡å…ƒç´ å‡ºç°çš„æ¬¡æ•°</li></ul><h2 id="3137-K-å‘¨æœŸå­—ç¬¦ä¸²éœ€è¦çš„æœ€å°‘æ“ä½œæ¬¡æ•°"><a href="#3137-K-å‘¨æœŸå­—ç¬¦ä¸²éœ€è¦çš„æœ€å°‘æ“ä½œæ¬¡æ•°" class="headerlink" title="3137. K å‘¨æœŸå­—ç¬¦ä¸²éœ€è¦çš„æœ€å°‘æ“ä½œæ¬¡æ•°"></a><a href="https://leetcode.cn/problems/minimum-number-of-operations-to-make-word-k-periodic/description/?envType=daily-question&envId=2024-08-17">3137. K å‘¨æœŸå­—ç¬¦ä¸²éœ€è¦çš„æœ€å°‘æ“ä½œæ¬¡æ•°</a></h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">minimumOperationsToMakeKPeriodic</span><span class="params">(string word, <span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">        unordered_map&lt;string, <span class="type">int</span>&gt; subStrCount;</span><br><span class="line">        <span class="type">int</span> len = word.<span class="built_in">length</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; i += k) &#123;</span><br><span class="line">            subStrCount[word.<span class="built_in">substr</span>(i, k)]++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> minOpCnt = len / k;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span>&amp; ite : subStrCount) &#123;</span><br><span class="line">            minOpCnt = <span class="built_in">min</span>(minOpCnt, len / k - ite.second);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> minOpCnt;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li>ç¿»è¯‘ä¸€ä¸‹è§„åˆ™ï¼Œå°±æ˜¯æŠŠé•¿åº¦ä¸º<code>nk</code>çš„å­—ç¬¦ä¸²åˆ‡å‰²æˆ<code>n</code>ä¸ªé•¿åº¦ä¸º<code>k</code>çš„å­ä¸²ï¼Œä¸€æ¬¡æ“ä½œå¯ä»¥æŠŠä¸€ä¸ªå­ä¸²æ›¿æ¢æˆå¦ä¸€ä¸ªå­—ä¸²ï¼Œæ±‚å¦‚ä½•æ›¿æ¢ï¼Œå°†æ‰€æœ‰å­—ä¸²éƒ½ç›¸åŒã€‚</li><li>ç¿»è¯‘å¥½éœ€æ±‚ï¼Œå°±å¾ˆæ¸…æ¥šäº†ï¼Œç›´æ¥ç»Ÿè®¡æ¯ä¸ªå­—ä¸²å‡ºç°çš„æ¬¡æ•°ï¼Œå–å‡ºç°æ¬¡æ•°æœ€å¤§çš„ï¼Œæ›¿æ¢æ¬¡æ•°æœ€å°‘ï¼Œä¸º<code>n - cnt[i]</code></li></ul><h2 id="3117-åˆ’åˆ†æ•°ç»„å¾—åˆ°æœ€å°çš„å€¼ä¹‹å’Œ"><a href="#3117-åˆ’åˆ†æ•°ç»„å¾—åˆ°æœ€å°çš„å€¼ä¹‹å’Œ" class="headerlink" title="3117. åˆ’åˆ†æ•°ç»„å¾—åˆ°æœ€å°çš„å€¼ä¹‹å’Œ"></a><a href="https://leetcode.cn/problems/minimum-sum-of-values-by-dividing-array/description/?envType=daily-question&envId=2024-08-16">3117. åˆ’åˆ†æ•°ç»„å¾—åˆ°æœ€å°çš„å€¼ä¹‹å’Œ</a></h2><h3 id="è¶…æ—¶æš´æœ"><a href="#è¶…æ—¶æš´æœ" class="headerlink" title="è¶…æ—¶æš´æœ"></a>è¶…æ—¶æš´æœ</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    <span class="type">int</span> m;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> minSum = <span class="number">-1</span>;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">minimumValueSum</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums, vector&lt;<span class="type">int</span>&gt;&amp; andValues)</span> </span>&#123;</span><br><span class="line">        n = nums.<span class="built_in">size</span>();</span><br><span class="line">        m = andValues.<span class="built_in">size</span>();</span><br><span class="line">        vector&lt;vector&lt;<span class="type">unsigned</span> <span class="type">int</span>&gt;&gt; <span class="built_in">andMat</span>(n, <span class="built_in">vector</span>&lt;<span class="type">unsigned</span> <span class="type">int</span>&gt;(n, INT_MAX));</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            andMat[i][i] = nums[i];</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j = i + <span class="number">1</span>; j &lt; n; j++) &#123;</span><br><span class="line">                andMat[i][j] = andMat[i][j<span class="number">-1</span>] &amp; nums[j];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">search</span>(andMat, andValues, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> minSum;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">search</span><span class="params">(<span class="type">const</span> vector&lt;vector&lt;<span class="type">unsigned</span> <span class="type">int</span>&gt;&gt;&amp; andMat, <span class="type">const</span> vector&lt;<span class="type">int</span>&gt;&amp; andValues, <span class="type">int</span> depth, <span class="type">int</span> start, <span class="type">unsigned</span> <span class="type">int</span> sum)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(depth + <span class="number">1</span> == m) &#123;</span><br><span class="line">            <span class="keyword">if</span>(andMat[start][n<span class="number">-1</span>] == andValues[m<span class="number">-1</span>]) &#123;</span><br><span class="line">                minSum = <span class="built_in">min</span>(minSum, sum + andMat[n<span class="number">-1</span>][n<span class="number">-1</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = start + <span class="number">1</span>; i &lt; n - m + depth + <span class="number">2</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(andMat[start][i<span class="number">-1</span>] == andValues[depth]) &#123;</span><br><span class="line">                <span class="built_in">search</span>(andMat, andValues, depth + <span class="number">1</span>, i, sum + andMat[i<span class="number">-1</span>][i<span class="number">-1</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="3148-çŸ©é˜µä¸­çš„æœ€å¤§å¾—åˆ†"><a href="#3148-çŸ©é˜µä¸­çš„æœ€å¤§å¾—åˆ†" class="headerlink" title="3148. çŸ©é˜µä¸­çš„æœ€å¤§å¾—åˆ†"></a><a href="https://leetcode.cn/problems/maximum-difference-score-in-a-grid/description/?envType=daily-question&envId=2024-08-15">3148. çŸ©é˜µä¸­çš„æœ€å¤§å¾—åˆ†</a></h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">maxScore</span><span class="params">(vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; grid)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> m = grid.<span class="built_in">size</span>(), n = grid[<span class="number">0</span>].<span class="built_in">size</span>();</span><br><span class="line">        vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; <span class="built_in">mat</span>(m, <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(n, INT_MIN));</span><br><span class="line">        <span class="type">int</span> maxScore = INT_MIN;</span><br><span class="line">        mat[<span class="number">0</span>][<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; n; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span>(i &gt; <span class="number">0</span>) mat[i][j] = <span class="built_in">max</span>(<span class="built_in">max</span>(mat[i][j], grid[i][j] - grid[i<span class="number">-1</span>][j]), mat[i<span class="number">-1</span>][j] + grid[i][j] - grid[i<span class="number">-1</span>][j]);</span><br><span class="line">                <span class="keyword">if</span>(j &gt; <span class="number">0</span>) mat[i][j] = <span class="built_in">max</span>(<span class="built_in">max</span>(mat[i][j], grid[i][j] - grid[i][j<span class="number">-1</span>]), mat[i][j<span class="number">-1</span>] + grid[i][j] - grid[i][j<span class="number">-1</span>]);</span><br><span class="line">                <span class="keyword">if</span>(i &gt; <span class="number">0</span> || j &gt; <span class="number">0</span>) maxScore = <span class="built_in">max</span>(maxScore, mat[i][j]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> maxScore;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li>åªèƒ½å‘ä¸‹æˆ–å‘å³èµ°ï¼Œæ‰€ä»¥å³ä¸‹æ–¹çš„æ ¼å­ä¸ä¼šå½±å“å·¦ä¸Šæ–¹æ ¼å­çš„æœ€ç»ˆç»“æœï¼Œç›´æ¥æ‹¿ä¸Šæ–¹æ ¼å­å’Œå·¦æ–¹æ ¼å­çš„å€¼è®¡ç®—ï¼Œå¹¶å­˜å‚¨åˆ°è¾¾æ¯ä¸ªæ ¼å­çš„æœ€å°å€¼å°±å¥½ã€‚</li></ul><h2 id="3152-ç‰¹æ®Šæ•°ç»„-II"><a href="#3152-ç‰¹æ®Šæ•°ç»„-II" class="headerlink" title="3152. ç‰¹æ®Šæ•°ç»„ II"></a><a href="https://leetcode.cn/problems/special-array-ii/description/?envType=daily-question&envId=2024-08-14">3152. ç‰¹æ®Šæ•°ç»„ II</a></h2><h3 id="äºŒåˆ†"><a href="#äºŒåˆ†" class="headerlink" title="äºŒåˆ†"></a>äºŒåˆ†</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">vector&lt;<span class="type">bool</span>&gt; <span class="title">isArraySpecial</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums, vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; queries)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> n = nums.<span class="built_in">size</span>();</span><br><span class="line">        vector&lt;<span class="type">int</span>&gt; startIndex, endIndex;</span><br><span class="line">        vector&lt;<span class="type">bool</span>&gt; ans;</span><br><span class="line">        <span class="type">int</span> s = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(((nums[i] &amp; <span class="number">1</span>) ^ (nums[i<span class="number">-1</span>] &amp; <span class="number">1</span>)) == <span class="number">0</span>) &#123;</span><br><span class="line">                startIndex.<span class="built_in">push_back</span>(s);</span><br><span class="line">                endIndex.<span class="built_in">push_back</span>(i - <span class="number">1</span>);</span><br><span class="line">                s = i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        startIndex.<span class="built_in">push_back</span>(s);</span><br><span class="line">        endIndex.<span class="built_in">push_back</span>(n - <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> &amp;query : queries) &#123;</span><br><span class="line">            <span class="type">int</span> start = query[<span class="number">0</span>], end = query[<span class="number">1</span>];</span><br><span class="line">            <span class="type">int</span> findIndex = <span class="built_in">upper_bound</span>(startIndex.<span class="built_in">begin</span>(), startIndex.<span class="built_in">end</span>(), start) - startIndex.<span class="built_in">begin</span>() - <span class="number">1</span>;</span><br><span class="line">            ans.<span class="built_in">push_back</span>(endIndex[findIndex] &gt;= end);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li><code>lower_bound</code>: ç›´è¯‘æ˜¯ä¸‹ç•Œï¼Œå®é™…ä¸Šæ˜¯ä¸Šç¡®ç•Œï¼Œä¹Ÿå°±æ˜¯å¯ä»¥ç­‰äºè¢«æŸ¥æ‰¾çš„å…ƒç´ </li><li><code>upper_bound</code>: ç›´è¯‘æ˜¯ä¸Šç•Œï¼Œä¹Ÿå°±æ˜¯ä¸å¯ä»¥ç­‰äºè¢«æŸ¥æ‰¾çš„å…ƒç´ </li></ul><h3 id="æ¨¡ä»¿çº¿æ®µæ ‘"><a href="#æ¨¡ä»¿çº¿æ®µæ ‘" class="headerlink" title="æ¨¡ä»¿çº¿æ®µæ ‘"></a>æ¨¡ä»¿çº¿æ®µæ ‘</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">SegTree</span> &#123;</span><br><span class="line">        vector&lt;<span class="type">int</span>&gt;&amp; nums;</span><br><span class="line">        vector&lt;<span class="type">bool</span>&gt; segTree;</span><br><span class="line">        <span class="type">int</span> n;</span><br><span class="line">        <span class="type">int</span> alignedSize;</span><br><span class="line">        <span class="function"><span class="type">unsigned</span> <span class="type">int</span> <span class="title">alignment</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">            <span class="type">unsigned</span> <span class="type">int</span> mask = <span class="number">0x80000000</span>;</span><br><span class="line">            <span class="keyword">while</span>(mask &amp;&amp; !(mask &amp; n)) mask &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">return</span> (n &amp; (n<span class="number">-1</span>)) != <span class="number">0</span> ? (mask &lt;&lt; <span class="number">1</span>) : mask; <span class="comment">// å¾—åˆ°å¤§äºç­‰äºnçš„2çš„å¹‚</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="type">void</span> <span class="title">initSegTreeLeaf</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(n &lt;= <span class="number">1</span>) <span class="keyword">return</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; n - (n &amp; <span class="number">1</span>); i+=<span class="number">2</span>) &#123;</span><br><span class="line">                <span class="type">int</span> leftIndex = alignedSize + i - <span class="number">1</span>;</span><br><span class="line">                <span class="type">int</span> rightIndex = alignedSize + i;</span><br><span class="line">                leftIndex = (leftIndex - <span class="number">1</span>) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">                segTree[leftIndex] = ((nums[i] &amp; <span class="number">1</span>) ^ (nums[i+<span class="number">1</span>] &amp; <span class="number">1</span>));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="type">bool</span> <span class="title">initSegTree</span><span class="params">(<span class="type">int</span> start, <span class="type">int</span> end, <span class="type">int</span> index)</span> </span>&#123;</span><br><span class="line">            <span class="type">int</span> mid = (end - start) / <span class="number">2</span> + start;</span><br><span class="line">            <span class="keyword">if</span>(start &gt;= end) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">if</span>(index &gt;= alignedSize / <span class="number">2</span>) <span class="keyword">return</span> segTree[index];</span><br><span class="line">            <span class="keyword">if</span>(mid &gt;= <span class="number">0</span> &amp;&amp; mid + <span class="number">1</span> &lt; n) &#123;</span><br><span class="line">                segTree[index] = (nums[mid] &amp; <span class="number">1</span>) ^ (nums[mid+<span class="number">1</span>] &amp; <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            segTree[index] = segTree[index] &amp; <span class="built_in">initSegTree</span>(start, mid, <span class="number">2</span> * index + <span class="number">1</span>) &amp; <span class="built_in">initSegTree</span>(mid+<span class="number">1</span>, end, <span class="number">2</span> * index + <span class="number">2</span>);</span><br><span class="line">            <span class="keyword">return</span> segTree[index];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="type">bool</span> <span class="title">query</span><span class="params">(<span class="type">int</span> i , <span class="type">int</span> j, <span class="type">int</span> start, <span class="type">int</span> end, <span class="type">int</span> index)</span> </span>&#123;</span><br><span class="line">            <span class="type">int</span> mid = (end - start) / <span class="number">2</span> + start;</span><br><span class="line">            <span class="keyword">if</span>(start == end) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">if</span>(i &lt;= start &amp;&amp; end &lt;= j) &#123;</span><br><span class="line">                <span class="keyword">return</span> segTree[index];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(mid &gt;= i &amp;&amp; mid + <span class="number">1</span> &lt;= j &amp;&amp; !((nums[mid] &amp; <span class="number">1</span>) ^ (nums[mid+<span class="number">1</span>] &amp; <span class="number">1</span>))) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">if</span>(mid &gt;= i &amp;&amp; !<span class="built_in">query</span>(i, j, start, mid, <span class="number">2</span> * index + <span class="number">1</span>)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(mid + <span class="number">1</span> &lt;= j &amp;&amp; !<span class="built_in">query</span>(i, j, mid+<span class="number">1</span>, end, <span class="number">2</span> * index + <span class="number">2</span>)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span>:</span><br><span class="line">        <span class="built_in">SegTree</span>(vector&lt;<span class="type">int</span>&gt;&amp; nums): \</span><br><span class="line">            <span class="built_in">nums</span>(nums), <span class="built_in">n</span>(nums.<span class="built_in">size</span>()), \</span><br><span class="line">            <span class="built_in">alignedSize</span>(<span class="built_in">alignment</span>(n)) &#123;</span><br><span class="line">            segTree = <span class="built_in">vector</span>&lt;<span class="type">bool</span>&gt;(alignedSize, <span class="literal">true</span>); <span class="comment">// ä¸ç”¨ä¹˜2ï¼Œå› ä¸ºå¶å­èŠ‚ç‚¹å…¨æ˜¯true</span></span><br><span class="line">            <span class="built_in">initSegTreeLeaf</span>();</span><br><span class="line">            <span class="built_in">initSegTree</span>(<span class="number">0</span>, alignedSize - <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="type">bool</span> <span class="title">query</span><span class="params">(<span class="type">int</span> i , <span class="type">int</span> j)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">query</span>(i, j, <span class="number">0</span>, alignedSize - <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">vector&lt;<span class="type">bool</span>&gt; <span class="title">isArraySpecial</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums, vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; queries)</span> </span>&#123;</span><br><span class="line">        vector&lt;<span class="type">bool</span>&gt; ans;</span><br><span class="line">        <span class="function">SegTree <span class="title">segTree</span><span class="params">(nums)</span></span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span>&amp; q : queries) &#123;</span><br><span class="line">            <span class="type">bool</span> result = segTree.<span class="built_in">query</span>(q[<span class="number">0</span>], q[<span class="number">1</span>]);</span><br><span class="line">            ans.<span class="built_in">push_back</span>(result);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å“ï¼Œé€Ÿåº¦ä¸æ˜¯å¾ˆå¿«<code>279ms å‡»è´¥13.48%</code></p><h3 id="dp"><a href="#dp" class="headerlink" title="dp"></a>dp</h3><h2 id="3151-ç‰¹æ®Šæ•°ç»„-I"><a href="#3151-ç‰¹æ®Šæ•°ç»„-I" class="headerlink" title="3151. ç‰¹æ®Šæ•°ç»„ I"></a><a href="https://leetcode.cn/problems/special-array-i/description/?envType=daily-question&envId=2024-08-13">3151. ç‰¹æ®Šæ•°ç»„ I</a></h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">isArraySpecial</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> len = nums.<span class="built_in">size</span>();</span><br><span class="line">        <span class="type">int</span> odd = nums[<span class="number">0</span>] &amp; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt; len; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>((nums[i] &amp; <span class="number">1</span>) == odd) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            odd = !odd;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="676-å®ç°ä¸€ä¸ªé­”æ³•å­—å…¸"><a href="#676-å®ç°ä¸€ä¸ªé­”æ³•å­—å…¸" class="headerlink" title="676. å®ç°ä¸€ä¸ªé­”æ³•å­—å…¸"></a><a href="https://leetcode.cn/problems/implement-magic-dictionary/description/?envType=daily-question&envId=2024-08-12">676. å®ç°ä¸€ä¸ªé­”æ³•å­—å…¸</a></h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MagicDictionary</span> &#123;</span><br><span class="line">    vector&lt;string&gt; dictionary;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">MagicDictionary</span>() &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">buildDict</span><span class="params">(vector&lt;string&gt; dictionary)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;dictionary = dictionary;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">search</span><span class="params">(string searchWord)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span>&amp; word : dictionary) &#123;</span><br><span class="line">            <span class="keyword">if</span>(word.<span class="built_in">size</span>() != searchWord.<span class="built_in">size</span>()) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">int</span> diff = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; word.<span class="built_in">size</span>(); i++) &#123;</span><br><span class="line">                <span class="keyword">if</span>(word[i] != searchWord[i]) &#123;</span><br><span class="line">                    diff++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(diff == <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="1035-ä¸ç›¸äº¤çš„çº¿"><a href="#1035-ä¸ç›¸äº¤çš„çº¿" class="headerlink" title="1035. ä¸ç›¸äº¤çš„çº¿"></a><a href="https://leetcode.cn/problems/uncrossed-lines/description/?envType=daily-question&envId=2024-08-11">1035. ä¸ç›¸äº¤çš„çº¿</a></h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure><h2 id="3132-æ‰¾å‡ºä¸æ•°ç»„ç›¸åŠ çš„æ•´æ•°-II"><a href="#3132-æ‰¾å‡ºä¸æ•°ç»„ç›¸åŠ çš„æ•´æ•°-II" class="headerlink" title="3132. æ‰¾å‡ºä¸æ•°ç»„ç›¸åŠ çš„æ•´æ•° II"></a>3132. æ‰¾å‡ºä¸æ•°ç»„ç›¸åŠ çš„æ•´æ•° II</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">minimumAddedInteger</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums1, vector&lt;<span class="type">int</span>&gt;&amp; nums2)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">sort</span>(nums1.<span class="built_in">begin</span>(), nums1.<span class="built_in">end</span>());</span><br><span class="line">        <span class="built_in">sort</span>(nums2.<span class="built_in">begin</span>(), nums2.<span class="built_in">end</span>());</span><br><span class="line">        <span class="type">int</span> len2 = nums2.<span class="built_in">size</span>();</span><br><span class="line">        <span class="type">int</span> x = INT_MAX;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> start = <span class="number">0</span>; start &lt; <span class="number">3</span>; start++) &#123;</span><br><span class="line">            <span class="type">int</span> skip = <span class="number">2</span> - start;</span><br><span class="line">            <span class="type">int</span> diff = nums2[<span class="number">0</span>] - nums1[start];</span><br><span class="line">            <span class="type">bool</span> flag = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>, j = <span class="number">1</span>; i &lt; len2; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span>(nums2[i] - nums1[start+j] != diff) &#123;</span><br><span class="line">                    <span class="keyword">if</span>(skip &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                        skip--;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        flag = <span class="literal">false</span>;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    i++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(flag) &#123;</span><br><span class="line">                x = <span class="built_in">min</span>(x, diff);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li>å…ˆæ’åºï¼Œè®¡ç®—å·®å€¼ï¼Œçœ‹æ˜¯å¦æ‰€æœ‰å·®å€¼éƒ½ç›¸åŒ</li><li>ç”±äºæ•°ç»„1çš„é•¿åº¦æ¯”æ•°ç»„2é•¿2ï¼Œæ‰€ä»¥æ¯”æ—¶ç»™æ•°ç»„1ä¸€ä¸ªåç§»</li><li>ç”±äºéœ€è¦åˆ é™¤ä¸¤ä¸ªï¼Œä¸”åˆ é™¤çš„ä½ç½®ä¸åŒï¼Œæ¯”è¾ƒæ—¶å¦‚æœé‡åˆ°ä¸ç›¸ç­‰çš„æƒ…å†µï¼Œåˆ™æ ¹æ®æƒ…å†µè·³è¿‡ä¸€ä¸ª</li></ul><h2 id="3131-æ‰¾å‡ºä¸æ•°ç»„ç›¸åŠ çš„æ•´æ•°-I"><a href="#3131-æ‰¾å‡ºä¸æ•°ç»„ç›¸åŠ çš„æ•´æ•°-I" class="headerlink" title="3131. æ‰¾å‡ºä¸æ•°ç»„ç›¸åŠ çš„æ•´æ•° I"></a>3131. æ‰¾å‡ºä¸æ•°ç»„ç›¸åŠ çš„æ•´æ•° I</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">addedInteger</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums1, vector&lt;<span class="type">int</span>&gt;&amp; nums2)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> *<span class="built_in">max_element</span>(nums2.<span class="built_in">begin</span>(), nums2.<span class="built_in">end</span>()) - *<span class="built_in">max_element</span>(nums1.<span class="built_in">begin</span>(), nums1.<span class="built_in">end</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="3129-æ‰¾å‡ºæ‰€æœ‰ç¨³å®šçš„äºŒè¿›åˆ¶æ•°ç»„-I"><a href="#3129-æ‰¾å‡ºæ‰€æœ‰ç¨³å®šçš„äºŒè¿›åˆ¶æ•°ç»„-I" class="headerlink" title="3129. æ‰¾å‡ºæ‰€æœ‰ç¨³å®šçš„äºŒè¿›åˆ¶æ•°ç»„ I"></a>3129. æ‰¾å‡ºæ‰€æœ‰ç¨³å®šçš„äºŒè¿›åˆ¶æ•°ç»„ I</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="type">const</span> <span class="type">long</span> <span class="type">long</span> MOD = <span class="number">1e9</span> + <span class="number">7</span>;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">numberOfStableArrays</span><span class="params">(<span class="type">int</span> zero, <span class="type">int</span> one, <span class="type">int</span> limit)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// è¿ç»­çš„0å’Œ1çš„ä¸ªæ•°ä¸è¶…è¿‡limit</span></span><br><span class="line">        vector&lt;vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&gt; dp0 = vector&lt;vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&gt;(zero + <span class="number">1</span>, vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;(one + <span class="number">1</span>, <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(limit+<span class="number">1</span>, <span class="number">0</span>)));</span><br><span class="line">        vector&lt;vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&gt; dp1 = vector&lt;vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&gt;(zero + <span class="number">1</span>, vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;(one + <span class="number">1</span>, <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(limit+<span class="number">1</span>, <span class="number">0</span>)));</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> z = <span class="number">1</span>; z &lt;= <span class="built_in">min</span>(zero, limit); z++) &#123;</span><br><span class="line">            dp0[z][<span class="number">0</span>][z] = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> o = <span class="number">1</span>; o &lt;= <span class="built_in">min</span>(one, limit); o++) &#123;</span><br><span class="line">            dp1[<span class="number">0</span>][o][o] = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> z = <span class="number">1</span>; z &lt;= zero; z++) &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> o = <span class="number">1</span>; o &lt;= one; o++) &#123;</span><br><span class="line">                <span class="type">int</span> dp01 = <span class="number">0</span>;</span><br><span class="line">                <span class="type">int</span> dp11 = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> l = <span class="number">1</span>; l &lt;= limit; l++) &#123;</span><br><span class="line">                    dp01 = (dp01 + dp1[z<span class="number">-1</span>][o][l]) % MOD; <span class="comment">// å«æœ‰z-1ä¸ª0ï¼Œoä¸ª1ï¼Œæœ«å°¾è¿ç»­1çš„ä¸ªæ•°ä¸ºlï¼Œçš„æ•°åé¢åŠ ä¸€ä¸ª0ï¼Œå˜æˆz+1ä¸ª0ï¼Œoä¸ª1ï¼Œæœ«å°¾è¿ç»­0çš„ä¸ªæ•°ä¸º1çš„æ•°</span></span><br><span class="line">                    dp11 = (dp11 + dp0[z][o<span class="number">-1</span>][l]) % MOD; <span class="comment">// å«æœ‰zä¸ª0ï¼Œo-1ä¸ª1ï¼Œæœ«å°¾è¿ç»­0çš„ä¸ªæ•°ä¸ºlï¼Œçš„æ•°åé¢åŠ ä¸€ä¸ª1ï¼Œå˜æˆzä¸ª0ï¼Œo+1ä¸ª1ï¼Œæœ«å°¾è¿ç»­1çš„ä¸ªæ•°ä¸º1çš„æ•°</span></span><br><span class="line">                    dp0[z][o][l] += dp0[z<span class="number">-1</span>][o][l<span class="number">-1</span>]; <span class="comment">// å«æœ‰z-1ä¸ª0ï¼Œoä¸ª1ï¼Œæœ«å°¾è¿ç»­0çš„ä¸ªæ•°ä¸ºl-1ï¼Œçš„æ•°åé¢å†åŠ ä¸€ä¸ª0ï¼Œå˜æˆz+1ä¸ª0ï¼Œoä¸ª1ï¼Œæœ«å°¾è¿ç»­0çš„ä¸ªæ•°ä¸ºlçš„æ•°</span></span><br><span class="line">                    dp1[z][o][l] += dp1[z][o<span class="number">-1</span>][l<span class="number">-1</span>]; <span class="comment">// å«æœ‰z-1ä¸ª0ï¼Œoä¸ª1ï¼Œæœ«å°¾è¿ç»­0çš„ä¸ªæ•°ä¸ºl-1ï¼Œçš„æ•°åé¢å†åŠ ä¸€ä¸ª1ï¼Œå˜æˆzä¸ª0ï¼Œo+1ä¸ª1ï¼Œæœ«å°¾è¿ç»­1çš„ä¸ªæ•°ä¸ºlçš„æ•°</span></span><br><span class="line">                &#125;</span><br><span class="line">                dp0[z][o][<span class="number">1</span>] += dp01;</span><br><span class="line">                dp1[z][o][<span class="number">1</span>] += dp11;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> l = limit; l &gt;= <span class="number">1</span>; l--) &#123;</span><br><span class="line">            ans = (ans + (dp0[zero][one][l] + dp1[zero][one][l]) % MOD) % MOD;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li>ç­”æ¡ˆè¿˜å¯ä»¥é™ç»´</li></ul><h2 id="600-ä¸å«è¿ç»­1çš„éè´Ÿæ•´æ•°"><a href="#600-ä¸å«è¿ç»­1çš„éè´Ÿæ•´æ•°" class="headerlink" title="600. ä¸å«è¿ç»­1çš„éè´Ÿæ•´æ•°"></a>600. ä¸å«è¿ç»­1çš„éè´Ÿæ•´æ•°</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="type">int</span> cnt = <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">search</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(i &gt; n) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        cnt++;</span><br><span class="line">        <span class="keyword">if</span>(!(i &amp; <span class="number">1</span>)) &#123;</span><br><span class="line">            <span class="built_in">search</span>((i &lt;&lt; <span class="number">1</span>) | <span class="number">1</span>, n);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">search</span>((i &lt;&lt; <span class="number">1</span>) | <span class="number">0</span>, n);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">findIntegers</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">search</span>(<span class="number">1</span>, n);</span><br><span class="line">        <span class="keyword">return</span> cnt + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="572-å¦ä¸€æ£µæ ‘çš„å­æ ‘"><a href="#572-å¦ä¸€æ£µæ ‘çš„å­æ ‘" class="headerlink" title="572. å¦ä¸€æ£µæ ‘çš„å­æ ‘"></a>572. å¦ä¸€æ£µæ ‘çš„å­æ ‘</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">findNode</span><span class="params">(TreeNode* root, <span class="type">int</span> val, vector&lt;TreeNode*&gt;&amp; result)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root == <span class="literal">nullptr</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(root-&gt;val == val) &#123;</span><br><span class="line">            result.<span class="built_in">push_back</span>(root);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">findNode</span>(root-&gt;left, val, result);</span><br><span class="line">        <span class="built_in">findNode</span>(root-&gt;right, val, result);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">bool</span> _isSubTree(TreeNode *root, TreeNode* subRoot) &#123;</span><br><span class="line">        <span class="keyword">if</span>(root == <span class="literal">nullptr</span> || subRoot == <span class="literal">nullptr</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> root == subRoot;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(root-&gt;val != subRoot-&gt;val) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> _isSubTree(root-&gt;left, subRoot-&gt;left) &amp;&amp; _isSubTree(root-&gt;right, subRoot-&gt;right);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">isSubtree</span><span class="params">(TreeNode* root, TreeNode* subRoot)</span> </span>&#123;</span><br><span class="line">        vector&lt;TreeNode*&gt; nodes;</span><br><span class="line">        <span class="built_in">findNode</span>(root, subRoot-&gt;val, nodes);</span><br><span class="line">        <span class="keyword">for</span>(TreeNode* node : nodes) &#123;</span><br><span class="line">            <span class="keyword">if</span>(_isSubTree(node, subRoot)) </span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="3143-æ­£æ–¹å½¢ä¸­çš„æœ€å¤šç‚¹æ•°"><a href="#3143-æ­£æ–¹å½¢ä¸­çš„æœ€å¤šç‚¹æ•°" class="headerlink" title="3143. æ­£æ–¹å½¢ä¸­çš„æœ€å¤šç‚¹æ•°"></a>3143. æ­£æ–¹å½¢ä¸­çš„æœ€å¤šç‚¹æ•°</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">maxPointsInsideSquare</span><span class="params">(vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; points, string s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">auto</span> getLineLen = [](<span class="type">const</span> vector&lt;<span class="type">int</span>&gt;&amp; point) &#123; <span class="comment">// ç‚¹æ‰€åœ¨æ­£æ–¹å½¢çš„è¾¹é•¿/2ï¼Œç”¨æ¥ä»£è¡¨ä¸€ä¸ªæ­£æ–¹å½¢</span></span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">max</span>(<span class="built_in">abs</span>(point[<span class="number">0</span>]), <span class="built_in">abs</span>(point[<span class="number">1</span>]));</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="type">int</span> len = points.<span class="built_in">size</span>();</span><br><span class="line">        <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">sortedIndex</span><span class="params">(len)</span></span>;</span><br><span class="line">        <span class="built_in">iota</span>(sortedIndex.<span class="built_in">begin</span>(), sortedIndex.<span class="built_in">end</span>(), <span class="number">0</span>);</span><br><span class="line">        <span class="built_in">sort</span>(sortedIndex.<span class="built_in">begin</span>(), sortedIndex.<span class="built_in">end</span>(), [&amp;points, &amp;getLineLen](<span class="type">int</span> a, <span class="type">int</span> b)&#123; <span class="keyword">return</span> <span class="built_in">getLineLen</span>(points[a]) &lt; <span class="built_in">getLineLen</span>(points[b]); &#125;);</span><br><span class="line">        <span class="comment">// æŒ‰ç…§ç‚¹æ‰€åœ¨æ­£æ–¹å½¢çš„è¾¹é•¿æ’åº</span></span><br><span class="line">        unordered_set&lt;<span class="type">char</span>&gt; labelSet; <span class="comment">// è®°å½•å‡ºç°è¿‡çš„labelï¼Œä¸å…è®¸å‡ºç°ç›¸åŒçš„label</span></span><br><span class="line">        <span class="type">int</span> cnt = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> maxcnt = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="type">bool</span> valid = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">while</span>(i &lt; len &amp;&amp; valid) &#123;</span><br><span class="line">            <span class="type">int</span> index = sortedIndex[i];</span><br><span class="line">            <span class="type">int</span> lineLen = <span class="built_in">getLineLen</span>(points[index]);</span><br><span class="line">            <span class="keyword">while</span>(i &lt; len &amp;&amp; lineLen == <span class="built_in">getLineLen</span>(points[index = sortedIndex[i]])) &#123;</span><br><span class="line">                <span class="comment">// éå†æ‰€æœ‰ç›¸åŒè¾¹é•¿çš„ç‚¹</span></span><br><span class="line">                <span class="type">char</span> label = s[index];</span><br><span class="line">                <span class="keyword">if</span>(labelSet.<span class="built_in">count</span>(label)) &#123;</span><br><span class="line">                    valid = <span class="literal">false</span>; <span class="comment">// è¿™ä¸ªæ­£æ–¹å½¢çš„è¾¹ä¸Šé‡åˆ°äº†å‡ºç°è¿‡çš„labelï¼Œè¿™ä¸ªæ­£æ–¹å½¢å¤±æ•ˆï¼Œæ›´å¤§çš„æ­£æ–¹å½¢ä¹Ÿå¤±æ•ˆ</span></span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    cnt++;</span><br><span class="line">                &#125;</span><br><span class="line">                labelSet.<span class="built_in">insert</span>(label);</span><br><span class="line">                i++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(valid) &#123; <span class="comment">// å¯¹äºåˆæ³•æ­£æ–¹å½¢ï¼Œæ›´æ–°ç‚¹æ•°</span></span><br><span class="line">                maxcnt = cnt;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> maxcnt;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="3128-ç›´è§’ä¸‰è§’å½¢"><a href="#3128-ç›´è§’ä¸‰è§’å½¢" class="headerlink" title="3128. ç›´è§’ä¸‰è§’å½¢"></a>3128. ç›´è§’ä¸‰è§’å½¢</h2><h3 id="å››æ¬¡å‰ç¼€å’Œ"><a href="#å››æ¬¡å‰ç¼€å’Œ" class="headerlink" title="å››æ¬¡å‰ç¼€å’Œ"></a>å››æ¬¡å‰ç¼€å’Œ</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">long</span> <span class="type">long</span> <span class="title">numberOfRightTriangles</span><span class="params">(vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; grid)</span> </span>&#123;</span><br><span class="line">        <span class="type">long</span> <span class="type">long</span> number = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> m = grid.<span class="built_in">size</span>(), n = grid[<span class="number">0</span>].<span class="built_in">size</span>();</span><br><span class="line">        vector&lt;<span class="type">int</span>&gt; verticalSum;</span><br><span class="line">        verticalSum = <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(n);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">            <span class="type">int</span> horSum = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; n; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span>(!grid[i][j]) <span class="keyword">continue</span>;</span><br><span class="line">                verticalSum[j] += grid[i][j];</span><br><span class="line">                horSum += grid[i][j];</span><br><span class="line">                number += (horSum - <span class="number">1</span>) * (verticalSum[j] - <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        verticalSum = <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(n);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = m - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">            <span class="type">int</span> horSum = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; n; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span>(!grid[i][j]) <span class="keyword">continue</span>;</span><br><span class="line">                verticalSum[j] += grid[i][j];</span><br><span class="line">                horSum += grid[i][j];</span><br><span class="line">                number += (horSum - <span class="number">1</span>) * (verticalSum[j] - <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        verticalSum = <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(n);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = m - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">            <span class="type">int</span> horSum = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j = n - <span class="number">1</span>; j &gt;= <span class="number">0</span>; j--) &#123;</span><br><span class="line">                <span class="keyword">if</span>(!grid[i][j]) <span class="keyword">continue</span>;</span><br><span class="line">                verticalSum[j] += grid[i][j];</span><br><span class="line">                horSum += grid[i][j];</span><br><span class="line">                number += (horSum - <span class="number">1</span>) * (verticalSum[j] - <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        verticalSum = <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(n);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">            <span class="type">int</span> horSum = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j = n - <span class="number">1</span>; j &gt;= <span class="number">0</span>; j--) &#123;</span><br><span class="line">                <span class="keyword">if</span>(!grid[i][j]) <span class="keyword">continue</span>;</span><br><span class="line">                verticalSum[j] += grid[i][j];</span><br><span class="line">                horSum += grid[i][j];</span><br><span class="line">                number += (horSum - <span class="number">1</span>) * (verticalSum[j] - <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> number;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="LCP-40-å¿ƒç®—æŒ‘æˆ˜"><a href="#LCP-40-å¿ƒç®—æŒ‘æˆ˜" class="headerlink" title="LCP 40. å¿ƒç®—æŒ‘æˆ˜"></a>LCP 40. å¿ƒç®—æŒ‘æˆ˜</h2><h3 id="è´ªå¿ƒ"><a href="#è´ªå¿ƒ" class="headerlink" title="è´ªå¿ƒ"></a>è´ªå¿ƒ</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">maximumScore</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; cards, <span class="type">int</span> cnt)</span> </span>&#123;</span><br><span class="line">        vector&lt;<span class="type">int</span>&gt; odd, even;</span><br><span class="line">        <span class="built_in">sort</span>(cards.<span class="built_in">begin</span>(), cards.<span class="built_in">end</span>());</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> card : cards) &#123;</span><br><span class="line">            ((card &amp; <span class="number">1</span>) ? odd : even).<span class="built_in">push_back</span>(card);</span><br><span class="line">            <span class="comment">// ä¸‰ç›®è¿ç®—ç¬¦çš„è¿™ç§ç”¨æ³•ç»ˆäºè¢«æˆ‘ç”¨ä¸Šäº†</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> score = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> odd_index = odd.<span class="built_in">size</span>() - <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> even_index = even.<span class="built_in">size</span>() - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(cnt) &#123;</span><br><span class="line">            <span class="type">bool</span> has2_odd = odd_index &gt;= <span class="number">1</span>;</span><br><span class="line">            <span class="type">bool</span> has2_even = even_index &gt;= <span class="number">1</span>;</span><br><span class="line">            <span class="type">bool</span> cnt_at_least_2 = cnt &gt;= <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">if</span>(has2_odd &amp;&amp; has2_even &amp;&amp; cnt_at_least_2) &#123;</span><br><span class="line">                <span class="keyword">if</span>(even[even_index] &gt;= odd[odd_index] + odd[odd_index - <span class="number">1</span>]) &#123;</span><br><span class="line">                    <span class="keyword">goto</span> do_even;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span>(odd[odd_index] + odd[odd_index - <span class="number">1</span>] &gt;= even[even_index] + even[even_index - <span class="number">1</span>]) &#123;</span><br><span class="line">                    <span class="keyword">goto</span> do_odd;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">goto</span> do2_even;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span>((cnt == <span class="number">1</span> || odd_index == <span class="number">0</span>) &amp;&amp; even_index &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="comment">// oddæˆ–cntä¸º1ï¼Œevenå¤§äº0, å–even</span></span><br><span class="line">                    <span class="keyword">goto</span> do_even;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span>(odd_index &lt; <span class="number">0</span> &amp;&amp; even_index &gt;= <span class="number">0</span> &amp;&amp; cnt &gt; <span class="number">1</span>) &#123;</span><br><span class="line">                    <span class="comment">// oddä¸º0ï¼Œevenä¸ä¸º0ï¼Œcntå¤§äº1ï¼Œå–even</span></span><br><span class="line">                    <span class="keyword">goto</span> do_even;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span>(even_index == <span class="number">0</span> &amp;&amp; odd_index &gt;= <span class="number">1</span> &amp;&amp; cnt &gt;= <span class="number">2</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span>(cnt == <span class="number">2</span>) &#123;</span><br><span class="line">                        <span class="keyword">goto</span> do_odd;</span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span>(even[even_index] &gt; odd[odd_index] + odd[odd_index - <span class="number">1</span>]) &#123;</span><br><span class="line">                        <span class="keyword">goto</span> do_even;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="keyword">goto</span> do_odd;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span>(even_index &lt; <span class="number">0</span> &amp;&amp; odd_index &gt;= <span class="number">1</span> &amp;&amp; cnt &gt;= <span class="number">2</span>) &#123;</span><br><span class="line">                    <span class="keyword">goto</span> do_odd;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            do_odd:</span><br><span class="line">            score += odd[odd_index] + odd[odd_index - <span class="number">1</span>];</span><br><span class="line">            cnt -= <span class="number">2</span>;</span><br><span class="line">            odd_index -= <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">goto</span> next;</span><br><span class="line">            do2_even:</span><br><span class="line">            score += even[even_index] + even[even_index - <span class="number">1</span>];</span><br><span class="line">            cnt -= <span class="number">2</span>;</span><br><span class="line">            even_index -= <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">goto</span> next;</span><br><span class="line">            do_even:</span><br><span class="line">            score += even[even_index];</span><br><span class="line">            cnt -= <span class="number">1</span>;</span><br><span class="line">            even_index -= <span class="number">1</span>;</span><br><span class="line">            next:</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> cnt == <span class="number">0</span> ? score : <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li>å…ˆæ’åºï¼Œç„¶åæŒ‰ç…§å¥‡å¶æ€§åˆ†æˆä¸¤ä¸ªæ•°ç»„</li><li>è´ªå¿ƒï¼Œæ¯æ¬¡ä»å¥‡æ•°æ•°ç»„ä¸­å–å‡ºä¸¤ä¸ªå¥‡æ•°ï¼Œæˆ–è€…ä»å¶æ•°æ•°ç»„ä¸­å–æ•°ï¼Œç›´åˆ°å–å®Œæ•°ç»„ï¼Œæˆ–è€…å¥‡æ•°æ•°ç»„å‰©ä¸€ä¸ªï¼Œæˆ–è€…å–å¤Ÿäº†cntä¸ªæ•°</li><li>å¦‚ä½•é€‰å–ï¼š<ul><li>ç”±äºå¥‡æ•°æ•°ç»„æ¯æ¬¡å–ä¸¤ä¸ªï¼Œå ç”¨ä¸¤ä¸ªcntèµ„æºï¼Œè€Œå¶æ•°æ•°ç»„å¯ä»¥å–ä¸€ä¸ªä¹Ÿå¯ä»¥å–ä¸¤ä¸ªï¼Œå¯¼è‡´å‰é¢çš„å–æ³•ä¼šå½±å“åç»­cntèƒ½å¦åˆšå¥½å–å¤Ÿã€‚</li><li>æ˜¯è¿ç»­å–ä¸¤ä¸ªå¶æ•°ï¼Œè¿˜æ˜¯å–ä¸¤ä¸ªå¥‡æ•°ï¼Œè¿˜æ˜¯åªå–ä¸€ä¸ªå¶æ•°ï¼Ÿ<ul><li><code>odd=[...,3,7]</code>, <code>even=[...,12]</code>,ç”±äºå¶æ•°æ•°ç»„ä¸­<code>12</code>å¤§äºå¥‡æ•°æ•°ç»„çš„<code>3+7</code>ï¼Œæ‰€ä»¥å–<code>12</code>,<code>(ä¸€ä¸ªå¶æ•°å®Œèƒœ)</code></li><li><code>odd=[...,3,7]</code>, <code>even=[...,6,6]</code>,è¿™æ¬¡<code>6</code>å°äº<code>3+7</code>,å¯æ˜¯è¿ç»­å–<code>ä¸¤ä¸ª6</code>çš„å¾—åˆ†å¤§äº<code>3+7</code>ï¼Œæ‰€ä»¥å–<code>6+6</code>ã€‚<code>(ä¸¤ä¸ªå¥‡æ•°æ‹‰ä½äº†å¹³å‡å€¼)</code></li><li><code>odd=[...,3,7]</code>, <code>even=[...,2,6]</code>,è¿™æ¬¡<code>6</code>å°äº<code>3+7</code>ï¼Œè¿ç»­ä¸¤æ¬¡éƒ½é€‰æ‹©å¶æ•°<code>2+6</code>ä¹Ÿæ¯”é€‰æ‹©<code>3+7</code>ä¸¤ä¸ªå¥‡æ•°å°ï¼Œæ‰€ä»¥é€‰ä¸¤ä¸ªå¥‡æ•°</li></ul></li><li>ä»¥ä¸Šé€‰å–ç­–ç•¥éœ€è¦<code>len(odd) &gt;= 2</code> <code>and</code> <code>len(even) &gt;= 2</code> <code>and</code> <code>ret &gt;= 2</code></li><li>ä¸‹é¢è®¨è®ºä¸æ»¡è¶³ä»¥ä¸Šæƒ…å†µï¼Œä¹Ÿå°±æ˜¯<code>len(odd)</code>,<code>len(even)</code>,<code>ret</code>ä¸ä¼šåŒæ—¶å¤§äºç­‰äº<code>2</code>çš„æƒ…å†µ</li><li>ç”±äºå¯èƒ½çš„æƒ…å†µå¤ªå¤šå¤ªå¤æ‚ï¼Œåˆ—è¡¨è®¨è®º</li></ul></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">odd     even    cnt     do</span></span><br><span class="line"><span class="comment">// oddæˆ–cntä¸º1ï¼Œevenå¤§äº0,åªèƒ½å–even</span></span><br><span class="line"><span class="comment">2+      2+      1       even</span></span><br><span class="line"><span class="comment">2       2+      1       even</span></span><br><span class="line"><span class="comment">1       2+      2+      even</span></span><br><span class="line"><span class="comment">1       2+      2       even</span></span><br><span class="line"><span class="comment">1       2+      1       even</span></span><br><span class="line"><span class="comment">0       2+      1       even</span></span><br><span class="line"><span class="comment">2+      2       1       even</span></span><br><span class="line"><span class="comment">2       2       1       even</span></span><br><span class="line"><span class="comment">1       2       2+      even</span></span><br><span class="line"><span class="comment">1       2       2       even</span></span><br><span class="line"><span class="comment">1       2       1       even</span></span><br><span class="line"><span class="comment">0       2       1       even</span></span><br><span class="line"><span class="comment">2+      1       1       even</span></span><br><span class="line"><span class="comment">2       1       1       even</span></span><br><span class="line"><span class="comment">1       1       2+      even</span></span><br><span class="line"><span class="comment">1       1       2       even</span></span><br><span class="line"><span class="comment">1       1       1       even</span></span><br><span class="line"><span class="comment">0       1       1       even</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">// oddä¸º0ï¼Œevenä¸ä¸º0ï¼Œcntå¤§äº1ï¼Œå–even</span></span><br><span class="line"><span class="comment">0       2+      2+      even</span></span><br><span class="line"><span class="comment">0       2+      2       even</span></span><br><span class="line"><span class="comment">0       2       2+      even</span></span><br><span class="line"><span class="comment">0       2       2       even</span></span><br><span class="line"><span class="comment">0       1       2+      even</span></span><br><span class="line"><span class="comment">0       1       2       even</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">// evenåªå‰©ä¸€ä¸ª, cntå‰©ä¸¤ä¸ªï¼Œä¸èƒ½å–evenï¼Œoddå¤§äºç­‰äº2ä¸ªï¼Œå–odd</span></span><br><span class="line"><span class="comment">2+      1       2       odd</span></span><br><span class="line"><span class="comment">2       1       2       odd</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">// evenåªå‰©ä¸€ä¸ª, cntå¤§äºä¸¤ä¸ªï¼Œå¯ä»¥å–evenï¼Œä½†éœ€è¦å’Œoddæ¯”è¾ƒ</span></span><br><span class="line"><span class="comment">2+      1       2+      even, odd1+odd2æ¯”è¾ƒ</span></span><br><span class="line"><span class="comment">2       1       2+      even, odd1+odd2æ¯”è¾ƒ</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">// evenç”¨å®Œäº†, oddè¿˜æœ‰ä¸¤ä¸ªä»¥ä¸Š, å–odd</span></span><br><span class="line"><span class="comment">2+      0       2+      odd</span></span><br><span class="line"><span class="comment">2+      0       2       odd</span></span><br><span class="line"><span class="comment">2       0       2+      odd</span></span><br><span class="line"><span class="comment">2       0       2       odd</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">// even,oddéƒ½å–å®Œäº†ï¼Œæ— æ³•å–å¤Ÿcntï¼Œbreak</span></span><br><span class="line"><span class="comment">0       0       2+      break</span></span><br><span class="line"><span class="comment">0       0       2       break</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">// cntæˆ–oddä¸º1ï¼Œæ²¡æœ‰evenå¯å–ï¼Œæ— æ³•æ»¡è¶³æ¡ä»¶ï¼Œbreak</span></span><br><span class="line"><span class="comment">2+      0       1       break</span></span><br><span class="line"><span class="comment">2       0       1       break</span></span><br><span class="line"><span class="comment">1       0       2+      break</span></span><br><span class="line"><span class="comment">1       0       2       break</span></span><br><span class="line"><span class="comment">1       0       1       break</span></span><br><span class="line"><span class="comment">0       0       1       break</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><blockquote><p><code>2+</code>ä»£è¡¨ä¸ªæ•°å¤§äº<code>2</code></p></blockquote><h3 id="æ’åº"><a href="#æ’åº" class="headerlink" title="æ’åº"></a>æ’åº</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">maximumScore</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; cards, <span class="type">int</span> cnt)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> odd = <span class="number">-1</span>, even = <span class="number">-1</span>;</span><br><span class="line">        <span class="type">int</span> tmp = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> n = cards.<span class="built_in">size</span>();</span><br><span class="line">        <span class="built_in">sort</span>(cards.<span class="built_in">begin</span>(), cards.<span class="built_in">end</span>());</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = n - <span class="number">1</span>; i &gt; n - cnt - <span class="number">1</span>; i--) &#123;</span><br><span class="line">            ((cards[i] &amp; <span class="number">1</span>) ? odd : even) = cards[i];</span><br><span class="line">            tmp += cards[i];</span><br><span class="line">            cout &lt;&lt; cards[i] &lt;&lt; endl;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!(tmp &amp; <span class="number">1</span>)) <span class="keyword">return</span> tmp;</span><br><span class="line">        <span class="type">bool</span> flag = <span class="literal">false</span>;</span><br><span class="line">        <span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = n - cnt - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">            <span class="keyword">if</span>(cards[i] &amp; <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span>(even != <span class="number">-1</span>) &#123;</span><br><span class="line">                    flag = <span class="literal">true</span>;</span><br><span class="line">                    ans = <span class="built_in">max</span>(ans, tmp - even + cards[i]);</span><br><span class="line">                    </span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span>(odd != <span class="number">-1</span>) &#123;</span><br><span class="line">                    ans = <span class="built_in">max</span>(ans, tmp - odd + cards[i]);</span><br><span class="line">                    flag = <span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li>æ’åºåå‰cntä¸ªæ•°åŠ èµ·æ¥ï¼Œå¦‚æœæ˜¯å¶æ•°ï¼Œåˆ™æ˜¯æ‰€æ±‚æœ€å¤§çš„æƒ…å†µï¼Œç›´æ¥è¿”å›</li><li>å¦åˆ™ï¼Œå‰cntä¸ªå’ŒåŠ èµ·æ¥æ˜¯å¥‡æ•°ï¼Œç”¨åé¢çš„æ•°æ›¿æ¢å‰é¢çš„æ•°ï¼Œä½¿å’Œå˜æˆå¶æ•°<ul><li>å¦‚æœåé¢çš„æ•°æ˜¯å¥‡æ•°ï¼Œåˆ™å‡å»æœ€åä¸€ä¸ªå¶æ•°ï¼Œè¿™æ ·å’Œä¸ºå¶æ•°</li><li>å¦‚æœåé¢çš„æ•°æ˜¯å¶æ•°ï¼Œåˆ™å‡å»æœ€åä¸€ä¸ªå¥‡æ•°ï¼Œè¿™æ ·å’Œä¸ºå¥‡æ•°</li></ul></li></ul><h3 id="å“ˆå¸Œ"><a href="#å“ˆå¸Œ" class="headerlink" title="å“ˆå¸Œ"></a>å“ˆå¸Œ</h3><p>å’Œä¸Šä¸€ä¸ªæƒ³æ³•æ€è·¯ä¸€è‡´ï¼Œ<code>1&lt;=cards[i]&lt;=1000</code>ï¼Œå¯ä»¥æŠŠä»–æ˜ å°„åˆ°ä¸€ä¸ªé•¿åº¦1000çš„æ•°ç»„ä¸­ï¼Œè®°å½•ä¸‹æ ‡æ—©cardsä¸­å‡ºç°çš„æ¬¡æ•°ï¼Œå¯ä»¥é¿å…æ’åºã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">maximumScore</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; cards, <span class="type">int</span> cnt)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> hash[<span class="number">1001</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">        <span class="type">int</span> n = cards.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            hash[cards[i]]++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> i = <span class="number">1000</span>;</span><br><span class="line">        <span class="type">int</span> tmp = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> odd = <span class="number">-1</span>, even = <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; cnt &amp;&amp; i &gt; <span class="number">0</span>; j++) &#123;</span><br><span class="line">            <span class="keyword">while</span>(i &gt; <span class="number">0</span> &amp;&amp; hash[i] == <span class="number">0</span>) i--;</span><br><span class="line">            <span class="keyword">if</span>(i == <span class="number">0</span>) <span class="keyword">break</span>; <span class="comment">// will never happen</span></span><br><span class="line">            tmp += i;</span><br><span class="line">            hash[i]--;</span><br><span class="line">            ((i &amp; <span class="number">1</span>) ? odd : even) = i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!(tmp &amp; <span class="number">1</span>)) <span class="keyword">return</span> tmp;</span><br><span class="line">        <span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(i &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">while</span>(i &gt; <span class="number">0</span> &amp;&amp; hash[i] == <span class="number">0</span>) i--;</span><br><span class="line">            <span class="keyword">if</span>(i == <span class="number">0</span>) <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">if</span>((i &amp; <span class="number">1</span>) == <span class="number">1</span> &amp;&amp; even != <span class="number">-1</span>) &#123;</span><br><span class="line">                ans = <span class="built_in">max</span>(ans, tmp - even + i);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>((i &amp; <span class="number">1</span>) == <span class="number">0</span> &amp;&amp; odd != <span class="number">-1</span>) &#123;</span><br><span class="line">                ans = <span class="built_in">max</span>(ans, tmp - odd + i);</span><br><span class="line">            &#125;</span><br><span class="line">            hash[i]--;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="3111-è¦†ç›–æ‰€æœ‰ç‚¹çš„æœ€å°‘çŸ©å½¢æ•°ç›®"><a href="#3111-è¦†ç›–æ‰€æœ‰ç‚¹çš„æœ€å°‘çŸ©å½¢æ•°ç›®" class="headerlink" title="3111. è¦†ç›–æ‰€æœ‰ç‚¹çš„æœ€å°‘çŸ©å½¢æ•°ç›®"></a>3111. è¦†ç›–æ‰€æœ‰ç‚¹çš„æœ€å°‘çŸ©å½¢æ•°ç›®</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">minRectanglesToCoverPoints</span><span class="params">(vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; points, <span class="type">int</span> w)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">sort</span>(points.<span class="built_in">begin</span>(), points.<span class="built_in">end</span>(), [](<span class="type">const</span> vector&lt;<span class="type">int</span>&gt;&amp; a, <span class="type">const</span> vector&lt;<span class="type">int</span>&gt;&amp; b)&#123; <span class="keyword">return</span> a[<span class="number">0</span>] &lt; b[<span class="number">0</span>]; &#125;);</span><br><span class="line">        <span class="type">int</span> len = points.<span class="built_in">size</span>();</span><br><span class="line">        <span class="type">int</span> i = <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> cnt = <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> lastx = points[<span class="number">0</span>][<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">while</span>(i &lt; len) &#123;</span><br><span class="line">            <span class="keyword">while</span>(i &lt; len &amp;&amp; points[i][<span class="number">0</span>] - lastx &lt;= w) i++;</span><br><span class="line">            <span class="keyword">if</span>(i &gt;= len) <span class="keyword">break</span>;</span><br><span class="line">            cnt++;</span><br><span class="line">            lastx = points[i][<span class="number">0</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> cnt;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li>å•Š?è¿™æ˜¯ä¸­ç­‰é¢˜å—</li></ul><h2 id="3007-ä»·å€¼å’Œå°äºç­‰äº-K-çš„æœ€å¤§æ•°å­—"><a href="#3007-ä»·å€¼å’Œå°äºç­‰äº-K-çš„æœ€å¤§æ•°å­—" class="headerlink" title="3007. ä»·å€¼å’Œå°äºç­‰äº K çš„æœ€å¤§æ•°å­—"></a>3007. ä»·å€¼å’Œå°äºç­‰äº K çš„æœ€å¤§æ•°å­—</h2><h3 id="å…¬å¼æ³•"><a href="#å…¬å¼æ³•" class="headerlink" title="å…¬å¼æ³•"></a>å…¬å¼æ³•</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="function"><span class="type">long</span> <span class="type">long</span> <span class="title">accumulatedValueOf</span><span class="params">(<span class="type">long</span> <span class="type">long</span> k, <span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="type">long</span> <span class="type">long</span> value = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> mask_off = <span class="number">63</span>; mask_off &gt;= <span class="number">1</span>; mask_off--) &#123;</span><br><span class="line">            <span class="type">long</span> <span class="type">long</span> mask = <span class="number">1l</span> &lt;&lt; (mask_off - <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">if</span>(!(mask &amp; k)) <span class="keyword">continue</span>;</span><br><span class="line">            k = k &amp; ~mask;</span><br><span class="line">            <span class="keyword">if</span>(mask_off % x == <span class="number">0</span>) &#123;</span><br><span class="line">                value += ((k|mask) - mask + <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            value += mask / <span class="number">2</span> * ((mask_off - <span class="number">1</span>) / x);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">long</span> <span class="type">long</span> <span class="title">findMaximumNumber</span><span class="params">(<span class="type">long</span> <span class="type">long</span> k, <span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="type">long</span> <span class="type">long</span> l = <span class="number">1</span>, r = <span class="number">1e15</span>;</span><br><span class="line">        <span class="keyword">while</span>(l &lt; r) &#123;</span><br><span class="line">            <span class="type">long</span> <span class="type">long</span> mid = (r - l + <span class="number">1</span>) / <span class="number">2</span> + l;</span><br><span class="line">            <span class="type">long</span> <span class="type">long</span> accuValue = <span class="built_in">accumulatedValueOf</span>(mid, x);</span><br><span class="line">            <span class="keyword">if</span>(accuValue &lt;= k) &#123;</span><br><span class="line">                l = mid;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                r = mid - <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> l;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h4><ul><li>è®°$ price_n(x) &#x3D; bit_count(n, x) $ </li><li>è®°$ accumulated_n(x) &#x3D; \sum_{i&#x3D;1}^nprice_i(x) $ </li><li><code>bit_count</code>, <code>price</code>æ˜¯nçš„ä»·å€¼ï¼Œä¹Ÿå°±æ˜¯ä¸‹æ ‡è¢«xæ•´é™¤çš„ä½æ•°å’Œ</li><li>å¯¹äº<code>n&gt;0</code>, å‡½æ•°<code>bit_count</code>, æ˜¯æ’å¤§äºé›¶çš„ã€‚</li><li>æ‰€ä»¥æ•°åˆ—$ {accumulated_n(x)} $æ˜¯å•è°ƒé€’å¢çš„ï¼Œå¦‚æœèƒ½æ‰¾åˆ°è®¡ç®—$ {accumulated_n(x)} $çš„å…¬å¼ï¼Œåˆ©ç”¨äºŒåˆ†æŸ¥æ‰¾å³å¯å¿«é€Ÿæ‰¾åˆ°ç­”æ¡ˆ</li></ul><h4 id="å…¬å¼æ¨å¯¼"><a href="#å…¬å¼æ¨å¯¼" class="headerlink" title="å…¬å¼æ¨å¯¼"></a>å…¬å¼æ¨å¯¼</h4><ul><li>ä»¥<code>n = 7</code>, <code>x = 1</code>ä¸ºä¾‹</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">0000</span><br><span class="line">0001</span><br><span class="line">0010</span><br><span class="line">0011</span><br><span class="line">0100</span><br><span class="line">0101</span><br><span class="line">0110</span><br><span class="line">0111</span><br></pre></td></tr></table></figure><p>å¯ä»¥è§‚å¯Ÿåˆ°<code>0 + 7</code> &#x3D; <code>1 + 6</code> &#x3D; <code>2 + 5</code> &#x3D; <code>3 + 4</code> &#x3D; äºŒè¿›åˆ¶çš„<code>111</code><br>æ€»ä»·å€¼ä¸º: <code>3*4=12</code></p><p>ä¹Ÿå°±æ˜¯å¯¹äº$ n &#x3D; 0 â€¦ (2^i-1) $æ—¶ï¼Œä»–ä»¬çš„æ€»ä»·å€¼ä¸º$ i * 2^{i-1} $ </p><p>$ a_{2^i}(1) &#x3D; i * 2^{i-1}$</p><ul><li>ä»¥<code>n = 10</code>, <code>x = 1</code>ä¸ºä¾‹</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">0000</span><br><span class="line">0001</span><br><span class="line">0010</span><br><span class="line">0011</span><br><span class="line">0100</span><br><span class="line">0101</span><br><span class="line">0110</span><br><span class="line">0111</span><br><span class="line">1000</span><br><span class="line">1001</span><br><span class="line">1010</span><br></pre></td></tr></table></figure><p>å…ˆè®¡ç®—<code>n = 0...7</code>çš„æ€»ä»·å€¼ï¼Œä¸º<code>12</code><br>$ a_{2^i-1}(1) &#x3D; i * 2^{i-1}$, $i &#x3D; 3$çš„æƒ…å†µ</p><p>ç»„æˆéƒ¨åˆ†ä¸º<code>n = 0...7</code>å’Œ<code>n = 8...10</code></p><p>å¯¹äº<code>n = 8...10</code><br>å…ˆæ•°å‡ºæœ€é«˜ä½çš„æƒ…å†µï¼Œä¹Ÿå°±æ˜¯$n - (2^i - 1)$ï¼Œå†å»æ‰æœ€é«˜ä½ï¼Œå˜æˆä»¥ä¸‹æƒ…å†µ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">00</span><br><span class="line">01</span><br><span class="line">10</span><br></pre></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯<code>n = 2</code>, <code>x = 1</code>çš„æƒ…å†µï¼Œé‡å¤ä¸Šé¢çš„æ“ä½œ<br>ä¹Ÿå°±æ˜¯ $ b_n(i) &#x3D; n%2^{i+1} - (2^i - 1) $</p><ul><li><p>å¯¹äºæ›´å¤æ‚çš„æƒ…å†µå¦‚: <code>n = 1001101</code>, <code>x = 1</code><br>æ€»ä»·å€¼ä¸º<br>$ a_{2^6-1}(1) + b_n(6) + $<br>$ a_{2^3-1}(1) + b_n(3) + $<br>$ a_{2^2-1}(1) + b_n(2) + $<br>$ a_{2^0-1}(1) + b_n{0}$</p></li><li><p>å¯¹äº<code>x != 1</code>çš„æƒ…å†µï¼Œä¹Ÿå°±æ˜¯<br>$ a_{2^i}(x) &#x3D;  \lfloor\frac{i}{x}\rfloor * 2^{i-1}$<br>$ b_n(i, x) &#x3D; n%2^{i+1} - (2^i - 1) $ $(i % x &#x3D; 0)$<br>$ b_n(i, x) &#x3D; 0 $ $(i % x \not &#x3D;{0})$</p></li></ul><h2 id="2961-åŒæ¨¡å¹‚è¿ç®—"><a href="#2961-åŒæ¨¡å¹‚è¿ç®—" class="headerlink" title="2961. åŒæ¨¡å¹‚è¿ç®—"></a>2961. åŒæ¨¡å¹‚è¿ç®—</h2><p>å¿«é€Ÿå¹‚ç§’äº†ï¼</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">fastPow</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> n, <span class="type">int</span> mod)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> res = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(n) &#123;</span><br><span class="line">            <span class="keyword">if</span>(n&amp;<span class="number">1</span>) &#123;</span><br><span class="line">                res = (res * a) % mod;</span><br><span class="line">            &#125;</span><br><span class="line">            a = (a * a) % mod;</span><br><span class="line">            n &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">getGoodIndices</span><span class="params">(vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; variables, <span class="type">int</span> target)</span> </span>&#123;</span><br><span class="line">        vector&lt;<span class="type">int</span>&gt; goodIndices;</span><br><span class="line">        <span class="type">int</span> len = variables.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">            <span class="type">int</span> n = <span class="built_in">fastPow</span>(variables[i][<span class="number">0</span>], variables[i][<span class="number">1</span>], <span class="number">10</span>);</span><br><span class="line">            n = <span class="built_in">fastPow</span>(n, variables[i][<span class="number">2</span>], variables[i][<span class="number">3</span>]);</span><br><span class="line">            <span class="keyword">if</span>(n == target) &#123;</span><br><span class="line">                goodIndices.<span class="built_in">push_back</span>(i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> goodIndices;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="682-æ£’çƒæ¯”èµ›"><a href="#682-æ£’çƒæ¯”èµ›" class="headerlink" title="682. æ£’çƒæ¯”èµ›"></a>682. æ£’çƒæ¯”èµ›</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">calPoints</span><span class="params">(vector&lt;string&gt;&amp; operations)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> n = operations.<span class="built_in">size</span>();</span><br><span class="line">        vector&lt;<span class="type">int</span>&gt; scores;</span><br><span class="line">        <span class="type">int</span> scoreCnt = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="type">int</span> score = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">if</span> (operations[i] == <span class="string">&quot;+&quot;</span>) &#123;</span><br><span class="line">                score = scores[scoreCnt - <span class="number">1</span>] + scores[scoreCnt - <span class="number">2</span>];</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (operations[i] == <span class="string">&quot;D&quot;</span>) &#123;</span><br><span class="line">                score = scores[scoreCnt - <span class="number">1</span>] * <span class="number">2</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (operations[i] == <span class="string">&quot;C&quot;</span>) &#123;</span><br><span class="line">                scores.<span class="built_in">pop_back</span>();</span><br><span class="line">                scoreCnt--;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="built_in">sscanf</span>(operations[i].<span class="built_in">c_str</span>(), <span class="string">&quot;%d&quot;</span>, &amp;score);</span><br><span class="line">            &#125;</span><br><span class="line">            scores.<span class="built_in">push_back</span>(score);</span><br><span class="line">            scoreCnt++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">accumulate</span>(scores.<span class="built_in">begin</span>(), scores.<span class="built_in">end</span>(), <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="3106-æ»¡è¶³è·ç¦»çº¦æŸä¸”å­—å…¸åºæœ€å°çš„å­—ç¬¦ä¸²"><a href="#3106-æ»¡è¶³è·ç¦»çº¦æŸä¸”å­—å…¸åºæœ€å°çš„å­—ç¬¦ä¸²" class="headerlink" title="3106. æ»¡è¶³è·ç¦»çº¦æŸä¸”å­—å…¸åºæœ€å°çš„å­—ç¬¦ä¸²"></a>3106. æ»¡è¶³è·ç¦»çº¦æŸä¸”å­—å…¸åºæœ€å°çš„å­—ç¬¦ä¸²</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">charDistance</span><span class="params">(<span class="type">char</span> a, <span class="type">char</span> b)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> d = <span class="built_in">abs</span>(a - b);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">min</span>(d, <span class="number">26</span> - d);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">string <span class="title">getSmallestString</span><span class="params">(string s, <span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> n = s.<span class="built_in">length</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; n &amp;&amp; k &gt; <span class="number">0</span>; i++) &#123;</span><br><span class="line">            <span class="type">int</span> target = <span class="string">&#x27;z&#x27;</span>;</span><br><span class="line">            <span class="keyword">if</span>(k &gt; <span class="number">12</span>) &#123;</span><br><span class="line">                target = <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt;= k; j++) &#123;</span><br><span class="line">                    target = <span class="built_in">min</span>(target, (s[i] + j - <span class="string">&#x27;a&#x27;</span>) % <span class="number">26</span> + <span class="string">&#x27;a&#x27;</span>);</span><br><span class="line">                    target = <span class="built_in">min</span>(target, (s[i] - j - <span class="string">&#x27;a&#x27;</span> + <span class="number">26</span>) % <span class="number">26</span> + <span class="string">&#x27;a&#x27;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            k -= <span class="built_in">charDistance</span>(s[i], target);</span><br><span class="line">            s[i] = target;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> s;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li>å®é™…ä¸Šå°±æ˜¯<code>26</code>è¿›åˆ¶æ•°ï¼Œåœ¨æœ‰é™æ­¥éª¤å†…ï¼Œå°†å…¶è½¬åŒ–ä¸ºåŒä½æ•°ä¸‹å°½é‡å°çš„æ•°</li><li>å°½é‡å¤šçš„å°†å½“å‰æœ€é«˜ä½å˜å°ï¼Œé«˜ä½ä½¿ç”¨1æ­¥çš„å‡å°‘é‡æ˜¯åœ°ä½ä½¿ç”¨ä¸€æ­¥çš„26å€</li><li>ç®€å•è®¡ç®—å¯çŸ¥ï¼Œä¸¤ä¸ªå­—æ¯æœ€å¤§è·ç¦»ä¸º12<ul><li>å½“<code>k &gt; 12</code>æ—¶ï¼Œä¸€å®šå¯ä»¥å˜æˆ<code>a</code></li><li>å½“<code>k &lt;= 12</code>æ—¶ï¼Œä¸€å®šå¯ä»¥å˜æˆ<code>a</code>ï¼Œå¯»æ‰¾kæ­¥å†…èƒ½å®ç°çš„æœ€å°å­—ç¬¦</li></ul></li></ul><h2 id="2740-æ‰¾å‡ºåˆ†åŒºå€¼"><a href="#2740-æ‰¾å‡ºåˆ†åŒºå€¼" class="headerlink" title="2740. æ‰¾å‡ºåˆ†åŒºå€¼"></a>2740. æ‰¾å‡ºåˆ†åŒºå€¼</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">findValueOfPartition</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">sort</span>(nums.<span class="built_in">begin</span>(), nums.<span class="built_in">end</span>());</span><br><span class="line">        <span class="type">int</span> len = nums.<span class="built_in">size</span>();</span><br><span class="line">        <span class="type">int</span> minDiff = INT_MAX;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt; len; i++) &#123;</span><br><span class="line">            minDiff = <span class="built_in">min</span>(minDiff, <span class="built_in">abs</span>(nums[i] - nums[i<span class="number">-1</span>]));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> minDiff;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="2844-ç”Ÿæˆç‰¹æ®Šæ•°å­—çš„æœ€å°‘æ“ä½œ"><a href="#2844-ç”Ÿæˆç‰¹æ®Šæ•°å­—çš„æœ€å°‘æ“ä½œ" class="headerlink" title="2844. ç”Ÿæˆç‰¹æ®Šæ•°å­—çš„æœ€å°‘æ“ä½œ"></a>2844. ç”Ÿæˆç‰¹æ®Šæ•°å­—çš„æœ€å°‘æ“ä½œ</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">minimumOperations</span><span class="params">(string num)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> len = num.<span class="built_in">length</span>();</span><br><span class="line">        <span class="type">int</span> first0 = len, first5 = len;</span><br><span class="line">        <span class="type">int</span> i = len - <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> minOp = len;</span><br><span class="line">        <span class="keyword">while</span>(i &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span>(num[i] == <span class="string">&#x27;0&#x27;</span> &amp;&amp; first0 == len) &#123;</span><br><span class="line">                first0 = i;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>(num[i] == <span class="string">&#x27;5&#x27;</span> &amp;&amp; first5 == len) &#123;</span><br><span class="line">                first5 = i;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(num[i] == <span class="string">&#x27;0&#x27;</span> &amp;&amp; first0 != len &amp;&amp; i &lt; first0) &#123;</span><br><span class="line">                minOp = <span class="built_in">min</span>(minOp, len - first0 - <span class="number">1</span> + first0 - i - <span class="number">1</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>(num[i] == <span class="string">&#x27;2&#x27;</span> &amp;&amp; first5 != len &amp;&amp; i &lt; first5) &#123;</span><br><span class="line">                minOp = <span class="built_in">min</span>(minOp, len - first5 - <span class="number">1</span> + first5 - i - <span class="number">1</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>(num[i] == <span class="string">&#x27;5&#x27;</span> &amp;&amp; first0 != len &amp;&amp; i &lt; first0) &#123;</span><br><span class="line">                minOp = <span class="built_in">min</span>(minOp, len - first0 - <span class="number">1</span> + first0 - i - <span class="number">1</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>(num[i] == <span class="string">&#x27;7&#x27;</span> &amp;&amp; first5 != len &amp;&amp; i &lt; first5) &#123;</span><br><span class="line">                minOp = <span class="built_in">min</span>(minOp, len - first5 - <span class="number">1</span> + first5 - i - <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            i--;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(first0 != len) minOp = <span class="built_in">min</span>(minOp, len - <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> minOp;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li>å¯¹äºæ‰€æœ‰25çš„å€æ•°ï¼Œä¸¾ä¾‹å¯çŸ¥ï¼Œç»“å°¾ä¸¤ä½ä¸º<code>00</code>,<code>25</code>,<code>50</code>,<code>75</code></li><li>ä¸€ä¸ªå­—ç¬¦ä¸²å¯èƒ½æœ‰å¤šç§æ–¹å¼åˆ°è¾¾å˜æˆ25çš„å€æ•°<ul><li>å¦‚æœæœ€åä»¥<code>00</code>ç»“å°¾ï¼Œå…ˆå€’ç€æ‰¾åˆ°ç¬¬ä¸€ä¸ª<code>0</code>ï¼Œåˆ å»åé¢çš„æ‰€æœ‰æ•°ï¼Œåœ¨æ‰¾ç¬¬äºŒä¸ª<code>0</code>ï¼Œåˆ æ‰ä¸¤ä¸ª<code>0</code>ä¸­é—´çš„æ•°</li><li><code>25</code>,<code>50</code>,<code>75</code>åŒç†</li><li>è¿”å›åˆ é™¤æ•°å­—æœ€å°‘çš„æƒ…å†µ</li></ul></li><li>ç‰¹æ®Šæƒ…å†µ<ul><li>æ²¡æœ‰æ‰¾åˆ°<code>00</code>,<code>25</code>,<code>50</code>,<code>75</code>ï¼Œå¯ä»¥æŠŠæ•´ä¸ªå­—ç¬¦ä¸²åˆ æ‰</li><li>æ²¡æœ‰æ‰¾åˆ°<code>00</code>,<code>25</code>,<code>50</code>,<code>75</code>ï¼Œåªæ‰¾åˆ°äº†ä¸€ä¸ª<code>0</code>ï¼Œå¯ä»¥æŠŠ<code>0</code>ä»¥å¤–çš„æ•°å…¨åˆ æ‰</li></ul></li></ul><h2 id="2766-é‡æ–°æ”¾ç½®çŸ³å—"><a href="#2766-é‡æ–°æ”¾ç½®çŸ³å—" class="headerlink" title="2766. é‡æ–°æ”¾ç½®çŸ³å—"></a>2766. é‡æ–°æ”¾ç½®çŸ³å—</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">relocateMarbles</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums, vector&lt;<span class="type">int</span>&gt;&amp; moveFrom, vector&lt;<span class="type">int</span>&gt;&amp; moveTo)</span> </span>&#123;</span><br><span class="line">        unordered_map&lt;<span class="type">int</span>, <span class="type">bool</span>&gt; pos2rock;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> rockPos : nums) &#123;</span><br><span class="line">            pos2rock[rockPos] = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> opNum = moveFrom.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; opNum; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(moveTo[i] == moveFrom[i]) <span class="keyword">continue</span>;</span><br><span class="line">            pos2rock[moveTo[i]] = <span class="literal">true</span>;</span><br><span class="line">            <span class="comment">// pos2rock[moveFrom[i]] = 0;</span></span><br><span class="line">            pos2rock.<span class="built_in">erase</span>(moveFrom[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        vector&lt;<span class="type">int</span>&gt; res;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">const</span> <span class="keyword">auto</span>&amp; [pos, num] : pos2rock) &#123;</span><br><span class="line">            <span class="comment">// if(num) &#123; // ä¸éœ€è¦åˆ¤æ–­ï¼Œéƒ½æ˜¯true</span></span><br><span class="line">                res.<span class="built_in">push_back</span>(pos);</span><br><span class="line">            <span class="comment">// &#125;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">sort</span>(res.<span class="built_in">begin</span>(), res.<span class="built_in">end</span>());</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="2101-å¼•çˆ†æœ€å¤šçš„ç‚¸å¼¹"><a href="#2101-å¼•çˆ†æœ€å¤šçš„ç‚¸å¼¹" class="headerlink" title="2101. å¼•çˆ†æœ€å¤šçš„ç‚¸å¼¹"></a>2101. å¼•çˆ†æœ€å¤šçš„ç‚¸å¼¹</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Solve</span> &#123;</span><br><span class="line">        unordered_map&lt;<span class="type">int</span>, vector&lt;<span class="type">int</span>&gt;&gt; graph;</span><br><span class="line">        vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; bombs;</span><br><span class="line">        <span class="type">int</span> bombsNum;</span><br><span class="line">        <span class="function"><span class="type">int</span> <span class="title">isICanBoomJ</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> ((<span class="type">long</span> <span class="type">long</span>)bombs[i][<span class="number">0</span>] - bombs[j][<span class="number">0</span>]) * (bombs[i][<span class="number">0</span>] - bombs[j][<span class="number">0</span>]) + ((<span class="type">long</span> <span class="type">long</span>)bombs[i][<span class="number">1</span>] - bombs[j][<span class="number">1</span>]) * (bombs[i][<span class="number">1</span>] - bombs[j][<span class="number">1</span>]) &lt;= (<span class="type">long</span> <span class="type">long</span>)bombs[i][<span class="number">2</span>] * bombs[i][<span class="number">2</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="type">int</span> <span class="title">cntNodes</span><span class="params">(<span class="type">int</span> start)</span> </span>&#123;</span><br><span class="line">            vector&lt;<span class="type">bool</span>&gt; visited = <span class="built_in">vector</span>&lt;<span class="type">bool</span>&gt;(bombsNum, <span class="literal">false</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">cntNodes</span>(start, visited);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="type">int</span> <span class="title">cntNodes</span><span class="params">(<span class="type">int</span> start, vector&lt;<span class="type">bool</span>&gt;&amp; visited)</span> </span>&#123;</span><br><span class="line">            visited[start] = <span class="literal">true</span>;</span><br><span class="line">            <span class="type">int</span> child = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> subNode : graph[start]) &#123;</span><br><span class="line">                <span class="keyword">if</span>(!visited[subNode]) &#123;</span><br><span class="line">                    visited[subNode] = <span class="literal">true</span>;</span><br><span class="line">                    child += <span class="built_in">cntNodes</span>(subNode, visited);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>+child;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span>:</span><br><span class="line">        <span class="built_in">Solve</span>(vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; bombs) </span><br><span class="line">            : <span class="built_in">bombs</span>(bombs), <span class="built_in">bombsNum</span>(bombs.<span class="built_in">size</span>()) &#123;&#125;</span><br><span class="line">        <span class="function"><span class="type">int</span> <span class="title">solve</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; bombsNum; i++) &#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; bombsNum; j++) &#123;</span><br><span class="line">                    <span class="keyword">if</span>(i == j) <span class="keyword">continue</span>;</span><br><span class="line">                    <span class="keyword">if</span>(<span class="built_in">isICanBoomJ</span>(i, j)) &#123;</span><br><span class="line">                        graph[i].<span class="built_in">push_back</span>(j);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">int</span> maxBoom = INT_MIN;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; bombsNum; i++) &#123;</span><br><span class="line">                maxBoom = <span class="built_in">max</span>(maxBoom, <span class="built_in">cntNodes</span>(i));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> maxBoom;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">maximumDetonation</span><span class="params">(vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; bombs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Solve</span>(bombs).<span class="built_in">solve</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">maximumDetonation</span><span class="params">(vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; bombs)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> bombsNum = bombs.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">auto</span> isICanBoomJ = [&amp;](<span class="type">int</span> i, <span class="type">int</span> j) &#123;</span><br><span class="line">            <span class="built_in">return</span> ((<span class="type">long</span> <span class="type">long</span>)bombs[i][<span class="number">0</span>] - bombs[j][<span class="number">0</span>]) * (bombs[i][<span class="number">0</span>] - bombs[j][<span class="number">0</span>]) + ((<span class="type">long</span> <span class="type">long</span>)bombs[i][<span class="number">1</span>] - bombs[j][<span class="number">1</span>]) * (bombs[i][<span class="number">1</span>] - bombs[j][<span class="number">1</span>]) &lt;= (<span class="type">long</span> <span class="type">long</span>)bombs[i][<span class="number">2</span>] * bombs[i][<span class="number">2</span>];</span><br><span class="line">        &#125;;</span><br><span class="line">        unordered_map&lt;<span class="type">int</span>, vector&lt;<span class="type">int</span>&gt;&gt; graph;</span><br><span class="line">        function&lt;<span class="type">int</span>(<span class="type">int</span>, vector&lt;<span class="type">bool</span>&gt;&amp;)&gt; _cntNodes = [&amp;](<span class="type">int</span> start, vector&lt;<span class="type">bool</span>&gt;&amp; visited) &#123;</span><br><span class="line">            visited[start] = <span class="literal">true</span>;</span><br><span class="line">            <span class="type">int</span> child = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> subNode : graph[start]) &#123;</span><br><span class="line">                <span class="keyword">if</span>(!visited[subNode]) &#123;</span><br><span class="line">                    visited[subNode] = <span class="literal">true</span>;</span><br><span class="line">                    child += _cntNodes(subNode, visited);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>+child;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">auto</span> cntNodes = [&amp;](<span class="type">int</span> start) &#123;</span><br><span class="line">            vector&lt;<span class="type">bool</span>&gt; visited = <span class="built_in">vector</span>&lt;<span class="type">bool</span>&gt;(bombsNum, <span class="literal">false</span>);</span><br><span class="line">            <span class="keyword">return</span> _cntNodes(start, visited);</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; bombsNum; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; bombsNum; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span>(i == j) <span class="keyword">continue</span>;</span><br><span class="line">                <span class="keyword">if</span>(<span class="built_in">isICanBoomJ</span>(i, j)) &#123;</span><br><span class="line">                    graph[i].<span class="built_in">push_back</span>(j);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> maxBoom = INT_MIN;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; bombsNum; i++) &#123;</span><br><span class="line">            maxBoom = <span class="built_in">max</span>(maxBoom, <span class="built_in">cntNodes</span>(i));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> maxBoom;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li>æ³¨æ„è®¡ç®—è·ç¦»æ—¶intå¯èƒ½ä¼šæº¢å‡º</li></ul><h2 id="1186-åˆ é™¤ä¸€æ¬¡å¾—åˆ°å­æ•°ç»„æœ€å¤§å’Œ"><a href="#1186-åˆ é™¤ä¸€æ¬¡å¾—åˆ°å­æ•°ç»„æœ€å¤§å’Œ" class="headerlink" title="1186. åˆ é™¤ä¸€æ¬¡å¾—åˆ°å­æ•°ç»„æœ€å¤§å’Œ"></a>1186. åˆ é™¤ä¸€æ¬¡å¾—åˆ°å­æ•°ç»„æœ€å¤§å’Œ</h2><h2 id="3133-æ•°ç»„æœ€åä¸€ä¸ªå…ƒç´ çš„æœ€å°å€¼"><a href="#3133-æ•°ç»„æœ€åä¸€ä¸ªå…ƒç´ çš„æœ€å°å€¼" class="headerlink" title="3133. æ•°ç»„æœ€åä¸€ä¸ªå…ƒç´ çš„æœ€å°å€¼"></a>3133. æ•°ç»„æœ€åä¸€ä¸ªå…ƒç´ çš„æœ€å°å€¼</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">long</span> <span class="type">long</span> <span class="title">minEnd</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="type">long</span> <span class="type">long</span> res = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> mask_n = <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> mask_x = <span class="number">1</span>;</span><br><span class="line">        <span class="type">long</span> <span class="type">long</span> mask_res = <span class="number">1l</span>;</span><br><span class="line">        n--;</span><br><span class="line">        <span class="keyword">while</span>(mask_n &lt; <span class="number">0x8000&#x27;0000</span> &amp;&amp; mask_x &lt; <span class="number">0x8000&#x27;0000</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span>(x &amp; mask_x) &#123;</span><br><span class="line">                res |= mask_res;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span>(n &amp; mask_n) res |= mask_res;</span><br><span class="line">                mask_n &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            mask_res &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">            mask_x &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span>(mask_n &lt; <span class="number">0x8000&#x27;0000</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span>(n &amp; mask_n) res |= mask_res;</span><br><span class="line">            mask_res &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">            mask_n &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span>(mask_x &lt; <span class="number">0x8000&#x27;0000</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span>(x &amp; mask_x) &#123;</span><br><span class="line">                res |= mask_res;</span><br><span class="line">            &#125;</span><br><span class="line">            mask_res &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">            mask_x &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="æ€è·¯-1"><a href="#æ€è·¯-1" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h3><p>é¦–å…ˆæ‰€æœ‰çš„æ•°ç›¸ä¸åçš„ç»“æœéœ€è¦ä¸ºx,å…ˆéšä¾¿æ¥ä¸€ä¸ªäºŒè¿›åˆ¶æ•°ï¼Œçœ‹çœ‹æ»¡è¶³è¿™æ ·çš„æ•°æœ‰ä»€ä¹ˆè§„å¾‹</p><p>ä»¥<code>x = 001101101001</code>ä¸ºä¾‹</p><p>å¯¹äºæ•°ç»„ä¸­çš„äºŒè¿›åˆ¶æ•°ï¼Œå¦‚æœxçš„ç¬¬iä½ä¸º0ï¼Œåˆ™å¯¹åº”æ•°ç»„ä¸­çš„æ•°çš„ç¬¬iä½å¯ä»¥æ˜¯0ä¹Ÿå¯ä»¥æ˜¯1ï¼›å¦‚æœæœxçš„ç¬¬iä½ä¸º1ï¼Œåˆ™å¯¹åº”æ•°ç»„ä¸­çš„æ•°çš„ç¬¬iä½å¿…é¡»æ˜¯1</p><p>ä¹Ÿå°±æ˜¯æ•°ç»„ä¸­çš„æ•°æ»¡è¶³ $ a_i &#x3D; ??11?11?1??1 $</p><p>ç°åœ¨å¸Œæœ›æ•°ç»„ä¸­æœ‰nä¸ªæ•°</p><p>ä»¥<code>n = 9 = 000000001001</code>ä¸ºä¾‹ï¼Œå…ˆä¸ç®¡ç›¸ä¸ä¸ºxçš„é™åˆ¶ï¼Œæ•°ç»„ä¸­çš„æ•°å¯ä»¥æ˜¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">0001</span><br><span class="line">0010</span><br><span class="line">0011</span><br><span class="line">0100</span><br><span class="line">0101</span><br><span class="line">0110</span><br><span class="line">0111</span><br><span class="line">1000</span><br><span class="line">1001</span><br></pre></td></tr></table></figure><p>å‰é¢æåˆ°æ•°ç»„ä¸­çš„æ•°å¿…é¡»æ»¡è¶³$ a_i &#x3D; ??11?11?1??1 $, å¯ä»¥æŠŠè¿™äº›æ•°å®‰æ’åˆ°?å¤„ï¼Œè¿™æ ·å¯ä»¥ä¿è¯ç›¸ä¸ä¸ºxï¼Œä¹Ÿå¯ä»¥ä¿è¯æ•°ç›®<br>é‚£ä¹ˆæ•°ç»„ä¸­æœ€å¤§æ•°<code>9</code>ï¼ŒæŠŠä»–å¡«å…¥?å¤„å¯å¾—:<code>001111101011</code><br>é‚£ä¹ˆæ•°ç»„ä¸­æœ€å°æ•°<code>1</code>ï¼ŒæŠŠä»–å¡«å…¥?å¤„å¯å¾—:<code>001101101011</code></p><p>è€ƒè™‘åˆ°x&amp;x &#x3D; x, æ‰€ä»¥æ•°ç»„ä¸­æœ€å°æ•°å¯ä»¥æ˜¯0ï¼Œæ‰€ä»¥å¯¹äº<code>x = 001101101001</code>, <code>n = 9 = 000000001001</code>, æ•°ç»„ä¸­æœ€å°æ•°ä¸º<code>x</code>ï¼Œæœ€å¤§æ•°ä¸ºå°†8å¡«å…¥?å¤„ï¼Œå¾—<code>001111101001</code></p><h2 id="2850-å°†çŸ³å¤´åˆ†æ•£åˆ°ç½‘æ ¼å›¾çš„æœ€å°‘ç§»åŠ¨æ¬¡æ•°"><a href="#2850-å°†çŸ³å¤´åˆ†æ•£åˆ°ç½‘æ ¼å›¾çš„æœ€å°‘ç§»åŠ¨æ¬¡æ•°" class="headerlink" title="2850. å°†çŸ³å¤´åˆ†æ•£åˆ°ç½‘æ ¼å›¾çš„æœ€å°‘ç§»åŠ¨æ¬¡æ•°"></a>2850. å°†çŸ³å¤´åˆ†æ•£åˆ°ç½‘æ ¼å›¾çš„æœ€å°‘ç§»åŠ¨æ¬¡æ•°</h2><h3 id="æš´åŠ›åˆ†å­"><a href="#æš´åŠ›åˆ†å­" class="headerlink" title="æš´åŠ›åˆ†å­"></a>æš´åŠ›åˆ†å­</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="type">int</span> minMove = INT_MAX;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">move</span><span class="params">(vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; grid, <span class="type">int</span> moveCnt)</span> </span>&#123;</span><br><span class="line">        <span class="type">bool</span> flag = <span class="literal">true</span>;</span><br><span class="line">        <span class="type">int</span> minDist = INT_MAX;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">9</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(grid[i/<span class="number">3</span>][i%<span class="number">3</span>] &lt;= <span class="number">1</span>) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">9</span>; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span>(i == j) <span class="keyword">continue</span>;</span><br><span class="line">                <span class="keyword">if</span>(grid[j/<span class="number">3</span>][j%<span class="number">3</span>] == <span class="number">0</span>) &#123;</span><br><span class="line">                    flag = <span class="literal">false</span>;</span><br><span class="line">                    minDist = <span class="built_in">min</span>(minDist, <span class="built_in">abs</span>(i/<span class="number">3</span> - j/<span class="number">3</span>) + <span class="built_in">abs</span>(i%<span class="number">3</span> - j%<span class="number">3</span>));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(flag) &#123;</span><br><span class="line">            minMove = <span class="built_in">min</span>(minMove, moveCnt);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">9</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(grid[i/<span class="number">3</span>][i%<span class="number">3</span>] &lt;= <span class="number">1</span>) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">9</span>; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span>(i == j) <span class="keyword">continue</span>;</span><br><span class="line">                <span class="keyword">if</span>(grid[j/<span class="number">3</span>][j%<span class="number">3</span>] == <span class="number">0</span> &amp;&amp; <span class="built_in">abs</span>(i/<span class="number">3</span> - j/<span class="number">3</span>) + <span class="built_in">abs</span>(i%<span class="number">3</span> - j%<span class="number">3</span>) == minDist) &#123;</span><br><span class="line">                    grid[j/<span class="number">3</span>][j%<span class="number">3</span>]++;</span><br><span class="line">                    grid[i/<span class="number">3</span>][i%<span class="number">3</span>]--;</span><br><span class="line">                    <span class="built_in">move</span>(grid, moveCnt + <span class="built_in">abs</span>(i/<span class="number">3</span> - j/<span class="number">3</span>) + <span class="built_in">abs</span>(i%<span class="number">3</span> - j%<span class="number">3</span>));</span><br><span class="line">                    grid[j/<span class="number">3</span>][j%<span class="number">3</span>]--;</span><br><span class="line">                    grid[i/<span class="number">3</span>][i%<span class="number">3</span>]++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">minimumMoves</span><span class="params">(vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; grid)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">move</span>(grid, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> minMove;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ç¡¬æœ</p><h3 id="æšä¸¾"><a href="#æšä¸¾" class="headerlink" title="æšä¸¾"></a>æšä¸¾</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">unordered_map&lt;<span class="type">long</span> <span class="type">long</span>, <span class="type">int</span>&gt; m; <span class="comment">// int64è¡¨ç¤ºçš„grid to åˆ°è¾¾ åˆå§‹çŠ¶æ€çš„æœ€å°æ­¥æ•°</span></span><br><span class="line"><span class="type">const</span> <span class="type">long</span> <span class="type">long</span> initState = <span class="number">0x00&#x27;00&#x27;00&#x27;01&#x27;11&#x27;11&#x27;11&#x27;11</span>;</span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">int</span> initMap = []()&#123;</span><br><span class="line">    queue&lt;<span class="type">long</span> <span class="type">long</span>&gt; q;</span><br><span class="line">    q.<span class="built_in">push</span>(initState);</span><br><span class="line">    m[initState] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(!q.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">        <span class="type">long</span> <span class="type">long</span> state = q.<span class="built_in">front</span>();</span><br><span class="line">        <span class="type">int</span> step = m[state];</span><br><span class="line">        q.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">9</span>; i++) &#123;</span><br><span class="line">            <span class="type">int</span> numI = (state &gt;&gt; (i &lt;&lt; <span class="number">2</span>)) &amp; <span class="number">0x0f</span>;</span><br><span class="line">            <span class="keyword">if</span>(numI != <span class="number">1</span>) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">9</span>; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span>(i == j) <span class="keyword">continue</span>;</span><br><span class="line">                <span class="type">long</span> <span class="type">long</span> numJ = (state &gt;&gt; (j &lt;&lt; <span class="number">2</span>)) &amp; <span class="number">0x0f</span>;</span><br><span class="line">                <span class="keyword">if</span>(numJ == <span class="number">0</span>) <span class="keyword">continue</span>;</span><br><span class="line">                <span class="type">int</span> newStep = step + <span class="built_in">abs</span>(i / <span class="number">3</span> - j / <span class="number">3</span>) + <span class="built_in">abs</span>(i % <span class="number">3</span> - j % <span class="number">3</span>);</span><br><span class="line">                numJ++;</span><br><span class="line">                <span class="type">long</span> <span class="type">long</span> newState = state;</span><br><span class="line">                newState = newState &amp; ~(<span class="number">0x0f</span>l &lt;&lt; (i &lt;&lt; <span class="number">2</span>));</span><br><span class="line">                newState = newState &amp; ~(<span class="number">0x0f</span>l &lt;&lt; (j &lt;&lt; <span class="number">2</span>));</span><br><span class="line">                newState = newState | (numJ &lt;&lt; (j &lt;&lt; <span class="number">2</span>));</span><br><span class="line">                <span class="keyword">if</span>(!m.<span class="built_in">count</span>(newState) || m[newState] &gt; newStep) &#123;</span><br><span class="line">                    q.<span class="built_in">push</span>(newState);</span><br><span class="line">                    m[newState] = newStep;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;();</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="function"><span class="type">long</span> <span class="type">long</span> <span class="title">grid2Int64</span><span class="params">(<span class="type">const</span> vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; grid)</span> </span>&#123;</span><br><span class="line">        <span class="type">long</span> <span class="type">long</span> int64Grid = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">3</span>; j++) &#123;</span><br><span class="line">                int64Grid &lt;&lt;= <span class="number">4</span>;</span><br><span class="line">                int64Grid += grid[i][j];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> int64Grid;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">minimumMoves</span><span class="params">(vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; grid)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> m[<span class="built_in">grid2Int64</span>(grid)];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ç”¨longlongè¡¨ç¤ºgridï¼Œä»å…¨1çš„gridå¼€å§‹ï¼Œæ‰¾å‡ºæ‰€æœ‰gridæƒ…å†µï¼Œè®¡ç®—å‡ºä»–å˜æˆå…¨1çš„stepï¼Œç¼“å­˜èµ·æ¥ï¼Œç”¨çš„æ—¶å€™æŸ¥</p><h3 id="å…¨æ’åˆ—"><a href="#å…¨æ’åˆ—" class="headerlink" title="å…¨æ’åˆ—"></a>å…¨æ’åˆ—</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">minimumMoves</span><span class="params">(vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; grid)</span> </span>&#123;</span><br><span class="line">        vector&lt;<span class="type">int</span>&gt; more, less;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">9</span>; i++) &#123;</span><br><span class="line">            <span class="type">int</span> num = grid[i / <span class="number">3</span>][i % <span class="number">3</span>];</span><br><span class="line">            <span class="keyword">if</span>(num &gt; <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">1</span>; j &lt; num; j++) &#123;</span><br><span class="line">                    more.<span class="built_in">push_back</span>(i);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>(num == <span class="number">0</span>) &#123;</span><br><span class="line">                less.<span class="built_in">push_back</span>(i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> len = more.<span class="built_in">size</span>();</span><br><span class="line">        <span class="type">int</span> minStep = INT_MAX;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="type">int</span> step = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">                step += <span class="built_in">abs</span>(more[i] / <span class="number">3</span> - less[i] / <span class="number">3</span>) + <span class="built_in">abs</span>(more[i] % <span class="number">3</span> - less[i] % <span class="number">3</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            minStep = <span class="built_in">min</span>(minStep, step);</span><br><span class="line">        &#125; <span class="keyword">while</span>(<span class="built_in">next_permutation</span>(more.<span class="built_in">begin</span>(), more.<span class="built_in">end</span>()));</span><br><span class="line">        <span class="keyword">return</span> minStep;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li>æŠ„çš„é¢˜è§£</li><li>æ¯ä¸ªå¤§äº1çš„æ ¼å­æœ€åéƒ½ä¼šå˜æˆ1ï¼Œå¡«è¡¥åˆ°0ä¸Šï¼Œå¤§äº1çš„æ ¼å­çš„å€¼-1ä¹‹å’Œç­‰äº0çš„æ ¼å­æ•°é‡æ˜¯ç›¸ç­‰çš„</li><li>æ„é€ ä¸¤ä¸ªæ•°ç»„ï¼Œä¸€ä¸ªå­˜å…¨0çš„æ ¼å­ä¸‹æ ‡ï¼Œä¸€ä¸ªå°†å¤§äº1çš„æ ¼å­å­˜n-1æ¬¡ï¼Œä¸¤ä¸ªæ•°ç»„é•¿åº¦ä¸€è‡´</li><li>(more[i],less[i])è¡¨ç¤ºå°†iæ ¼å­ä¸Šçš„ä¸€å—çŸ³å¤´æ¬åˆ°lessä¸Šï¼Œåªè¦å¯¹moreè¿›è¡Œå…¨æ’åˆ—ï¼Œå°±å¯ä»¥æ‰¾å‡ºæ‰€æœ‰ç§»åŠ¨çš„æ–¹æ³•ï¼Œç„¶åç®—å‡ºæ‰€éœ€çš„æ€»æ­¥æ•°ï¼Œç„¶åç®—å‡ºæœ€å°æ­¥æ•°</li></ul><h2 id="3096-å¾—åˆ°æ›´å¤šåˆ†æ•°çš„æœ€å°‘å…³å¡æ•°ç›®"><a href="#3096-å¾—åˆ°æ›´å¤šåˆ†æ•°çš„æœ€å°‘å…³å¡æ•°ç›®" class="headerlink" title="3096. å¾—åˆ°æ›´å¤šåˆ†æ•°çš„æœ€å°‘å…³å¡æ•°ç›®"></a>3096. å¾—åˆ°æ›´å¤šåˆ†æ•°çš„æœ€å°‘å…³å¡æ•°ç›®</h2><p>åˆæ˜¯åšå¼ˆé—®é¢˜ï¼Œä¸ä¼š</p><h2 id="3112-è®¿é—®æ¶ˆå¤±èŠ‚ç‚¹çš„æœ€å°‘æ—¶é—´"><a href="#3112-è®¿é—®æ¶ˆå¤±èŠ‚ç‚¹çš„æœ€å°‘æ—¶é—´" class="headerlink" title="3112. è®¿é—®æ¶ˆå¤±èŠ‚ç‚¹çš„æœ€å°‘æ—¶é—´"></a>3112. è®¿é—®æ¶ˆå¤±èŠ‚ç‚¹çš„æœ€å°‘æ—¶é—´</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">minimumTime</span><span class="params">(<span class="type">int</span> n, vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; edges, vector&lt;<span class="type">int</span>&gt;&amp; disappear)</span> </span>&#123;</span><br><span class="line">        vector&lt;vector&lt;pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt;&gt;&gt; <span class="built_in">graph</span>(n);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">const</span> <span class="keyword">auto</span>&amp; edge : edges) &#123;</span><br><span class="line">            graph[edge[<span class="number">0</span>]].<span class="built_in">emplace_back</span>(edge[<span class="number">1</span>], edge[<span class="number">2</span>]);</span><br><span class="line">            graph[edge[<span class="number">1</span>]].<span class="built_in">emplace_back</span>(edge[<span class="number">0</span>], edge[<span class="number">2</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">ans</span><span class="params">(n, INT_MAX / <span class="number">2</span>)</span></span>;</span><br><span class="line">        <span class="keyword">auto</span> cmp = [](<span class="type">const</span> pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt;&amp; i , <span class="type">const</span> pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt;&amp; j)&#123;</span><br><span class="line">            <span class="keyword">return</span> i.second &gt; j.second;</span><br><span class="line">        &#125;;</span><br><span class="line">        priority_queue&lt;pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt;, vector&lt;pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt;&gt;, <span class="keyword">decltype</span>(cmp)&gt; <span class="built_in">q</span>(cmp);</span><br><span class="line">        q.<span class="built_in">emplace</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        ans[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(!q.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="keyword">auto</span> [min_index, len] = q.<span class="built_in">top</span>();</span><br><span class="line">            q.<span class="built_in">pop</span>();</span><br><span class="line">            <span class="keyword">if</span>(len &gt; ans[min_index]) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">auto</span> [child, len] : graph[min_index]) &#123;</span><br><span class="line">                <span class="type">int</span> newLen = ans[min_index] + len &gt;= disappear[child] ? INT_MAX / <span class="number">2</span> : ans[min_index] + len;</span><br><span class="line">                <span class="keyword">if</span>(newLen &lt; ans[child] &amp;&amp; newLen &lt; INT_MAX / <span class="number">2</span>) &#123;</span><br><span class="line">                    ans[child] = newLen;</span><br><span class="line">                    q.<span class="built_in">emplace</span>(child, ans[child]);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(ans[i] &gt;= INT_MAX / <span class="number">2</span>) ans[i] = <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li>å°±æ˜¯å¸¦é™åˆ¶çš„dijkstraï¼Œä½†æ˜¯å¾ˆå‘<ul><li>ä¸¤ä¸ªé¡¶ç‚¹ä¹‹é—´å¯èƒ½å­˜åœ¨å¤šä¸ªé•¿åº¦ä¸åŒçš„è¾¹ï¼Œæ˜¾ç„¶è¦é€‰æœ€å°çš„ï¼Œä½†ä¸èƒ½ç”¨n*nçš„vectorå­˜å›¾ï¼Œä¼šè¶…å†…å­˜</li><li>å¿…é¡»ç”¨ä¼˜å…ˆé˜Ÿåˆ—é€‰ç‚¹ï¼Œå¦åˆ™æ—¶é—´è¶…</li></ul></li></ul><h2 id="3145-å¤§æ•°ç»„å…ƒç´ çš„ä¹˜ç§¯"><a href="#3145-å¤§æ•°ç»„å…ƒç´ çš„ä¹˜ç§¯" class="headerlink" title="3145. å¤§æ•°ç»„å…ƒç´ çš„ä¹˜ç§¯"></a>3145. å¤§æ•°ç»„å…ƒç´ çš„ä¹˜ç§¯</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span> uint64;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="function">uint64 <span class="title">fastPower</span><span class="params">(uint64 a, uint64 n, uint64 mod)</span> </span>&#123;</span><br><span class="line">        uint64 res = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(n) &#123;</span><br><span class="line">            <span class="keyword">if</span>(n &amp; <span class="number">1</span>) &#123;</span><br><span class="line">                res = (res * a) % mod;</span><br><span class="line">            &#125;</span><br><span class="line">            a = (a * a) % mod;</span><br><span class="line">            n &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res % mod;</span><br><span class="line">    &#125; <span class="comment">// å¿«é€Ÿå¹‚</span></span><br><span class="line">    <span class="function">uint64 <span class="title">powerOfproduct</span><span class="params">(uint64 k)</span> </span>&#123;</span><br><span class="line">        <span class="type">long</span> <span class="type">long</span> value = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> mask_off = <span class="number">64</span>; mask_off &gt;= <span class="number">1</span>; mask_off--) &#123;</span><br><span class="line">            uint64 mask = <span class="number">1l</span> &lt;&lt; (mask_off - <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">if</span>(!(mask &amp; k)) <span class="keyword">continue</span>;</span><br><span class="line">            k = k &amp; ~mask;</span><br><span class="line">            value += ((k|mask) - mask + <span class="number">1</span>) * (mask_off - <span class="number">1</span>);</span><br><span class="line">            value += mask / <span class="number">2</span> * ((mask_off - <span class="number">1</span>)*(mask_off - <span class="number">2</span>)/<span class="number">2</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125; <span class="comment">// å°äºç­‰äºkçš„æ‰€æœ‰æ•°çš„æŒ‡æ•°å’Œ</span></span><br><span class="line"></span><br><span class="line">    <span class="function">uint64 <span class="title">totalOneOf</span><span class="params">(uint64 k)</span> </span>&#123;</span><br><span class="line">        <span class="type">long</span> <span class="type">long</span> value = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> mask_off = <span class="number">64</span>; mask_off &gt;= <span class="number">1</span>; mask_off--) &#123;</span><br><span class="line">            uint64 mask = <span class="number">1l</span> &lt;&lt; (mask_off - <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">if</span>(!(mask &amp; k)) <span class="keyword">continue</span>;</span><br><span class="line">            k = k &amp; ~mask;</span><br><span class="line">            value += ((k|mask) - mask + <span class="number">1</span>);</span><br><span class="line">            value += mask / <span class="number">2</span> * (mask_off - <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125; <span class="comment">// å°äºç­‰äºkçš„æ‰€æœ‰æ•°çš„1çš„ä¸ªæ•°</span></span><br><span class="line"></span><br><span class="line">    <span class="function">uint64 <span class="title">findLeftRange</span><span class="params">(uint64 pos)</span> </span>&#123;</span><br><span class="line">        uint64 l = <span class="number">0</span>, r = pos;</span><br><span class="line">        <span class="keyword">while</span>(l &lt; r) &#123;</span><br><span class="line">            uint64 mid = (r - l + <span class="number">1</span>) / <span class="number">2</span> + l;</span><br><span class="line">            uint64 totalOnOfPos = <span class="built_in">totalOneOf</span>(mid);</span><br><span class="line">            <span class="keyword">if</span>(totalOnOfPos &lt; pos) &#123;</span><br><span class="line">                l = mid;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                r = mid - <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> l; </span><br><span class="line">    &#125; <span class="comment">// äºŒåˆ†æŸ¥æ‰¾ä¸‹æ ‡åœ¨æ•°ç»„ä¸­å¯¹åº”çš„æ•°çš„å‰ä¸€ä¸ªæ•°</span></span><br><span class="line"></span><br><span class="line">    <span class="function">uint64 <span class="title">powerSumTo</span><span class="params">(uint64 k, uint64 pos)</span> </span>&#123;</span><br><span class="line">        uint64 powerSum = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> cnt = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> off = <span class="number">0</span>; off &lt; <span class="number">64</span>; off++) &#123;</span><br><span class="line">            uint64 mask = <span class="number">1l</span> &lt;&lt; off;</span><br><span class="line">            <span class="keyword">if</span>(k &amp; mask) &#123;</span><br><span class="line">                cnt++;</span><br><span class="line">                <span class="keyword">if</span>(cnt &lt;= pos) &#123;</span><br><span class="line">                    powerSum += off;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> powerSum;</span><br><span class="line">    &#125; <span class="comment">// è®¡ç®—kçš„å‰posä¸ª1å¯¹åº”çš„æŒ‡æ•°å’Œ</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">findProductsOfElements</span><span class="params">(vector&lt;vector&lt;<span class="type">long</span> <span class="type">long</span>&gt;&gt;&amp; queries)</span> </span>&#123;</span><br><span class="line">        vector&lt;<span class="type">int</span>&gt; anwser;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">const</span> <span class="keyword">auto</span>&amp; query: queries) &#123;</span><br><span class="line">            uint64 leftRange0 = <span class="built_in">findLeftRange</span>(query[<span class="number">0</span>]+<span class="number">1</span>) + <span class="number">1</span>;</span><br><span class="line">            uint64 leftRange1 = <span class="built_in">findLeftRange</span>(query[<span class="number">1</span>]+<span class="number">1</span>) + <span class="number">1</span>;</span><br><span class="line">            uint64 totalOneOf0 = <span class="built_in">totalOneOf</span>(leftRange0 - <span class="number">1</span>);</span><br><span class="line">            uint64 totalOneOf1 = <span class="built_in">totalOneOf</span>(leftRange1 - <span class="number">1</span>);</span><br><span class="line">            uint64 powerSum0 = <span class="built_in">powerSumTo</span>(leftRange0, query[<span class="number">0</span>] - totalOneOf0);</span><br><span class="line">            uint64 powerSum1 = <span class="built_in">powerSumTo</span>(leftRange1, query[<span class="number">1</span>]+<span class="number">1</span> - totalOneOf1);</span><br><span class="line">            uint64 power = (<span class="built_in">powerOfproduct</span>(leftRange1 - <span class="number">1</span>) - <span class="built_in">powerOfproduct</span>(leftRange0 - <span class="number">1</span>) + powerSum1 - powerSum0);</span><br><span class="line">            anwser.<span class="built_in">push_back</span>(<span class="built_in">fastPower</span>(<span class="number">2</span>, power, query[<span class="number">2</span>]));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> anwser;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨å’Œ<a href="#3007-%E4%BB%B7%E5%80%BC%E5%92%8C%E5%B0%8F%E4%BA%8E%E7%AD%89%E4%BA%8E-k-%E7%9A%84%E6%9C%80%E5%A4%A7%E6%95%B0%E5%AD%97">3007. ä»·å€¼å’Œå°äºç­‰äº K çš„æœ€å¤§æ•°å­—</a>ç›¸åŒçš„æ€è·¯ï¼Œæ‰¾åˆ°<code>O(1)</code>çš„è®¡ç®—å°äºç­‰äºNçš„1çš„ä¸ªæ•°</li><li>é€šè¿‡äºŒåˆ†æŸ¥æ‰¾å°±å¯ä»¥æ‰¾åˆ°big_numsä¸‹æ ‡å¯¹åº”çš„æ•°ï¼Œç”±äºæ‰€æ±‚æ•°æ˜¯2çš„å¹‚çš„ç§¯ï¼Œæ‰€ä»¥å†è®¡ç®—è¿™ä¸ªæ•°ä¹‹å‰çš„æ‰€æœ‰æ•°çš„ä¹˜ç§¯çš„æŒ‡æ•°ï¼Œä¸¤ä¸ªæŒ‡æ•°ç›¸å‡ï¼Œå†æ¨¡nå¿«é€Ÿå¹‚å³å¯æ±‚å¾—æœ€ç»ˆç­”æ¡ˆ</li></ul><h2 id="2956-æ‰¾åˆ°ä¸¤ä¸ªæ•°ç»„ä¸­çš„å…¬å…±å…ƒç´ "><a href="#2956-æ‰¾åˆ°ä¸¤ä¸ªæ•°ç»„ä¸­çš„å…¬å…±å…ƒç´ " class="headerlink" title="2956. æ‰¾åˆ°ä¸¤ä¸ªæ•°ç»„ä¸­çš„å…¬å…±å…ƒç´ "></a>2956. æ‰¾åˆ°ä¸¤ä¸ªæ•°ç»„ä¸­çš„å…¬å…±å…ƒç´ </h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">findIntersectionValues</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums1, vector&lt;<span class="type">int</span>&gt;&amp; nums2)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> ans1 = <span class="number">0</span>, ans2 = <span class="number">0</span>;</span><br><span class="line">        unordered_map&lt;<span class="type">int</span>, <span class="type">int</span>&gt; m1, m2;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> num1 : nums1) &#123;</span><br><span class="line">            m1[num1]++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> num2 : nums2) &#123;</span><br><span class="line">            <span class="keyword">if</span>(m1.<span class="built_in">count</span>(num2)) &#123;</span><br><span class="line">                ans2++;</span><br><span class="line">            &#125;</span><br><span class="line">            m2[num2]++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> num1 : nums1) &#123;</span><br><span class="line">            <span class="keyword">if</span>(m2.<span class="built_in">count</span>(num1)) &#123;</span><br><span class="line">                ans1++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> &#123;ans1, ans2&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;551-å­¦ç”Ÿå‡ºå‹¤è®°å½•-I&quot;&gt;&lt;a href=&quot;#551-å­¦ç”Ÿå‡ºå‹¤è®°å½•-I&quot; class=&quot;headerlink&quot; title=&quot;551. å­¦ç”Ÿå‡ºå‹¤è®°å½• I&quot;&gt;&lt;/a&gt;&lt;a href=&quot;https://leetcode.cn/problems/student-attendance-record-i/description/?envType=daily-question&amp;envId=2024-08-18&quot;&gt;551. å­¦ç”Ÿå‡ºå‹¤è®°å½• I&lt;/a&gt;&lt;/h2&gt;&lt;figure class=&quot;highlight c++&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title class_&quot;&gt;Solution&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;type&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;checkRecord&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(string s)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; count = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; max_seq_late = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; seq_late = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;type&quot;&gt;char&lt;/span&gt; c : s) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(c == &lt;span class=&quot;string&quot;&gt;&amp;#x27;A&amp;#x27;&lt;/span&gt;) count++;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(c == &lt;span class=&quot;string&quot;&gt;&amp;#x27;L&amp;#x27;&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                seq_late++;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                max_seq_late = &lt;span class=&quot;built_in&quot;&gt;max&lt;/span&gt;(max_seq_late, seq_late);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                seq_late = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        max_seq_late = &lt;span class=&quot;built_in&quot;&gt;max&lt;/span&gt;(max_seq_late, seq_late);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; count &amp;lt; &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt; &amp;amp;&amp;amp; max_seq_late &amp;lt; &lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;ul&gt;
&lt;li&gt;è¿ç»­ç›¸åŒçš„å€¼çš„ä¸ªæ•°&lt;/li&gt;
&lt;li&gt;ç»Ÿè®¡å…ƒç´ å‡ºç°çš„æ¬¡æ•°&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;3137-K-å‘¨æœŸå­—ç¬¦ä¸²éœ€è¦çš„æœ€å°‘æ“ä½œæ¬¡æ•°&quot;&gt;&lt;a href=&quot;#3137-K-å‘¨æœŸå­—ç¬¦ä¸²éœ€è¦çš„æœ€å°‘æ“ä½œæ¬¡æ•°&quot; class=&quot;headerlink&quot; title=&quot;3137. K å‘¨æœŸå­—ç¬¦ä¸²éœ€è¦çš„æœ€å°‘æ“ä½œæ¬¡æ•°&quot;&gt;&lt;/a&gt;&lt;a href=&quot;https://leetcode.cn/problems/minimum-number-of-operations-to-make-word-k-periodic/description/?envType=daily-question&amp;envId=2024-08-17&quot;&gt;3137. K å‘¨æœŸå­—ç¬¦ä¸²éœ€è¦çš„æœ€å°‘æ“ä½œæ¬¡æ•°&lt;/a&gt;&lt;/h2&gt;&lt;figure class=&quot;highlight c++&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title class_&quot;&gt;Solution&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;minimumOperationsToMakeKPeriodic&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(string word, &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; k)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        unordered_map&amp;lt;string, &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt;&amp;gt; subStrCount;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; len = word.&lt;span class=&quot;built_in&quot;&gt;length&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; i = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;; i &amp;lt; len; i += k) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            subStrCount[word.&lt;span class=&quot;built_in&quot;&gt;substr&lt;/span&gt;(i, k)]++;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; minOpCnt = len / k;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;auto&lt;/span&gt;&amp;amp; ite : subStrCount) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            minOpCnt = &lt;span class=&quot;built_in&quot;&gt;min&lt;/span&gt;(minOpCnt, len / k - ite.second);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; minOpCnt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;ul&gt;
&lt;li&gt;ç¿»è¯‘ä¸€ä¸‹è§„åˆ™ï¼Œå°±æ˜¯æŠŠé•¿åº¦ä¸º&lt;code&gt;nk&lt;/code&gt;çš„å­—ç¬¦ä¸²åˆ‡å‰²æˆ&lt;code&gt;n&lt;/code&gt;ä¸ªé•¿åº¦ä¸º&lt;code&gt;k&lt;/code&gt;çš„å­ä¸²ï¼Œä¸€æ¬¡æ“ä½œå¯ä»¥æŠŠä¸€ä¸ªå­ä¸²æ›¿æ¢æˆå¦ä¸€ä¸ªå­—ä¸²ï¼Œæ±‚å¦‚ä½•æ›¿æ¢ï¼Œå°†æ‰€æœ‰å­—ä¸²éƒ½ç›¸åŒã€‚&lt;/li&gt;
&lt;li&gt;ç¿»è¯‘å¥½éœ€æ±‚ï¼Œå°±å¾ˆæ¸…æ¥šäº†ï¼Œç›´æ¥ç»Ÿè®¡æ¯ä¸ªå­—ä¸²å‡ºç°çš„æ¬¡æ•°ï¼Œå–å‡ºç°æ¬¡æ•°æœ€å¤§çš„ï¼Œæ›¿æ¢æ¬¡æ•°æœ€å°‘ï¼Œä¸º&lt;code&gt;n - cnt[i]&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="LeetCode" scheme="https://jingtianer.github.io/home/categories/LeetCode/"/>
    
    <category term="ç®—æ³•" scheme="https://jingtianer.github.io/home/categories/LeetCode/%E7%AE%97%E6%B3%95/"/>
    
    
    <category term="LeetCode" scheme="https://jingtianer.github.io/home/tags/LeetCode/"/>
    
    <category term="ç®—æ³•" scheme="https://jingtianer.github.io/home/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>åŸºç¡€05-Navigation</title>
    <link href="https://jingtianer.github.io/home/2024/08/07/Android%E9%AB%98%E7%BA%A7/%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/%E5%9F%BA%E7%A1%8005-Navigation/"/>
    <id>https://jingtianer.github.io/home/2024/08/07/Android%E9%AB%98%E7%BA%A7/%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/%E5%9F%BA%E7%A1%8005-Navigation/</id>
    <published>2024-08-07T13:15:36.000Z</published>
    <updated>2025-04-15T02:37:55.589Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p><code>NavController</code>æ˜¯ä¸­å¤®å¯¼èˆª APIã€‚å®ƒä¼šè·Ÿè¸ªç”¨æˆ·è®¿é—®è¿‡çš„ç›®çš„åœ°ï¼Œå¹¶å…è®¸ç”¨æˆ·åœ¨ç›®çš„åœ°ä¹‹é—´ç§»åŠ¨ã€‚</p><h3 id="è·å–NavController"><a href="#è·å–NavController" class="headerlink" title="è·å–NavController"></a>è·å–<code>NavController</code></h3><ul><li>fragment</li></ul><p>å¦‚æœæ˜¯NavHostFragment</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> navController = <span class="keyword">this</span>.navController</span><br></pre></td></tr></table></figure><p>å¦‚æœæ˜¯æ™®é€šFragment</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> navController = <span class="keyword">this</span>.findNavController()</span><br></pre></td></tr></table></figure><ul><li>compose</li></ul><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> navController = rememberNavController()</span><br></pre></td></tr></table></figure><p><code>NavHostFragment</code>å®ç°äº†<code>NavHost</code>æ¥å£ï¼Œå¯ä»¥ç›´æ¥è·å–<code>NavController</code>ã€‚</p><ul><li>view</li></ul><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> navController = view.findNavController()</span><br><span class="line"><span class="comment">// è¿™ä¸ªviewå¿…é¡»åœ¨ä¸€ä¸ªNavHostä¹‹ä¸­</span></span><br></pre></td></tr></table></figure><ul><li>activity</li></ul><p>å…ˆè·å–<code>Activity</code>ä¸­çš„<code>NavHostFragment</code>ï¼Œå†è·å–<code>NavController</code>ã€‚</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> navHostFragment =</span><br><span class="line">    supportFragmentManager.findFragmentById(R.id.nav_host_fragment) <span class="keyword">as</span> NavHostFragment</span><br><span class="line"><span class="keyword">val</span> navController = navHostFragment.navController</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨Activityçš„æ‰©å±•å‡½æ•°<code>findNavController</code>ï¼Œå¯ä»¥è·å–<code>NavController</code>ã€‚</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> navController = activity.findNavController(R.id.view_within_navhost)</span><br><span class="line"><span class="comment">// R.id.view_within_navhostè¿™ä¸ªviewå¿…é¡»åœ¨ä¸€ä¸ªNavHostä¹‹ä¸­</span></span><br></pre></td></tr></table></figure><h4 id="Fragment-findNavController"><a href="#Fragment-findNavController" class="headerlink" title="Fragment.findNavController"></a>Fragment.findNavController</h4><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">fun</span> Fragment.<span class="title">findNavController</span><span class="params">()</span></span>: NavController =</span><br><span class="line">    NavHostFragment.findNavController(<span class="keyword">this</span>)</span><br></pre></td></tr></table></figure><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@JvmStatic</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">fun</span> <span class="title">findNavController</span><span class="params">(fragment: <span class="type">Fragment</span>)</span></span>: NavController &#123;</span><br><span class="line">    <span class="keyword">var</span> findFragment: Fragment? = fragment</span><br><span class="line">    <span class="keyword">while</span> (findFragment != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (findFragment <span class="keyword">is</span> NavHostFragment) &#123;</span><br><span class="line">            <span class="keyword">return</span> findFragment.navHostController</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">val</span> primaryNavFragment = findFragment.parentFragmentManager</span><br><span class="line">            .primaryNavigationFragment</span><br><span class="line">        <span class="keyword">if</span> (primaryNavFragment <span class="keyword">is</span> NavHostFragment) &#123;</span><br><span class="line">            <span class="keyword">return</span> primaryNavFragment.navHostController</span><br><span class="line">        &#125;</span><br><span class="line">        findFragment = findFragment.parentFragment</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Try looking for one associated with the view instead, if applicable</span></span><br><span class="line">    <span class="keyword">val</span> view = fragment.view</span><br><span class="line">    <span class="keyword">if</span> (view != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> Navigation.findNavController(view)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// For DialogFragments, look at the dialog&#x27;s decor view</span></span><br><span class="line">    <span class="keyword">val</span> dialogDecorView = (fragment <span class="keyword">as</span>? DialogFragment)?.dialog?.window?.decorView</span><br><span class="line">    <span class="keyword">if</span> (dialogDecorView != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> Navigation.findNavController(dialogDecorView)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">throw</span> IllegalStateException(<span class="string">&quot;Fragment <span class="variable">$fragment</span> does not have a NavController set&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ä»å½“å‰fragmentå¼€å§‹å¯»æ‰¾<ul><li>å¦‚æœæœ‰<code>NavHostFragment</code>ï¼Œå°±è¿”å›ä»–çš„<code>NavController</code></li><li>å¦‚æœæ²¡æœ‰ï¼Œå°±æ‰¾<code>parentFragmentManager</code>çš„<code>primaryNavigationFragment</code><ul><li>å¦‚æœæ˜¯<code>NavHostFragment</code>ï¼Œå°±è¿”å›ä»–çš„<code>NavController</code></li><li>å¦‚æœä¸æ˜¯ï¼Œå°±æŠŠå½“å‰<code>fragment</code>è®¾ç½®ä¸º<code>parentFragment</code>ï¼Œé‡å¤ä¸Šé¢è¿‡ç¨‹ï¼Œç›´åˆ°æ‰¾åˆ°ä¸€ä¸ª<code>NavHostFragment</code>æˆ–æ²¡æœ‰<code>parentFragment</code>ä¸ºæ­¢</li></ul></li></ul></li><li>å¦‚æœå½“å‰fragmentåŠçˆ¶fragmentä¸­æ‰¾ä¸åˆ°<code>NavHostFragment</code>ï¼Œå°±å°è¯•ä»å½“å‰fragmentçš„<code>view</code>ä¸­å¯»æ‰¾</li><li>å¦‚æœè¿˜æ˜¯æ‰¾ä¸åˆ°ï¼Œå°è¯•åˆ¤æ–­å½“å‰<code>fragment</code>æ˜¯å¦ä¸º<code>DialogFragment</code>ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™ä»<code>DialogFragment</code>çš„<code>decorView</code>ä¸­æŸ¥æ‰¾</li><li>å¦‚æœè¿˜æ˜¯æ‰¾ä¸åˆ°ï¼Œå°±æŠ›å‡ºå¼‚å¸¸</li></ul><h4 id="View-findNavController"><a href="#View-findNavController" class="headerlink" title="View.findNavController"></a>View.findNavController</h4><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">fun</span> View.<span class="title">findNavController</span><span class="params">()</span></span>: NavController =</span><br><span class="line">    Navigation.findNavController(<span class="keyword">this</span>)</span><br></pre></td></tr></table></figure><h4 id="Activity-findNavController"><a href="#Activity-findNavController" class="headerlink" title="Activity.findNavController"></a>Activity.findNavController</h4><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">fun</span> Activity.<span class="title">findNavController</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="meta">@IdRes</span> viewId: <span class="type">Int</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>: NavController = Navigation.findNavController(<span class="keyword">this</span>, viewId)</span><br></pre></td></tr></table></figure><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@JvmStatic</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">fun</span> <span class="title">findNavController</span><span class="params">(activity: <span class="type">Activity</span>, <span class="meta">@IdRes</span> viewId: <span class="type">Int</span>)</span></span>: NavController &#123;</span><br><span class="line">    <span class="keyword">val</span> view = ActivityCompat.requireViewById&lt;View&gt;(activity, viewId)</span><br><span class="line">    <span class="keyword">return</span> findViewNavController(view)</span><br><span class="line">        ?: <span class="keyword">throw</span> IllegalStateException(</span><br><span class="line">            <span class="string">&quot;Activity <span class="variable">$activity</span> does not have a NavController set on <span class="variable">$viewId</span>&quot;</span></span><br><span class="line">        )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>Activityå°±æ˜¯æ¯”Viewå¤šäº†ä¸€æ­¥<code>findViewById</code></li></ul><h4 id="findViewNavController-view-View"><a href="#findViewNavController-view-View" class="headerlink" title="findViewNavController(view: View)"></a><code>findViewNavController(view: View)</code></h4><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">findViewNavController</span><span class="params">(view: <span class="type">View</span>)</span></span>: NavController? =</span><br><span class="line">    generateSequence(view) &#123;</span><br><span class="line">        it.parent <span class="keyword">as</span>? View?</span><br><span class="line">    &#125;.mapNotNull &#123;</span><br><span class="line">        getViewNavController(it)</span><br><span class="line">    &#125;.firstOrNull()</span><br></pre></td></tr></table></figure><ul><li>å…¶å®å°±æ˜¯ä»å½“å‰viewå¼€å§‹ï¼Œä¸€ç›´æ‰¾åˆ°æ ¹viewï¼Œå¦‚æœè¿‡ç¨‹ä¸­æœ‰<code>NavController</code>ï¼Œå°±è¿”å›</li><li>å…¶ä¸­ä¸€ä¸ªè®¾ç½®<code>nav_controller_view_tag</code>çš„åœ°æ–¹å¯ä»¥çœ‹<a href="#onviewcreated">NavHostFragment#onviewcreated</a></li></ul><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Suppress(<span class="string">&quot;UNCHECKED_CAST&quot;</span>)</span></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">getViewNavController</span><span class="params">(view: <span class="type">View</span>)</span></span>: NavController? &#123;</span><br><span class="line">    <span class="keyword">val</span> tag = view.getTag(R.id.nav_controller_view_tag)</span><br><span class="line">    <span class="keyword">var</span> controller: NavController? = <span class="literal">null</span></span><br><span class="line">    <span class="keyword">if</span> (tag <span class="keyword">is</span> WeakReference&lt;*&gt;) &#123;</span><br><span class="line">        controller = (tag <span class="keyword">as</span> WeakReference&lt;NavController&gt;).<span class="keyword">get</span>()</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (tag <span class="keyword">is</span> NavController) &#123;</span><br><span class="line">        controller = tag</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> controller</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@kotlin</span>.<span class="keyword">internal</span>.LowPriorityInOverloadResolution</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;T : Any&gt;</span> <span class="title">generateSequence</span><span class="params">(seed: <span class="type">T</span>?, nextFunction: (<span class="type">T</span>) -&gt; <span class="type">T</span>?)</span></span>: Sequence&lt;T&gt; =</span><br><span class="line">    <span class="keyword">if</span> (seed == <span class="literal">null</span>)</span><br><span class="line">        EmptySequence</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        GeneratorSequence(&#123; seed &#125;, nextFunction)</span><br></pre></td></tr></table></figure><h3 id="å¯¼èˆªå›¾"><a href="#å¯¼èˆªå›¾" class="headerlink" title="å¯¼èˆªå›¾"></a>å¯¼èˆªå›¾</h3><h4 id="ä½¿ç”¨kotlin-DSL"><a href="#ä½¿ç”¨kotlin-DSL" class="headerlink" title="ä½¿ç”¨kotlin DSL"></a>ä½¿ç”¨kotlin DSL</h4><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> NavController.<span class="title">createGraph</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    startDestination: <span class="type">String</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    route: <span class="type">String</span>? = <span class="literal">null</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    builder: <span class="type">NavGraphBuilder</span>.() -&gt; <span class="type">Unit</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>: NavGraph = navigatorProvider.navigation(startDestination, route, builder)</span><br></pre></td></tr></table></figure><h4 id="xml"><a href="#xml" class="headerlink" title="xml"></a>xml</h4><p>é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ª NavHostFragmentã€‚å®ƒå……å½“åŒ…å«å®é™…å¯¼èˆªå›¾çš„å¯¼èˆªå®¿ä¸»ã€‚</p><p>NavHostFragment çš„æœ€å°å®ç°ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">FrameLayout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:app</span>=<span class="string">&quot;http://schemas.android.com/apk/res-auto&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">androidx.fragment.app.FragmentContainerView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/nav_host_fragment&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:name</span>=<span class="string">&quot;androidx.navigation.fragment.NavHostFragment&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:navGraph</span>=<span class="string">&quot;@navigation/nav_graph&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">FrameLayout</span>&gt;</span></span><br></pre></td></tr></table></figure><p>NavHostFragment åŒ…å« app:navGraph å±æ€§ã€‚ä½¿ç”¨æ­¤å±æ€§å¯å°†å¯¼èˆªå›¾è¿æ¥åˆ°å¯¼èˆªå®¿ä¸»ã€‚ä»¥ä¸‹ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•å®ç°è¯¥å›¾ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">navigation</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:app</span>=<span class="string">&quot;http://schemas.android.com/apk/res-auto&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">&quot;@+id/nav_graph&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:startDestination</span>=<span class="string">&quot;@id/profile&quot;</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- Action back to destination which launched into this profile --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:id</span>=<span class="string">&quot;@+id/action_global_profile&quot;</span></span></span><br><span class="line"><span class="tag">                       <span class="attr">app:popUpTo</span>=<span class="string">&quot;@id/profile&quot;</span></span></span><br><span class="line"><span class="tag">                       <span class="attr">app:popUpToInclusive</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fragment</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/profile&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:name</span>=<span class="string">&quot;com.example.ProfileFragment&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:label</span>=<span class="string">&quot;Profile&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- Action to navigate from Profile to Friends List. --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/action_profile_to_friendslist&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:destination</span>=<span class="string">&quot;@id/friendslist&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">fragment</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">fragment</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/friendslist&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:name</span>=<span class="string">&quot;com.example.FriendsListFragment&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:label</span>=<span class="string">&quot;Friends List&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- æ·±å±‚é“¾æ¥ --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- https://developer.android.com/guide/navigation/design/deep-link?hl=zh-cn --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">deepLink</span> <span class="attr">app:uri</span>=<span class="string">&quot;www.example.com&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">app:action</span>=<span class="string">&quot;android.intent.action.MY_ACTION&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">app:mimeType</span>=<span class="string">&quot;type/subtype&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">fragment</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Add other fragment destinations similarly. --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- å¯¹è¯æ¡†ç›®çš„åœ° --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dialog</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/my_dialog_fragment&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:name</span>=<span class="string">&quot;androidx.navigation.myapp.MyDialogFragment&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">argument</span> <span class="attr">android:name</span>=<span class="string">&quot;myarg&quot;</span> <span class="attr">android:defaultValue</span>=<span class="string">&quot;@null&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">action</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:id</span>=<span class="string">&quot;@+id/myaction&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">app:destination</span>=<span class="string">&quot;@+id/another_destination&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dialog</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Activityç›®çš„åœ° --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">activity</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/sampleActivityDestination&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:name</span>=<span class="string">&quot;com.example.android.navigation.activity.DestinationActivity&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:label</span>=<span class="string">&quot;@string/sampleActivityTitle&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- åµŒå¥—å›¾ --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- åº”ç”¨ä¸­çš„ç™»å½•æµç¨‹ã€å‘å¯¼æˆ–å…¶ä»–å­æµç¨‹é€šå¸¸æ˜¯åµŒå¥—å¯¼èˆªå›¾çš„æœ€ä½³è¡¨ç¤ºå½¢å¼ã€‚é€šè¿‡ä»¥è¿™ç§æ–¹å¼åµŒå¥—ç‹¬ç«‹çš„å­å¯¼èˆªæµç¨‹ï¼Œæ‚¨å¯ä»¥æ›´è½»æ¾åœ°ç†è§£å’Œç®¡ç†åº”ç”¨ç•Œé¢çš„ä¸»æµç¨‹ã€‚ --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">navigation</span> <span class="attr">android:id</span>=<span class="string">&quot;@+id/sendMoneyGraph&quot;</span> <span class="attr">app:startDestination</span>=<span class="string">&quot;@id/chooseRecipient&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">fragment</span></span></span><br><span class="line"><span class="tag">           <span class="attr">android:id</span>=<span class="string">&quot;@+id/chooseRecipient&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">android:name</span>=<span class="string">&quot;com.example.cashdog.cashdog.ChooseRecipient&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">android:label</span>=<span class="string">&quot;fragment_choose_recipient&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">tools:layout</span>=<span class="string">&quot;@layout/fragment_choose_recipient&quot;</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">action</span></span></span><br><span class="line"><span class="tag">               <span class="attr">android:id</span>=<span class="string">&quot;@+id/action_chooseRecipient_to_chooseAmountFragment&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">app:destination</span>=<span class="string">&quot;@id/chooseAmountFragment&quot;</span> /&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">fragment</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">fragment</span></span></span><br><span class="line"><span class="tag">           <span class="attr">android:id</span>=<span class="string">&quot;@+id/chooseAmountFragment&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">android:name</span>=<span class="string">&quot;com.example.cashdog.cashdog.ChooseAmountFragment&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">android:label</span>=<span class="string">&quot;fragment_choose_amount&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">tools:layout</span>=<span class="string">&quot;@layout/fragment_choose_amount&quot;</span> /&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">navigation</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">navigation</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="NavHostFragment"><a href="#NavHostFragment" class="headerlink" title="NavHostFragment"></a>NavHostFragment</h2><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">open</span> <span class="keyword">class</span> <span class="title class_">NavHostFragment</span> : <span class="type">Fragment</span>(), NavHost &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®ç°äº†<code>navHost</code>æ¥å£ï¼Œä¹Ÿå°±æ˜¯æœ‰äº†ä¸€ä¸ª<code>navHostController</code>å±æ€§</p><h3 id="navHostController"><a href="#navHostController" class="headerlink" title="navHostController"></a>navHostController</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="keyword">override</span> <span class="keyword">val</span> navController: NavController</span><br><span class="line">        <span class="keyword">get</span>() = navHostController</span><br><span class="line"></span><br><span class="line"><span class="keyword">internal</span> <span class="keyword">val</span> navHostController: NavHostController <span class="keyword">by</span> lazy &#123; <span class="comment">// 1: lazy</span></span><br><span class="line">    <span class="keyword">val</span> context = checkNotNull(context) &#123; <span class="comment">// 2: è·å–contextå¹¶åˆ¤ç©º</span></span><br><span class="line">        <span class="string">&quot;NavController cannot be created before the fragment is attached&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    NavHostController(context).apply &#123; <span class="comment">// 3: ç”Ÿæˆå®ä¾‹</span></span><br><span class="line">        setLifecycleOwner(<span class="keyword">this</span><span class="symbol">@NavHostFragment</span>) <span class="comment">// 4: ä¼ é€’fragmentä¸ºlifecycleOwner</span></span><br><span class="line">        setViewModelStore(viewModelStore) <span class="comment">// 5: ä¼ é€’fragmentçš„viewModelStore</span></span><br><span class="line">        onCreateNavHostController(<span class="keyword">this</span>) <span class="comment">// 6: å›è°ƒé€šçŸ¥fragment</span></span><br><span class="line">        savedStateRegistry.consumeRestoredStateForKey(KEY_NAV_CONTROLLER_STATE)?.let &#123;</span><br><span class="line">            restoreState(it)</span><br><span class="line">        &#125;</span><br><span class="line">        savedStateRegistry.registerSavedStateProvider(KEY_NAV_CONTROLLER_STATE) &#123;</span><br><span class="line">            saveState() ?: Bundle.EMPTY</span><br><span class="line">        &#125;</span><br><span class="line">        savedStateRegistry.consumeRestoredStateForKey(KEY_GRAPH_ID)?.let &#123; bundle -&gt;</span><br><span class="line">            graphId = bundle.getInt(KEY_GRAPH_ID)</span><br><span class="line">        &#125;</span><br><span class="line">        savedStateRegistry.registerSavedStateProvider(KEY_GRAPH_ID) &#123;</span><br><span class="line">            <span class="keyword">if</span> (graphId != <span class="number">0</span>) &#123;</span><br><span class="line">                bundleOf(KEY_GRAPH_ID to graphId)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                Bundle.EMPTY</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="comment">// 7: savedStateç›¸å…³çš„çœ‹ä¸æ‡‚ï¼Œtodo: ä»¥åå†çœ‹</span></span><br><span class="line">        <span class="keyword">if</span> (graphId != <span class="number">0</span>) &#123; <span class="comment">// // 8: setGraph</span></span><br><span class="line">            <span class="comment">// Set from onInflate()</span></span><br><span class="line">            setGraph(graphId) <span class="comment">// 8.1: å¯¼èˆªå›¾idä¸ä¸º0ï¼Œæœ‰æ•ˆï¼Œè®¾ç½®å¯¼èˆªå›¾</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// See if it was set by NavHostFragment.create()</span></span><br><span class="line">            <span class="keyword">val</span> args = arguments</span><br><span class="line">            <span class="keyword">val</span> graphId = args?.getInt(KEY_GRAPH_ID) ?: <span class="number">0</span></span><br><span class="line">            <span class="keyword">val</span> startDestinationArgs = args?.getBundle(KEY_START_DESTINATION_ARGS)</span><br><span class="line">            <span class="keyword">if</span> (graphId != <span class="number">0</span>) &#123; <span class="comment">// 8.2: å°è¯•ä»fragmentçš„`arguments`è·å–å¯¼èˆªå›¾å’ŒstartDestinationArgs</span></span><br><span class="line">                setGraph(graphId, startDestinationArgs)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°±æ˜¯åˆ›å»ºäº†ä¸€ä¸ª<code>navHostController</code>,è¯¦ç»†å†…å®¹çœ‹<a href="#navhostcontroller%E7%B1%BB">NavHostControllerç±»</a></p><h4 id="1-lazy"><a href="#1-lazy" class="headerlink" title="1: lazy"></a>1: lazy</h4><p>è¿™ä¸ªæ²¡å•¥è¯´çš„ï¼Œå°±æ˜¯æ‡’åŠ è½½</p><h4 id="2-è·å–contextå¹¶åˆ¤ç©º"><a href="#2-è·å–contextå¹¶åˆ¤ç©º" class="headerlink" title="2: è·å–contextå¹¶åˆ¤ç©º"></a>2: è·å–contextå¹¶åˆ¤ç©º</h4><ul><li><code>fragment</code>çš„<code>getContext</code></li></ul><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="keyword">public</span> Context getContext() &#123;</span><br><span class="line">    <span class="keyword">return</span> mHost == <span class="literal">null</span> ? <span class="literal">null</span> : mHost.getContext();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><code>mHost</code>ä¼šåœ¨<code>FragmentStateManager</code>è°ƒç”¨<code>moveToExpectedState</code>æ—¶ï¼Œå¦‚æœç§»åŠ¨åˆ°<code>Fragment.ATTACHED</code>çŠ¶æ€ï¼Œè°ƒç”¨<code>attach</code>æ–¹æ³•æ—¶ï¼Œè¿›è¡Œåˆå§‹åŒ–</p><p>&#x2F;&#x2F; todo: å†æŒ–ä¸ªå‘ä»¥åå­¦ä¹ </p></blockquote><h4 id="6-å›è°ƒé€šçŸ¥fragment"><a href="#6-å›è°ƒé€šçŸ¥fragment" class="headerlink" title="6: å›è°ƒé€šçŸ¥fragment"></a>6: å›è°ƒé€šçŸ¥fragment</h4><ul><li>è¿™é‡Œè°ƒç”¨çš„æ˜¯<code>NavHostFragment</code>çš„æ–¹æ³•<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Suppress(<span class="string">&quot;DEPRECATION&quot;</span>)</span></span><br><span class="line"><span class="meta">@CallSuper</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">open</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreateNavHostController</span><span class="params">(navHostController: <span class="type">NavHostController</span>)</span></span> &#123;</span><br><span class="line">    onCreateNavController(navHostController)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* Callback for when the [NavController][getNavController] is created. If you</span></span><br><span class="line"><span class="comment">* support any custom destination types, their [Navigator] should be added here to</span></span><br><span class="line"><span class="comment">* ensure it is available before the navigation graph is inflated / set.</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* By default, this adds a [DialogFragmentNavigator] and [FragmentNavigator].</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* This is only called once when the navController is called. This will be called in [onCreate]</span></span><br><span class="line"><span class="comment">* if the navController has not yet been called. This should not be called directly by</span></span><br><span class="line"><span class="comment">* subclasses.</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> navController The newly created [NavController].</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Suppress(<span class="string">&quot;DEPRECATION&quot;</span>)</span></span><br><span class="line"><span class="meta">@CallSuper</span></span><br><span class="line"><span class="meta">@Deprecated(</span></span><br><span class="line"><span class="meta">    <span class="string">&quot;&quot;&quot;Override &#123;@link #onCreateNavHostController(NavHostController)&#125; to gain</span></span></span><br><span class="line"><span class="string"><span class="meta">    access to the full &#123;@link NavHostController&#125; that is created by this NavHostFragment.&quot;&quot;&quot;</span></span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">open</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreateNavController</span><span class="params">(navController: <span class="type">NavController</span>)</span></span> &#123;</span><br><span class="line">    navController.navigatorProvider +=</span><br><span class="line">        DialogFragmentNavigator(requireContext(), childFragmentManager)</span><br><span class="line">    navController.navigatorProvider.addNavigator(createFragmentNavigator())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><ol><li>åˆ›å»º<code>getNavController</code>æ—¶çš„å›è°ƒå‡½æ•°ã€‚å¦‚æœæ‚¨æ”¯æŒä»»ä½•è‡ªå®šä¹‰ç›®æ ‡ç±»å‹ï¼Œåˆ™åº”å°†å…¶å¯¼èˆªå™¨æ·»åŠ åˆ°æ­¤å¤„ï¼Œä»¥ç¡®ä¿åœ¨å¯¼èˆªå›¾<code>inflate/set</code>ä¹‹å‰å¯ç”¨ã€‚ </li><li>é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™ä¼šæ·»åŠ ä¸€ä¸ª<code>DialogFragmentNavigator</code>å’Œ<code>FragmentNavigator</code>ã€‚ </li><li>å®ƒåªåœ¨<code>navController</code>è¢«è°ƒç”¨æ—¶è¢«è°ƒç”¨ä¸€æ¬¡ã€‚å¦‚æœ<code>navController</code>è¿˜æ²¡æœ‰è¢«è°ƒç”¨ï¼Œè¿™ä¸ªå‡½æ•°ä¼šåœ¨<code>onCreate</code>ä¸­è¢«è°ƒç”¨ã€‚å­ç±»ä¸åº”è¯¥ç›´æ¥è°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚</li></ol></blockquote><p>ç¿»è¯‘ä¸€ä¸‹è¿™ä¸ªå‡½æ•°çš„æ³¨é‡Š</p><ol><li>ç¬¬ä¸€å¥æ˜¯è¯´å­ç±»å¯ä»¥é‡å†™è¿™ä¸ªæ–¹æ³•ï¼Œæ·»åŠ è‡ªå®šä¹‰çš„Navigator</li><li>ç¬¬äºŒå¥æ˜¯è¯´é»˜è®¤ä¼šæ·»åŠ <code>DialogFragmentNavigator</code>å’Œ<code>FragmentNavigator</code></li><li>è¦ç†è§£ç¬¬ä¸‰å¥å…ˆçœ‹ä¸‹é¢ä»£ç ï¼Œ<code>navHostController</code>æ—¶lazyï¼Œä½†æ˜¯åœ¨<code>Fragment#onCreate</code>æ—¶ä¼šä¸»åŠ¨å‡ºå‘ä»–çš„åˆ›å»ºè¿‡ç¨‹<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@CallSuper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">    <span class="comment">// We are accessing the NavController here to ensure that it is always created by this point</span></span><br><span class="line">    navHostController</span><br><span class="line">    <span class="keyword">if</span> (savedInstanceState != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (savedInstanceState.getBoolean(KEY_DEFAULT_NAV_HOST, <span class="literal">false</span>)) &#123;</span><br><span class="line">            defaultNavHost = <span class="literal">true</span></span><br><span class="line">            parentFragmentManager.beginTransaction()</span><br><span class="line">                .setPrimaryNavigationFragment(<span class="keyword">this</span>)</span><br><span class="line">                .commit()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// We purposefully run this last as this will trigger the onCreate() of</span></span><br><span class="line">    <span class="comment">// child fragments, which may be relying on having the NavController already</span></span><br><span class="line">    <span class="comment">// created and having its state restored by that point.</span></span><br><span class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h4 id="7-savedStateç›¸å…³çš„çœ‹ä¸æ‡‚ï¼Œtodo-ä»¥åå†çœ‹"><a href="#7-savedStateç›¸å…³çš„çœ‹ä¸æ‡‚ï¼Œtodo-ä»¥åå†çœ‹" class="headerlink" title="7: savedStateç›¸å…³çš„çœ‹ä¸æ‡‚ï¼Œtodo: ä»¥åå†çœ‹"></a>7: savedStateç›¸å…³çš„çœ‹ä¸æ‡‚ï¼Œtodo: ä»¥åå†çœ‹</h4><p>&#x2F;&#x2F; todo: å å‘ï¼Œä»¥åå†çœ‹</p><h4 id="8-setGraph"><a href="#8-setGraph" class="headerlink" title="8: setGraph"></a>8: setGraph</h4><ul><li>å¯¼èˆªå›¾idä¸ä¸º0ï¼Œæœ‰æ•ˆï¼Œè®¾ç½®å¯¼èˆªå›¾</li><li>å¯¼èˆªå›¾idä¸º0, å°è¯•ä»fragmentçš„<code>arguments</code>è·å–<code>å¯¼èˆªå›¾id</code>å’Œ<code>startDestinationArgs</code></li><li>setArgumentsæ˜¯çˆ¶ç±»<code>Fragment</code>çš„ä¸€ä¸ªæ–¹æ³•ï¼Œ<code>mArguments</code>å°±æ˜¯ä¸€ä¸ª<code>Bundle</code></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setArguments</span><span class="params">(<span class="meta">@Nullable</span> Bundle args)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (mFragmentManager != <span class="literal">null</span> &amp;&amp; isStateSaved()) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;Fragment already added and state has been saved&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    mArguments = args;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åˆ›å»ºNavHostFragment"><a href="#åˆ›å»ºNavHostFragment" class="headerlink" title="åˆ›å»ºNavHostFragment"></a>åˆ›å»ºNavHostFragment</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@JvmOverloads</span></span><br><span class="line"><span class="meta">@JvmStatic</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">fun</span> <span class="title">create</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="meta">@NavigationRes</span> graphResId: <span class="type">Int</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    startDestinationArgs: <span class="type">Bundle</span>? = <span class="literal">null</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>: NavHostFragment &#123;</span><br><span class="line">    <span class="keyword">var</span> b: Bundle? = <span class="literal">null</span></span><br><span class="line">    <span class="keyword">if</span> (graphResId != <span class="number">0</span>) &#123;</span><br><span class="line">        b = Bundle()</span><br><span class="line">        b.putInt(KEY_GRAPH_ID, graphResId)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (startDestinationArgs != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (b == <span class="literal">null</span>) &#123;</span><br><span class="line">            b = Bundle()</span><br><span class="line">        &#125;</span><br><span class="line">        b.putBundle(KEY_START_DESTINATION_ARGS, startDestinationArgs)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">val</span> result = NavHostFragment()</span><br><span class="line">    <span class="keyword">if</span> (b != <span class="literal">null</span>) &#123;</span><br><span class="line">        result.arguments = b</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å¯ä»¥çœ‹åˆ°, <code>KEY_GRAPH_ID</code>å’Œ<code>KEY_START_DESTINATION_ARGS</code></li></ul><h3 id="å‡ ä¸ªkeyçš„å®šä¹‰"><a href="#å‡ ä¸ªkeyçš„å®šä¹‰" class="headerlink" title="å‡ ä¸ªkeyçš„å®šä¹‰"></a>å‡ ä¸ªkeyçš„å®šä¹‰</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">companion</span> <span class="keyword">object</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">    <span class="meta">@RestrictTo(RestrictTo.Scope.LIBRARY_GROUP)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">const</span> <span class="keyword">val</span> KEY_GRAPH_ID: String = <span class="string">&quot;android-support-nav:fragment:graphId&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">    <span class="meta">@RestrictTo(RestrictTo.Scope.LIBRARY_GROUP)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">const</span> <span class="keyword">val</span> KEY_START_DESTINATION_ARGS: String =</span><br><span class="line">        <span class="string">&quot;android-support-nav:fragment:startDestinationArgs&quot;</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">const</span> <span class="keyword">val</span> KEY_NAV_CONTROLLER_STATE =</span><br><span class="line">        <span class="string">&quot;android-support-nav:fragment:navControllerState&quot;</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">const</span> <span class="keyword">val</span> KEY_DEFAULT_NAV_HOST = <span class="string">&quot;android-support-nav:fragment:defaultHost&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>KEY_GRAPH_ID</code>å’Œ<code>KEY_START_DESTINATION_ARGS</code>è¢«é™åˆ¶åœ¨åŒç»„libä¸­ä½¿ç”¨ï¼Œä¹Ÿå°±æ˜¯ä¸æ¨èæˆ‘ä»¬è‡ªå·±æ‰‹åŠ¨é€šè¿‡è¿™ä¸¤ä¸ªkeyæ¥è®¾ç½®<code>å¯¼èˆªå›¾id</code>å’Œ<code>args</code></li></ul><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">var</span> graphId = <span class="number">0</span></span><br></pre></td></tr></table></figure><p><code>graphId</code>ä¹Ÿæ˜¯<code>private</code>çš„ï¼Œä¹Ÿæ— æ³•é€šè¿‡ç»§æ‰¿çš„æ–¹å¼ä¿®æ”¹ä»–çš„å€¼</p><h3 id="onInflate"><a href="#onInflate" class="headerlink" title="onInflate"></a>onInflate</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@CallSuper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onInflate</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    context: <span class="type">Context</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    attrs: <span class="type">AttributeSet</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    savedInstanceState: <span class="type">Bundle</span>?</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.onInflate(context, attrs, savedInstanceState)</span><br><span class="line">    context.obtainStyledAttributes(</span><br><span class="line">        attrs,</span><br><span class="line">        androidx.navigation.R.styleable.NavHost</span><br><span class="line">    ).use &#123; navHost -&gt;</span><br><span class="line">        <span class="keyword">val</span> graphId = navHost.getResourceId(</span><br><span class="line">            androidx.navigation.R.styleable.NavHost_navGraph, <span class="number">0</span></span><br><span class="line">        )</span><br><span class="line">        <span class="keyword">if</span> (graphId != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">this</span>.graphId = graphId</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    context.obtainStyledAttributes(attrs, R.styleable.NavHostFragment).use &#123; array -&gt;</span><br><span class="line">        <span class="keyword">val</span> defaultHost = array.getBoolean(R.styleable.NavHostFragment_defaultNavHost, <span class="literal">false</span>)</span><br><span class="line">        <span class="keyword">if</span> (defaultHost) &#123;</span><br><span class="line">            defaultNavHost = <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¼èˆªå›¾å’Œ<code>defaultNavHost</code>å¯ä»¥åœ¨<code>FragmentContainerView</code>çš„<code>xml</code>ä¸­ä½¿ç”¨<code>navGraph</code>å’Œ<code>defaultNavHost</code>å®šä¹‰</p><h3 id="onSaveInstanceState"><a href="#onSaveInstanceState" class="headerlink" title="onSaveInstanceState"></a>onSaveInstanceState</h3><ul><li><code>onSaveInstanceState</code>æ—¶å¦‚æœ<code>defaultNavHost</code>æ˜¯<code>true</code>ä¼šæŠŠè¿™ä¸ªçŠ¶æ€å­˜èµ·æ¥ï¼Œ<code>onCreate</code>æ—¶æ¢å¤<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@CallSuper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onSaveInstanceState</span><span class="params">(outState: <span class="type">Bundle</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.onSaveInstanceState(outState)</span><br><span class="line">    <span class="keyword">if</span> (defaultNavHost) &#123;</span><br><span class="line">        outState.putBoolean(KEY_DEFAULT_NAV_HOST, <span class="literal">true</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="onCreate"><a href="#onCreate" class="headerlink" title="onCreate"></a>onCreate</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@CallSuper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">    <span class="comment">// We are accessing the NavController here to ensure that it is always created by this point</span></span><br><span class="line">    navHostController</span><br><span class="line">    <span class="keyword">if</span> (savedInstanceState != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (savedInstanceState.getBoolean(KEY_DEFAULT_NAV_HOST, <span class="literal">false</span>)) &#123;</span><br><span class="line">            defaultNavHost = <span class="literal">true</span></span><br><span class="line">            parentFragmentManager.beginTransaction()</span><br><span class="line">                .setPrimaryNavigationFragment(<span class="keyword">this</span>)</span><br><span class="line">                .commit()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// We purposefully run this last as this will trigger the onCreate() of</span></span><br><span class="line">    <span class="comment">// child fragments, which may be relying on having the NavController already</span></span><br><span class="line">    <span class="comment">// created and having its state restored by that point.</span></span><br><span class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="onViewCreated"><a href="#onViewCreated" class="headerlink" title="onViewCreated"></a>onViewCreated</h3><ul><li>ä¼šç»™viewè®¾ç½®<code>navHostController</code><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onViewCreated</span><span class="params">(view: <span class="type">View</span>, savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.onViewCreated(view, savedInstanceState)</span><br><span class="line">    check(view <span class="keyword">is</span> ViewGroup) &#123; <span class="string">&quot;created host view <span class="variable">$view</span> is not a ViewGroup&quot;</span> &#125;</span><br><span class="line">    Navigation.setViewNavController(view, navHostController)</span><br><span class="line">    <span class="comment">// When added programmatically, we need to set the NavController on the parent - i.e.,</span></span><br><span class="line">    <span class="comment">// the View that has the ID matching this NavHostFragment.</span></span><br><span class="line">    <span class="keyword">if</span> (view.getParent() != <span class="literal">null</span>) &#123;</span><br><span class="line">        viewParent = view.getParent() <span class="keyword">as</span> View</span><br><span class="line">        <span class="keyword">if</span> (viewParent!!.id == id) &#123;</span><br><span class="line">            Navigation.setViewNavController(viewParent!!, navHostController)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>é€šè¿‡viewçš„<code>setTag</code>è®¾ç½®<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@JvmStatic</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">fun</span> <span class="title">setViewNavController</span><span class="params">(view: <span class="type">View</span>, controller: <span class="type">NavController</span>?)</span></span> &#123;</span><br><span class="line">    view.setTag(R.id.nav_controller_view_tag, controller)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="onDestroyView"><a href="#onDestroyView" class="headerlink" title="onDestroyView"></a>onDestroyView</h3><ul><li>éå¸¸å¯¹ç§°çš„ï¼Œåœ¨onDestroyViewæ—¶ï¼Œä¼šæŠŠ<code>viewParent</code>ä¸­çš„<code>navHostController</code>è®¾ç½®ä¸º<code>null</code><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onDestroyView</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.onDestroyView()</span><br><span class="line">    viewParent?.let &#123; it -&gt;</span><br><span class="line">        <span class="keyword">if</span> (Navigation.findNavController(it) === navHostController) &#123;</span><br><span class="line">            Navigation.setViewNavController(it, <span class="literal">null</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    viewParent = <span class="literal">null</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="defaultNavHost"><a href="#defaultNavHost" class="headerlink" title="defaultNavHost"></a>defaultNavHost</h3><p>å¦‚æœåœ¨<code>attach</code>æ—¶å‘ç°æ˜¯<code>defaultNavHost</code>ï¼Œä¼šæäº¤ä¸€ä¸ª<code>setPrimaryNavigationFragment</code>çš„<code>transaction</code>ï¼Œè¿½è¸ªè¿™ä¸ªæ“ä½œï¼Œä»–å…·ä½“åšäº†ä»¥ä¸‹å†…å®¹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">setPrimaryNavigationFragment</span><span class="params">(<span class="meta">@Nullable</span> Fragment f)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (f != <span class="literal">null</span> &amp;&amp; (!f.equals(findActiveFragment(f.mWho))</span><br><span class="line">            || (f.mHost != <span class="literal">null</span> &amp;&amp; f.mFragmentManager != <span class="built_in">this</span>))) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Fragment &quot;</span> + f</span><br><span class="line">                + <span class="string">&quot; is not an active fragment of FragmentManager &quot;</span> + <span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">Fragment</span> <span class="variable">previousPrimaryNav</span> <span class="operator">=</span> mPrimaryNav;</span><br><span class="line">    mPrimaryNav = f;</span><br><span class="line">    dispatchParentPrimaryNavigationFragmentChanged(previousPrimaryNav);</span><br><span class="line">    dispatchParentPrimaryNavigationFragmentChanged(mPrimaryNav);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">dispatchParentPrimaryNavigationFragmentChanged</span><span class="params">(<span class="meta">@Nullable</span> Fragment f)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (f != <span class="literal">null</span> &amp;&amp; f.equals(findActiveFragment(f.mWho))) &#123;</span><br><span class="line">        f.performPrimaryNavigationFragmentChanged();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>æ‰¾åˆ°å‰ä¸€ä¸ª<code>primaryNavigationFragment</code>ï¼Œå’Œå°†è¦è®¾ç½®ä¸º<code>defaultNav</code>çš„<code>fragment</code>,è°ƒç”¨å…¶<code>performPrimaryNavigationFragmentChanged</code>æ“ä½œ<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">performPrimaryNavigationFragmentChanged</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">isPrimaryNavigationFragment</span> <span class="operator">=</span> mFragmentManager.isPrimaryNavigation(<span class="built_in">this</span>);</span><br><span class="line">    <span class="comment">// Only send out the callback / dispatch if the state has changed</span></span><br><span class="line">    <span class="keyword">if</span> (mIsPrimaryNavigationFragment == <span class="literal">null</span></span><br><span class="line">            || mIsPrimaryNavigationFragment != isPrimaryNavigationFragment) &#123;</span><br><span class="line">        mIsPrimaryNavigationFragment = isPrimaryNavigationFragment;</span><br><span class="line">        onPrimaryNavigationFragmentChanged(isPrimaryNavigationFragment);</span><br><span class="line">        mChildFragmentManager.dispatchPrimaryNavigationFragmentChanged();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>æ›´æ–°Fragmentä¸­çš„<code>mIsPrimaryNavigationFragment</code>è¿™ä¸ªflagï¼Œå¹¶ä¸”æ‰¾åˆ°å­fragmentï¼Œä¹Ÿå»æ›´æ–°å…¶çŠ¶æ€</li><li>è°ƒç”¨é’©å­å‡½æ•°<code>onPrimaryNavigationFragmentChanged</code></li></ul><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> void onPrimaryNavigationFragmentChanged(boolean isPrimaryNavigationFragment) &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ä»–æ˜¯ä¸€ä¸ªç©ºçš„æ–¹æ³•ï¼Œå­ç±»å¯ä»¥é‡å†™ï¼Œ<code>NavHostFragment</code>ä¹Ÿæ²¡æœ‰å®ç°å®ƒï¼Œçœ‹æ¥æ˜¯ç»™ç¨‹åºå‘˜è‡ªç”±å‘æŒ¥çš„ã€‚</li><li>å®˜æ–¹æ–‡æ¡£ä¸­<a href="https://developer.android.com/guide/navigation/use-graph/programmatic?hl=zh-cn#create_a_navhostfragment">åˆ›å»º NavHostFragment</a>æåˆ°è¿™ä¸ªæ“ä½œä¼š<code>&quot;å…è®¸æ‚¨çš„ NavHost æˆªè·å¯¹ç³»ç»Ÿâ€œè¿”å›â€æŒ‰é’®çš„æŒ‰ä¸‹æ“ä½œ&quot;</code>ã€‚ä¸Šé¢çš„ä»£ç å¥½åƒå¹¶æ²¡æœ‰ä½“ç°å‡ºæ¥ã€‚</li></ul><h2 id="NavHostControllerç±»"><a href="#NavHostControllerç±»" class="headerlink" title="NavHostControllerç±»"></a>NavHostControllerç±»</h2><ul><li><code>NavHostController</code>ç»§æ‰¿è‡ª<code>NavController</code>ï¼Œå…¶ä¸­æ²¡æœ‰ä»€ä¹ˆä»£ç ï¼Œå…¶æœ¬èº«æ˜¯opençš„ï¼Œä½†å®ƒæŠŠçˆ¶ç±»çš„å‡ ä¸ªæ–¹æ³•è®¾ç½®ä¸º<code>final</code>ï¼ŒåŒ…æ‹¬ï¼š<ul><li>setLifecycleOwner</li><li>setOnBackPressedDispatcher</li><li>enableOnBackPressed</li><li>setViewModelStore</li></ul></li></ul><h2 id="NavController"><a href="#NavController" class="headerlink" title="NavController"></a>NavController</h2><h3 id="3-ç”Ÿæˆå®ä¾‹"><a href="#3-ç”Ÿæˆå®ä¾‹" class="headerlink" title="3: ç”Ÿæˆå®ä¾‹"></a>3: ç”Ÿæˆå®ä¾‹</h3><p>NavHostControlleræ„é€ å‡½æ•°</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">open</span> <span class="keyword">class</span> <span class="title class_">NavHostController</span>(context: Context) </span><br><span class="line">    : NavController(context) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">open</span> <span class="keyword">class</span> <span class="title class_">NavController</span>(</span><br><span class="line">    <span class="comment">/** <span class="doctag">@suppress</span> */</span></span><br><span class="line">    <span class="meta">@get:RestrictTo</span>(RestrictTo.Scope.LIBRARY_GROUP)</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">val</span> context: Context</span><br><span class="line">) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">init</span> &#123;</span><br><span class="line">        _navigatorProvider.addNavigator(NavGraphNavigator(_navigatorProvider))</span><br><span class="line">        _navigatorProvider.addNavigator(ActivityNavigator(context))</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>ä¼ é€’<code>context</code>å°±æ˜¯å­˜èµ·æ¥ä»¥åä¼šç”¨</p></li><li><p>é€šè¿‡<code>context</code>åˆ›å»º<code>ActivityNavigator</code></p></li><li><p>å¯ä»¥å…ˆå‰§é€ä¸€ä¸‹ï¼Œ<code>Navigator</code>å°±æ˜¯ä¸€ä¸ªå…·ä½“å®æ–½è·³è½¬ç­‰æ“ä½œçš„ç±»</p><ul><li>æ¯”å¦‚<code>ActivityNavigator</code>å°±ä¼šè°ƒç”¨<code>startActivity</code></li><li><code>FragmentNavigator</code>å°±ä¼šæ„é€ <code>FragmentTransaction</code>æ¥è·³è½¬<code>fragment</code></li></ul></li></ul><h3 id="4-ä¼ é€’fragmentä¸ºlifecycleOwner"><a href="#4-ä¼ é€’fragmentä¸ºlifecycleOwner" class="headerlink" title="4: ä¼ é€’fragmentä¸ºlifecycleOwner"></a>4: ä¼ é€’fragmentä¸ºlifecycleOwner</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">setLifecycleOwner</span><span class="params">(owner: <span class="type">LifecycleOwner</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.setLifecycleOwner(owner)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestrictTo(RestrictTo.Scope.LIBRARY_GROUP)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">open</span> <span class="function"><span class="keyword">fun</span> <span class="title">setLifecycleOwner</span><span class="params">(owner: <span class="type">LifecycleOwner</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (owner == lifecycleOwner) &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    lifecycleOwner?.lifecycle?.removeObserver(lifecycleObserver)</span><br><span class="line">    lifecycleOwner = owner</span><br><span class="line">    owner.lifecycle.addObserver(lifecycleObserver)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å»æ‰åŸæ¥çš„ownerï¼Œæ·»åŠ æ–°çš„ownerï¼Œå¹¶æ·»åŠ è§‚å¯Ÿè€…<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">val</span> lifecycleObserver: LifecycleObserver = LifecycleEventObserver &#123; _, event -&gt;</span><br><span class="line">    hostLifecycleState = event.targetState</span><br><span class="line">    <span class="keyword">if</span> (_graph != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (entry <span class="keyword">in</span> backQueue) &#123;</span><br><span class="line">            entry.handleLifecycleEvent(event)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>hostLifecycleStateå°±æ˜¯å­˜å¯¹åº”çš„ç”Ÿå‘½å‘¨æœŸçŠ¶æ€</li><li>_graphæ˜¯ä¸€ä¸ª<code>NavGraph</code>, åœ¨<code>setGraph</code>ä¸­åˆå§‹åŒ–</li><li>backQueueæ˜¯å­˜æ”¾<code>NavBackStackEntry</code>çš„åŒç«¯é˜Ÿåˆ—</li></ul><h3 id="5-ä¼ é€’fragmentçš„viewModelStore"><a href="#5-ä¼ é€’fragmentçš„viewModelStore" class="headerlink" title="5: ä¼ é€’fragmentçš„viewModelStore"></a>5: ä¼ é€’fragmentçš„viewModelStore</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">setViewModelStore</span><span class="params">(viewModelStore: <span class="type">ViewModelStore</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.setViewModelStore(viewModelStore)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestrictTo(RestrictTo.Scope.LIBRARY_GROUP)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">open</span> <span class="function"><span class="keyword">fun</span> <span class="title">setViewModelStore</span><span class="params">(viewModelStore: <span class="type">ViewModelStore</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (viewModel == NavControllerViewModel.getInstance(viewModelStore)) &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    check(backQueue.isEmpty()) &#123; <span class="string">&quot;ViewModelStore should be set before setGraph call&quot;</span> &#125;</span><br><span class="line">    viewModel = NavControllerViewModel.getInstance(viewModelStore)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å°±æ˜¯åˆ›å»ºäº†ä¸€ä¸ª<code>viewModel</code>ï¼Œä»¥åä¼šç”¨</li></ul><h3 id="8-setGraph-1"><a href="#8-setGraph-1" class="headerlink" title="8: setGraph"></a>8: setGraph</h3><ul><li><p>å¦‚æœå¯¼èˆªå›¾idä¸ä¸º0ï¼Œæœ‰æ•ˆï¼Œè®¾ç½®å¯¼èˆªå›¾</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">open</span> <span class="function"><span class="keyword">fun</span> <span class="title">setGraph</span><span class="params">(<span class="meta">@NavigationRes</span> graphResId: <span class="type">Int</span>)</span></span> &#123;</span><br><span class="line">    setGraph(navInflater.inflate(graphResId), <span class="literal">null</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>å¦‚æœå¯¼èˆªå›¾ä¸º0ï¼Œåˆ™å°è¯•ä»<code>fragment</code>çš„<code>arguments</code>ä¸­è·å–<code>å¯¼èˆªå›¾id</code>å’Œ<code>startDestinationArgs</code></p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MainThread</span></span><br><span class="line"><span class="meta">@CallSuper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">open</span> <span class="function"><span class="keyword">fun</span> <span class="title">setGraph</span><span class="params">(<span class="meta">@NavigationRes</span> graphResId: <span class="type">Int</span>, startDestinationArgs: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">    setGraph(navInflater.inflate(graphResId), startDestinationArgs)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>æœ€ç»ˆéƒ½è°ƒç”¨äº†<code>setGraph(graph: NavGraph, startDestinationArgs: Bundle?)</code></p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* Sets the [navigation graph][NavGraph] to the specified graph.</span></span><br><span class="line"><span class="comment">* Any current navigation graph data (including back stack) will be replaced.</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* The graph can be retrieved later via [graph].</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> graph graph to set</span></span><br><span class="line"><span class="comment">* <span class="doctag">@see</span> NavController.setGraph</span></span><br><span class="line"><span class="comment">* <span class="doctag">@see</span> NavController.graph</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@MainThread</span></span><br><span class="line"><span class="meta">@CallSuper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">open</span> <span class="function"><span class="keyword">fun</span> <span class="title">setGraph</span><span class="params">(graph: <span class="type">NavGraph</span>, startDestinationArgs: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (_graph != graph) &#123;</span><br><span class="line">        _graph?.let &#123; previousGraph -&gt;</span><br><span class="line">            <span class="comment">// Clear all saved back stacks by iterating through a copy of the saved keys,</span></span><br><span class="line">            <span class="comment">// thus avoiding any concurrent modification exceptions</span></span><br><span class="line">            <span class="keyword">val</span> savedBackStackIds = ArrayList(backStackMap.keys)</span><br><span class="line">            savedBackStackIds.forEach &#123; id -&gt;</span><br><span class="line">                clearBackStackInternal(id)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// Pop everything from the old graph off the back stack</span></span><br><span class="line">            NavControllerInternal(previousGraph.id, <span class="literal">true</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        _graph = graph</span><br><span class="line">        onGraphCreated(startDestinationArgs)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// first we update _graph with new instances from graph</span></span><br><span class="line">        <span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">0</span> until graph.nodes.size()) &#123;</span><br><span class="line">            <span class="keyword">val</span> newDestination = graph.nodes.valueAt(i)</span><br><span class="line">            <span class="keyword">val</span> key = _graph!!.nodes.keyAt(i)</span><br><span class="line">            _graph!!.nodes.replace(key, newDestination)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// then we update backstack with the new instances</span></span><br><span class="line">        backQueue.forEach &#123; entry -&gt;</span><br><span class="line">            <span class="comment">// we will trace this hierarchy in new graph to get new destination instance</span></span><br><span class="line">            <span class="keyword">val</span> hierarchy = entry.destination.hierarchy.toList().asReversed()</span><br><span class="line">            <span class="keyword">val</span> newDestination = hierarchy.fold(_graph!!) &#123;</span><br><span class="line">                    newDest: NavDestination, oldDest: NavDestination -&gt;</span><br><span class="line">                <span class="keyword">if</span> (oldDest == _graph &amp;&amp; newDest == graph) &#123;</span><br><span class="line">                    <span class="comment">// if root graph, it is already the node that matches with oldDest</span></span><br><span class="line">                    newDest</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (newDest <span class="keyword">is</span> NavGraph) &#123;</span><br><span class="line">                    <span class="comment">// otherwise we walk down the hierarchy to the next child</span></span><br><span class="line">                    newDest.findNode(oldDest.id)!!</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">// final leaf node found</span></span><br><span class="line">                    newDest</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            entry.destination = newDestination</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>è€ƒè™‘äº†ä¸¤ç§æƒ…å†µï¼ŒsetGraphå‰å<code>_graph</code>å’Œ<code>graph</code>æ˜¯å¦ç›¸ç­‰<ul><li>æ³¨æ„ktä»£ç æœ‰è¿ç®—ç¬¦é‡è½½ï¼Œå®é™…ä¸Šè°ƒç”¨çš„æ˜¯<code>NavGraph</code>çš„<code>equals</code></li></ul></li></ul><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">equals</span><span class="params">(other: <span class="type">Any</span>?)</span></span>: <span class="built_in">Boolean</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span> === other) <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    <span class="keyword">if</span> (other == <span class="literal">null</span> || other !<span class="keyword">is</span> NavGraph) <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">super</span>.equals(other) &amp;&amp;</span><br><span class="line">        nodes.size == other.nodes.size &amp;&amp;</span><br><span class="line">        startDestinationId == other.startDestinationId &amp;&amp;</span><br><span class="line">        nodes.valueIterator().asSequence().all &#123; it == other.nodes.<span class="keyword">get</span>(it.id) &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="navigate"><a href="#navigate" class="headerlink" title="navigate"></a>navigate</h3><h4 id="é€šè¿‡actionçš„èµ„æºidè·³è½¬çš„"><a href="#é€šè¿‡actionçš„èµ„æºidè·³è½¬çš„" class="headerlink" title="é€šè¿‡actionçš„èµ„æºidè·³è½¬çš„"></a>é€šè¿‡actionçš„èµ„æºidè·³è½¬çš„</h4><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// id1: </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">open</span> <span class="function"><span class="keyword">fun</span> <span class="title">navigate</span><span class="params">(<span class="meta">@IdRes</span> resId: <span class="type">Int</span>)</span></span> &#123;</span><br><span class="line">    navigate(resId, <span class="literal">null</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// id2: </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">open</span> <span class="function"><span class="keyword">fun</span> <span class="title">navigate</span><span class="params">(<span class="meta">@IdRes</span> resId: <span class="type">Int</span>, args: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">    navigate(resId, args, <span class="literal">null</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// id3: </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">open</span> <span class="function"><span class="keyword">fun</span> <span class="title">navigate</span><span class="params">(<span class="meta">@IdRes</span> resId: <span class="type">Int</span>, args: <span class="type">Bundle</span>?, navOptions: <span class="type">NavOptions</span>?)</span></span> &#123;</span><br><span class="line">    navigate(resId, args, navOptions, <span class="literal">null</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// id4: </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">open</span> <span class="function"><span class="keyword">fun</span> <span class="title">navigate</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="meta">@IdRes</span> resId: <span class="type">Int</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    args: <span class="type">Bundle</span>?,</span></span></span><br><span class="line"><span class="params"><span class="function">    navOptions: <span class="type">NavOptions</span>?,</span></span></span><br><span class="line"><span class="params"><span class="function">    navigatorExtras: <span class="type">Navigator</span>.<span class="type">Extras</span>?</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ä¸€ä¸ªå‚æ•°çš„è°ƒä¸¤ä¸ªå‚æ•°çš„ï¼Œä¸¤ä¸ªå‚æ•°çš„è°ƒä¸‰ä¸ªå‚æ•°çš„<br>å››ä¸ªå‚æ•°çš„å·¨é•¿ä½†ä¹Ÿä¸æ˜¯æ ¸å¿ƒçš„æ–¹æ³•ï¼Œè¿˜ä¼šè°ƒç”¨æ ¸å¿ƒçš„navigateæ–¹æ³•</p></blockquote><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// id4:</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">open</span> <span class="function"><span class="keyword">fun</span> <span class="title">navigate</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="meta">@IdRes</span> resId: <span class="type">Int</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    args: <span class="type">Bundle</span>?,</span></span></span><br><span class="line"><span class="params"><span class="function">    navOptions: <span class="type">NavOptions</span>?,</span></span></span><br><span class="line"><span class="params"><span class="function">    navigatorExtras: <span class="type">Navigator</span>.<span class="type">Extras</span>?</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> finalNavOptions = navOptions <span class="comment">// 1: navOptions</span></span><br><span class="line">    <span class="keyword">val</span> currentNode = (</span><br><span class="line">        <span class="keyword">if</span> (backQueue.isEmpty())</span><br><span class="line">            _graph</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            backQueue.last().destination</span><br><span class="line">        ) ?: <span class="keyword">throw</span> IllegalStateException(</span><br><span class="line">            <span class="string">&quot;No current destination found. Ensure a navigation graph has been set for &quot;</span> +</span><br><span class="line">                <span class="string">&quot;NavController <span class="variable">$this</span>.&quot;</span></span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    <span class="meta">@IdRes</span></span><br><span class="line">    <span class="keyword">var</span> destId = resId</span><br><span class="line">    <span class="keyword">val</span> navAction = currentNode.getAction(resId)</span><br><span class="line">    <span class="keyword">var</span> combinedArgs: Bundle? = <span class="literal">null</span></span><br><span class="line">    <span class="keyword">if</span> (navAction != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (finalNavOptions == <span class="literal">null</span>) &#123; <span class="comment">// 1.2: navOptionsç©ºçš„æƒ…å†µ</span></span><br><span class="line">            finalNavOptions = navAction.navOptions</span><br><span class="line">        &#125;</span><br><span class="line">        destId = navAction.destinationId <span class="comment">// 3: destId</span></span><br><span class="line">        <span class="keyword">val</span> navActionArgs = navAction.defaultArguments</span><br><span class="line">        <span class="keyword">if</span> (navActionArgs != <span class="literal">null</span>) &#123;</span><br><span class="line">            combinedArgs = Bundle()</span><br><span class="line">            combinedArgs.putAll(navActionArgs)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (args != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (combinedArgs == <span class="literal">null</span>) &#123;</span><br><span class="line">            combinedArgs = Bundle()</span><br><span class="line">        &#125;</span><br><span class="line">        combinedArgs.putAll(args) <span class="comment">// 2: åˆå¹¶args</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (destId == <span class="number">0</span> &amp;&amp; finalNavOptions != <span class="literal">null</span> &amp;&amp; (finalNavOptions.popUpToId != -<span class="number">1</span> ||</span><br><span class="line">            finalNavOptions.popUpToRoute != <span class="literal">null</span>)</span><br><span class="line">    ) &#123;</span><br><span class="line">        <span class="keyword">when</span> &#123; <span class="comment">// 5: popUpTo</span></span><br><span class="line">            finalNavOptions.popUpToRoute != <span class="literal">null</span> -&gt;</span><br><span class="line">                NavController(</span><br><span class="line">                    finalNavOptions.popUpToRoute!!, finalNavOptions.isPopUpToInclusive()</span><br><span class="line">                )</span><br><span class="line">            finalNavOptions.popUpToId != -<span class="number">1</span> -&gt;</span><br><span class="line">                NavController(</span><br><span class="line">                    finalNavOptions.popUpToId, finalNavOptions.isPopUpToInclusive()</span><br><span class="line">                )</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    require(destId != <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="string">&quot;Destination id == 0 can only be used in conjunction with a valid navOptions.popUpTo&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">val</span> node = findDestination(destId) <span class="comment">// 4: æ‰¾åˆ°destinationçš„node</span></span><br><span class="line">    <span class="keyword">if</span> (node == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">val</span> dest = NavDestination.getDisplayName(context, destId)</span><br><span class="line">        require(navAction == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="string">&quot;Navigation destination <span class="variable">$dest</span> referenced from action &quot;</span> +</span><br><span class="line">                <span class="string">&quot;<span class="subst">$&#123;NavDestination.getDisplayName(context, resId)&#125;</span> cannot be found from &quot;</span> +</span><br><span class="line">                <span class="string">&quot;the current destination <span class="variable">$currentNode</span>&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">throw</span> IllegalArgumentException(</span><br><span class="line">            <span class="string">&quot;Navigation action/destination <span class="variable">$dest</span> cannot be found from the current &quot;</span> +</span><br><span class="line">                <span class="string">&quot;destination <span class="variable">$currentNode</span>&quot;</span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">    navigate(node, combinedArgs, finalNavOptions, navigatorExtras) <span class="comment">// 6:</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å¤§æ¦‚åšäº†ä¸‹é¢å‡ ä»¶äº‹</p><ul><li>1: å¦‚æœè°ƒç”¨<code>navigate</code>æ—¶<ul><li>1.1: <code>NavOptions</code>å‚æ•°ä¸ç©ºï¼Œåˆ™å¿½ç•¥å½“å‰<code>node</code>çš„<code>action</code>ä¸­å­˜å‚¨çš„<code>NavOptions</code></li><li>1.2: å¦‚æœç©ºï¼Œåˆ™ä½¿ç”¨å½“å‰<code>node</code>çš„<code>action</code>ä¸­å­˜å‚¨çš„<code>NavOptions</code></li></ul></li><li>2: å°†actionçš„<code>defaultArguments</code>å’Œå‚æ•°ä¸­çš„<code>args</code>åˆå¹¶ï¼Œå¹¶ä¼ é€’ç»™æ ¸å¿ƒçš„<code>navigate</code></li><li>3: ä»actionä¸­è·å–<code>destinationId</code></li><li>4: ä»å½“å‰å›¾ä¸­æ‰¾åˆ°<code>destinationId</code>å¯¹åº”çš„node</li><li>5: å¼¹å‡ºå¯¼èˆªæ ˆï¼Œç›´åˆ°é‡åˆ°å¯¹åº”çš„routeæˆ–id</li><li>6: å°†<code>node</code>å’Œåˆå¹¶çš„<code>args</code>, <code>NavOptions</code>, è¿˜æœ‰<code>navigatorExtras</code>ä¼ é€’ç»™æ ¸å¿ƒçš„<code>navigate</code>æ–¹æ³•</li></ul></blockquote><h4 id="é€šè¿‡NavDirectionsè·³è½¬çš„"><a href="#é€šè¿‡NavDirectionsè·³è½¬çš„" class="headerlink" title="é€šè¿‡NavDirectionsè·³è½¬çš„"></a>é€šè¿‡NavDirectionsè·³è½¬çš„</h4><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// NavDirections1:</span></span><br><span class="line"><span class="meta">@MainThread</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">open</span> <span class="function"><span class="keyword">fun</span> <span class="title">navigate</span><span class="params">(directions: <span class="type">NavDirections</span>)</span></span> &#123;</span><br><span class="line">    navigate(directions.actionId, directions.arguments, <span class="literal">null</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// NavDirections2:</span></span><br><span class="line"><span class="meta">@MainThread</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">open</span> <span class="function"><span class="keyword">fun</span> <span class="title">navigate</span><span class="params">(directions: <span class="type">NavDirections</span>, navOptions: <span class="type">NavOptions</span>?)</span></span> &#123;</span><br><span class="line">    navigate(directions.actionId, directions.arguments, navOptions)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// NavDirections3:</span></span><br><span class="line"><span class="meta">@MainThread</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">open</span> <span class="function"><span class="keyword">fun</span> <span class="title">navigate</span><span class="params">(directions: <span class="type">NavDirections</span>, navigatorExtras: <span class="type">Navigator</span>.<span class="type">Extras</span>)</span></span> &#123;</span><br><span class="line">    navigate(directions.actionId, directions.arguments, <span class="literal">null</span>, navigatorExtras)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…ˆçœ‹ä¸€ä¸‹NavDirectionsæ˜¯å•¥</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">NavDirections</span> &#123;</span><br><span class="line">    <span class="meta">@get:IdRes</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">val</span> actionId: <span class="built_in">Int</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">val</span> arguments: Bundle</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶å®å°±æ˜¯æŠŠaction-idå’ŒargumentsåŒ…è£…äº†ä¸€ä¸‹ï¼Œæœ€ç»ˆä¹Ÿä¼šè°ƒç”¨<code>id4</code></p><h4 id="é€šè¿‡Uriç±»å‹çš„DeepLinkè·³è½¬çš„"><a href="#é€šè¿‡Uriç±»å‹çš„DeepLinkè·³è½¬çš„" class="headerlink" title="é€šè¿‡Uriç±»å‹çš„DeepLinkè·³è½¬çš„"></a>é€šè¿‡Uriç±»å‹çš„DeepLinkè·³è½¬çš„</h4><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// uri1:</span></span><br><span class="line"><span class="meta">@MainThread</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">open</span> <span class="function"><span class="keyword">fun</span> <span class="title">navigate</span><span class="params">(deepLink: <span class="type">Uri</span>)</span></span> &#123;</span><br><span class="line">    navigate(NavDeepLinkRequest(deepLink, <span class="literal">null</span>, <span class="literal">null</span>))</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// uri2:</span></span><br><span class="line"><span class="meta">@MainThread</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">open</span> <span class="function"><span class="keyword">fun</span> <span class="title">navigate</span><span class="params">(deepLink: <span class="type">Uri</span>, navOptions: <span class="type">NavOptions</span>?)</span></span> &#123;</span><br><span class="line">    navigate(NavDeepLinkRequest(deepLink, <span class="literal">null</span>, <span class="literal">null</span>), navOptions, <span class="literal">null</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// uri3:</span></span><br><span class="line"><span class="meta">@MainThread</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">open</span> <span class="function"><span class="keyword">fun</span> <span class="title">navigate</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    deepLink: <span class="type">Uri</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    navOptions: <span class="type">NavOptions</span>?,</span></span></span><br><span class="line"><span class="params"><span class="function">    navigatorExtras: <span class="type">Navigator</span>.<span class="type">Extras</span>?</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span> &#123;</span><br><span class="line">    navigate(NavDeepLinkRequest(deepLink, <span class="literal">null</span>, <span class="literal">null</span>), navOptions, navigatorExtras)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»–ä»¬éƒ½ä¼šæ„é€ NavDeepLinkRequestå¯¹è±¡ç„¶åè°ƒç”¨<code>NavDeepLinkRequest3</code></p><h4 id="é€šè¿‡routeè·³è½¬çš„"><a href="#é€šè¿‡routeè·³è½¬çš„" class="headerlink" title="é€šè¿‡routeè·³è½¬çš„"></a>é€šè¿‡routeè·³è½¬çš„</h4><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// route1:</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">fun</span> <span class="title">navigate</span><span class="params">(route: <span class="type">String</span>, builder: <span class="type">NavOptionsBuilder</span>.() -&gt; <span class="type">Unit</span>)</span></span> &#123;</span><br><span class="line">    navigate(route, navOptions(builder))</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">fun</span> <span class="title">navigate</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    route: <span class="type">String</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    navOptions: <span class="type">NavOptions</span>? = <span class="literal">null</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    navigatorExtras: <span class="type">Navigator</span>.<span class="type">Extras</span>? = <span class="literal">null</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span> &#123;</span><br><span class="line">    navigate(</span><br><span class="line">        NavDeepLinkRequest.Builder.fromUri(createRoute(route).toUri()).build(), navOptions,</span><br><span class="line">        navigatorExtras</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>é€šè¿‡routeè·³è½¬çš„ï¼Œæœ€åä¹Ÿä¼šå˜æˆdeeplink</li></ul><h4 id="é€šè¿‡NavDeepLinkRequestè·³è½¬çš„"><a href="#é€šè¿‡NavDeepLinkRequestè·³è½¬çš„" class="headerlink" title="é€šè¿‡NavDeepLinkRequestè·³è½¬çš„"></a>é€šè¿‡NavDeepLinkRequestè·³è½¬çš„</h4><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// NavDeepLinkRequest1:</span></span><br><span class="line"><span class="meta">@MainThread</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">open</span> <span class="function"><span class="keyword">fun</span> <span class="title">navigate</span><span class="params">(request: <span class="type">NavDeepLinkRequest</span>)</span></span> &#123;</span><br><span class="line">    navigate(request, <span class="literal">null</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// NavDeepLinkRequest2:</span></span><br><span class="line"><span class="meta">@MainThread</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">open</span> <span class="function"><span class="keyword">fun</span> <span class="title">navigate</span><span class="params">(request: <span class="type">NavDeepLinkRequest</span>, navOptions: <span class="type">NavOptions</span>?)</span></span> &#123;</span><br><span class="line">    navigate(request, navOptions, <span class="literal">null</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// NavDeepLinkRequest3:</span></span><br><span class="line"><span class="meta">@MainThread</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">open</span> <span class="function"><span class="keyword">fun</span> <span class="title">navigate</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    request: <span class="type">NavDeepLinkRequest</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    navOptions: <span class="type">NavOptions</span>?,</span></span></span><br><span class="line"><span class="params"><span class="function">    navigatorExtras: <span class="type">Navigator</span>.<span class="type">Extras</span>?</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">open</span> <span class="function"><span class="keyword">fun</span> <span class="title">navigate</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    request: <span class="type">NavDeepLinkRequest</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    navOptions: <span class="type">NavOptions</span>?,</span></span></span><br><span class="line"><span class="params"><span class="function">    navigatorExtras: <span class="type">Navigator</span>.<span class="type">Extras</span>?</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span> &#123;</span><br><span class="line">    requireNotNull(_graph) &#123;</span><br><span class="line">        <span class="string">&quot;Cannot navigate to <span class="variable">$request</span>. Navigation graph has not been set for &quot;</span> +</span><br><span class="line">            <span class="string">&quot;NavController <span class="variable">$this</span>.&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">val</span> deepLinkMatch = _graph!!.matchDeepLink(request)</span><br><span class="line">    <span class="keyword">if</span> (deepLinkMatch != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">val</span> destination = deepLinkMatch.destination</span><br><span class="line">        <span class="keyword">val</span> args = destination.addInDefaultArgs(deepLinkMatch.matchingArgs) ?: Bundle()</span><br><span class="line">        <span class="keyword">val</span> node = deepLinkMatch.destination</span><br><span class="line">        <span class="keyword">val</span> intent = Intent().apply &#123;</span><br><span class="line">            setDataAndType(request.uri, request.mimeType)</span><br><span class="line">            action = request.action</span><br><span class="line">        &#125;</span><br><span class="line">        args.putParcelable(KEY_DEEP_LINK_INTENT, intent)</span><br><span class="line">        navigate(node, args, navOptions, navigatorExtras)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> IllegalArgumentException(</span><br><span class="line">            <span class="string">&quot;Navigation destination that matches request <span class="variable">$request</span> cannot be found in the &quot;</span> +</span><br><span class="line">                <span class="string">&quot;navigation graph <span class="variable">$_graph</span>&quot;</span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>é€šè¿‡matchDeepLinkæ–¹æ³•æ‰¾åˆ°matchå¯¹è±¡<ul><li>å¦‚æœæ²¡æœ‰matchï¼ŒæŠ›å‡ºå¼‚å¸¸</li><li>å¦‚æœæœ‰matchï¼Œä»matchå¯¹è±¡ä¸­å–å‡º<code>destination</code>ï¼Œå’Œ<code>id4</code>æ–¹æ³•ä¸€æ ·ï¼Œæœ€ç»ˆéƒ½ä¼šè°ƒç”¨æ ¸å¿ƒçš„<code>navigate</code>æ–¹æ³•ï¼ŒåŒæ ·éœ€è¦æ‰¾åˆ°æ ¸å¿ƒ<code>navigate</code>æ–¹æ³•æ‰€éœ€çš„å‡ ä¸ªå‚æ•°<ul><li>node: ä»destinationå¯¹è±¡ä¸­è·å¾—</li><li>args: ä»destinationå¯¹è±¡ä¸­è·å¾—</li><li>navOptions: å‡½æ•°å‚æ•°</li><li>navigatorExtras: å‡½æ•°å‚æ•°</li></ul></li><li>è°ƒç”¨æ ¸å¿ƒçš„<code>navigate</code>æ–¹æ³•</li></ul></li></ul><h4 id="æ ¸å¿ƒçš„navigateæ–¹æ³•"><a href="#æ ¸å¿ƒçš„navigateæ–¹æ³•" class="headerlink" title="æ ¸å¿ƒçš„navigateæ–¹æ³•"></a>æ ¸å¿ƒçš„navigateæ–¹æ³•</h4><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">navigate</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    node: <span class="type">NavDestination</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    args: <span class="type">Bundle</span>?,</span></span></span><br><span class="line"><span class="params"><span class="function">    navOptions: <span class="type">NavOptions</span>?,</span></span></span><br><span class="line"><span class="params"><span class="function">    navigatorExtras: <span class="type">Navigator</span>.<span class="type">Extras</span>?</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span> &#123;</span><br><span class="line">    navigatorState.values.forEach &#123; state -&gt;</span><br><span class="line">        state.isNavigating = <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> popped = <span class="literal">false</span></span><br><span class="line">    <span class="keyword">var</span> launchSingleTop = <span class="literal">false</span></span><br><span class="line">    <span class="keyword">var</span> navigated = <span class="literal">false</span></span><br><span class="line">    <span class="keyword">if</span> (navOptions != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">when</span> &#123; <span class="comment">// 1: æ ¹æ®navOptionsçš„ä¸åŒæƒ…å†µï¼Œpopæ ˆ</span></span><br><span class="line">            navOptions.popUpToRoute != <span class="literal">null</span> -&gt;</span><br><span class="line">                popped = NavControllerInternal(</span><br><span class="line">                    navOptions.popUpToRoute!!,</span><br><span class="line">                    navOptions.isPopUpToInclusive(),</span><br><span class="line">                    navOptions.shouldPopUpToSaveState()</span><br><span class="line">                )</span><br><span class="line">            navOptions.popUpToId != -<span class="number">1</span> -&gt;</span><br><span class="line">                popped = NavControllerInternal(</span><br><span class="line">                    navOptions.popUpToId,</span><br><span class="line">                    navOptions.isPopUpToInclusive(),</span><br><span class="line">                    navOptions.shouldPopUpToSaveState()</span><br><span class="line">                )</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">val</span> finalArgs = node.addInDefaultArgs(args)</span><br><span class="line">    <span class="comment">// Now determine what new destinations we need to add to the back stack</span></span><br><span class="line">    <span class="keyword">if</span> (navOptions?.shouldRestoreState() == <span class="literal">true</span> &amp;&amp; backStackMap.containsKey(node.id)) &#123;</span><br><span class="line">        navigated = restoreStateInternal(node.id, finalArgs, navOptions, navigatorExtras) <span class="comment">// 2: éœ€è¦æ¢å¤çŠ¶æ€ï¼Œä¸”backStackMapä¸­å­˜åœ¨å¯¹åº”çš„nodeçš„æƒ…å†µ</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        launchSingleTop = navOptions?.shouldLaunchSingleTop() == <span class="literal">true</span> &amp;&amp;</span><br><span class="line">            launchSingleTopInternal(node, args) <span class="comment">//3: singleTopçš„æƒ…å†µ</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!launchSingleTop) &#123; <span class="comment">// ä¸éœ€è¦singleTopçš„æƒ…å†µ</span></span><br><span class="line">            <span class="comment">// Not a single top operation, so we&#x27;re looking to add the node to the back stack</span></span><br><span class="line">            <span class="keyword">val</span> backStackEntry = NavBackStackEntry.create(</span><br><span class="line">                context, node, finalArgs, hostLifecycleState, viewModel</span><br><span class="line">            )</span><br><span class="line">            <span class="keyword">val</span> navigator = _navigatorProvider.getNavigator&lt;Navigator&lt;NavDestination&gt;&gt;(</span><br><span class="line">                node.navigatorName</span><br><span class="line">            )</span><br><span class="line">            navigator.navigateInternal(listOf(backStackEntry), navOptions, navigatorExtras) &#123;</span><br><span class="line">                navigated = <span class="literal">true</span></span><br><span class="line">                addEntryToBackStack(node, finalArgs, it)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    updateOnBackPressedCallbackEnabled() <span class="comment">// 4: çœ‹èµ·æ¥æ˜¯è®¾ç½®ä¸€ä¸ªflag</span></span><br><span class="line">    navigatorState.values.forEach &#123; state -&gt;</span><br><span class="line">        state.isNavigating = <span class="literal">false</span> <span class="comment">// 5: åˆè®¾ç½®ä¸€ä¸ªflag</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (popped || navigated || launchSingleTop) &#123;</span><br><span class="line">        dispatchOnDestinationChanged() <span class="comment">// 6: è°ƒç”¨å›è°ƒ</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        updateBackStackLifecycle() <span class="comment">// 7: æ›´æ–°å¯¼èˆªæ ˆçš„ç”Ÿå‘½å‘¨æœŸ</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>æ ¹æ®ä¸Šé¢çš„æ³¨é‡Šï¼Œä¸€å…±åšäº†7ä»¶äº‹</li></ul><h5 id="2-éœ€è¦æ¢å¤çŠ¶æ€ï¼Œä¸”backStackMapä¸­å­˜åœ¨å¯¹åº”çš„nodeçš„æƒ…å†µ"><a href="#2-éœ€è¦æ¢å¤çŠ¶æ€ï¼Œä¸”backStackMapä¸­å­˜åœ¨å¯¹åº”çš„nodeçš„æƒ…å†µ" class="headerlink" title="2: éœ€è¦æ¢å¤çŠ¶æ€ï¼Œä¸”backStackMapä¸­å­˜åœ¨å¯¹åº”çš„nodeçš„æƒ…å†µ"></a>2: éœ€è¦æ¢å¤çŠ¶æ€ï¼Œä¸”backStackMapä¸­å­˜åœ¨å¯¹åº”çš„nodeçš„æƒ…å†µ</h5><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NavOptions</span> <span class="keyword">internal</span> <span class="keyword">constructor</span>(</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> singleTop: <span class="built_in">Boolean</span>,</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> restoreState: <span class="built_in">Boolean</span>,</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">) &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">fun</span> <span class="title">shouldRestoreState</span><span class="params">()</span></span>: <span class="built_in">Boolean</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> restoreState</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Builder</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">var</span> singleTop = <span class="literal">false</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">var</span> restoreState = <span class="literal">false</span></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">fun</span> <span class="title">setRestoreState</span><span class="params">(restoreState: <span class="type">Boolean</span>)</span></span>: Builder &#123;</span><br><span class="line">            <span class="keyword">this</span>.restoreState = restoreState</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>shouldRestoreState</code>è¿”å›çš„æ˜¯<code>restoreState</code>ï¼Œæ˜¯åœ¨æ„é€ æ—¶ç¡®å®šçš„</li></ul><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">restoreStateInternal</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    id: <span class="type">Int</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    args: <span class="type">Bundle</span>?,</span></span></span><br><span class="line"><span class="params"><span class="function">    navOptions: <span class="type">NavOptions</span>?,</span></span></span><br><span class="line"><span class="params"><span class="function">    navigatorExtras: <span class="type">Navigator</span>.<span class="type">Extras</span>?</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>: <span class="built_in">Boolean</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!backStackMap.containsKey(id)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span> <span class="comment">// 1: é¦–å…ˆæ˜¯é˜²æ­¢backStackMapä¸­æ²¡æœ‰å¯¹åº”çš„node</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">val</span> backStackId = backStackMap[id]</span><br><span class="line">    <span class="comment">// Clear out the state we&#x27;re going to restore so that it isn&#x27;t restored a second time</span></span><br><span class="line">    backStackMap.values.removeAll &#123; it == backStackId &#125; <span class="comment">// 2: åˆ é™¤mapä¸­æ‰€æœ‰å’ŒbackStackIdç›¸ç­‰çš„entry</span></span><br><span class="line">    <span class="keyword">val</span> backStackState = backStackStates.remove(backStackId) <span class="comment">// 3: åˆ é™¤backStackStatesä¸­å¯¹åº”çš„entry</span></span><br><span class="line">    <span class="comment">// Now restore the back stack from its saved state</span></span><br><span class="line">    <span class="keyword">val</span> entries = instantiateBackStack(backStackState) <span class="comment">// 4: æ›´æ–°backStackStateä¸­çš„NavBackStackEntryState</span></span><br><span class="line">    <span class="keyword">return</span> executeRestoreState(entries, args, navOptions, navigatorExtras) <span class="comment">// 5: æ‰¾åˆ°Navigatorï¼Œå¯¼èˆªåˆ°å¯¹åº”ä½ç½®</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h6 id="3-åˆ é™¤backStackStatesä¸­å¯¹åº”çš„entry"><a href="#3-åˆ é™¤backStackStatesä¸­å¯¹åº”çš„entry" class="headerlink" title="3: åˆ é™¤backStackStatesä¸­å¯¹åº”çš„entry"></a>3: åˆ é™¤backStackStatesä¸­å¯¹åº”çš„entry</h6><p>çœ‹ä¸€ä¸‹backStackStatesçš„æ•°æ®ç»“æ„</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">val</span> backStackStates = mutableMapOf&lt;String, ArrayDeque&lt;NavBackStackEntryState&gt;&gt;()</span><br></pre></td></tr></table></figure><h6 id="4-æ›´æ–°backStackStateä¸­çš„"><a href="#4-æ›´æ–°backStackStateä¸­çš„" class="headerlink" title="4: æ›´æ–°backStackStateä¸­çš„"></a>4: æ›´æ–°backStackStateä¸­çš„</h6><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">instantiateBackStack</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    backStackState: <span class="type">ArrayDeque</span>&lt;<span class="type">NavBackStackEntryState</span>&gt;?</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>: List&lt;NavBackStackEntry&gt; &#123;</span><br><span class="line">    <span class="keyword">val</span> backStack = mutableListOf&lt;NavBackStackEntry&gt;()</span><br><span class="line">    <span class="keyword">var</span> currentDestination = backQueue.lastOrNull()?.destination ?: graph</span><br><span class="line">    backStackState?.forEach &#123; state -&gt;</span><br><span class="line">        <span class="keyword">val</span> node = currentDestination.findDestination(state.destinationId)</span><br><span class="line">        checkNotNull(node) &#123;</span><br><span class="line">            <span class="keyword">val</span> dest = NavDestination.getDisplayName(</span><br><span class="line">                context, state.destinationId</span><br><span class="line">            )</span><br><span class="line">            <span class="string">&quot;Restore State failed: destination <span class="variable">$dest</span> cannot be found from the current &quot;</span> +</span><br><span class="line">                <span class="string">&quot;destination <span class="variable">$currentDestination</span>&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        backStack += state.instantiate(context, node, hostLifecycleState, viewModel)</span><br><span class="line">        currentDestination = node</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> backStack</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>åˆ›å»ºä¸€ä¸ªç©ºçš„backStackï¼Œç„¶åéå†backStackState</li><li>æ‰¾åˆ°å½“å‰æ ˆæœ€åä¸€ä¸ªentryçš„destination</li><li>ä»currentDestinationä¸­æ‰¾åˆ°<code>state.destinationId</code>å¯¹åº”çš„node</li><li>æ ¹æ®nodeé‡æ–°åˆ›å»ºstateå¯¹è±¡ï¼Œæ·»åŠ åˆ°backStackä¸­ï¼Œè¿”å›è¯¥backStack</li></ul><h6 id="5-æ‰¾åˆ°Navigatorï¼Œå¯¼èˆªåˆ°å¯¹åº”ä½ç½®"><a href="#5-æ‰¾åˆ°Navigatorï¼Œå¯¼èˆªåˆ°å¯¹åº”ä½ç½®" class="headerlink" title="5: æ‰¾åˆ°Navigatorï¼Œå¯¼èˆªåˆ°å¯¹åº”ä½ç½®"></a>5: æ‰¾åˆ°Navigatorï¼Œå¯¼èˆªåˆ°å¯¹åº”ä½ç½®</h6><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">executeRestoreState</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    entries: <span class="type">List</span>&lt;<span class="type">NavBackStackEntry</span>&gt;,</span></span></span><br><span class="line"><span class="params"><span class="function">    args: <span class="type">Bundle</span>?,</span></span></span><br><span class="line"><span class="params"><span class="function">    navOptions: <span class="type">NavOptions</span>?,</span></span></span><br><span class="line"><span class="params"><span class="function">    navigatorExtras: <span class="type">Navigator</span>.<span class="type">Extras</span>?</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>: <span class="built_in">Boolean</span> &#123;</span><br><span class="line">    <span class="comment">// Split up the entries by Navigator so we can restore them as an atomic operation</span></span><br><span class="line">    <span class="keyword">val</span> entriesGroupedByNavigator = mutableListOf&lt;MutableList&lt;NavBackStackEntry&gt;&gt;()</span><br><span class="line">    entries.filterNot &#123; entry -&gt;</span><br><span class="line">        <span class="comment">// Skip navigation graphs - they&#x27;ll be added by addEntryToBackStack()</span></span><br><span class="line">        entry.destination <span class="keyword">is</span> NavGraph</span><br><span class="line">    &#125;.forEach &#123; entry -&gt;</span><br><span class="line">        <span class="keyword">val</span> previousEntryList = entriesGroupedByNavigator.lastOrNull()</span><br><span class="line">        <span class="keyword">val</span> previousNavigatorName = previousEntryList?.last()?.destination?.navigatorName</span><br><span class="line">        <span class="keyword">if</span> (previousNavigatorName == entry.destination.navigatorName) &#123;</span><br><span class="line">            <span class="comment">// Group back to back entries associated with the same Navigator together</span></span><br><span class="line">            previousEntryList += entry</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// Create a new group for the new Navigator</span></span><br><span class="line">            entriesGroupedByNavigator += mutableListOf(entry)</span><br><span class="line">        &#125; <span class="comment">// 1: å¦‚æœ navigatorNameå’Œå‰ä¸€ä¸ªçš„ç›¸ç­‰ï¼Œåˆ™æ·»åŠ åˆ°å‰ä¸€ä¸ªçš„listä¸­ï¼Œå¦åˆ™æ·»åŠ åˆ°æ–°å»ºä¸€ä¸ªlistä¸­ï¼Œæœ€åä¼šå¾—åˆ°ä¸€ä¸ªäºŒç»´æ•°ç»„ï¼Œæ¯ä¸ªæ•°ç»„ä¸­çš„å…ƒç´ éƒ½æ˜¯å…·æœ‰ç›¸åŒNavigatorNameçš„</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> navigated = <span class="literal">false</span></span><br><span class="line">    <span class="comment">// Now actually navigate to each set of entries</span></span><br><span class="line">    <span class="keyword">for</span> (entryList <span class="keyword">in</span> entriesGroupedByNavigator) &#123;</span><br><span class="line">        <span class="keyword">val</span> navigator = _navigatorProvider.getNavigator&lt;Navigator&lt;NavDestination&gt;&gt;(</span><br><span class="line">            entryList.first().destination.navigatorName</span><br><span class="line">        ) <span class="comment">// 2: æ¯ä¸ªentryListéƒ½å…·æœ‰ç›¸åŒçš„navigatorNameï¼Œæ‰¾åˆ°å¯¹åº”çš„Navigator</span></span><br><span class="line">        <span class="keyword">var</span> lastNavigatedIndex = <span class="number">0</span></span><br><span class="line">        navigator.navigateInternal(entryList, navOptions, navigatorExtras) &#123; entry -&gt;</span><br><span class="line">            navigated = <span class="literal">true</span></span><br><span class="line">            <span class="comment">// If this destination is part of the restored back stack,</span></span><br><span class="line">            <span class="comment">// pass all destinations between the last navigated entry and this one</span></span><br><span class="line">            <span class="comment">// to ensure that any navigation graphs are properly restored as well</span></span><br><span class="line">            <span class="keyword">val</span> entryIndex = entries.indexOf(entry)</span><br><span class="line">            <span class="keyword">val</span> restoredEntries = <span class="keyword">if</span> (entryIndex != -<span class="number">1</span>) &#123;</span><br><span class="line">                entries.subList(lastNavigatedIndex, entryIndex + <span class="number">1</span>).also &#123;</span><br><span class="line">                    lastNavigatedIndex = entryIndex + <span class="number">1</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                emptyList()</span><br><span class="line">            &#125;</span><br><span class="line">            addEntryToBackStack(entry.destination, args, entry, restoredEntries)</span><br><span class="line">        &#125; <span class="comment">// æ‰§è¡Œå¯¼èˆªæ“ä½œ</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> navigated</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> Navigator<span class="type">&lt;out NavDestination&gt;</span>.<span class="title">navigateInternal</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    entries: <span class="type">List</span>&lt;<span class="type">NavBackStackEntry</span>&gt;,</span></span></span><br><span class="line"><span class="params"><span class="function">    navOptions: <span class="type">NavOptions</span>?,</span></span></span><br><span class="line"><span class="params"><span class="function">    navigatorExtras: <span class="type">Navigator</span>.<span class="type">Extras</span>?,</span></span></span><br><span class="line"><span class="params"><span class="function">    handler: (<span class="type">backStackEntry</span>: <span class="type">NavBackStackEntry</span>) -&gt; <span class="type">Unit</span> = &#123;&#125;</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span> &#123;</span><br><span class="line">    addToBackStackHandler = handler <span class="comment">// å…ˆæŠŠå›è°ƒæ”¾åˆ°ä¸€è¾¹ï¼Œç¨åç”±NavControllerNavigatorStateçš„pushæ–¹æ³•è°ƒç”¨</span></span><br><span class="line">    navigate(entries, navOptions, navigatorExtras) <span class="comment">// æ‰§è¡Œå¯¼èˆªæ“ä½œ</span></span><br><span class="line">    addToBackStackHandler = <span class="literal">null</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">open</span> <span class="function"><span class="keyword">fun</span> <span class="title">navigate</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    entries: <span class="type">List</span>&lt;<span class="type">NavBackStackEntry</span>&gt;,</span></span></span><br><span class="line"><span class="params"><span class="function">    navOptions: <span class="type">NavOptions</span>?,</span></span></span><br><span class="line"><span class="params"><span class="function">    navigatorExtras: <span class="type">Extras</span>?</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span> &#123;</span><br><span class="line">    entries.asSequence().map &#123; backStackEntry -&gt; <span class="comment">// éå†entriesï¼ŒæŠŠä»–è¿›è¡Œå˜æ¢</span></span><br><span class="line">        <span class="keyword">val</span> destination = backStackEntry.destination <span class="keyword">as</span>? D ?: <span class="keyword">return</span><span class="symbol">@map</span> <span class="literal">null</span></span><br><span class="line">        <span class="keyword">val</span> navigatedToDestination = navigate(</span><br><span class="line">            destination, backStackEntry.arguments, navOptions, navigatorExtras</span><br><span class="line">        ) <span class="comment">// ç”±å­ç±»å®ç°ï¼Œæ‰§è¡ŒçœŸæ­£çš„å¯¼èˆªæ“ä½œ</span></span><br><span class="line">        <span class="keyword">when</span> (navigatedToDestination) &#123;</span><br><span class="line">            <span class="literal">null</span> -&gt; <span class="literal">null</span> <span class="comment">// è¿”å›nullï¼Œå½“å‰backStackEntryå˜æˆnull</span></span><br><span class="line">            destination -&gt; backStackEntry <span class="comment">// è¿”å›å¯¼èˆªç»“æœä¸destinationç›¸åŒï¼ŒbackStackEntryä¹Ÿä¸å˜</span></span><br><span class="line">            <span class="keyword">else</span> -&gt; &#123;</span><br><span class="line">                state.createBackStackEntry(</span><br><span class="line">                    navigatedToDestination,</span><br><span class="line">                    navigatedToDestination.addInDefaultArgs(backStackEntry.arguments)</span><br><span class="line">                ) <span class="comment">// å¦åˆ™åˆ›å»ºæ–°çš„backStackEntry</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;.filterNotNull().forEach &#123; backStackEntry -&gt;</span><br><span class="line">        state.push(backStackEntry)</span><br><span class="line">    &#125; <span class="comment">// 1: å¯¹äºä¸ä¸ºnullçš„ï¼Œé‡æ–°æ”¾å…¥stateä¸­,æ³¨æ„è¿™é‡Œè°ƒç”¨çš„pushæ–¹æ³•</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œé¢çš„stateå®šä¹‰å¦‚ä¸‹</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">val</span> state: NavigatorState</span><br><span class="line">    <span class="keyword">get</span>() = checkNotNull(_state) &#123;</span><br><span class="line">        <span class="string">&quot;You cannot access the Navigator&#x27;s state until the Navigator is attached&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">var</span> _state: NavigatorState? = <span class="literal">null</span></span><br><span class="line"><span class="meta">@CallSuper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">open</span> <span class="function"><span class="keyword">fun</span> <span class="title">onAttach</span><span class="params">(state: <span class="type">NavigatorState</span>)</span></span> &#123; <span class="comment">// åœ¨onAttachæ—¶ä¼šåˆå§‹åŒ–</span></span><br><span class="line">    _state = state</span><br><span class="line">    isAttached = <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨NavControllerçš„onGraphCreatedæ–¹æ³•ä¸­æœ‰</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> navigatorBackStack = navigatorState.getOrPut(navigator) &#123;</span><br><span class="line">    NavControllerNavigatorState(navigator)</span><br><span class="line">&#125;</span><br><span class="line">navigator.onAttach(navigatorBackStack)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…¶ä¸­navigatorStateæ˜¯ä»navigatoråˆ°NavControllerNavigatorStateçš„map</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">val</span> navigatorState =</span><br><span class="line">        mutableMapOf&lt;Navigator&lt;<span class="keyword">out</span> NavDestination&gt;, NavControllerNavigatorState&gt;()</span><br><span class="line"><span class="comment">// getOrPutæ–¹æ³•å°±æ˜¯å½“æ²¡æœ‰keyæ—¶ï¼Œè°ƒç”¨åé¢çš„å‡½æ•°æ’å…¥åˆ°mapä¸­å¹¶è¿”å›ï¼Œæœ‰keyæ—¶åˆ™è¿”å›æŸ¥è¯¢åˆ°çš„value</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;K, V&gt;</span> MutableMap<span class="type">&lt;K, V&gt;</span>.<span class="title">getOrPut</span><span class="params">(key: <span class="type">K</span>, defaultValue: () -&gt; <span class="type">V</span>)</span></span>: V &#123;</span><br><span class="line">    <span class="keyword">val</span> value = <span class="keyword">get</span>(key)</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">if</span> (value == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">val</span> answer = defaultValue()</span><br><span class="line">        put(key, answer)</span><br><span class="line">        answer</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        value</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥ä¸Šé¢<code>1:</code>å‡ºè°ƒç”¨çš„pushæ–¹æ³•ï¼Œå°±æ˜¯NavControllerNavigatorStateçš„pushæ–¹æ³•</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">push</span><span class="params">(backStackEntry: <span class="type">NavBackStackEntry</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> destinationNavigator: Navigator&lt;<span class="keyword">out</span> NavDestination&gt; =</span><br><span class="line">        _navigatorProvider[backStackEntry.destination.navigatorName]</span><br><span class="line">    <span class="keyword">if</span> (destinationNavigator == navigator) &#123;</span><br><span class="line">        <span class="keyword">val</span> handler = addToBackStackHandler <span class="comment">// è¿˜è®°å¾—å‰é¢å­˜èµ·æ¥çš„å›è°ƒå—ï¼Œå°±ä¼šåœ¨è¿™é‡Œè°ƒç”¨</span></span><br><span class="line">        <span class="keyword">if</span> (handler != <span class="literal">null</span>) &#123;</span><br><span class="line">            handler(backStackEntry)</span><br><span class="line">            addInternal(backStackEntry)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// TODO handle the Navigator calling add() outside of a call to navigate()</span></span><br><span class="line">            Log.i(</span><br><span class="line">                TAG,</span><br><span class="line">                <span class="string">&quot;Ignoring add of destination <span class="subst">$&#123;backStackEntry.destination&#125;</span> &quot;</span> +</span><br><span class="line">                    <span class="string">&quot;outside of the call to navigate(). &quot;</span></span><br><span class="line">            )</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">val</span> navigatorBackStack = checkNotNull(navigatorState[destinationNavigator]) &#123;</span><br><span class="line">            <span class="string">&quot;NavigatorBackStack for <span class="subst">$&#123;backStackEntry.destination.navigatorName&#125;</span> should &quot;</span> +</span><br><span class="line">                <span class="string">&quot;already be created&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        navigatorBackStack.push(backStackEntry)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ç–‘é—®ï¼Œä»–è·³è½¬é‚£ä¹ˆå¤šå¹²ä»€ä¹ˆï¼Ÿ</p></blockquote><h4 id="3-singleTopçš„æƒ…å†µ"><a href="#3-singleTopçš„æƒ…å†µ" class="headerlink" title="3: singleTopçš„æƒ…å†µ"></a>3: singleTopçš„æƒ…å†µ</h4><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NavOptions</span> <span class="keyword">internal</span> <span class="keyword">constructor</span>(</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> singleTop: <span class="built_in">Boolean</span>,</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">) &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">fun</span> <span class="title">shouldLaunchSingleTop</span><span class="params">()</span></span>: <span class="built_in">Boolean</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> singleTop</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>shouldLaunchSingleTopè¿”å›çš„å€¼æ˜¯å…¶æ„é€ æ—¶çš„ä¸€ä¸ªæ ‡å¿—ä½</p><p>åœ¨åˆ†æ<code>launchSingleTopInternal</code>æ–¹æ³•å‰ï¼Œå…ˆçœ‹ä¸€ä¸‹NavControllerä¸­ç»´æŠ¤çš„ä¸€ä¸ªçˆ¶å­å…³ç³»</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">val</span> childToParentEntries = mutableMapOf&lt;NavBackStackEntry, NavBackStackEntry&gt;()</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">val</span> parentToChildCount = mutableMapOf&lt;NavBackStackEntry, AtomicInteger&gt;()</span><br></pre></td></tr></table></figure><p>çœ‹èµ·æ¥NavBackStackEntryä¹‹é—´å­˜åœ¨ä¸€ä¸ªçˆ¶å­å…³ç³»ï¼Œå¯èƒ½æ˜¯ä¸€å¼ å›¾çš„å½¢å¼ï¼Œä¸€ä¸ªmapå­˜å‚¨è¿™ç§çˆ¶å­å…³ç³»ï¼Œä¸€ä¸ªmapå­˜å‚¨å­èŠ‚ç‚¹çš„ä¸ªæ•°</p><blockquote><p>åé¢çœ‹äº†<code>NavDestination</code>å’Œ<code>NavBackStackEntry</code>åå°±çŸ¥é“ï¼Œè¿™é‡Œç»´æŠ¤çš„å°±æ˜¯<code>NavDestination</code>ä¹‹é—´çš„çˆ¶å­å…³ç³»ã€‚</p></blockquote><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">linkChildToParent</span><span class="params">(child: <span class="type">NavBackStackEntry</span>, parent: <span class="type">NavBackStackEntry</span>)</span></span> &#123;</span><br><span class="line">    childToParentEntries[child] = parent</span><br><span class="line">    <span class="keyword">if</span> (parentToChildCount[parent] == <span class="literal">null</span>) &#123;</span><br><span class="line">        parentToChildCount[parent] = AtomicInteger(<span class="number">0</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    parentToChildCount[parent]!!.incrementAndGet()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">internal</span> <span class="function"><span class="keyword">fun</span> <span class="title">unlinkChildFromParent</span><span class="params">(child: <span class="type">NavBackStackEntry</span>)</span></span>: NavBackStackEntry? &#123;</span><br><span class="line">    <span class="keyword">val</span> parent = childToParentEntries.remove(child) ?: <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">    <span class="keyword">val</span> count = parentToChildCount[parent]?.decrementAndGet()</span><br><span class="line">    <span class="keyword">if</span> (count == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">val</span> navGraphNavigator: Navigator&lt;<span class="keyword">out</span> NavGraph&gt; =</span><br><span class="line">            _navigatorProvider[parent.destination.navigatorName]</span><br><span class="line">        navigatorState[navGraphNavigator]?.markTransitionComplete(parent)</span><br><span class="line">        parentToChildCount.remove(parent)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> parent</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>è¿™ä¸¤ä¸ªå‡½æ•°ç”¨äºç»´æŠ¤NavBackStackEntryä¹‹é—´çš„çˆ¶å­å…³ç³»<br>å½“ä¸€ä¸ªNavBackStackEntryçš„childä¸ªæ•°ä¸º0æ—¶ï¼Œä¼šè°ƒç”¨markTransitionCompleteï¼Œå…·ä½“å¹²å•¥çš„ç»§ç»­æŒ–å‘å§ï¼<br>&#x2F;&#x2F; todo : markTransitionComplete</p></blockquote><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">launchSingleTopInternal</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    node: <span class="type">NavDestination</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    args: <span class="type">Bundle</span>?</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>: <span class="built_in">Boolean</span> &#123;</span><br><span class="line">    <span class="keyword">val</span> currentBackStackEntry = currentBackStackEntry</span><br><span class="line">    <span class="keyword">val</span> nodeId = <span class="keyword">if</span> (node <span class="keyword">is</span> NavGraph) node.findStartDestination().id <span class="keyword">else</span> node.id</span><br><span class="line">    <span class="keyword">if</span> (nodeId != currentBackStackEntry?.destination?.id) <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> tempBackQueue: ArrayDeque&lt;NavBackStackEntry&gt; = ArrayDeque()</span><br><span class="line">    <span class="comment">// pop from startDestination back to original node and create a new entry for each</span></span><br><span class="line">    backQueue.indexOfLast &#123; it.destination === node &#125;.let &#123; nodeIndex -&gt; <span class="comment">// æ‰¾åˆ°queueä¸­æœ€åä¸€ä¸ªdestinationå’Œnodeç›¸ç­‰çš„index</span></span><br><span class="line">        <span class="keyword">while</span> (backQueue.lastIndex &gt;= nodeIndex) &#123; <span class="comment">// å¦‚æœqueueä¸­æœ€åä¸€ä¸ªindexå¤§äºnodeIndexï¼Œå°±åˆ æ‰ä»–ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªæ–°çš„entryï¼Œæ”¾åˆ°tempBackQueueä¸­ï¼Œç›´åˆ°lastIndexå°äºnodeIndexä¸ºæ­¢</span></span><br><span class="line">            <span class="keyword">val</span> oldEntry = backQueue.removeLast() </span><br><span class="line">            unlinkChildFromParent(oldEntry) <span class="comment">// åˆ é™¤çˆ¶å­å…³ç³»</span></span><br><span class="line">            <span class="keyword">val</span> newEntry = NavBackStackEntry(</span><br><span class="line">                oldEntry,</span><br><span class="line">                oldEntry.destination.addInDefaultArgs(args)</span><br><span class="line">            ) <span class="comment">// åˆ›å»ºæ–°çš„entry</span></span><br><span class="line">            tempBackQueue.addFirst(newEntry) <span class="comment">// æ·»åŠ åˆ°tempBackQueueä¸­</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// add each new entry to backQueue starting from original node to startDestination</span></span><br><span class="line">    tempBackQueue.forEach &#123; newEntry -&gt;</span><br><span class="line">        <span class="keyword">val</span> parent = newEntry.destination.parent</span><br><span class="line">        <span class="keyword">if</span> (parent != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">val</span> newParent = getBackStackEntry(parent.id)</span><br><span class="line">            linkChildToParent(newEntry, newParent) <span class="comment">// æ›´æ–°entryä¹‹é—´çš„çˆ¶å­å…³ç³»</span></span><br><span class="line">        &#125;</span><br><span class="line">        backQueue.add(newEntry)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// we replace NavState entries here only after backQueue has been finalized</span></span><br><span class="line">    tempBackQueue.forEach &#123; newEntry -&gt;</span><br><span class="line">        <span class="keyword">val</span> navigator = _navigatorProvider.getNavigator&lt;Navigator&lt;*&gt;&gt;(</span><br><span class="line">            newEntry.destination.navigatorName</span><br><span class="line">        )</span><br><span class="line">        navigator.onLaunchSingleTop(newEntry) <span class="comment">// æ‹¿åˆ°å¯¹åº”çš„Navigatorï¼Œæ‰§è¡ŒonLaunchSingleTop</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Suppress(<span class="string">&quot;UNCHECKED_CAST&quot;</span>)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">open</span> <span class="function"><span class="keyword">fun</span> <span class="title">onLaunchSingleTop</span><span class="params">(backStackEntry: <span class="type">NavBackStackEntry</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> destination = backStackEntry.destination <span class="keyword">as</span>? D ?: <span class="keyword">return</span></span><br><span class="line">    navigate(destination, <span class="literal">null</span>, navOptions &#123; launchSingleTop = <span class="literal">true</span> &#125;, <span class="literal">null</span>) <span class="comment">// è¿™ä¸ªnavigateæ‰§è¡ŒçœŸæ­£çš„å¯¼èˆªæ“ä½œï¼Œè€æ¼”å‘˜äº†ï¼Œä¸Šé¢è§è¿‡å°±ä¸è¯´äº†</span></span><br><span class="line">    state.onLaunchSingleTop(backStackEntry) <span class="comment">// è¿™ä¸ªstateåœ¨å‰é¢ä¹Ÿä»‹ç»è¿‡ï¼Œä¸‹é¢çœ‹çœ‹ä»–çš„onLaunchSingleTopæ–¹æ³•å¹²äº†ä»€ä¹ˆ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">open</span> <span class="function"><span class="keyword">fun</span> <span class="title">onLaunchSingleTop</span><span class="params">(backStackEntry: <span class="type">NavBackStackEntry</span>)</span></span> &#123;</span><br><span class="line">    <span class="comment">// We update the back stack here because we don&#x27;t want to leave it to the navigator since</span></span><br><span class="line">    <span class="comment">// it might be using transitions.</span></span><br><span class="line">    backStackLock.withLock &#123;</span><br><span class="line">        <span class="keyword">val</span> tempStack = backStack.value.toMutableList()</span><br><span class="line">        tempStack.indexOfLast &#123; it.id == backStackEntry.id &#125;.let &#123; idx -&gt;</span><br><span class="line">            tempStack[idx] = backStackEntry</span><br><span class="line">        &#125;</span><br><span class="line">        _backStack.value = tempStack</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å…¶å®å°±æ˜¯æ›´æ–°å½“å‰çš„è¿”å›æ ˆ<br>æ‰¾åˆ°æœ€åä¸€ä¸ªidä¸backStackEntryçš„idç›¸ç­‰çš„indexï¼Œå°†è¿™ä¸ªä½ç½®çš„entryæ›¿æ¢ä¸ºbackStackEntry</p></blockquote><h4 id="å…¶ä»–æƒ…å†µ"><a href="#å…¶ä»–æƒ…å†µ" class="headerlink" title="å…¶ä»–æƒ…å†µ"></a>å…¶ä»–æƒ…å†µ</h4><p>åœ¨æ²¡æœ‰å¼€å¯LaunchSingleTopçš„æƒ…å†µï¼Œæˆ–launchSingleTopInternalæ²¡æœ‰æˆåŠŸçš„æƒ…å†µé‚£ï¼Œå°±ä¼šèµ°åˆ°è¿™ä¸ªä»£ç åˆ†æ”¯</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!launchSingleTop) &#123;</span><br><span class="line">    <span class="comment">// Not a single top operation, so we&#x27;re looking to add the node to the back stack</span></span><br><span class="line">    <span class="keyword">val</span> backStackEntry = NavBackStackEntry.create(</span><br><span class="line">        context, node, finalArgs, hostLifecycleState, viewModel</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">val</span> navigator = _navigatorProvider.getNavigator&lt;Navigator&lt;NavDestination&gt;&gt;(</span><br><span class="line">        node.navigatorName</span><br><span class="line">    )</span><br><span class="line">    navigator.navigateInternal(listOf(backStackEntry), navOptions, navigatorExtras) &#123;</span><br><span class="line">        navigated = <span class="literal">true</span></span><br><span class="line">        addEntryToBackStack(node, finalArgs, it)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ›å»ºæ–°çš„backStackEntryæ¡ç›®ï¼Œæ‰¾åˆ°å¯¹åº”çš„Navigatorï¼Œæ‰§è¡Œå¯¼èˆªæ“ä½œï¼Œå¦‚æœæˆåŠŸäº†ï¼Œå°±å°†å…¶åŠ å…¥åˆ°è¿”å›æ ˆä¸­</p><h2 id="NavigatorProvider"><a href="#NavigatorProvider" class="headerlink" title="NavigatorProvider"></a>NavigatorProvider</h2><h3 id="æ•°æ®ç»“æ„"><a href="#æ•°æ®ç»“æ„" class="headerlink" title="æ•°æ®ç»“æ„"></a>æ•°æ®ç»“æ„</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">val</span> _navigators: MutableMap&lt;String, Navigator&lt;<span class="keyword">out</span> NavDestination&gt;&gt; = mutableMapOf()</span><br><span class="line"><span class="meta">@get:RestrictTo</span>(RestrictTo.Scope.LIBRARY_GROUP)</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">val</span> navigators: Map&lt;String, Navigator&lt;<span class="keyword">out</span> NavDestination&gt;&gt;</span><br><span class="line">    <span class="keyword">get</span>() = _navigators.toMap()</span><br></pre></td></tr></table></figure><ul><li>ä»¥ä¸Šå°±æ˜¯<code>NavigatorProvider</code>çš„å…¨éƒ¨æ•°æ®ç»“æ„äº†ï¼Œå°±æ˜¯ä¸€ä¸ª<code>String to Navigator</code>çš„<code>Map</code></li><li>å›æƒ³<a href="#%E6%A0%B8%E5%BF%83%E7%9A%84navigate%E6%96%B9%E6%B3%95">æ ¸å¿ƒçš„navigateæ–¹æ³•</a>ä¸­å¤šæ¬¡ä½¿ç”¨<code>NavDestination#navigatorName</code>ä»<code>NavigatorProvider</code>ä¸­è·å–<code>Navigator</code>ï¼Œæ‰€ä»¥<code>NavigatorProvider</code>çš„å°±æ˜¯ä¸€ä¸ªç”¨æ¥ä¿å­˜<code>navigatorName</code>åˆ°<code>Navigator</code>å®ä¾‹çš„<code>Map</code></li></ul><h3 id="è·å–Navigator"><a href="#è·å–Navigator" class="headerlink" title="è·å–Navigator"></a>è·å–Navigator</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;T : Navigator&lt;*&gt;</span>&gt; <span class="title">getNavigator</span><span class="params">(navigatorClass: <span class="type">Class</span>&lt;<span class="type">T</span>&gt;)</span></span>: T &#123;</span><br><span class="line">    <span class="keyword">val</span> name = getNameForNavigator(navigatorClass)</span><br><span class="line">    <span class="keyword">return</span> getNavigator(name)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* Retrieves a registered [Navigator] by name.</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> name name of the navigator to return</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span> the registered navigator with the given name</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* <span class="doctag">@throws</span> IllegalStateException if the Navigator has not been added</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* <span class="doctag">@see</span> NavigatorProvider.addNavigator</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Suppress(<span class="string">&quot;UNCHECKED_CAST&quot;</span>)</span></span><br><span class="line"><span class="meta">@CallSuper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">open</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;T : Navigator&lt;*&gt;</span>&gt; <span class="title">getNavigator</span><span class="params">(name: <span class="type">String</span>)</span></span>: T &#123;</span><br><span class="line">    require(validateName(name)) &#123; <span class="string">&quot;navigator name cannot be an empty string&quot;</span> &#125;</span><br><span class="line">    <span class="keyword">val</span> navigator = _navigators[name]</span><br><span class="line">        ?: <span class="keyword">throw</span> IllegalStateException(</span><br><span class="line">            <span class="string">&quot;Could not find Navigator with name \&quot;<span class="variable">$name</span>\&quot;. You must call &quot;</span> +</span><br><span class="line">                <span class="string">&quot;NavController.addNavigator() for each navigation type.&quot;</span></span><br><span class="line">        )</span><br><span class="line">    <span class="keyword">return</span> navigator <span class="keyword">as</span> T</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="getNameForNavigator"><a href="#getNameForNavigator" class="headerlink" title="getNameForNavigator"></a>getNameForNavigator</h4><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">internal</span> <span class="keyword">companion</span> <span class="keyword">object</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> annotationNames = mutableMapOf&lt;Class&lt;*&gt;, String?&gt;()</span><br><span class="line">    <span class="keyword">internal</span> <span class="function"><span class="keyword">fun</span> <span class="title">validateName</span><span class="params">(name: <span class="type">String</span>?)</span></span>: <span class="built_in">Boolean</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name != <span class="literal">null</span> &amp;&amp; name.isNotEmpty()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JvmStatic</span></span><br><span class="line">    <span class="keyword">internal</span> <span class="function"><span class="keyword">fun</span> <span class="title">getNameForNavigator</span><span class="params">(navigatorClass: <span class="type">Class</span>&lt;<span class="type">out</span> <span class="type">Navigator</span>&lt;*&gt;&gt;)</span></span>: String &#123;</span><br><span class="line">        <span class="keyword">var</span> name = annotationNames[navigatorClass]</span><br><span class="line">        <span class="keyword">if</span> (name == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">val</span> <span class="keyword">annotation</span> = navigatorClass.getAnnotation(</span><br><span class="line">                Navigator.Name::<span class="keyword">class</span>.java</span><br><span class="line">            )</span><br><span class="line">            name = <span class="keyword">annotation</span>?.value</span><br><span class="line">            require(validateName(name)) &#123;</span><br><span class="line">                <span class="string">&quot;No @Navigator.Name annotation found for <span class="subst">$&#123;navigatorClass.simpleName&#125;</span>&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">            annotationNames[navigatorClass] = name</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> name!!</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å‘ç°è·å–çš„nameæ˜¯ä¸€ä¸ªè¿è¡Œæ—¶æ³¨è§£ï¼Œæ‰€ä»¥éœ€è¦å…ˆçœ‹çœ‹<code>Navigator.Name</code>è¿™ä¸ªæ³¨è§£</li><li><code>Navigator.Name</code>æ˜¯<code>Navigator</code>ä¸­çš„ä¸€ä¸ªè¿è¡Œæ—¶æ³¨è§£<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@kotlin</span>.<span class="keyword">annotation</span>.Retention(AnnotationRetention.RUNTIME)</span><br><span class="line"><span class="meta">@Target(AnnotationTarget.ANNOTATION_CLASS, AnnotationTarget.CLASS)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">annotation</span> <span class="keyword">class</span> <span class="title class_">Name</span>(<span class="keyword">val</span> value: String)</span><br></pre></td></tr></table></figure></li><li>æˆ‘ä»¬è§‚å¯Ÿå‡ ä¸ª<code>Navigator</code>ï¼Œå‘ç°ä»–ä»¬éƒ½æœ‰<code>@Navigator.Name</code>æ³¨è§£ï¼Œå¹¶ä¼ å…¥äº†å¯¹åº”çš„å‚æ•°<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. FragmentNavigator</span></span><br><span class="line"><span class="meta">@Navigator</span>.Name(<span class="string">&quot;fragment&quot;</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">open</span> <span class="keyword">class</span> <span class="title class_">FragmentNavigator</span>(</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> context: Context,</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> fragmentManager: FragmentManager,</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> containerId: <span class="built_in">Int</span></span><br><span class="line">) : Navigator&lt;Destination&gt;() &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. ActivityNavigator</span></span><br><span class="line"><span class="meta">@Navigator</span>.Name(<span class="string">&quot;activity&quot;</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">open</span> <span class="keyword">class</span> <span class="title class_">ActivityNavigator</span>(</span><br><span class="line">    <span class="comment">/** <span class="doctag">@suppress</span> */</span></span><br><span class="line">    <span class="meta">@get:RestrictTo</span>(RestrictTo.Scope.LIBRARY_GROUP)</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">val</span> context: Context</span><br><span class="line">) : Navigator&lt;ActivityNavigator.Destination&gt;() &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. NavGraphNavigator</span></span><br><span class="line"><span class="meta">@Navigator</span>.Name(<span class="string">&quot;navigation&quot;</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">open</span> <span class="keyword">class</span> <span class="title class_">NavGraphNavigator</span>(</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> navigatorProvider: NavigatorProvider</span><br><span class="line">) : Navigator&lt;NavGraph&gt;() &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>è¿™æ ·å°±å¯ä»¥æ˜ç¡®äº†ï¼Œ<code>Navigator</code>çš„<code>name</code>å°±æ˜¯æ³¨è§£æ—¶çš„<code>value</code></li><li><code>FragmentNavigator</code>çš„<code>name</code>æ˜¯<code>&quot;fragment&quot;</code></li><li><code>ActivityNavigator</code>çš„<code>name</code>æ˜¯<code>&quot;activity&quot;</code></li><li>â€¦</li></ul><h3 id="addNavigator"><a href="#addNavigator" class="headerlink" title="addNavigator"></a>addNavigator</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">fun</span> <span class="title">addNavigator</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    navigator: <span class="type">Navigator</span>&lt;<span class="type">out</span> <span class="type">NavDestination</span>&gt;</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>: Navigator&lt;<span class="keyword">out</span> NavDestination&gt;? &#123;</span><br><span class="line">    <span class="keyword">return</span> addNavigator(getNameForNavigator(navigator.javaClass), navigator)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* Register a navigator by name. [destinations][NavDestination] may refer to any</span></span><br><span class="line"><span class="comment">* registered navigator by name for inflation. If a navigator by this name is already</span></span><br><span class="line"><span class="comment">* registered, this new navigator will replace it.</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> name name for this navigator</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> navigator navigator to add</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span> the previously added Navigator for the given name, if any</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@CallSuper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">open</span> <span class="function"><span class="keyword">fun</span> <span class="title">addNavigator</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    name: <span class="type">String</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    navigator: <span class="type">Navigator</span>&lt;<span class="type">out</span> <span class="type">NavDestination</span>&gt;</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>: Navigator&lt;<span class="keyword">out</span> NavDestination&gt;? &#123;</span><br><span class="line">    require(validateName(name)) &#123; <span class="string">&quot;navigator name cannot be an empty string&quot;</span> &#125;</span><br><span class="line">    <span class="keyword">val</span> previousNavigator = _navigators[name]</span><br><span class="line">    <span class="keyword">if</span> (previousNavigator == navigator) &#123;</span><br><span class="line">        <span class="keyword">return</span> navigator</span><br><span class="line">    &#125;</span><br><span class="line">    check(previousNavigator?.isAttached != <span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="string">&quot;Navigator <span class="variable">$navigator</span> is replacing an already attached <span class="variable">$previousNavigator</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    check(!navigator.isAttached) &#123;</span><br><span class="line">        <span class="string">&quot;Navigator <span class="variable">$navigator</span> is already attached to another NavController&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _navigators.put(name, navigator)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>addNavigator</code>æ—¶ï¼Œé¦–å…ˆå–å‡ºå¯¹åº”<code>name</code>çš„<code>Navigator</code><ul><li>å¦‚æœ<code>Navigator</code>å’Œè¦æ”¾å…¥çš„<code>Navigator</code>ç›¸åŒï¼Œåˆ™ç›´æ¥è¿”å›</li><li>å¦‚æœå‰ä¸€ä¸ª<code>Navigator</code>ä¸ç©ºä¸”æ²¡æœ‰è¢«<code>attach</code>ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸<ul><li>è¿™é‡Œåˆ¤æ–­æ–¹æ³•ä¸º<code>previousNavigator?.isAttached != true</code>, <code>null</code>æˆ–è€…<code>bool</code>å’Œ<code>true</code>æ¯”è¾ƒï¼Œååˆ†ç®€æ´ï¼Œå€¼å¾—å­¦ä¹ ï¼</li></ul></li><li>æ£€æŸ¥ç¡®è®¤è¦æ”¾å…¥çš„<code>Navigator</code>æ²¡æœ‰è¢«<code>attach</code>ï¼Œå¦åˆ™æŠ›å‡ºå¼‚å¸¸</li><li>æœ€åå°†<code>Navigator</code>æ”¾å…¥<code>_navigators</code>ä¸­ï¼Œå¹¶è¿”å›å‰ä¸€ä¸ª<code>Navigator</code></li></ul></li><li>è¢«æ›¿æ¢çš„<code>Navigator</code>å¦‚æœä¸ç©ºçš„è¯ï¼Œä¸èƒ½æ˜¯å·²ç»Attachçš„</li><li>æƒ³è¦æ”¾å…¥çš„<code>Navigator</code>ä¹Ÿä¸èƒ½è¢«<code>attach</code></li></ul><h3 id="æ‰©å±•getå’Œsetæ–¹æ³•"><a href="#æ‰©å±•getå’Œsetæ–¹æ³•" class="headerlink" title="æ‰©å±•getå’Œsetæ–¹æ³•"></a>æ‰©å±•getå’Œsetæ–¹æ³•</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Suppress(<span class="string">&quot;NOTHING_TO_INLINE&quot;</span>)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">inline</span> <span class="keyword">operator</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;T : Navigator&lt;out NavDestination&gt;</span>&gt; NavigatorProvider.<span class="title">get</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    name: <span class="type">String</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>: T = getNavigator(name)</span><br><span class="line"></span><br><span class="line"><span class="meta">@Suppress(<span class="string">&quot;NOTHING_TO_INLINE&quot;</span>)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">inline</span> <span class="keyword">operator</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;T : Navigator&lt;out NavDestination&gt;</span>&gt; NavigatorProvider.<span class="title">get</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    clazz: <span class="type">KClass</span>&lt;<span class="type">T</span>&gt;</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>: T = getNavigator(clazz.java)</span><br><span class="line"></span><br><span class="line"><span class="meta">@Suppress(<span class="string">&quot;NOTHING_TO_INLINE&quot;</span>)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">inline</span> <span class="keyword">operator</span> <span class="function"><span class="keyword">fun</span> NavigatorProvider.<span class="title">set</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    name: <span class="type">String</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    navigator: <span class="type">Navigator</span>&lt;<span class="type">out</span> <span class="type">NavDestination</span>&gt;</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>: Navigator&lt;<span class="keyword">out</span> NavDestination&gt;? = addNavigator(name, navigator)</span><br></pre></td></tr></table></figure><p>å¾ˆç®€å•</p><h3 id="æ‰©å±•çš„-è¿ç®—ç¬¦"><a href="#æ‰©å±•çš„-è¿ç®—ç¬¦" class="headerlink" title="æ‰©å±•çš„+=è¿ç®—ç¬¦"></a>æ‰©å±•çš„<code>+=</code>è¿ç®—ç¬¦</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Suppress(<span class="string">&quot;NOTHING_TO_INLINE&quot;</span>)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">inline</span> <span class="keyword">operator</span> <span class="function"><span class="keyword">fun</span> NavigatorProvider.<span class="title">plusAssign</span><span class="params">(navigator: <span class="type">Navigator</span>&lt;<span class="type">out</span> <span class="type">NavDestination</span>&gt;)</span></span> &#123;</span><br><span class="line">    addNavigator(navigator)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¾ˆç®€å•</p><h2 id="NavBackStackEntry"><a href="#NavBackStackEntry" class="headerlink" title="NavBackStackEntry"></a>NavBackStackEntry</h2><h3 id="å…ˆçœ‹æ³¨é‡Š"><a href="#å…ˆçœ‹æ³¨é‡Š" class="headerlink" title="å…ˆçœ‹æ³¨é‡Š"></a>å…ˆçœ‹æ³¨é‡Š</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Representation of an entry <span class="keyword">in</span> the back stack of a androidx.navigation.NavController.</span><br><span class="line">The Lifecycle, ViewModelStore, and SavedStateRegistry provided via <span class="keyword">this</span> <span class="keyword">object</span> are valid <span class="keyword">for</span> the lifetime of <span class="keyword">this</span> destination on the back stack: <span class="keyword">when</span> <span class="keyword">this</span> destination <span class="keyword">is</span> popped off the back stack, the lifecycle will be destroyed, state will no longer be saved, and ViewModels will be cleared.</span><br></pre></td></tr></table></figure><ul><li>ä»‹ç»äº†ä¸¤ä»¶äº‹æƒ…<ul><li>è¿™ä¸ªç±»ä»£è¡¨çš„æ˜¯<code>NavController</code>ä¸­è¿”å›æ ˆçš„ä¸€ä¸ª<code>entry</code></li><li>ä»–èƒ½æä¾›<code>Lifecycle, ViewModelStore, and SavedStateRegistry</code><ul><li>å½“è¿™ä¸ª<code>NavBackStackEntry</code>å­˜åœ¨äºè¿”å›æ ˆæ—¶ï¼Œä»–ä»¬çš„ç”Ÿå‘½å‘¨æœŸæ—¶æœ‰æ•ˆçš„ï¼Œå½“è¿™ä¸ª<code>NavBackStackEntry</code>è¢«popæ‰æ—¶ï¼Œä»–ä»¬çš„ç”Ÿå‘½å‘¨æœŸä¼šè¢«é”€æ¯ï¼ŒçŠ¶æ€ä¼šè¢«æ¸…é™¤ï¼ŒViewModelä¼šè¢«æ¸…é™¤</li></ul></li></ul></li></ul><h3 id="ç±»å®šä¹‰å’Œæ•°æ®ç»“æ„"><a href="#ç±»å®šä¹‰å’Œæ•°æ®ç»“æ„" class="headerlink" title="ç±»å®šä¹‰å’Œæ•°æ®ç»“æ„"></a>ç±»å®šä¹‰å’Œæ•°æ®ç»“æ„</h3><h4 id="lifeCycleéƒ¨åˆ†"><a href="#lifeCycleéƒ¨åˆ†" class="headerlink" title="lifeCycleéƒ¨åˆ†"></a>lifeCycleéƒ¨åˆ†</h4><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NavBackStackEntry</span> <span class="keyword">private</span> <span class="keyword">constructor</span>(</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> context: Context?,</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The destination associated with this entry</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> The destination that is currently visible to users</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@set:RestrictTo</span>(RestrictTo.Scope.LIBRARY_GROUP)</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> destination: NavDestination,</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> immutableArgs: Bundle? = <span class="literal">null</span>,</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> hostLifecycleState: Lifecycle.State = Lifecycle.State.CREATED,</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> viewModelStoreProvider: NavViewModelStoreProvider? = <span class="literal">null</span>,</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The unique ID that serves as the identity of this entry</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the unique ID of this entry</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">val</span> id: String = UUID.randomUUID().toString(),</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> savedState: Bundle? = <span class="literal">null</span></span><br><span class="line">) : LifecycleOwner,</span><br><span class="line">    ViewModelStoreOwner,</span><br><span class="line">    HasDefaultViewModelProviderFactory,</span><br><span class="line">    SavedStateRegistryOwner &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> _lifecycle = LifecycleRegistry(<span class="keyword">this</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">val</span> lifecycle: Lifecycle</span><br><span class="line">        <span class="keyword">get</span>() = _lifecycle</span><br><span class="line"></span><br><span class="line">    <span class="meta">@get:RestrictTo</span>(RestrictTo.Scope.LIBRARY_GROUP)</span><br><span class="line">    <span class="meta">@set:RestrictTo</span>(RestrictTo.Scope.LIBRARY_GROUP)</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> maxLifecycle: Lifecycle.State = Lifecycle.State.INITIALIZED</span><br><span class="line">        <span class="keyword">set</span>(maxState) &#123;</span><br><span class="line">            field = maxState</span><br><span class="line">            updateState()</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å¾ˆç®€å•å®ç°äº†<code>lifeCycle</code></li><li><code>maxLifecycle</code>æ˜¯<code>Lifecycle.State</code>ï¼Œä¿å­˜å½“å‰çš„çŠ¶æ€ï¼Œé»˜è®¤æ˜¯<code>Lifecycle.State.INITIALIZED</code></li><li>è°ƒç”¨<code>maxLifecycle</code>çš„<code>set</code>å±æ€§æ—¶ï¼Œä¼šè°ƒç”¨<code>updateState</code>æ–¹æ³•<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestrictTo(RestrictTo.Scope.LIBRARY_GROUP)</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">fun</span> <span class="title">updateState</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!savedStateRegistryAttached) &#123;</span><br><span class="line">        savedStateRegistryController.performAttach()</span><br><span class="line">        savedStateRegistryAttached = <span class="literal">true</span></span><br><span class="line">        <span class="keyword">if</span> (viewModelStoreProvider != <span class="literal">null</span>) &#123;</span><br><span class="line">            enableSavedStateHandles()</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// Perform the restore just once, the first time updateState() is called</span></span><br><span class="line">        <span class="comment">// and specifically *before* we move up the Lifecycle</span></span><br><span class="line">        savedStateRegistryController.performRestore(savedState)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (hostLifecycleState.ordinal &lt; maxLifecycle.ordinal) &#123;</span><br><span class="line">        _lifecycle.currentState = hostLifecycleState</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        _lifecycle.currentState = maxLifecycle</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>é¦–å…ˆåˆ¤æ–­<code>savedStateRegistry</code>æ˜¯å¦è¢«<code>attach</code>, å¦‚æœæ²¡æœ‰ï¼Œå°±æ‰§è¡Œ<code>attach</code>,å¹¶å›å¤çŠ¶æ€</li><li>ç„¶åå°±æ˜¯æ›´æ–°<code>lifeCycle</code>çš„çŠ¶æ€ï¼Œå–<code>hostLifecycleState</code>å’Œ<code>maxLifecycle</code>ä¹‹ä¸­è¾ƒå°çš„é‚£ä¸€ä¸ª</li></ul><p>è¿™é‡Œçœ‹åˆ°ä¸€ä¸ª<code>ordinal</code>ä¸å¤ªç†Ÿæ‚‰ï¼Œè¿™ä¸ªå±äº<code>java</code>åŸºç¡€</p><blockquote><p>ç»§ç»­æŒ–å‘<br>&#x2F;&#x2F; todo: enum, ordinal</p></blockquote><h4 id="ViewModeléƒ¨åˆ†"><a href="#ViewModeléƒ¨åˆ†" class="headerlink" title="ViewModeléƒ¨åˆ†"></a>ViewModeléƒ¨åˆ†</h4><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NavBackStackEntry</span> <span class="keyword">private</span> <span class="keyword">constructor</span>(</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> context: Context?,</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The destination associated with this entry</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> The destination that is currently visible to users</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@set:RestrictTo</span>(RestrictTo.Scope.LIBRARY_GROUP)</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> destination: NavDestination,</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> immutableArgs: Bundle? = <span class="literal">null</span>,</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> hostLifecycleState: Lifecycle.State = Lifecycle.State.CREATED,</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> viewModelStoreProvider: NavViewModelStoreProvider? = <span class="literal">null</span>,</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The unique ID that serves as the identity of this entry</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the unique ID of this entry</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">val</span> id: String = UUID.randomUUID().toString(),</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> savedState: Bundle? = <span class="literal">null</span></span><br><span class="line">) : LifecycleOwner,</span><br><span class="line">    ViewModelStoreOwner,</span><br><span class="line">    HasDefaultViewModelProviderFactory,</span><br><span class="line">    SavedStateRegistryOwner &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> defaultFactory <span class="keyword">by</span> lazy &#123;</span><br><span class="line">        SavedStateViewModelFactory((context?.applicationContext <span class="keyword">as</span>? Application), <span class="keyword">this</span>, arguments)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The [SavedStateHandle] for this entry.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">val</span> savedStateHandle: SavedStateHandle <span class="keyword">by</span> lazy &#123;</span><br><span class="line">        check(savedStateRegistryAttached) &#123;</span><br><span class="line">            <span class="string">&quot;You cannot access the NavBackStackEntry&#x27;s SavedStateHandle until it is added to &quot;</span> +</span><br><span class="line">                <span class="string">&quot;the NavController&#x27;s back stack (i.e., the Lifecycle of the NavBackStackEntry &quot;</span> +</span><br><span class="line">                <span class="string">&quot;reaches the CREATED state).&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        check(lifecycle.currentState != Lifecycle.State.DESTROYED) &#123;</span><br><span class="line">            <span class="string">&quot;You cannot access the NavBackStackEntry&#x27;s SavedStateHandle after the &quot;</span> +</span><br><span class="line">                <span class="string">&quot;NavBackStackEntry is destroyed.&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        ViewModelProvider(</span><br><span class="line">            <span class="keyword">this</span>, NavResultSavedStateFactory(<span class="keyword">this</span>)</span><br><span class="line">        ).<span class="keyword">get</span>(SavedStateViewModel::<span class="keyword">class</span>.java).handle</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">val</span> defaultViewModelProviderFactory: ViewModelProvider.Factory = defaultFactory</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">val</span> defaultViewModelCreationExtras: CreationExtras</span><br><span class="line">        <span class="keyword">get</span>() &#123;</span><br><span class="line">            <span class="keyword">val</span> extras = MutableCreationExtras()</span><br><span class="line">            (context?.applicationContext <span class="keyword">as</span>? Application)?.let &#123; application -&gt;</span><br><span class="line">                extras[ViewModelProvider.AndroidViewModelFactory.APPLICATION_KEY] = application</span><br><span class="line">            &#125;</span><br><span class="line">            extras[SAVED_STATE_REGISTRY_OWNER_KEY] = <span class="keyword">this</span></span><br><span class="line">            extras[VIEW_MODEL_STORE_OWNER_KEY] = <span class="keyword">this</span></span><br><span class="line">            arguments?.let &#123; args -&gt;</span><br><span class="line">                extras[DEFAULT_ARGS_KEY] = args</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> extras</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">val</span> savedStateRegistry: SavedStateRegistry</span><br><span class="line">        <span class="keyword">get</span>() = savedStateRegistryController.savedStateRegistry</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">NavResultSavedStateFactory</span>(</span><br><span class="line">        owner: SavedStateRegistryOwner</span><br><span class="line">    ) : AbstractSavedStateViewModelFactory(owner, <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="meta">@Suppress(<span class="string">&quot;UNCHECKED_CAST&quot;</span>)</span></span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;T : ViewModel&gt;</span> <span class="title">create</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">            key: <span class="type">String</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">            modelClass: <span class="type">Class</span>&lt;<span class="type">T</span>&gt;,</span></span></span><br><span class="line"><span class="params"><span class="function">            handle: <span class="type">SavedStateHandle</span></span></span></span><br><span class="line"><span class="params"><span class="function">        )</span></span>: T &#123;</span><br><span class="line">            <span class="keyword">return</span> SavedStateViewModel(handle) <span class="keyword">as</span> T</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">SavedStateViewModel</span>(<span class="keyword">val</span> handle: SavedStateHandle) : ViewModel()</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>è¿™é‡Œä¿ç•™äº†<code>savedStateHandle</code>ï¼Œå’Œ<code>viewModel</code>æœ‰ä¸€å®šçš„è€¦åˆ</li><li>æˆ‘ä»¬ä½¿ç”¨çš„<code>viewModel</code>å°±å­˜äº†ä¸€ä¸ª<code>SavedStateHandle</code></li><li>æä¾›äº†é»˜è®¤çš„<code>ViewModelProvider.Factory</code>å’Œ<code>Extras</code></li><li>åŸºæœ¬éƒ½æ˜¯å’Œ<code>savedState</code>ç›¸å…³çš„ï¼Œæ‰€ä»¥å…ˆä¸çœ‹äº†</li><li><code>viewModel</code>çš„ä½œç”¨<ul><li>æä¾›<code>handle</code></li><li>æä¾›<code>viewModelStore</code>(å°±æ˜¯<code>viewModelName</code>åˆ°<code>viewModel</code>çš„<code>map</code>)</li></ul></li><li>&#x2F;&#x2F; todo: å­¦ä¹ saveStateåå†çœ‹</li><li>&#x2F;&#x2F; ç–‘é—®ï¼Œä¸ºå•¥éè¦é€šè¿‡<code>viewModel</code>æ¥è·å–<code>handle</code>å‘¢ï¼Ÿ</li></ul><h4 id="savedStateéƒ¨åˆ†"><a href="#savedStateéƒ¨åˆ†" class="headerlink" title="savedStateéƒ¨åˆ†"></a>savedStateéƒ¨åˆ†</h4><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NavBackStackEntry</span> <span class="keyword">private</span> <span class="keyword">constructor</span>(</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> context: Context?,</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The destination associated with this entry</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> The destination that is currently visible to users</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@set:RestrictTo</span>(RestrictTo.Scope.LIBRARY_GROUP)</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> destination: NavDestination,</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> immutableArgs: Bundle? = <span class="literal">null</span>,</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> hostLifecycleState: Lifecycle.State = Lifecycle.State.CREATED,</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> viewModelStoreProvider: NavViewModelStoreProvider? = <span class="literal">null</span>,</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The unique ID that serves as the identity of this entry</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the unique ID of this entry</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">val</span> id: String = UUID.randomUUID().toString(),</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> savedState: Bundle? = <span class="literal">null</span></span><br><span class="line">) : LifecycleOwner,</span><br><span class="line">    ViewModelStoreOwner,</span><br><span class="line">    HasDefaultViewModelProviderFactory,</span><br><span class="line">    SavedStateRegistryOwner &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> savedStateRegistryController = SavedStateRegistryController.create(<span class="keyword">this</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> savedStateRegistryAttached = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The [SavedStateHandle] for this entry.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">val</span> savedStateHandle: SavedStateHandle <span class="keyword">by</span> lazy &#123;</span><br><span class="line">        check(savedStateRegistryAttached) &#123;</span><br><span class="line">            <span class="string">&quot;You cannot access the NavBackStackEntry&#x27;s SavedStateHandle until it is added to &quot;</span> +</span><br><span class="line">                <span class="string">&quot;the NavController&#x27;s back stack (i.e., the Lifecycle of the NavBackStackEntry &quot;</span> +</span><br><span class="line">                <span class="string">&quot;reaches the CREATED state).&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        check(lifecycle.currentState != Lifecycle.State.DESTROYED) &#123;</span><br><span class="line">            <span class="string">&quot;You cannot access the NavBackStackEntry&#x27;s SavedStateHandle after the &quot;</span> +</span><br><span class="line">                <span class="string">&quot;NavBackStackEntry is destroyed.&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        ViewModelProvider(</span><br><span class="line">            <span class="keyword">this</span>, NavResultSavedStateFactory(<span class="keyword">this</span>)</span><br><span class="line">        ).<span class="keyword">get</span>(SavedStateViewModel::<span class="keyword">class</span>.java).handle</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">val</span> savedStateRegistry: SavedStateRegistry</span><br><span class="line">        <span class="keyword">get</span>() = savedStateRegistryController.savedStateRegistry</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>&#x2F;&#x2F; todo: å­¦ä¹ saveStateåå†çœ‹</li></ul><h4 id="å…¶ä»–éƒ¨åˆ†"><a href="#å…¶ä»–éƒ¨åˆ†" class="headerlink" title="å…¶ä»–éƒ¨åˆ†"></a>å…¶ä»–éƒ¨åˆ†</h4><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NavBackStackEntry</span> <span class="keyword">private</span> <span class="keyword">constructor</span>(</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> context: Context?,</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The destination associated with this entry</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> The destination that is currently visible to users</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@set:RestrictTo</span>(RestrictTo.Scope.LIBRARY_GROUP)</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> destination: NavDestination,</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> immutableArgs: Bundle? = <span class="literal">null</span>,</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> hostLifecycleState: Lifecycle.State = Lifecycle.State.CREATED,</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> viewModelStoreProvider: NavViewModelStoreProvider? = <span class="literal">null</span>,</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The unique ID that serves as the identity of this entry</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the unique ID of this entry</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">val</span> id: String = UUID.randomUUID().toString(),</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> savedState: Bundle? = <span class="literal">null</span></span><br><span class="line">) : LifecycleOwner,</span><br><span class="line">    ViewModelStoreOwner,</span><br><span class="line">    HasDefaultViewModelProviderFactory,</span><br><span class="line">    SavedStateRegistryOwner &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">val</span> arguments: Bundle?</span><br><span class="line">        <span class="keyword">get</span>() = <span class="keyword">if</span> (immutableArgs == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="literal">null</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            Bundle(immutableArgs)</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>id: publicçš„ä¸€ä¸ªéšæœºuniqueçš„idï¼Œåº”è¯¥æ˜¯ç”¨äºæ ‡è¯†ä¸€ä¸ª<code>NavBackStackEntry</code></li><li>arguments: åœ¨å‰é¢çš„<code>defaultViewModelCreationExtras</code>å’Œ<code>defaultFactory</code>ä¸­æœ‰ä½¿ç”¨ï¼Œå°†argsæä¾›ç»™<code>extras</code>å’Œ<code>factory</code></li></ul><h4 id="æ„é€ å‡½æ•°"><a href="#æ„é€ å‡½æ•°" class="headerlink" title="æ„é€ å‡½æ•°"></a>æ„é€ å‡½æ•°</h4><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestrictTo(RestrictTo.Scope.LIBRARY_GROUP)</span></span><br><span class="line"><span class="keyword">constructor</span>(entry: NavBackStackEntry, arguments: Bundle? = entry.arguments) : <span class="keyword">this</span>(</span><br><span class="line">    entry.context,</span><br><span class="line">    entry.destination,</span><br><span class="line">    arguments,</span><br><span class="line">    entry.hostLifecycleState,</span><br><span class="line">    entry.viewModelStoreProvider,</span><br><span class="line">    entry.id,</span><br><span class="line">    entry.savedState</span><br><span class="line">) &#123;</span><br><span class="line">    hostLifecycleState = entry.hostLifecycleState</span><br><span class="line">    maxLifecycle = entry.maxLifecycle</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¹å¤–æš´éœ²çš„æ„é€ å‡½æ•°ä»…è¿™ä¸€ä¸ªï¼Œé™¤äº†<code>arguments</code>å…¶ä»–éƒ½æ˜¯ä»å¦ä¸€ä¸ª<code>NavBackStackEntry</code>ä¸­è·å–çš„</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">companion</span> <span class="keyword">object</span> &#123;</span><br><span class="line">    <span class="meta">@RestrictTo(RestrictTo.Scope.LIBRARY_GROUP)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">fun</span> <span class="title">create</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">        context: <span class="type">Context</span>?,</span></span></span><br><span class="line"><span class="params"><span class="function">        destination: <span class="type">NavDestination</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        arguments: <span class="type">Bundle</span>? = <span class="literal">null</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        hostLifecycleState: <span class="type">Lifecycle</span>.<span class="type">State</span> = Lifecycle.State.CREATED,</span></span></span><br><span class="line"><span class="params"><span class="function">        viewModelStoreProvider: <span class="type">NavViewModelStoreProvider</span>? = <span class="literal">null</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        id: <span class="type">String</span> = UUID.randomUUID()</span></span>.toString(),</span><br><span class="line">        savedState: Bundle? = <span class="literal">null</span></span><br><span class="line">    ): NavBackStackEntry = NavBackStackEntry(</span><br><span class="line">        context, destination, arguments,</span><br><span class="line">        hostLifecycleState, viewModelStoreProvider, id, savedState</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡createæ–¹æ³•æš´éœ²äº†å¦å¤–ä¸€ä¸ªç§æœ‰çš„æ„é€ å‡½æ•°ï¼ŒçŒœæµ‹è¿™ä¹ˆåšçš„ç›®çš„æ˜¯ä¸ºäº†é™åˆ¶è¯¥æ„é€ å‡½æ•°ä»…åœ¨<code>navigation</code>åº“çš„èŒƒå›´å†…ä½¿ç”¨å§ï¼Ÿ</p><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><ul><li>æ€»çš„æ¥è¯´ï¼Œè¿™ä¸ªç±»ä½œä¸º<code>NavController</code>è¿”å›æ ˆçš„ä¸€ä¸ª<code>entry</code>ï¼ŒåŒæ—¶æä¾›äº†ä¸€äº›å˜é‡<ul><li>destination</li><li>id</li><li>arguments</li><li>savedStateHandle</li><li>maxLifecycle</li><li>viewModelStore</li></ul></li></ul><h2 id="NavDestination"><a href="#NavDestination" class="headerlink" title="NavDestination"></a>NavDestination</h2><h3 id="å…ˆçœ‹æ³¨é‡Š-1"><a href="#å…ˆçœ‹æ³¨é‡Š-1" class="headerlink" title="å…ˆçœ‹æ³¨é‡Š"></a>å…ˆçœ‹æ³¨é‡Š</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">NavDestination represents one node within an overall navigation graph.</span><br><span class="line">Each destination <span class="keyword">is</span> associated with a Navigator which knows how to navigate to <span class="keyword">this</span> particular destination.</span><br><span class="line">Destinations declare a <span class="keyword">set</span> of actions that they support. These actions form a navigation API <span class="keyword">for</span> the destination; the same actions declared on different destinations that fill similar roles allow application code to navigate based on semantic intent.</span><br><span class="line">Each destination has a <span class="keyword">set</span> of arguments that will be applied <span class="keyword">when</span> navigating to that destination. Any default values <span class="keyword">for</span> those arguments can be overridden at the time of navigation.</span><br><span class="line">NavDestinations should be created via Navigator.createDestination.</span><br></pre></td></tr></table></figure><ul><li><code>NavDestination</code>ä»£è¡¨ä¸€ä¸ªå¯¼èˆªå›¾ä¸­çš„ä¸€ä¸ªèŠ‚ç‚¹</li><li>æ¯ä¸ª<code>NavDestination</code>éƒ½å…³è”ä¸€ä¸ª<code>Navigator</code>ï¼Œ<code>Navigator</code>çŸ¥é“å¦‚ä½•å¯¼èˆªåˆ°è¿™ä¸ª<code>NavDestination</code></li><li>ä¿å­˜ä¸€ç»„<code>action</code><ul><li>ååŠå¥æœ‰ç‚¹éš¾æ‡‚ï¼Œä¸åŒ<code>destinations</code>ä¸­ç›¸åŒçš„<code>action</code>å‘æŒ¥ç›¸åŒçš„ä½œç”¨ï¼Œå¯ä»¥å…è®¸åº”ç”¨ä»£ç åŸºäºè¯­ä¹‰intentå¯¼èˆª</li></ul></li><li>æ¯ä¸ªdestinationéƒ½æœ‰ä¸€ç»„argsï¼Œåœ¨å¯¼èˆªåˆ°è¿™ä¸ªdestinationæ—¶å¯èƒ½ä¼šè¢«è¦†ç›–</li><li><code>NavDestinations</code>åº”è¯¥é€šè¿‡<code>Navigator.createDestination</code>åˆ›å»º</li></ul><h3 id="ç±»å®šä¹‰å’Œæ•°æ®ç»“æ„-1"><a href="#ç±»å®šä¹‰å’Œæ•°æ®ç»“æ„-1" class="headerlink" title="ç±»å®šä¹‰å’Œæ•°æ®ç»“æ„"></a>ç±»å®šä¹‰å’Œæ•°æ®ç»“æ„</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">open</span> <span class="keyword">class</span> <span class="title class_">NavDestination</span>(</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The name associated with this destination&#x27;s [Navigator].</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">val</span> navigatorName: String</span><br><span class="line">) &#123;</span><br><span class="line">    <span class="meta">@kotlin</span>.<span class="keyword">annotation</span>.Retention(AnnotationRetention.BINARY)</span><br><span class="line">    <span class="meta">@Target(AnnotationTarget.ANNOTATION_CLASS, AnnotationTarget.CLASS)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">annotation</span> <span class="keyword">class</span> <span class="title class_">ClassType</span>(<span class="keyword">val</span> value: KClass&lt;*&gt;) <span class="comment">// 1. æ³¨è§£</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> parent: NavGraph? = <span class="literal">null</span> <span class="comment">// 2. partent</span></span><br><span class="line">        <span class="comment">/** <span class="doctag">@suppress</span> */</span></span><br><span class="line">        <span class="meta">@RestrictTo(RestrictTo.Scope.LIBRARY_GROUP)</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">set</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> idName: String? = <span class="literal">null</span> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> label: CharSequence? = <span class="literal">null</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> deepLinks = mutableListOf&lt;NavDeepLink&gt;() <span class="comment">// 3. deepLinks</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> actions: SparseArrayCompat&lt;NavAction&gt; = SparseArrayCompat() <span class="comment">// 4. actions</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> _arguments: MutableMap&lt;String, NavArgument&gt; = mutableMapOf() <span class="comment">// 5. args</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">val</span> arguments: Map&lt;String, NavArgument&gt;</span><br><span class="line">        <span class="keyword">get</span>() = _arguments.toMap()</span><br><span class="line">    <span class="meta">@get:IdRes</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> id: <span class="built_in">Int</span> = <span class="number">0</span> <span class="comment">// 6. id</span></span><br><span class="line">        <span class="keyword">set</span>(<span class="meta">@IdRes</span> id) &#123;</span><br><span class="line">            field = id</span><br><span class="line">            idName = <span class="literal">null</span></span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> route: String? = <span class="literal">null</span> <span class="comment">// 7. route</span></span><br><span class="line">        <span class="keyword">set</span>(route) &#123;</span><br><span class="line">            <span class="keyword">if</span> (route == <span class="literal">null</span>) &#123;</span><br><span class="line">                id = <span class="number">0</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                require(route.isNotBlank()) &#123; <span class="string">&quot;Cannot have an empty route&quot;</span> &#125;</span><br><span class="line">                <span class="keyword">val</span> internalRoute = createRoute(route)</span><br><span class="line">                id = internalRoute.hashCode()</span><br><span class="line">                addDeepLink(internalRoute)</span><br><span class="line">            &#125;</span><br><span class="line">            deepLinks.remove(deepLinks.firstOrNull &#123; it.uriPattern == createRoute(field) &#125;)</span><br><span class="line">            field = route</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">open</span> <span class="keyword">val</span> displayName: String</span><br><span class="line">        <span class="meta">@RestrictTo(RestrictTo.Scope.LIBRARY_GROUP)</span></span><br><span class="line">        <span class="keyword">get</span>() = idName ?: id.toString()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">companion</span> <span class="keyword">object</span> &#123;</span><br><span class="line">        <span class="meta">@JvmStatic</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">val</span> NavDestination.hierarchy: Sequence&lt;NavDestination&gt; <span class="comment">// 8. hierarchy</span></span><br><span class="line">            <span class="keyword">get</span>() = generateSequence(<span class="keyword">this</span>) &#123; it.parent &#125;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br></pre></td></tr></table></figure><h4 id="1-æ³¨è§£"><a href="#1-æ³¨è§£" class="headerlink" title="1. æ³¨è§£"></a><code>1. æ³¨è§£</code></h4><p>åœ¨å­ç±»ä¸­ä½¿ç”¨ï¼Œåœ¨<code>XXXNavigator</code>ä¸­ä¼šæœ‰å†…éƒ¨ç±»<code>Destination</code>ç»§æ‰¿<code>NavDestination</code>ï¼Œå¹¶ä½¿ç”¨è¯¥æ³¨è§£æ ‡æ³¨å…¶å¯¼èˆªçš„<code>class</code></p><p>å¦‚ï¼Œåœ¨<code>FragmentNavigator</code>ä¸­</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@NavDestination</span>.ClassType(Fragment::<span class="keyword">class</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">open</span> <span class="keyword">class</span> <span class="title class_">Destination</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">constructor</span>(fragmentNavigator: Navigator&lt;<span class="keyword">out</span> Destination&gt;) :</span><br><span class="line">    NavDestination(fragmentNavigator) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æš‚æ—¶æ²¡æœ‰æ‰¾åˆ°è·å–å¹¶ä½¿ç”¨è¿™ä¸ªæ³¨è§£çš„ä»£ç </p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">This optional <span class="keyword">annotation</span> allows tooling to offer auto-complete <span class="keyword">for</span> the android:name attribute. This should match the <span class="keyword">class</span> <span class="title class_">type</span> <span class="title">passed</span> <span class="title">to</span> <span class="title">parseClassFromName</span> <span class="title">when</span> <span class="title">parsing</span> <span class="title">the</span> <span class="title">android</span>:<span class="type">name</span> <span class="title">attribute</span>.</span><br></pre></td></tr></table></figure><p>çœ‹èµ·æ¥æ˜¯xmlè‡ªåŠ¨è¡¥å…¨çš„æ—¶å€™ä¼šç”¨åˆ°</p><h4 id="2-parent"><a href="#2-parent" class="headerlink" title="2. parent"></a><code>2. parent</code></h4><p>parentæ˜¯<code>NavGraph</code>ï¼Œè¡¨ç¤ºå½“å‰<code>NavDestination</code>çš„çˆ¶èŠ‚ç‚¹ï¼ŒåŒæ—¶å‰§é€ä¸€ä¸‹, <code>NavGraph</code>æ˜¯<code>NavDestination</code>çš„å­ç±»</p><h4 id="8-hierarchy"><a href="#8-hierarchy" class="headerlink" title="8. hierarchy"></a><code>8. hierarchy</code></h4><p><code>hierarchy</code>æ˜¯ä¸€ä¸ªæ‰©å±•å±æ€§ï¼Œä»å½“å‰<code>NavDestination</code>å¼€å§‹ï¼Œç”Ÿæˆä¸€ä¸ªçˆ¶èŠ‚ç‚¹çš„sequence</p><h4 id="3-deepLinks"><a href="#3-deepLinks" class="headerlink" title="3. deepLinks"></a><code>3. deepLinks</code></h4><p>deepLinksæ˜¯ä¸€ä¸ªlist, åœ¨<code>matchDeepLink</code>æ—¶ä¼šéå†è¯¥listï¼Œå¯»æ‰¾åˆ°æœ€ä½³matchçš„<code>NavDeepLink</code></p><h4 id="4-actions"><a href="#4-actions" class="headerlink" title="4. actions"></a><code>4. actions</code></h4><p>actionæ˜¯ä¸€ä¸ªSparseArrayCompatï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ª<code>Int</code>åˆ°<code>Object</code>çš„<code>Map</code></p><h4 id="7-route"><a href="#7-route" class="headerlink" title="7. route"></a><code>7. route</code></h4><p>ä»£è¡¨å½“å‰Destinationçš„routeå­—ç¬¦ä¸²ï¼Œå¯ä»¥çœ‹åˆ°ä»–ä¹Ÿè°ƒç”¨äº†<code>addDeepLink</code></p><h3 id="addDeepLink"><a href="#addDeepLink" class="headerlink" title="addDeepLink"></a>addDeepLink</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">fun</span> <span class="title">addDeepLink</span><span class="params">(uriPattern: <span class="type">String</span>)</span></span> &#123;</span><br><span class="line">    addDeepLink(NavDeepLink.Builder().setUriPattern(uriPattern).build())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">fun</span> <span class="title">addDeepLink</span><span class="params">(navDeepLink: <span class="type">NavDeepLink</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> missingRequiredArguments = _arguments.missingRequiredArguments &#123; key -&gt;</span><br><span class="line">        key !<span class="keyword">in</span> navDeepLink.argumentsNames</span><br><span class="line">    &#125;</span><br><span class="line">    require(missingRequiredArguments.isEmpty()) &#123;</span><br><span class="line">        <span class="string">&quot;Deep link <span class="subst">$&#123;navDeepLink.uriPattern&#125;</span> can&#x27;t be used to open destination <span class="variable">$this</span>.\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;Following required arguments are missing: <span class="variable">$missingRequiredArguments</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    deepLinks.add(navDeepLink)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€ä¸ªå‡½æ•°æ˜¯ç»™<code>route</code>ä½¿ç”¨çš„ï¼Œå°†routeå­—ç¬¦ä¸²å˜æˆä¸€ä¸ª<code>NavDeepLink</code><br>ç¬¬äºŒä¸ªå‡½æ•°å¾ˆç®€å•ï¼Œå°±æ˜¯å°†<code>NavDeepLink</code>æ·»åŠ åˆ°<code>deepLinks</code>ä¸­ï¼Œåœ¨æ”¾å…¥ä¹‹å‰ä¼šæ£€æŸ¥ä¸€ä¸‹ï¼Œä¿è¯<code>_arguments</code>ä¸­çš„keyå…¨éƒ¨å­˜åœ¨äº<code>deepLink</code>çš„<code>argumentsNames</code>ä¸­</p><h3 id="routeè½¬æ¢æˆNavDeepLinkRequest"><a href="#routeè½¬æ¢æˆNavDeepLinkRequest" class="headerlink" title="routeè½¬æ¢æˆNavDeepLinkRequest"></a>routeè½¬æ¢æˆNavDeepLinkRequest</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestrictTo(RestrictTo.Scope.LIBRARY_GROUP)</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">fun</span> <span class="title">createRoute</span><span class="params">(route: <span class="type">String</span>?)</span></span>: String =</span><br><span class="line">    <span class="keyword">if</span> (route != <span class="literal">null</span>) <span class="string">&quot;android-app://androidx.navigation/<span class="variable">$route</span>&quot;</span> <span class="keyword">else</span> <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// NavDeepLinkRequest.Builder#build</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">fun</span> <span class="title">build</span><span class="params">()</span></span>: NavDeepLinkRequest &#123;</span><br><span class="line">    <span class="keyword">return</span> NavDeepLinkRequest(uri, action, mimeType)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°±æ˜¯æŠŠrouteæ ¹æ®ç‰¹å®šæ ¼å¼è½¬æ¢æˆä¸€ä¸ªuriï¼Œå­˜åˆ°<code>NavDeepLinkRequest</code>è¿™ä¸ªç±»ä¸­ï¼Œè¿™ä¸ªç±»ä¹Ÿå¾ˆç®€å•</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">open</span> <span class="keyword">class</span> <span class="title class_">NavDeepLinkRequest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">open</span> <span class="keyword">val</span> uri: Uri?</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">open</span> <span class="keyword">val</span> action: String?</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">open</span> <span class="keyword">val</span> mimeType: String?</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°±æ˜¯ç”¨æ¥å­˜è¿™ä¸‰ä¸ªä¸œè¥¿çš„</p><h3 id="matchDeepLink"><a href="#matchDeepLink" class="headerlink" title="matchDeepLink"></a>matchDeepLink</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestrictTo(RestrictTo.Scope.LIBRARY_GROUP)</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">fun</span> <span class="title">matchDeepLink</span><span class="params">(route: <span class="type">String</span>)</span></span>: DeepLinkMatch? &#123;</span><br><span class="line">    <span class="keyword">val</span> request = NavDeepLinkRequest.Builder.fromUri(createRoute(route).toUri()).build()</span><br><span class="line">    <span class="keyword">val</span> matchingDeepLink = <span class="keyword">if</span> (<span class="keyword">this</span> <span class="keyword">is</span> NavGraph) &#123;</span><br><span class="line">        matchDeepLinkExcludingChildren(request)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        matchDeepLink(request)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> matchingDeepLink</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå‡½æ•°æ˜¯ç”¨æ¥é€šè¿‡routeæ¥åŒ¹é…DeepLinkçš„ï¼Œå¦‚æœå½“å‰<code>NavDestination</code>æ˜¯å­ç±»<code>NavGraph</code>ï¼Œåˆ™ä¼šè°ƒç”¨å­ç±»çš„å‡½æ•°<code>matchDeepLinkExcludingChildren</code>ï¼Œå¦åˆ™è°ƒç”¨<code>matchDeepLink</code>ã€‚<code>matchDeepLinkExcludingChildren</code>åœ¨åé¢ä»‹ç»</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestrictTo(RestrictTo.Scope.LIBRARY_GROUP)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">open</span> <span class="function"><span class="keyword">fun</span> <span class="title">matchDeepLink</span><span class="params">(navDeepLinkRequest: <span class="type">NavDeepLinkRequest</span>)</span></span>: DeepLinkMatch? &#123;</span><br><span class="line">    <span class="keyword">if</span> (deepLinks.isEmpty()) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> bestMatch: DeepLinkMatch? = <span class="literal">null</span></span><br><span class="line">    <span class="keyword">for</span> (deepLink <span class="keyword">in</span> deepLinks) &#123;</span><br><span class="line">        <span class="keyword">val</span> uri = navDeepLinkRequest.uri</span><br><span class="line">        <span class="comment">// includes matching args for path, query, and fragment</span></span><br><span class="line">        <span class="keyword">val</span> matchingArguments =</span><br><span class="line">            <span class="keyword">if</span> (uri != <span class="literal">null</span>) deepLink.getMatchingArguments(uri, _arguments) <span class="keyword">else</span> <span class="literal">null</span></span><br><span class="line">        <span class="keyword">val</span> matchingPathSegments = deepLink.calculateMatchingPathSegments(uri)</span><br><span class="line">        <span class="keyword">val</span> requestAction = navDeepLinkRequest.action</span><br><span class="line">        <span class="keyword">val</span> matchingAction = requestAction != <span class="literal">null</span> &amp;&amp; requestAction ==</span><br><span class="line">            deepLink.action</span><br><span class="line">        <span class="keyword">val</span> mimeType = navDeepLinkRequest.mimeType</span><br><span class="line">        <span class="keyword">val</span> mimeTypeMatchLevel =</span><br><span class="line">            <span class="keyword">if</span> (mimeType != <span class="literal">null</span>) deepLink.getMimeTypeMatchRating(mimeType) <span class="keyword">else</span> -<span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> (matchingArguments != <span class="literal">null</span> || ((matchingAction || mimeTypeMatchLevel &gt; -<span class="number">1</span>) &amp;&amp;</span><br><span class="line">                hasRequiredArguments(deepLink, uri, _arguments))</span><br><span class="line">        ) &#123; <span class="comment">// 2. matchçš„æ¡ä»¶</span></span><br><span class="line">            <span class="keyword">val</span> newMatch = DeepLinkMatch(</span><br><span class="line">                <span class="keyword">this</span>, matchingArguments,</span><br><span class="line">                deepLink.isExactDeepLink, matchingPathSegments, matchingAction,</span><br><span class="line">                mimeTypeMatchLevel</span><br><span class="line">            )</span><br><span class="line">            <span class="keyword">if</span> (bestMatch == <span class="literal">null</span> || newMatch &gt; bestMatch) &#123; <span class="comment">// 1. æ¯”è¾ƒmatch, é€‰æ‹©æœ€å¥½çš„ä¸€ä¸ªmatch</span></span><br><span class="line">                bestMatch = newMatch</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> bestMatch</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å°±æ˜¯éå†æ‰€æœ‰deepLinksæ•°ç»„ï¼Œæ‰¾åˆ°æœ€matchçš„ä¸€ä¸ª</li><li>&#x2F;&#x2F; todo: 2. matchçš„æ¡ä»¶</li></ul><h3 id="id"><a href="#id" class="headerlink" title="id"></a>id</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ¯ä¸ªdestinationçš„å”¯ä¸€idï¼Œå¿…é¡»æ˜¯èµ„æºid</span></span><br><span class="line"><span class="meta">@get:IdRes</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">var</span> id: <span class="built_in">Int</span> = <span class="number">0</span></span><br><span class="line">    <span class="keyword">set</span>(<span class="meta">@IdRes</span> id) &#123;</span><br><span class="line">        field = id</span><br><span class="line">        idName = <span class="literal">null</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå°±æœ‰ç–‘é—®äº†ï¼Œè¿™é‡Œçš„idåº”è¯¥æ˜¯å¯¼èˆªå›¾xmlçš„idï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œidåœ¨onInflateçš„æ—¶å€™è¢«èµ‹å€¼ã€‚</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@CallSuper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">open</span> <span class="function"><span class="keyword">fun</span> <span class="title">onInflate</span><span class="params">(context: <span class="type">Context</span>, attrs: <span class="type">AttributeSet</span>)</span></span> &#123;</span><br><span class="line">    context.resources.obtainAttributes(attrs, R.styleable.Navigator).use &#123; array -&gt;</span><br><span class="line">        route = array.getString(R.styleable.Navigator_route)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (array.hasValue(R.styleable.Navigator_android_id)) &#123;</span><br><span class="line">            id = array.getResourceId(R.styleable.Navigator_android_id, <span class="number">0</span>)</span><br><span class="line">            idName = getDisplayName(context, id)</span><br><span class="line">        &#125;</span><br><span class="line">        label = array.getText(R.styleable.Navigator_android_label)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†åœ¨Composeä¸­ï¼Œå¹¶ä¸ä½¿ç”¨xmlçš„å¯¼èˆªå›¾ï¼Œå¦‚ä½•åˆå§‹åŒ–è¿™ä¸ªidå‘¢ï¼Ÿ</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">var</span> route: String? = <span class="literal">null</span></span><br><span class="line">    <span class="keyword">set</span>(route) &#123;</span><br><span class="line">        <span class="keyword">if</span> (route == <span class="literal">null</span>) &#123;</span><br><span class="line">            id = <span class="number">0</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            require(route.isNotBlank()) &#123; <span class="string">&quot;Cannot have an empty route&quot;</span> &#125;</span><br><span class="line">            <span class="keyword">val</span> internalRoute = createRoute(route)</span><br><span class="line">            id = internalRoute.hashCode()</span><br><span class="line">            addDeepLink(internalRoute)</span><br><span class="line">        &#125;</span><br><span class="line">        deepLinks.remove(deepLinks.firstOrNull &#123; it.uriPattern == createRoute(field) &#125;)</span><br><span class="line">        field = route</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°è¿™é‡Œï¼Œå¦‚æœæ˜¯composeçš„routeå­—ç¬¦ä¸²ï¼ŒcreateRouteåï¼Œä¼šä½¿ç”¨hashCodeä¸ºidèµ‹å€¼</p><h3 id="addInDefaultArgs"><a href="#addInDefaultArgs" class="headerlink" title="addInDefaultArgs"></a>addInDefaultArgs</h3><h3 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>å¤§æ¦‚ä½œç”¨å°±æ˜¯</p><ul><li>ä¿å­˜actionå¯¹è±¡ï¼Œç»´æŠ¤äº†ä¸€ä¸ªmapï¼Œä¿å­˜actionçš„resIdåˆ°actionå¯¹è±¡</li><li>æä¾›navigatorNameï¼Œæ–¹ä¾¿NavControlleræ ¹æ®nameæ‰¾åˆ°å¯¹åº”çš„Navigator</li><li>ç»´æŠ¤deeplinkåˆ—è¡¨ï¼Œæä¾›deeplinkåŒ¹é…çš„æ–¹æ³•</li><li>æä¾›parentå’Œhierarchyï¼Œæä¾›åµŒå¥—å›¾çš„æ”¯æŒ</li><li>æä¾›routeåˆ°deeplinkRequestçš„è½¬æ¢</li></ul><h2 id="NavGraph"><a href="#NavGraph" class="headerlink" title="NavGraph"></a>NavGraph</h2><h3 id="å…ˆçœ‹æ³¨é‡Š-2"><a href="#å…ˆçœ‹æ³¨é‡Š-2" class="headerlink" title="å…ˆçœ‹æ³¨é‡Š"></a>å…ˆçœ‹æ³¨é‡Š</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">NavGraph <span class="keyword">is</span> a collection of NavDestination nodes fetchable <span class="keyword">by</span> ID.</span><br><span class="line">A NavGraph serves <span class="keyword">as</span> a <span class="string">&#x27;virtual&#x27;</span> destination: <span class="keyword">while</span> the NavGraph itself will not appear on the back stack, navigating to the NavGraph will cause the starting destination to be added to the back stack.</span><br><span class="line">Construct a new NavGraph. This NavGraph <span class="keyword">is</span> not valid until you add a destination and <span class="keyword">set</span> the starting destination.</span><br><span class="line">Params:</span><br><span class="line">navGraphNavigator - The NavGraphNavigator which <span class="keyword">this</span> destination will be associated with. Generally retrieved via a NavController<span class="string">&#x27;sNavigatorProvider.getNavigator method.</span></span><br></pre></td></tr></table></figure><ul><li>å­˜å‚¨äº†å›¾ä¸­æ‰€æœ‰çš„èŠ‚ç‚¹ï¼Œå¯ä»¥é€šè¿‡idè·å–å„ä¸ªèŠ‚ç‚¹<ul><li>è¿™é‡Œçš„èŠ‚ç‚¹å°±æ˜¯ä¸Šé¢ä»‹ç»çš„<code>NavDestination</code></li></ul></li><li>å¯¼èˆªå›¾æœ¬èº«æ˜¯ä¸€ä¸ªè™šæ‹Ÿçš„destinationï¼Œä½†æ˜¯ä»–ä¸ä¼šå‡ºç°åœ¨æ ˆä¸­ï¼Œå¦‚æœè¯•å›¾å¯¼èˆªåˆ°NavGraphï¼Œå°†ä¼šå¯¼èˆªåˆ°è¿™ä¸ªå¯¼èˆªå›¾çš„<code>startDest</code>ä¸­</li></ul><h3 id="æ•°æ®ç»“æ„-1"><a href="#æ•°æ®ç»“æ„-1" class="headerlink" title="æ•°æ®ç»“æ„"></a>æ•°æ®ç»“æ„</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">open</span> <span class="keyword">class</span> <span class="title class_">NavGraph</span>(navGraphNavigator: Navigator&lt;<span class="keyword">out</span> NavGraph&gt;) :</span><br><span class="line">    NavDestination(navGraphNavigator), Iterable&lt;NavDestination&gt; &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">val</span> nodes: SparseArrayCompat&lt;NavDestination&gt; = SparseArrayCompat&lt;NavDestination&gt;()</span><br><span class="line">        <span class="comment">/** <span class="doctag">@suppress</span> */</span></span><br><span class="line">        <span class="meta">@RestrictTo(RestrictTo.Scope.LIBRARY_GROUP)</span></span><br><span class="line">        <span class="keyword">get</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> startDestId = <span class="number">0</span></span><br><span class="line">    <span class="meta">@get:IdRes</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> startDestinationId: <span class="built_in">Int</span></span><br><span class="line">        <span class="keyword">get</span>() = startDestId</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">set</span>(startDestId) &#123;</span><br><span class="line">            require(startDestId != id) &#123;</span><br><span class="line">                <span class="string">&quot;Start destination <span class="variable">$startDestId</span> cannot use the same id as the graph <span class="variable">$this</span>&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (startDestinationRoute != <span class="literal">null</span>) &#123;</span><br><span class="line">                startDestinationRoute = <span class="literal">null</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">this</span>.startDestId = startDestId</span><br><span class="line">            startDestIdName = <span class="literal">null</span></span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> startDestinationRoute: String? = <span class="literal">null</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">set</span>(startDestRoute) &#123;</span><br><span class="line">            startDestId = <span class="keyword">if</span> (startDestRoute == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="number">0</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                require(startDestRoute != route) &#123;</span><br><span class="line">                    <span class="string">&quot;Start destination <span class="variable">$startDestRoute</span> cannot use the same route as the graph <span class="variable">$this</span>&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">                require(startDestRoute.isNotBlank()) &#123;</span><br><span class="line">                    <span class="string">&quot;Cannot have an empty start destination route&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">val</span> internalRoute = createRoute(startDestRoute)</span><br><span class="line">                internalRoute.hashCode()</span><br><span class="line">            &#125;</span><br><span class="line">            field = startDestRoute</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>nodesï¼Œå­˜å‚¨æ‰€æœ‰destinationçš„mapï¼Œkeyæ—¶destinationçš„id</li><li>startDestIdï¼ŒstartDestinationRouteèµ·å§‹destinationçš„idã€route<ul><li>å¦‚æœstartDestinationRouteä¸ç©ºï¼Œå’Œidçš„æƒ…å†µç›¸åŒï¼ŒcreateRouteåï¼Œä½¿ç”¨hashCodeä½œä¸ºstartDestId</li></ul></li></ul><h3 id="onInflate-1"><a href="#onInflate-1" class="headerlink" title="onInflate"></a>onInflate</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onInflate</span><span class="params">(context: <span class="type">Context</span>, attrs: <span class="type">AttributeSet</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.onInflate(context, attrs)</span><br><span class="line">    context.resources.obtainAttributes(</span><br><span class="line">        attrs,</span><br><span class="line">        R.styleable.NavGraphNavigator</span><br><span class="line">    ).use &#123;</span><br><span class="line">        startDestinationId = it.getResourceId(R.styleable.NavGraphNavigator_startDestination, <span class="number">0</span>)</span><br><span class="line">        startDestIdName = getDisplayName(context, startDestId)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è§£æxmlæ—¶ï¼Œä»xmlä¸­è·å–startDestinationçš„id</p><h3 id="matchDeepLink-1"><a href="#matchDeepLink-1" class="headerlink" title="matchDeepLink"></a>matchDeepLink</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestrictTo(RestrictTo.Scope.LIBRARY_GROUP)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">matchDeepLink</span><span class="params">(navDeepLinkRequest: <span class="type">NavDeepLinkRequest</span>)</span></span>: DeepLinkMatch? &#123;</span><br><span class="line">    <span class="comment">// First search through any deep links directly added to this NavGraph</span></span><br><span class="line">    <span class="keyword">val</span> bestMatch = <span class="keyword">super</span>.matchDeepLink(navDeepLinkRequest)</span><br><span class="line">    <span class="comment">// Then search through all child destinations for a matching deep link</span></span><br><span class="line">    <span class="keyword">val</span> bestChildMatch = mapNotNull &#123; child -&gt;</span><br><span class="line">        child.matchDeepLink(navDeepLinkRequest)</span><br><span class="line">    &#125;.maxOrNull()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> listOfNotNull(bestMatch, bestChildMatch).maxOrNull()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestrictTo(RestrictTo.Scope.LIBRARY_GROUP)</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">fun</span> <span class="title">matchDeepLinkExcludingChildren</span><span class="params">(request: <span class="type">NavDeepLinkRequest</span>)</span></span>: DeepLinkMatch? =</span><br><span class="line">    <span class="keyword">super</span>.matchDeepLink(request)</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>navGraphæœ¬èº«ä¹Ÿå¯ä»¥ä½œä¸ºä¸€ä¸ªdestinationï¼Œæ‹¥æœ‰deeplinkï¼Œæ‰€ä»¥å…ˆæœç´¢ä»–è‡ªèº«çš„matchï¼Œç„¶åæœç´¢æ‰€æœ‰å­èŠ‚ç‚¹çš„matchï¼Œæœ€åè¿”å›æœ€matchçš„ä¸€ä¸ª</li><li>è¿™ä¸ªå‡½æ•°åªæœ‰åœ¨ä½¿ç”¨routeå­—ç¬¦ä¸²åŒ¹é…æ—¶ä¼šä½¿ç”¨ï¼Œé€šè¿‡routeåŒ¹é…æ—¶å°±ä¸è€ƒè™‘å­èŠ‚ç‚¹ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</li></ul><h3 id="æ€»ç»“-2"><a href="#æ€»ç»“-2" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><ul><li>å…¶å®æœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ä¸ªä¿å­˜å­èŠ‚ç‚¹çš„map</li><li>æä¾›matchDeepLinkæ–¹æ³•ï¼Œç”¨äºåŒ¹é…å­å­èŠ‚ç‚¹å’Œè‡ªå·±æœ¬èº«deeplink</li></ul><h2 id="NavigatorState"><a href="#NavigatorState" class="headerlink" title="NavigatorState"></a>NavigatorState</h2><h2 id="NavControllerNavigatorState"><a href="#NavControllerNavigatorState" class="headerlink" title="NavControllerNavigatorState"></a>NavControllerNavigatorState</h2><h2 id="NavControllerViewModel"><a href="#NavControllerViewModel" class="headerlink" title="NavControllerViewModel"></a>NavControllerViewModel</h2><h2 id="FragmentNavigator"><a href="#FragmentNavigator" class="headerlink" title="FragmentNavigator"></a>FragmentNavigator</h2><h2 id="ActivityNavigator"><a href="#ActivityNavigator" class="headerlink" title="ActivityNavigator"></a>ActivityNavigator</h2><h2 id="æ€»ç»“ä¸­çš„æ€»ç»“"><a href="#æ€»ç»“ä¸­çš„æ€»ç»“" class="headerlink" title="æ€»ç»“ä¸­çš„æ€»ç»“"></a>æ€»ç»“ä¸­çš„æ€»ç»“</h2><h3 id="éœ€è¦ä¸€ä¸ªNavHostFragment"><a href="#éœ€è¦ä¸€ä¸ªNavHostFragment" class="headerlink" title="éœ€è¦ä¸€ä¸ªNavHostFragment"></a>éœ€è¦ä¸€ä¸ªNavHostFragment</h3><p>æƒ³è¦ä½¿ç”¨<code>navigation</code>åº“ï¼Œéœ€è¦æœ‰ä¸€ä¸ª<code>NavHostFragment</code>ã€‚<code>navigation</code>åº“ä¸º<code>Fragment</code>, <code>View</code>, <code>Acivity</code>éƒ½æ·»åŠ äº†æ‰©å±•å‡½æ•°<code>findNavController</code>ï¼Œç”¨æ¥æ‰¾åˆ°<code>navController</code>ï¼ŒæŸ¥æ‰¾æ—¶éƒ½éœ€è¦ä¸€ä¸ª<code>NavHostFragment</code>çš„å­˜åœ¨ã€‚</p><ul><li>å¯¹äº<code>Fragment</code>æ¥è¯´ï¼Œéœ€è¦å®ƒæœ¬èº«ï¼Œæˆ–è€…æ‰€æœ‰ä¸Šçº§<code>Fragment</code>ä¸­å­˜åœ¨ä¸€ä¸ª<code>NavHostFragment</code></li><li>å¯¹äºViewæ¥è¯´ï¼Œéœ€è¦ä»–æœ¬èº«ï¼Œæˆ–è€…æ‰€æœ‰ä¸Šçº§viewçš„tagä¸­ï¼Œå­˜åœ¨<code>R.id.nav_controller_view_tag</code>,è¿™ä¸ªtagä¸‹å¯ä»¥è·å¾—NavControllerã€‚NavHostFragmentçš„<a href="#onviewcreated">onViewCreated</a>æ–¹æ³•ä¸­,ä¼šå¯¹<code>Fragment</code>çš„<code>rootView</code>è®¾ç½®è¿™ä¸ª<code>tag</code></li><li>å¯¹äº<code>activity</code>æ¥è¯´ï¼Œéœ€è¦æŒ‡å®šä¸€ä¸ª<code>viewId</code>ï¼Œé€šè¿‡<code>findView</code>æ‰¾åˆ°è¿™ä¸ª<code>view</code>åï¼Œå¯»æ‰¾è¿‡ç¨‹å’Œ<code>View</code>ç›¸åŒ</li></ul><p>è¿™ä¸ª<code>NavHostFragment</code>çš„<code>graphId</code>ä¸èƒ½é€šè¿‡ç”¨æˆ·ä¼ å…¥ï¼Œå› ä¸ºè¿™ä¸ªå˜é‡æ˜¯<code>private</code>çš„ã€‚<code>NavHostFragment</code>é€šè¿‡<code>xml</code>è·å–è¿™ä¸ªå¯¼èˆªå›¾çš„<code>id</code>ï¼Œæˆ–è€…ä½¿ç”¨<code>KEY_GRAPH_ID</code>ä»<code>savedState</code>æˆ–<code>Fragment</code>çš„<code>mArguments</code>ä¸­è·å–ï¼Œè€Œè¿™ä¸ª<code>KEY_GRAPH_ID</code>ä¹Ÿæ˜¯ä»…åœ¨<code>navigation</code>åº“ä¸­å¯ç”¨çš„ã€‚</p><p><code>NavHostFragment</code>å®ç°äº†<code>NavHost</code>ï¼Œæ‹¥æœ‰äº†ä¸€ä¸ª<code>NavController</code>ï¼Œé€šè¿‡å®ƒçš„<code>navigate</code>æ–¹æ³•å¯ä»¥è¿›è¡Œè·³è½¬ã€‚<br><code>NavHostFragment</code>å®ç°<code>NavController</code>çš„å®ç°ç±»æ˜¯<code>NavHostController</code>,è¿™ä¸ªç±»ä¸­æ²¡æœ‰ä»»ä½•å‡½æ•°å®ç°ï¼Œåªæ˜¯å°†çˆ¶ç±»çš„å‡ ä¸ªå‡½æ•°å˜æˆ<code>final</code>çš„</p><h3 id="å¯¼èˆªå›¾-1"><a href="#å¯¼èˆªå›¾-1" class="headerlink" title="å¯¼èˆªå›¾"></a>å¯¼èˆªå›¾</h3><ul><li>å¯¼èˆªå›¾å¯ä»¥é€šè¿‡<code>xml</code>å’Œ<code>kotlin DSL</code>æè¿°ã€‚</li><li>å¯¼èˆªå›¾å¯ä»¥åŒ…å«å¤šä¸ªå­èŠ‚ç‚¹ï¼Œæ¯ä¸ªå­èŠ‚ç‚¹éƒ½æ˜¯ä¸€ä¸ª<code>destination</code>ã€‚<ul><li>æ¯ä¸ª<code>destination</code>å¯ä»¥æ˜¯<code>fragment</code>ï¼Œ<code>activity</code>ï¼Œ<code>dialog</code>ï¼Œæˆ–è€…ä¸€ä¸ª<code>NavGraph</code>ä½œä¸ºå­å›¾ã€‚æ¯ä¸ª<code>destination</code>å¯ä»¥åŒ…å«å¤šä¸ª<code>action</code><ul><li>æ¯ä¸ª<code>action</code>åŒ…å«å®ƒæœ¬èº«çš„<code>id</code>å’Œå¯¼èˆªç›®çš„åœ°çš„<code>destinationId</code>ï¼Œç”¨äºç¡®å®šå¯¼èˆªçš„ç›®çš„åœ°ã€‚</li></ul></li><li>æ¯ä¸ª<code>destination</code>ä¹Ÿå¯ä»¥åŒ…å«å¤šä¸ª<code>deeplink</code><ul><li><code>NavController</code>é€šè¿‡<code>deeplink</code>è¿›è¡Œå¯¼èˆªæ—¶ï¼Œä¼šæœç´¢å¯¼èˆªå›¾ï¼Œä»¥åŠå¯¼èˆªå›¾ä¸­çš„<code>destination</code>çš„<code>deeplink</code>ï¼Œæ‰¾åˆ°åŒ¹é…åº¦æœ€é«˜çš„ä¸€ä¸ªï¼Œè¿›è¡Œå¯¼èˆªã€‚</li><li>åœ¨<code>Compose</code>ä¸­ä½¿ç”¨<code>route</code>å­—ç¬¦ä¸²è¿›è¡Œå¯¼èˆªæ—¶ï¼Œå®é™…ä¸Šä¼šå°†å…¶åŒ…è£…ä¸ºä¸€ä¸ª<code>uri</code>ç±»å‹çš„<code>deeplink</code>ï¼Œç„¶åè¿›è¡ŒåŒ¹é…ã€‚</li><li>æ¯ä¸ª<code>deeplink</code>åŒ…å«å…¶<code>uri</code>ï¼Œ<code>action</code>å­—ç¬¦ä¸²ï¼Œ<code>mimeType</code>å­—ç¬¦ä¸²ï¼Œç”¨äºåŒ¹é…ã€‚</li></ul></li></ul></li><li>å¯¼èˆªå›¾æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ª<code>destination</code>ï¼Œå¯¼èˆªåˆ°ä¸€ä¸ª<code>NavGraph</code>æ˜¯ï¼Œä¼šå¯¼èˆªåˆ°<code>startDestination</code>ã€‚<ul><li>åœ¨<code>xml</code>ä¸­ï¼Œç»™æ ¹èŠ‚ç‚¹<code>&lt;navigation&gt;</code>æ·»åŠ <code>startDestination</code>å‚æ•°ï¼Œå¡«å†™ä¸€ä¸ª<code>destinationId</code>ï¼Œä½œä¸º<code>startDestination</code>ã€‚</li><li>åœ¨<code>kotlin DSL</code>ä¸­ï¼Œé€šè¿‡<code>startDestination</code>æŒ‡å®šä¸€ä¸ª<code>route</code>å­—ç¬¦ä¸²ï¼Œä½œä¸º<code>startDestination</code></li></ul></li></ul><h3 id="NavController-1"><a href="#NavController-1" class="headerlink" title="NavController"></a>NavController</h3><ul><li>è¿™ä¸ªç±»æ˜¯æ•´ä¸ª<code>navigation</code>åº“çš„æ ¸å¿ƒ<ul><li>æä¾›å¤šç§<code>navigate</code>æ–¹æ³•ï¼Œå¯ä»¥é€šè¿‡<code>destination</code>çš„<code>resId</code>ï¼Œ<code>route</code>å­—ç¬¦ä¸²å’Œ<code>deepLink</code>è¿›è¡Œå¯¼èˆª</li><li>è¿™ä¸ªç±»ç»´æŠ¤äº†å¯¼èˆªå›¾<code>NavGraph</code>ï¼Œè¿”å›æ ˆ<code>_currentBackStack</code>ç­‰æ•°æ®ç»“æ„</li><li>è¿™ä¸ªç±»å¹¶æ‰¿æ‹…å…·ä½“çš„è·³è½¬ä»»åŠ¡ï¼Œå…·ä½“çš„è·³è½¬ä»»åŠ¡ç”±<code>Navigator</code>çš„å„ä¸ªå­ç±»å®Œæˆ<ul><li>ä¸Šé¢è¯´åˆ°å¯¼èˆªç›®çš„åœ°æœ‰å¾ˆå¤šç§ç±»ï¼Œ<code>NavController</code>ä¼šæ ¹æ®å¯¼èˆªç›®çš„åœ°çš„ç±»å‹ï¼Œé€‰æ‹©ä¸åŒçš„<code>Navigator</code>æ¥å®Œæˆè·³è½¬ä»»åŠ¡ï¼Œæ¯”å¦‚<code>FragmentNavigator</code>ï¼Œ<code>ActivityNavigator</code>ï¼Œ<code>DialogNavigator</code></li><li>æ¯ä¸ª<code>Navigator</code>éƒ½æœ‰<code>name</code>ï¼Œæ˜¯é€šè¿‡ä¸€ä¸ªæ³¨è§£<code>Navigator.Name</code>æŒ‡å®šçš„ã€‚</li><li><code>NavController</code>ä¸­å› æ­¤ä¹Ÿç»´æŠ¤äº†<code>_navigatorProvider</code>ï¼Œä»–çš„ä½œç”¨ç±»ä¼¼äºä¸€ä¸ª<code>map</code>,å­˜å‚¨<code>Navigator</code>çš„<code>name</code>å’Œ<code>Navigator</code>çš„æ˜ å°„å…³ç³»ã€‚</li></ul></li></ul></li></ul>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;ç®€ä»‹&quot;&gt;&lt;a href=&quot;#ç®€ä»‹&quot; class=&quot;headerlink&quot; title=&quot;ç®€ä»‹&quot;&gt;&lt;/a&gt;ç®€ä»‹&lt;/h2&gt;&lt;p&gt;&lt;code&gt;NavController&lt;/code&gt;æ˜¯ä¸­å¤®å¯¼èˆª APIã€‚å®ƒä¼šè·Ÿè¸ªç”¨æˆ·è®¿é—®è¿‡çš„ç›®çš„åœ°ï¼Œå¹¶å…è®¸ç”¨æˆ·åœ¨ç›®çš„åœ°ä¹‹é—´ç§»åŠ¨ã€‚&lt;/p&gt;
&lt;h3 id=&quot;è·å–NavController&quot;&gt;&lt;a href=&quot;#è·å–NavController&quot; class=&quot;headerlink&quot; title=&quot;è·å–NavController&quot;&gt;&lt;/a&gt;è·å–&lt;code&gt;NavController&lt;/code&gt;&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;fragment&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦‚æœæ˜¯NavHostFragment&lt;/p&gt;
&lt;figure class=&quot;highlight kotlin&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;val&lt;/span&gt; navController = &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.navController&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="Android" scheme="https://jingtianer.github.io/home/categories/Android/"/>
    
    <category term="æ‰‹æ’¸Androidæºç " scheme="https://jingtianer.github.io/home/categories/Android/%E6%89%8B%E6%92%B8Android%E6%BA%90%E7%A0%81/"/>
    
    
    <category term="Android-å®˜æ–¹æºç " scheme="https://jingtianer.github.io/home/tags/Android-%E5%AE%98%E6%96%B9%E6%BA%90%E7%A0%81/"/>
    
  </entry>
  
  <entry>
    <title>åŸºç¡€04-LiveData</title>
    <link href="https://jingtianer.github.io/home/2024/08/06/Android%E9%AB%98%E7%BA%A7/%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/%E5%9F%BA%E7%A1%8004-LiveData/"/>
    <id>https://jingtianer.github.io/home/2024/08/06/Android%E9%AB%98%E7%BA%A7/%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/%E5%9F%BA%E7%A1%8004-LiveData/</id>
    <published>2024-08-06T13:15:36.000Z</published>
    <updated>2025-04-15T02:37:55.588Z</updated>
    
    <content type="html"><![CDATA[<h2 id="LiveData"><a href="#LiveData" class="headerlink" title="LiveData"></a>LiveData</h2><h3 id="LiveDataçš„è§‚å¯Ÿè€…"><a href="#LiveDataçš„è§‚å¯Ÿè€…" class="headerlink" title="LiveDataçš„è§‚å¯Ÿè€…"></a>LiveDataçš„è§‚å¯Ÿè€…</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="keyword">interface</span> Observer<span class="type">&lt;T&gt;</span> &#123;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Called when the data is changed to [value].</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">onChanged</span><span class="params">(value: <span class="type">T</span>)</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>é€šè¿‡<code>onChanged</code>å‡½æ•°åˆ†æ´¾æ•°æ®å˜åŒ–</li></ul><h3 id="æˆå‘˜"><a href="#æˆå‘˜" class="headerlink" title="æˆå‘˜"></a>æˆå‘˜</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SuppressWarnings(&quot;WeakerAccess&quot;)</span> <span class="comment">/* synthetic access */</span></span><br><span class="line"><span class="keyword">final</span> <span class="type">Object</span> <span class="variable">mDataLock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">START_VERSION</span> <span class="operator">=</span> -<span class="number">1</span>;</span><br><span class="line"><span class="meta">@SuppressWarnings(&quot;WeakerAccess&quot;)</span> <span class="comment">/* synthetic access */</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Object</span> <span class="variable">NOT_SET</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> SafeIterableMap&lt;Observer&lt;? <span class="built_in">super</span> T&gt;, ObserverWrapper&gt; mObservers =</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">SafeIterableMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line"><span class="comment">// how many observers are in active state</span></span><br><span class="line"><span class="meta">@SuppressWarnings(&quot;WeakerAccess&quot;)</span> <span class="comment">/* synthetic access */</span></span><br><span class="line"><span class="type">int</span> <span class="variable">mActiveCount</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="comment">// to handle active/inactive reentry, we guard with this boolean</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">boolean</span> mChangingActiveState;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">volatile</span> Object mData; <span class="comment">// 1ï¸âƒ£ï¼šå½“å‰çš„data</span></span><br><span class="line"><span class="comment">// when setData is called, we set the pending data and actual data swap happens on the main</span></span><br><span class="line"><span class="comment">// thread</span></span><br><span class="line"><span class="meta">@SuppressWarnings(&quot;WeakerAccess&quot;)</span> <span class="comment">/* synthetic access */</span></span><br><span class="line"><span class="keyword">volatile</span> <span class="type">Object</span> <span class="variable">mPendingData</span> <span class="operator">=</span> NOT_SET; <span class="comment">// 2ï¸âƒ£ï¼šç»™å¤šçº¿ç¨‹ä½¿ç”¨çš„ï¼Œåœ¨4ï¸âƒ£mPostValueRunnableä¸­ä½¿ç”¨</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> mVersion; <span class="comment">// 3ï¸âƒ£ï¼šmVersionæ˜¯æ•°æ®ç‰ˆæœ¬</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="type">boolean</span> mDispatchingValue;</span><br><span class="line"><span class="meta">@SuppressWarnings(&quot;FieldCanBeLocal&quot;)</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">boolean</span> mDispatchInvalidated;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Runnable</span> <span class="variable">mPostValueRunnable</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;<span class="comment">// 4ï¸âƒ£mPostValueRunnableï¼Œåœ¨ä¸»çº¿ç¨‹ä¸­å°†mPendingDataè®¾ç½®ä¸ºå½“å‰å€¼</span></span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        Object newValue;</span><br><span class="line">        <span class="keyword">synchronized</span> (mDataLock) &#123;</span><br><span class="line">            newValue = mPendingData;</span><br><span class="line">            mPendingData = NOT_SET;</span><br><span class="line">        &#125;</span><br><span class="line">        setValue((T) newValue);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li>æ•°æ®å­˜åœ¨mDataä¸­</li><li>mPendingDataç»™å¤šçº¿ç¨‹ä½¿ç”¨çš„ï¼Œåœ¨mPostValueRunnableæ—¶è®¾ç½®ä¸ºå½“å‰å€¼</li><li>mVersionæ˜¯æ•°æ®ç‰ˆæœ¬</li><li>mPostValueRunnableï¼Œåœ¨ä¸»çº¿ç¨‹ä¸­å°†mPendingDataè®¾ç½®ä¸ºå½“å‰å€¼</li></ul><h3 id="æ„é€ "><a href="#æ„é€ " class="headerlink" title="æ„é€ "></a>æ„é€ </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">LiveData</span><span class="params">(T value)</span> &#123;</span><br><span class="line">    mData = value;</span><br><span class="line">    mVersion = START_VERSION + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">LiveData</span><span class="params">()</span> &#123;</span><br><span class="line">    mData = NOT_SET;</span><br><span class="line">    mVersion = START_VERSION;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="get-å’Œ-set"><a href="#get-å’Œ-set" class="headerlink" title="get å’Œ set"></a>get å’Œ set</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MainThread</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">setValue</span><span class="params">(T value)</span> &#123;</span><br><span class="line">    assertMainThread(<span class="string">&quot;setValue&quot;</span>);</span><br><span class="line">    mVersion++;</span><br><span class="line">    mData = value;</span><br><span class="line">    dispatchingValue(<span class="literal">null</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="keyword">public</span> T <span class="title function_">getValue</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Object</span> <span class="variable">data</span> <span class="operator">=</span> mData;</span><br><span class="line">    <span class="keyword">if</span> (data != NOT_SET) &#123;</span><br><span class="line">        <span class="keyword">return</span> (T) data;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">postValue</span><span class="params">(T value)</span> &#123;</span><br><span class="line">    <span class="type">boolean</span> postTask;</span><br><span class="line">    <span class="keyword">synchronized</span> (mDataLock) &#123;</span><br><span class="line">        postTask = mPendingData == NOT_SET;</span><br><span class="line">        mPendingData = value;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!postTask) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    ArchTaskExecutor.getInstance().postToMainThread(mPostValueRunnable);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>æ¯æ¬¡set,mVersionéƒ½ä¼šè‡ªå¢1ï¼Œå¹¶è°ƒç”¨dispatchingValue</li><li>éä¸»çº¿ç¨‹ä¸­è°ƒç”¨postValueåœ¨ä¸»çº¿ç¨‹ä¸­æ›´æ–°å€¼, mPendingDataæ˜¯è¢«å¼‚æ­¥æ›´æ–°çš„ï¼Œä½†æœ€ç»ˆmDataéƒ½åœ¨ä¸»çº¿ç¨‹ä¸­è¢«set</li><li>postValueå’ŒmPostValueRunnableæ›´æ–°mPendingDataæ—¶å…ˆè·å–mDataLockå¯¹è±¡çš„é”ï¼Œrunnableæ‰§è¡Œåä¼šå°†mPendingDataè®¾ç½®ä¸ºNOT_SETã€‚å¦‚æœpostValueæ—¶mPendingDataä¸æ˜¯NOT_SETï¼Œå°±ä¸ä¼šé‡å¤post runnable</li></ul><h3 id="åˆ†æ´¾äº‹ä»¶"><a href="#åˆ†æ´¾äº‹ä»¶" class="headerlink" title="åˆ†æ´¾äº‹ä»¶"></a>åˆ†æ´¾äº‹ä»¶</h3><h4 id="dispatchingValue"><a href="#dispatchingValue" class="headerlink" title="dispatchingValue"></a>dispatchingValue</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SuppressWarnings(&quot;WeakerAccess&quot;)</span> <span class="comment">/* synthetic access */</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">dispatchingValue</span><span class="params">(<span class="meta">@Nullable</span> ObserverWrapper initiator)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (mDispatchingValue) &#123;</span><br><span class="line">        mDispatchInvalidated = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    mDispatchingValue = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        mDispatchInvalidated = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">if</span> (initiator != <span class="literal">null</span>) &#123;</span><br><span class="line">            considerNotify(initiator);</span><br><span class="line">            initiator = <span class="literal">null</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (Iterator&lt;Map.Entry&lt;Observer&lt;? <span class="built_in">super</span> T&gt;, ObserverWrapper&gt;&gt; iterator =</span><br><span class="line">                    mObservers.iteratorWithAdditions(); iterator.hasNext(); ) &#123;</span><br><span class="line">                considerNotify(iterator.next().getValue());</span><br><span class="line">                <span class="keyword">if</span> (mDispatchInvalidated) &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">while</span> (mDispatchInvalidated);</span><br><span class="line">    mDispatchingValue = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å¦‚æœå½“å‰æ­£åœ¨åˆ†æ´¾ï¼Œåˆ™é€€å‡ºï¼Œå¹¶é€šè¿‡<code>mDispatchInvalidated</code>æ‰“æ–­åç»­åˆ†æ´¾</li><li>å¦‚æœå‚æ•°ä¸ç©ºï¼Œåˆ™åªåˆ†æ´¾ç»™å‚æ•°ï¼Œå¦åˆ™åˆ†æ´¾ç»™æ‰€æœ‰observer</li></ul><h4 id="considerNotify"><a href="#considerNotify" class="headerlink" title="considerNotify"></a>considerNotify</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">considerNotify</span><span class="params">(ObserverWrapper observer)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!observer.mActive) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Check latest state b4 dispatch. Maybe it changed state but we didn&#x27;t get the event yet.</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// we still first check observer.active to keep it as the entrance for events. So even if</span></span><br><span class="line">    <span class="comment">// the observer moved to an active state, if we&#x27;ve not received that event, we better not</span></span><br><span class="line">    <span class="comment">// notify for a more predictable notification order.</span></span><br><span class="line">    <span class="keyword">if</span> (!observer.shouldBeActive()) &#123;</span><br><span class="line">        observer.activeStateChanged(<span class="literal">false</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (observer.mLastVersion &gt;= mVersion) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    observer.mLastVersion = mVersion;</span><br><span class="line">    observer.mObserver.onChanged((T) mData);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å¦‚æœ<code>observer</code>é<code>active</code>çŠ¶æ€ï¼Œä¸åˆ†æ´¾</li><li>å¦‚æœ<code>observer</code>ä¸Šæ¬¡çš„æ•°æ®ç‰ˆæœ¬å¤§äºå½“å‰ç‰ˆæœ¬ï¼Œä¸åˆ†æ´¾</li><li>æ›´æ–°<code>observer</code>çš„æ•°æ®ç‰ˆæœ¬</li><li>è°ƒç”¨<code>observer</code>çš„<code>onChanged</code>åˆ†æ´¾æ•°æ®å˜åŒ–</li></ul><h3 id="ObserverWrapper"><a href="#ObserverWrapper" class="headerlink" title="ObserverWrapper"></a>ObserverWrapper</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">ObserverWrapper</span> &#123;</span><br><span class="line">    <span class="keyword">final</span> Observer&lt;? <span class="built_in">super</span> T&gt; mObserver;</span><br><span class="line">    <span class="type">boolean</span> mActive;</span><br><span class="line">    <span class="type">int</span> <span class="variable">mLastVersion</span> <span class="operator">=</span> START_VERSION;</span><br><span class="line"></span><br><span class="line">    ObserverWrapper(Observer&lt;? <span class="built_in">super</span> T&gt; observer) &#123;</span><br><span class="line">        mObserver = observer;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">abstract</span> <span class="type">boolean</span> <span class="title function_">shouldBeActive</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">isAttachedTo</span><span class="params">(LifecycleOwner owner)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">detachObserver</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">activeStateChanged</span><span class="params">(<span class="type">boolean</span> newActive)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (newActive == mActive) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// immediately set active state, so we&#x27;d never dispatch anything to inactive</span></span><br><span class="line">        <span class="comment">// owner</span></span><br><span class="line">        mActive = newActive;</span><br><span class="line">        changeActiveCounter(mActive ? <span class="number">1</span> : -<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (mActive) &#123;</span><br><span class="line">            dispatchingValue(<span class="built_in">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å¯¹<code>Observer</code>è¿›è¡ŒåŒ…è£…ï¼Œè®°å½•äº†å½“å‰çš„æ•°æ®<code>version</code>å’Œ<code>active</code>çŠ¶æ€</li><li>å½“<code>activeStateChanged</code>è¢«è°ƒç”¨æ—¶ï¼Œé¦–å…ˆåˆ¤æ–­ä¸åŸæ¥çš„<code>active</code>çŠ¶æ€æ˜¯å¦ä¸€è‡´ï¼Œå¦‚æœä¸€è‡´ï¼Œåˆ™ç›´æ¥è¿”å›</li><li>å¦‚æœä¸ä¸€è‡´ï¼Œåˆ™æ›´æ–°<code>active</code>çŠ¶æ€ï¼Œå¹¶è°ƒç”¨å¤–éƒ¨ç±»(<code>LiveData</code>)çš„<code>changeActiveCounter</code></li><li>å¦‚æœå½“å‰<code>active</code>çŠ¶æ€ä»<code>false</code>å˜ä¸º<code>true</code>ï¼Œåˆ™è°ƒç”¨<code>dispatchingValue</code>ï¼Œç«‹åˆ»å‘è§‚å¯Ÿè€…ä¼ é€’æœ€æ–°çš„æ•°æ®çŠ¶æ€</li></ul><h3 id="changeActiveCounter"><a href="#changeActiveCounter" class="headerlink" title="changeActiveCounter"></a>changeActiveCounter</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MainThread</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">changeActiveCounter</span><span class="params">(<span class="type">int</span> change)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">previousActiveCount</span> <span class="operator">=</span> mActiveCount;</span><br><span class="line">    mActiveCount += change;</span><br><span class="line">    <span class="keyword">if</span> (mChangingActiveState) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    mChangingActiveState = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (previousActiveCount != mActiveCount) &#123;</span><br><span class="line">            <span class="type">boolean</span> <span class="variable">needToCallActive</span> <span class="operator">=</span> previousActiveCount == <span class="number">0</span> &amp;&amp; mActiveCount &gt; <span class="number">0</span>;</span><br><span class="line">            <span class="type">boolean</span> <span class="variable">needToCallInactive</span> <span class="operator">=</span> previousActiveCount &gt; <span class="number">0</span> &amp;&amp; mActiveCount == <span class="number">0</span>;</span><br><span class="line">            previousActiveCount = mActiveCount;</span><br><span class="line">            <span class="keyword">if</span> (needToCallActive) &#123;</span><br><span class="line">                onActive();</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (needToCallInactive) &#123;</span><br><span class="line">                onInactive();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        mChangingActiveState = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ä¼šä¿å­˜å½“å‰çŠ¶æ€ä¸º<code>active</code>çš„<code>observer</code>çš„æ•°é‡</li><li>è¿™ä¸ªå‡½æ•°ä¼šæ›´æ–°å…¶å€¼</li><li>å¦‚æœåŸæ¥<code>active</code>çš„ä¸ªæ•°ä¸º0ï¼Œç°åœ¨å¤§äº0ï¼Œé‚£ä¹ˆè°ƒç”¨<code>onActive</code></li><li>å¦‚æœåŸæ¥<code>active</code>çš„ä¸ªæ•°å¤§äº0ï¼Œç°åœ¨ä¸º0ï¼Œé‚£ä¹ˆè°ƒç”¨<code>onInactive</code></li></ul><h3 id="onActiveå’ŒonInactive"><a href="#onActiveå’ŒonInactive" class="headerlink" title="onActiveå’ŒonInactive"></a>onActiveå’ŒonInactive</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onInactive</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onActive</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»™å­ç±»ç”¨çš„é’©å­æ–¹æ³•ï¼Œç”¨äºé€šçŸ¥å½“å‰æ˜¯å¦æœ‰<code>active</code>çš„<code>observer</code></p><h3 id="AlwaysActiveObserver"><a href="#AlwaysActiveObserver" class="headerlink" title="AlwaysActiveObserver"></a>AlwaysActiveObserver</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">AlwaysActiveObserver</span> <span class="keyword">extends</span> <span class="title class_">ObserverWrapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    AlwaysActiveObserver(Observer&lt;? <span class="built_in">super</span> T&gt; observer) &#123;</span><br><span class="line">        <span class="built_in">super</span>(observer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">shouldBeActive</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>è¿™ç±»<code>Observer</code>ä¼šä¸€ç›´å¤„äº<code>active</code>çŠ¶æ€</li><li><code>observeForever</code>ä¼šåˆ›å»º<code>AlwaysActiveObserver</code>ï¼Œåˆ›å»ºåç«‹åˆ»è°ƒç”¨<code>activeStateChanged(true)</code>æ›´æ–°<code>active</code>çŠ¶æ€ï¼Œ<code>active</code>æ€»æ•°</li></ul><h3 id="æ·»åŠ AlwaysActiveObserver"><a href="#æ·»åŠ AlwaysActiveObserver" class="headerlink" title="æ·»åŠ AlwaysActiveObserver"></a>æ·»åŠ AlwaysActiveObserver</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">observeForever</span><span class="params">(<span class="meta">@NonNull</span> Observer&lt;? <span class="built_in">super</span> T&gt; observer)</span> &#123;</span><br><span class="line">    assertMainThread(<span class="string">&quot;observeForever&quot;</span>);</span><br><span class="line">    <span class="type">AlwaysActiveObserver</span> <span class="variable">wrapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AlwaysActiveObserver</span>(observer);</span><br><span class="line">    <span class="type">ObserverWrapper</span> <span class="variable">existing</span> <span class="operator">=</span> mObservers.putIfAbsent(observer, wrapper);</span><br><span class="line">    <span class="keyword">if</span> (existing <span class="keyword">instanceof</span> LiveData.LifecycleBoundObserver) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Cannot add the same observer&quot;</span></span><br><span class="line">                + <span class="string">&quot; with different lifecycles&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (existing != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    wrapper.activeStateChanged(<span class="literal">true</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="LifecycleBoundObserver"><a href="#LifecycleBoundObserver" class="headerlink" title="LifecycleBoundObserver"></a>LifecycleBoundObserver</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">LifecycleBoundObserver</span> <span class="keyword">extends</span> <span class="title class_">ObserverWrapper</span> <span class="keyword">implements</span> <span class="title class_">LifecycleEventObserver</span> &#123;</span><br><span class="line">    <span class="meta">@NonNull</span></span><br><span class="line">    <span class="keyword">final</span> LifecycleOwner mOwner;</span><br><span class="line"></span><br><span class="line">    LifecycleBoundObserver(<span class="meta">@NonNull</span> LifecycleOwner owner, Observer&lt;? <span class="built_in">super</span> T&gt; observer) &#123;</span><br><span class="line">        <span class="built_in">super</span>(observer);</span><br><span class="line">        mOwner = owner;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">shouldBeActive</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> mOwner.getLifecycle().getCurrentState().isAtLeast(STARTED);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onStateChanged</span><span class="params">(<span class="meta">@NonNull</span> LifecycleOwner source,</span></span><br><span class="line"><span class="params">            <span class="meta">@NonNull</span> Lifecycle.Event event)</span> &#123;</span><br><span class="line">        Lifecycle.<span class="type">State</span> <span class="variable">currentState</span> <span class="operator">=</span> mOwner.getLifecycle().getCurrentState();</span><br><span class="line">        <span class="keyword">if</span> (currentState == DESTROYED) &#123;</span><br><span class="line">            removeObserver(mObserver);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        Lifecycle.<span class="type">State</span> <span class="variable">prevState</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">while</span> (prevState != currentState) &#123;</span><br><span class="line">            prevState = currentState;</span><br><span class="line">            activeStateChanged(shouldBeActive());</span><br><span class="line">            currentState = mOwner.getLifecycle().getCurrentState();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">isAttachedTo</span><span class="params">(LifecycleOwner owner)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> mOwner == owner;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">detachObserver</span><span class="params">()</span> &#123;</span><br><span class="line">        mOwner.getLifecycle().removeObserver(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>åŒæ—¶å®ç°äº†<code>LifecycleEventObserver</code>ï¼Œå¯ä»¥è§‚å¯Ÿ<code>lifecycle</code></li><li>ä¿å­˜å¯¹åº”çš„<code>lifecycleOwner</code></li><li>æ ¹æ®<code>shouldBeActive</code>ï¼Œå½“å…³è”çš„<code>Lifecycle</code>åˆ°è¾¾äº†<code>started</code>åŠä»¥åçš„çŠ¶æ€ï¼Œå°±æ˜¯<code>active</code>çš„äº†</li><li>å½“<code>lifecycle</code>çŠ¶æ€å˜åŒ–æ—¶<ul><li>å¦‚æœåˆ°äº†<code>destroyed</code>,åˆ™è°ƒç”¨å¤–éƒ¨ç±»çš„<code>removeObserver</code>ç§»é™¤å½“å‰<code>observer</code></li><li>ç„¶åè¿›ä¸€ä¸ªå¾ªç¯ï¼Œè°ƒç”¨<code>activeStateChanged</code>æ›´æ–°å½“å‰çš„activeçŠ¶æ€ï¼Œç›´åˆ°ä¸¤æ¬¡è·å–<code>lifecycle</code>çš„å½“å‰çŠ¶æ€éƒ½ç›¸åŒæ—¶ï¼Œé€€å‡ºå¾ªç¯</li></ul></li></ul><h3 id="æ·»åŠ ä¸€ä¸ªLifecycleBoundObserver"><a href="#æ·»åŠ ä¸€ä¸ªLifecycleBoundObserver" class="headerlink" title="æ·»åŠ ä¸€ä¸ªLifecycleBoundObserver"></a>æ·»åŠ ä¸€ä¸ªLifecycleBoundObserver</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MainThread</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">observe</span><span class="params">(<span class="meta">@NonNull</span> LifecycleOwner owner, <span class="meta">@NonNull</span> Observer&lt;? <span class="built_in">super</span> T&gt; observer)</span> &#123;</span><br><span class="line">    assertMainThread(<span class="string">&quot;observe&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (owner.getLifecycle().getCurrentState() == DESTROYED) &#123;</span><br><span class="line">        <span class="comment">// ignore</span></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">LifecycleBoundObserver</span> <span class="variable">wrapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LifecycleBoundObserver</span>(owner, observer);</span><br><span class="line">    <span class="type">ObserverWrapper</span> <span class="variable">existing</span> <span class="operator">=</span> mObservers.putIfAbsent(observer, wrapper);</span><br><span class="line">    <span class="keyword">if</span> (existing != <span class="literal">null</span> &amp;&amp; !existing.isAttachedTo(owner)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Cannot add the same observer&quot;</span></span><br><span class="line">                + <span class="string">&quot; with different lifecycles&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (existing != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    owner.getLifecycle().addObserver(wrapper);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>åˆ›å»º<code>LifecycleBoundObserver</code>ï¼Œå¹¶ç«‹åˆ»å°†å…¶æ³¨å†Œåˆ°<code>lifecycle</code>çš„<code>observer</code>ä¸­</li><li><code>lifecycle</code>æ·»åŠ <code>observer</code>åï¼Œä¼šç«‹åˆ»ä¼ é€’çŠ¶æ€ï¼Œè¿™é‡Œä¹Ÿå¯ä»¥ç«‹åˆ»æ ¹æ®<code>lifecycle</code>çš„çŠ¶æ€æ›´æ–°<code>active</code>çŠ¶æ€ï¼Œè¿›è€Œå‘è§‚å¯Ÿè€…åˆ†æ´¾å½“å‰å€¼</li></ul><h3 id="ç§»é™¤observer"><a href="#ç§»é™¤observer" class="headerlink" title="ç§»é™¤observer"></a>ç§»é™¤observer</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MainThread</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">removeObserver</span><span class="params">(<span class="meta">@NonNull</span> <span class="keyword">final</span> Observer&lt;? <span class="built_in">super</span> T&gt; observer)</span> &#123;</span><br><span class="line">    assertMainThread(<span class="string">&quot;removeObserver&quot;</span>);</span><br><span class="line">    <span class="type">ObserverWrapper</span> <span class="variable">removed</span> <span class="operator">=</span> mObservers.remove(observer);</span><br><span class="line">    <span class="keyword">if</span> (removed == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    removed.detachObserver();</span><br><span class="line">    removed.activeStateChanged(<span class="literal">false</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Removes all observers that are tied to the given &#123;<span class="doctag">@link</span> LifecycleOwner&#125;.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> owner The &#123;<span class="doctag">@code</span> LifecycleOwner&#125; scope for the observers to be removed.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SuppressWarnings(&quot;WeakerAccess&quot;)</span></span><br><span class="line"><span class="meta">@MainThread</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">removeObservers</span><span class="params">(<span class="meta">@NonNull</span> <span class="keyword">final</span> LifecycleOwner owner)</span> &#123;</span><br><span class="line">    assertMainThread(<span class="string">&quot;removeObservers&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (Map.Entry&lt;Observer&lt;? <span class="built_in">super</span> T&gt;, ObserverWrapper&gt; entry : mObservers) &#123;</span><br><span class="line">        <span class="keyword">if</span> (entry.getValue().isAttachedTo(owner)) &#123;</span><br><span class="line">            removeObserver(entry.getKey());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ä»mapä¸­åˆ é™¤observer<ul><li>è°ƒç”¨<code>activeStateChanged(false)</code>, å°†å…¶<code>active</code>çŠ¶æ€å˜æˆ<code>false</code>ï¼Œå‡å°‘æ´»è·ƒçŠ¶æ€çš„æ•°é‡ï¼ŒæŒ‰éœ€è°ƒç”¨onInactive(),</li><li>è°ƒç”¨<code>detachObserver</code>ï¼Œå¦‚æœæ˜¯<code>LifecycleBoundObserver</code>ï¼Œå°±åœæ­¢ä»lifecycleä¸­è§‚å¯ŸçŠ¶æ€ã€‚</li></ul></li></ul><h2 id="MutableLiveData"><a href="#MutableLiveData" class="headerlink" title="MutableLiveData"></a>MutableLiveData</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SuppressWarnings(&quot;WeakerAccess&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MutableLiveData</span>&lt;T&gt; <span class="keyword">extends</span> <span class="title class_">LiveData</span>&lt;T&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Creates a MutableLiveData initialized with the given &#123;<span class="doctag">@code</span> value&#125;.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value initial value</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MutableLiveData</span><span class="params">(T value)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Creates a MutableLiveData with no value assigned to it.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MutableLiveData</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postValue</span><span class="params">(T value)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.postValue(value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setValue</span><span class="params">(T value)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.setValue(value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å¥½çŒ«çŒ«ç®€æ´</li><li>postValueå’ŒsetValueå‡çº§æˆpublicäº†</li></ul><h2 id="MediatorLiveData"><a href="#MediatorLiveData" class="headerlink" title="MediatorLiveData"></a>MediatorLiveData</h2><ul><li>é…ç½®å¤šä¸ªæ›´æ–°æº<code>LiveData</code>ï¼Œå½“è§‚å¯Ÿåˆ°ä¸€ä¸ª<code>LiveData</code>å‘ç”Ÿæ”¹å˜ï¼Œåˆ™æ‰§è¡Œç›¸åº”çš„åŠ¨ä½œ</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MediatorLiveData</span>&lt;T&gt; <span class="keyword">extends</span> <span class="title class_">MutableLiveData</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> SafeIterableMap&lt;LiveData&lt;?&gt;, Source&lt;?&gt;&gt; mSources = <span class="keyword">new</span> <span class="title class_">SafeIterableMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Creates a MediatorLiveData with no value assigned to it.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MediatorLiveData</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Creates a MediatorLiveData initialized with the given &#123;<span class="doctag">@code</span> value&#125;.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value initial value</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MediatorLiveData</span><span class="params">(T value)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Starts to listen to the given &#123;<span class="doctag">@code</span> source&#125; LiveData, &#123;<span class="doctag">@code</span> onChanged&#125; observer will be</span></span><br><span class="line"><span class="comment">     * called when &#123;<span class="doctag">@code</span> source&#125; value was changed.</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@code</span> onChanged&#125; callback will be called only when this &#123;<span class="doctag">@code</span> MediatorLiveData&#125; is active.</span></span><br><span class="line"><span class="comment">     * &lt;p&gt; If the given LiveData is already added as a source but with a different Observer,</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@link</span> IllegalArgumentException&#125; will be thrown.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> source    the &#123;<span class="doctag">@code</span> LiveData&#125; to listen to</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> onChanged The observer that will receive the events</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &lt;S&gt;       The type of data hold by &#123;<span class="doctag">@code</span> source&#125; LiveData</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@MainThread</span></span><br><span class="line">    <span class="keyword">public</span> &lt;S&gt; <span class="keyword">void</span> <span class="title function_">addSource</span><span class="params">(<span class="meta">@NonNull</span> LiveData&lt;S&gt; source, <span class="meta">@NonNull</span> Observer&lt;? <span class="built_in">super</span> S&gt; onChanged)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (source == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NullPointerException</span>(<span class="string">&quot;source cannot be null&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        Source&lt;S&gt; e = <span class="keyword">new</span> <span class="title class_">Source</span>&lt;&gt;(source, onChanged);</span><br><span class="line">        Source&lt;?&gt; existing = mSources.putIfAbsent(source, e);</span><br><span class="line">        <span class="keyword">if</span> (existing != <span class="literal">null</span> &amp;&amp; existing.mObserver != onChanged) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(</span><br><span class="line">                    <span class="string">&quot;This source was already added with the different observer&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (existing != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (hasActiveObservers()) &#123;</span><br><span class="line">            e.plug();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Stops to listen the given &#123;<span class="doctag">@code</span> LiveData&#125;.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> toRemote &#123;<span class="doctag">@code</span> LiveData&#125; to stop to listen</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &lt;S&gt;      the type of data hold by &#123;<span class="doctag">@code</span> source&#125; LiveData</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@MainThread</span></span><br><span class="line">    <span class="keyword">public</span> &lt;S&gt; <span class="keyword">void</span> <span class="title function_">removeSource</span><span class="params">(<span class="meta">@NonNull</span> LiveData&lt;S&gt; toRemote)</span> &#123;</span><br><span class="line">        Source&lt;?&gt; source = mSources.remove(toRemote);</span><br><span class="line">        <span class="keyword">if</span> (source != <span class="literal">null</span>) &#123;</span><br><span class="line">            source.unplug();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@CallSuper</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onActive</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;LiveData&lt;?&gt;, Source&lt;?&gt;&gt; source : mSources) &#123;</span><br><span class="line">            source.getValue().plug();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@CallSuper</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onInactive</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;LiveData&lt;?&gt;, Source&lt;?&gt;&gt; source : mSources) &#123;</span><br><span class="line">            source.getValue().unplug();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Source</span>&lt;V&gt; <span class="keyword">implements</span> <span class="title class_">Observer</span>&lt;V&gt; &#123;</span><br><span class="line">        <span class="keyword">final</span> LiveData&lt;V&gt; mLiveData;</span><br><span class="line">        <span class="keyword">final</span> Observer&lt;? <span class="built_in">super</span> V&gt; mObserver;</span><br><span class="line">        <span class="type">int</span> <span class="variable">mVersion</span> <span class="operator">=</span> START_VERSION;</span><br><span class="line"></span><br><span class="line">        Source(LiveData&lt;V&gt; liveData, <span class="keyword">final</span> Observer&lt;? <span class="built_in">super</span> V&gt; observer) &#123;</span><br><span class="line">            mLiveData = liveData;</span><br><span class="line">            mObserver = observer;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">void</span> <span class="title function_">plug</span><span class="params">()</span> &#123;</span><br><span class="line">            mLiveData.observeForever(<span class="built_in">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">void</span> <span class="title function_">unplug</span><span class="params">()</span> &#123;</span><br><span class="line">            mLiveData.removeObserver(<span class="built_in">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onChanged</span><span class="params">(<span class="meta">@Nullable</span> V v)</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (mVersion != mLiveData.getVersion()) &#123;</span><br><span class="line">                mVersion = mLiveData.getVersion();</span><br><span class="line">                mObserver.onChanged(v);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ„Ÿè§‰å°±æ˜¯å¸®æˆ‘ä»¬<code>observeForever</code>ï¼Œæ²¡ä»€ä¹ˆç‰¹æ®Šçš„</p><h2 id="CoroutineLiveData"><a href="#CoroutineLiveData" class="headerlink" title="CoroutineLiveData"></a>CoroutineLiveData</h2><ul><li>è¿™ç§livedataæä¾›ç»™ä¸€ä¸ªæ‰§è¡Œå¼‚æ­¥çš„åç¨‹ï¼Œåœ¨æºç¨‹ä¸­è¿›è¡Œè€—æ—¶æ“ä½œï¼Œé€šè¿‡<code>emit</code>, <code>emitSource</code>å‘é€æ•°æ®ï¼Œç»™è§‚å¯Ÿè€…è¿›è¡Œè§‚å¯Ÿ</li><li>å…¶ä»–çš„ä½¿ç”¨æ–¹æ³•å’Œ<code>LiveData</code>ä¸€æ ·ï¼Œå¯¹å…¶è¿›è¡Œè§‚å¯Ÿï¼Œå½“æ•°æ®å˜åŒ–æ—¶ï¼Œæ¥æ”¶åˆ°æ•°æ®å˜åŒ–</li></ul><h3 id="ä½¿ç”¨æ–¹æ³•"><a href="#ä½¿ç”¨æ–¹æ³•" class="headerlink" title="ä½¿ç”¨æ–¹æ³•"></a>ä½¿ç”¨æ–¹æ³•</h3><ul><li>emit:</li></ul><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// a LiveData that tries to load the `User` from local cache first and then tries to fetch</span></span><br><span class="line"><span class="comment">// from the server and also yields the updated value</span></span><br><span class="line"><span class="keyword">val</span> user = liveData &#123;</span><br><span class="line">    <span class="comment">// check local storage</span></span><br><span class="line">    <span class="keyword">val</span> cached = cache.loadUser(id)</span><br><span class="line">    <span class="keyword">if</span> (cached != <span class="literal">null</span>) &#123;</span><br><span class="line">        emit(cached)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (cached == <span class="literal">null</span> || cached.isStale()) &#123;</span><br><span class="line">        <span class="keyword">val</span> fresh = api.fetch(id) <span class="comment">// errors are ignored for brevity</span></span><br><span class="line">        cache.save(fresh)</span><br><span class="line">        emit(fresh)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>è¿™é‡ŒliveDataå‡½æ•°äº§ç”Ÿäº†ä¸€ä¸ª<code>LiveData</code>ï¼Œå¹¶æä¾›äº†ä¸€ä¸ªä»£ç å—ï¼Œè¿™ä¸ªä»£ç å—å›è¿›è¡Œè€—æ—¶æ“ä½œï¼Œé€šè¿‡<code>emit</code>å‡½æ•°æ›´æ–°<code>LiveData</code>çš„æ•°æ®</p><ul><li>å‡ ä¸ªé—®é¢˜<ul><li>ä»£ç å—ä½•æ—¶æ‰§è¡Œï¼Ÿ</li><li>emitå¦‚ä½•æ›´æ–°æ•°æ®ï¼Ÿ</li></ul></li></ul></blockquote><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// a LiveData that immediately receives a LiveData&lt;User&gt; from the database and yields it as a</span></span><br><span class="line"><span class="comment">// source but also tries to back-fill the database from the server</span></span><br><span class="line"><span class="keyword">val</span> user = liveData &#123;</span><br><span class="line">    <span class="keyword">val</span> fromDb: LiveData&lt;User&gt; = roomDatabase.loadUser(id)</span><br><span class="line">    emitSource(fromDb)</span><br><span class="line">    <span class="keyword">val</span> updated = api.fetch(id) <span class="comment">// errors are ignored for brevity</span></span><br><span class="line">    roomDatabase.insert(updated)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ä»æ•°æ®åº“è¯»å–<code>User</code>ç±»å‹çš„æ•°æ®ï¼Œè¿”å›<code>fromDb</code>ï¼Œç„¶åé€šè¿‡<code>emitSource</code>è§‚å¯Ÿè¯¥<code>fromDb</code>ï¼Œå½“<code>fromDb</code>æ›´æ–°æ—¶ï¼Œæ›´æ–°<code>user</code></li><li>åŒæ—¶æ‰§è¡Œå…¶ä»–ç›¸å…³çš„ï¼Œæ•°æ®åº“æ›´æ–°æ“ä½œ</li></ul><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> <span class="title">liveData</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    context: <span class="type">CoroutineContext</span> = EmptyCoroutineContext,</span></span></span><br><span class="line"><span class="params"><span class="function">    timeoutInMs: <span class="type">Long</span> = DEFAULT_TIMEOUT,</span></span></span><br><span class="line"><span class="params"><span class="function">    block: <span class="type">suspend</span> <span class="type">LiveDataScope</span>&lt;<span class="type">T</span>&gt;.() -&gt; <span class="type">Unit</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>: LiveData&lt;T&gt; = CoroutineLiveData(context, timeoutInMs, block)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ”¯æŒDurationçš„Api</span></span><br><span class="line"><span class="meta">@RequiresApi(Build.VERSION_CODES.O)</span></span><br><span class="line"><span class="meta">@JvmOverloads</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> <span class="title">liveData</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    timeout: <span class="type">Duration</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    context: <span class="type">CoroutineContext</span> = EmptyCoroutineContext,</span></span></span><br><span class="line"><span class="params"><span class="function">    block: <span class="type">suspend</span> <span class="type">LiveDataScope</span>&lt;<span class="type">T</span>&gt;.() -&gt; <span class="type">Unit</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>: LiveData&lt;T&gt; = CoroutineLiveData(context, Api26Impl.toMillis(timeout), block)</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequiresApi(26)</span></span><br><span class="line"><span class="keyword">internal</span> <span class="keyword">object</span> Api26Impl &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">toMillis</span><span class="params">(timeout: <span class="type">Duration</span>)</span></span>: <span class="built_in">Long</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> timeout.toMillis()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å¯ä»¥ä¼ å…¥ä¸€ä¸ª<code>CoroutineContext</code>ï¼Œç”¨äºæŒ‡å®šåç¨‹çš„æ‰§è¡Œç¯å¢ƒï¼Œé»˜è®¤æ˜¯<code>EmptyCoroutineContext</code></li><li>å¯ä»¥ä¼ å…¥ä¸€ä¸ª<code>timeoutInMs</code>ï¼Œå…·ä½“ä½œç”¨ä¸‹é¢å†è¯´</li></ul><h3 id="CoroutineLiveData-1"><a href="#CoroutineLiveData-1" class="headerlink" title="CoroutineLiveData"></a>CoroutineLiveData</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title class_">CoroutineLiveData</span>&lt;<span class="type">T</span>&gt;(</span><br><span class="line">    context: CoroutineContext = EmptyCoroutineContext,</span><br><span class="line">    timeoutInMs: <span class="built_in">Long</span> = DEFAULT_TIMEOUT,</span><br><span class="line">    block: Block&lt;T&gt;</span><br><span class="line">) : MediatorLiveData&lt;T&gt;() &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> blockRunner: BlockRunner&lt;T&gt;?</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> emittedSource: EmittedSource? = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span> &#123;</span><br><span class="line">        <span class="comment">// use an intermediate supervisor job so that if we cancel individual block runs due to losing</span></span><br><span class="line">        <span class="comment">// observers, it won&#x27;t cancel the given context as we only cancel w/ the intention of possibly</span></span><br><span class="line">        <span class="comment">// relaunching using the same parent context.</span></span><br><span class="line">        <span class="keyword">val</span> supervisorJob = SupervisorJob(context[Job])</span><br><span class="line"></span><br><span class="line">        <span class="comment">// The scope for this LiveData where we launch every block Job.</span></span><br><span class="line">        <span class="comment">// We default to Main dispatcher but developer can override it.</span></span><br><span class="line">        <span class="comment">// The supervisor job is added last to isolate block runs.</span></span><br><span class="line">        <span class="keyword">val</span> scope = CoroutineScope(Dispatchers.Main.immediate + context + supervisorJob)</span><br><span class="line">        blockRunner = BlockRunner(</span><br><span class="line">            liveData = <span class="keyword">this</span>,</span><br><span class="line">            block = block,</span><br><span class="line">            timeoutInMs = timeoutInMs,</span><br><span class="line">            scope = scope</span><br><span class="line">        ) &#123;</span><br><span class="line">            blockRunner = <span class="literal">null</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">internal</span> <span class="keyword">suspend</span> <span class="function"><span class="keyword">fun</span> <span class="title">emitSource</span><span class="params">(source: <span class="type">LiveData</span>&lt;<span class="type">T</span>&gt;)</span></span>: DisposableHandle &#123;</span><br><span class="line">        clearSource()</span><br><span class="line">        <span class="keyword">val</span> newSource = addDisposableSource(source)</span><br><span class="line">        emittedSource = newSource</span><br><span class="line">        <span class="keyword">return</span> newSource</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">internal</span> <span class="keyword">suspend</span> <span class="function"><span class="keyword">fun</span> <span class="title">clearSource</span><span class="params">()</span></span> &#123;</span><br><span class="line">        emittedSource?.disposeNow()</span><br><span class="line">        emittedSource = <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onActive</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onActive()</span><br><span class="line">        blockRunner?.maybeRun()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onInactive</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onInactive()</span><br><span class="line">        blockRunner?.cancel()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>onActive</code>å’Œ<code>onInactive</code>ä¸¤ä¸ªå‡½æ•°çš„å†…å®¹æ ‡æ˜ï¼Œä»£ç å—ä¼šåœ¨æ´»è·ƒè§‚å¯Ÿè€…æ•°é‡å¤§äº1æ—¶å¼€å§‹æ‰§è¡Œï¼Œæ²¡æœ‰æ´»è·ƒè§‚å¯Ÿè€…æ—¶è¢«<code>cancel</code></li><li>æ³¨æ„åˆ°<code>CoroutineLiveData</code>æ˜¯ä¸€ä¸ª<code>MediatorLiveData</code>ï¼Œä¸‹é¢è¦è€ƒ</li></ul><h3 id="Blockçš„è¿è¡Œå’Œå–æ¶ˆ"><a href="#Blockçš„è¿è¡Œå’Œå–æ¶ˆ" class="headerlink" title="Blockçš„è¿è¡Œå’Œå–æ¶ˆ"></a>Blockçš„è¿è¡Œå’Œå–æ¶ˆ</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title class_">BlockRunner</span>&lt;<span class="type">T</span>&gt;(</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> liveData: CoroutineLiveData&lt;T&gt;,</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> block: Block&lt;T&gt;,</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> timeoutInMs: <span class="built_in">Long</span>,</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> scope: CoroutineScope,</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> onDone: () -&gt; <span class="built_in">Unit</span></span><br><span class="line">) &#123;</span><br><span class="line">    <span class="comment">// currently running block job.</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> runningJob: Job? = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// cancelation job created in cancel.</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> cancellationJob: Job? = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@MainThread</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">maybeRun</span><span class="params">()</span></span> &#123;</span><br><span class="line">        cancellationJob?.cancel()</span><br><span class="line">        cancellationJob = <span class="literal">null</span></span><br><span class="line">        <span class="keyword">if</span> (runningJob != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        runningJob = scope.launch &#123;</span><br><span class="line">            <span class="keyword">val</span> liveDataScope = LiveDataScopeImpl(liveData, coroutineContext)</span><br><span class="line">            block(liveDataScope)</span><br><span class="line">            onDone()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@MainThread</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">cancel</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (cancellationJob != <span class="literal">null</span>) &#123;</span><br><span class="line">            error(<span class="string">&quot;Cancel call cannot happen without a maybeRun&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        cancellationJob = scope.launch(Dispatchers.Main.immediate) &#123;</span><br><span class="line">            delay(timeoutInMs)</span><br><span class="line">            <span class="keyword">if</span> (!liveData.hasActiveObservers()) &#123;</span><br><span class="line">                <span class="comment">// one last check on active observers to avoid any race condition between starting</span></span><br><span class="line">                <span class="comment">// a running coroutine and cancelation</span></span><br><span class="line">                runningJob?.cancel()</span><br><span class="line">                runningJob = <span class="literal">null</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>maybeRunå¾ˆç®€å•ï¼Œå°±æ˜¯åœ¨æŒ‡å®šçš„<code>scope</code>ä¸­å¯åŠ¨ä¸€ä¸ªåç¨‹ï¼Œæ‰§è¡Œ<code>block</code></p></li><li><p>cancelä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯åœ¨åç¨‹ä¸­å…ˆç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œç„¶ååˆ¤æ–­æ˜¯å¦æœ‰æ´»è·ƒçš„è§‚å¯Ÿè€…ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™å–æ¶ˆ<code>runningJob</code></p></li><li><p>æˆ‘ä»¬è§‚å¯Ÿåˆ°blockæ˜¯<code>LiveDataScope</code>çš„æ‰©å±•å‡½æ•°ï¼Œå¯¹åº”çš„å…·ä½“å®ç°ç±»æ˜¯<code>LiveDataScopeImpl</code></p></li></ul><h3 id="LiveDataScope"><a href="#LiveDataScope" class="headerlink" title="LiveDataScope"></a>LiveDataScope</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">LiveDataScope</span>&lt;<span class="type">T</span>&gt; &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Set&#x27;s the [LiveData]&#x27;s value to the given [value]. If you&#x27;ve called [emitSource] previously,</span></span><br><span class="line"><span class="comment">     * calling [emit] will remove that source.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * Note that this function suspends until the value is set on the [LiveData].</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value The new value for the [LiveData]</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> emitSource</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">suspend</span> <span class="function"><span class="keyword">fun</span> <span class="title">emit</span><span class="params">(value: <span class="type">T</span>)</span></span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Add the given [LiveData] as a source, similar to [MediatorLiveData.addSource]. Calling this</span></span><br><span class="line"><span class="comment">     * method will remove any source that was yielded before via [emitSource].</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> source The [LiveData] instance whose values will be dispatched from the current</span></span><br><span class="line"><span class="comment">     * [LiveData].</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> emit</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> MediatorLiveData.addSource</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> MediatorLiveData.removeSource</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">suspend</span> <span class="function"><span class="keyword">fun</span> <span class="title">emitSource</span><span class="params">(source: <span class="type">LiveData</span>&lt;<span class="type">T</span>&gt;)</span></span>: DisposableHandle</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * References the current value of the [LiveData].</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * If the block never `emit`ed a value, [latestValue] will be `null`. You can use this</span></span><br><span class="line"><span class="comment">     * value to check what was then latest value `emit`ed by your `block` before it got cancelled.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * Note that if the block called [emitSource], then `latestValue` will be last value</span></span><br><span class="line"><span class="comment">     * dispatched by the `source` [LiveData].</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">val</span> latestValue: T?</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®šä¹‰äº†emitå‡½æ•°å’ŒemitSourceå‡½æ•°</p><h3 id="LiveDataScopeImpl"><a href="#LiveDataScopeImpl" class="headerlink" title="LiveDataScopeImpl"></a>LiveDataScopeImpl</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title class_">LiveDataScopeImpl</span>&lt;<span class="type">T</span>&gt;(</span><br><span class="line">    <span class="keyword">internal</span> <span class="keyword">var</span> target: CoroutineLiveData&lt;T&gt;,</span><br><span class="line">    context: CoroutineContext</span><br><span class="line">) : LiveDataScope&lt;T&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">val</span> latestValue: T?</span><br><span class="line">        <span class="keyword">get</span>() = target.value</span><br><span class="line"></span><br><span class="line">    <span class="comment">// use `liveData` provided context + main dispatcher to communicate with the target</span></span><br><span class="line">    <span class="comment">// LiveData. This gives us main thread safety as well as cancellation cooperation</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> coroutineContext = context + Dispatchers.Main.immediate</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">suspend</span> <span class="function"><span class="keyword">fun</span> <span class="title">emitSource</span><span class="params">(source: <span class="type">LiveData</span>&lt;<span class="type">T</span>&gt;)</span></span>: DisposableHandle =</span><br><span class="line">        withContext(coroutineContext) &#123;</span><br><span class="line">            <span class="keyword">return</span><span class="symbol">@withContext</span> target.emitSource(source)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SuppressLint(<span class="string">&quot;NullSafeMutableLiveData&quot;</span>)</span></span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">suspend</span> <span class="function"><span class="keyword">fun</span> <span class="title">emit</span><span class="params">(value: <span class="type">T</span>)</span></span> = withContext(coroutineContext) &#123;</span><br><span class="line">        target.clearSource()</span><br><span class="line">        target.value = value</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>emitå‡½æ•°çš„å®ç°æ˜¯è°ƒç”¨<code>CoroutineLiveData</code>çš„<code>clearSource</code>,å¹¶æ›´æ–°<code>LiveData</code>å€¼</li><li>emitSourceçš„å®ç°æ˜¯åœ¨åç¨‹ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œ<code>CoroutineLiveData</code>çš„<code>emitSource</code></li></ul><h3 id="CoroutineLiveDataçš„emitSource"><a href="#CoroutineLiveDataçš„emitSource" class="headerlink" title="CoroutineLiveDataçš„emitSource"></a>CoroutineLiveDataçš„emitSource</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">internal</span> <span class="keyword">suspend</span> <span class="function"><span class="keyword">fun</span> <span class="title">clearSource</span><span class="params">()</span></span> &#123;</span><br><span class="line">    emittedSource?.disposeNow()</span><br><span class="line">    emittedSource = <span class="literal">null</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">internal</span> <span class="keyword">suspend</span> <span class="function"><span class="keyword">fun</span> <span class="title">emitSource</span><span class="params">(source: <span class="type">LiveData</span>&lt;<span class="type">T</span>&gt;)</span></span>: DisposableHandle &#123;</span><br><span class="line">    clearSource()</span><br><span class="line">    <span class="keyword">val</span> newSource = addDisposableSource(source)</span><br><span class="line">    emittedSource = newSource</span><br><span class="line">    <span class="keyword">return</span> newSource</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>emitSourceé¦–å…ˆè°ƒç”¨clearSource<ul><li>å°†å·²å‘å°„çš„sourceè¿›è¡Œdispose</li></ul></li><li>åˆ›å»ºæ–°çš„emittedSource</li></ul><h4 id="addDisposableSource"><a href="#addDisposableSource" class="headerlink" title="addDisposableSource"></a>addDisposableSource</h4><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">internal</span> <span class="keyword">suspend</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> MediatorLiveData<span class="type">&lt;T&gt;</span>.<span class="title">addDisposableSource</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    source: <span class="type">LiveData</span>&lt;<span class="type">T</span>&gt;</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>: EmittedSource = withContext(Dispatchers.Main.immediate) &#123;</span><br><span class="line">    addSource(source) &#123;</span><br><span class="line">        value = it</span><br><span class="line">    &#125;</span><br><span class="line">    EmittedSource(</span><br><span class="line">        source = source,</span><br><span class="line">        mediator = <span class="keyword">this</span><span class="symbol">@addDisposableSource</span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>CoroutineLiveDataæœ¬èº«å°±æ˜¯ä¸€ä¸ªMediatorLiveData</li><li>addDisposableSourceæ—¶é¦–å…ˆé€šè¿‡addSourceä¸ºè‡ªèº«æ·»åŠ ä¸€ä¸ªsource</li><li>åœ¨è¯¥sourceå˜åŒ–æ—¶ï¼Œæ›´æ–°è‡ªèº«çš„å€¼</li><li>åˆ›å»ºä¸€ä¸ª<code>EmittedSource</code>ï¼Œå¹¶è¿”å›</li></ul><h3 id="CoroutineLiveDataçš„clearSource"><a href="#CoroutineLiveDataçš„clearSource" class="headerlink" title="CoroutineLiveDataçš„clearSource"></a>CoroutineLiveDataçš„clearSource</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">internal</span> <span class="keyword">suspend</span> <span class="function"><span class="keyword">fun</span> <span class="title">clearSource</span><span class="params">()</span></span> &#123;</span><br><span class="line">    emittedSource?.disposeNow()</span><br><span class="line">    emittedSource = <span class="literal">null</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="EmittedSource"><a href="#EmittedSource" class="headerlink" title="EmittedSource"></a>EmittedSource</h4><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title class_">EmittedSource</span>(</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> source: LiveData&lt;*&gt;,</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> mediator: MediatorLiveData&lt;*&gt;</span><br><span class="line">) : DisposableHandle &#123;</span><br><span class="line">    <span class="comment">// @MainThread</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> disposed = <span class="literal">false</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Unlike [dispose] which cannot be sync because it not a coroutine (and we do not want to</span></span><br><span class="line"><span class="comment">     * lock), this version is a suspend function and does not return until source is removed.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">suspend</span> <span class="function"><span class="keyword">fun</span> <span class="title">disposeNow</span><span class="params">()</span></span> = withContext(Dispatchers.Main.immediate) &#123;</span><br><span class="line">        removeSource()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">dispose</span><span class="params">()</span></span> &#123;</span><br><span class="line">        CoroutineScope(Dispatchers.Main.immediate).launch &#123;</span><br><span class="line">            removeSource()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@MainThread</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">removeSource</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!disposed) &#123;</span><br><span class="line">            mediator.removeSource(source)</span><br><span class="line">            disposed = <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>emittedSourceå°±æ˜¯ä¸ºäº†æ–¹ä¾¿disposeè€Œåˆ›å»ºçš„ï¼Œdisposeå°±æ˜¯æŠŠsourceç§»é™¤</p><ul><li>åœ¨blockä¸­ï¼Œå¦‚æœæˆ‘ä»¬emitSourceäº†ï¼Œå¦‚æœåœ¨æœªæ¥æŸæ—¶åˆ»ï¼Œæˆ‘ä»¬ä¸å†éœ€è¦è¿™ä¸ªsourceäº†ï¼Œå¯ä»¥è°ƒç”¨<code>emitSource</code>è¿”å›çš„<code>EmittedSource</code>å¯¹è±¡çš„<code>dispose</code>æ–¹æ³•æ¥ç§»é™¤</li><li>emitå’ŒemitSourceå­˜åœ¨äº’æ–¥æ€§ï¼Œä½¿ç”¨emitåï¼Œä¹‹å‰çš„sourceå°±ä¼šå¤±æ•ˆ</li></ul><h2 id="PublisherLiveData"><a href="#PublisherLiveData" class="headerlink" title="PublisherLiveData"></a>PublisherLiveData</h2><ul><li>rxjavaå…¼å®¹çš„livedataï¼Œä½¿ç”¨rxjavaçš„<code>Publisher</code>ä½œä¸ºæ•°æ®æº</li></ul>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;LiveData&quot;&gt;&lt;a href=&quot;#LiveData&quot; class=&quot;headerlink&quot; title=&quot;LiveData&quot;&gt;&lt;/a&gt;LiveData&lt;/h2&gt;&lt;h3 id=&quot;LiveDataçš„è§‚å¯Ÿè€…&quot;&gt;&lt;a href=&quot;#LiveDataçš„è§‚å¯Ÿè€…&quot; class=&quot;headerlink&quot; title=&quot;LiveDataçš„è§‚å¯Ÿè€…&quot;&gt;&lt;/a&gt;LiveDataçš„è§‚å¯Ÿè€…&lt;/h3&gt;&lt;figure class=&quot;highlight kotlin&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;interface&lt;/span&gt; Observer&lt;span class=&quot;type&quot;&gt;&amp;lt;T&amp;gt;&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     * Called when the data is changed to [value].&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onChanged&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(value: &lt;span class=&quot;type&quot;&gt;T&lt;/span&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;ul&gt;
&lt;li&gt;é€šè¿‡&lt;code&gt;onChanged&lt;/code&gt;å‡½æ•°åˆ†æ´¾æ•°æ®å˜åŒ–&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;æˆå‘˜&quot;&gt;&lt;a href=&quot;#æˆå‘˜&quot; class=&quot;headerlink&quot; title=&quot;æˆå‘˜&quot;&gt;&lt;/a&gt;æˆå‘˜&lt;/h3&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;@SuppressWarnings(&amp;quot;WeakerAccess&amp;quot;)&lt;/span&gt; &lt;span class=&quot;comment&quot;&gt;/* synthetic access */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;Object&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;mDataLock&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;title class_&quot;&gt;Object&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;START_VERSION&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; -&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;@SuppressWarnings(&amp;quot;WeakerAccess&amp;quot;)&lt;/span&gt; &lt;span class=&quot;comment&quot;&gt;/* synthetic access */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;Object&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;NOT_SET&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;title class_&quot;&gt;Object&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; SafeIterableMap&amp;lt;Observer&amp;lt;? &lt;span class=&quot;built_in&quot;&gt;super&lt;/span&gt; T&amp;gt;, ObserverWrapper&amp;gt; mObservers =&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;title class_&quot;&gt;SafeIterableMap&lt;/span&gt;&amp;lt;&amp;gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// how many observers are in active state&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;@SuppressWarnings(&amp;quot;WeakerAccess&amp;quot;)&lt;/span&gt; &lt;span class=&quot;comment&quot;&gt;/* synthetic access */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;mActiveCount&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// to handle active/inactive reentry, we guard with this boolean&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;boolean&lt;/span&gt; mChangingActiveState;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;volatile&lt;/span&gt; Object mData; &lt;span class=&quot;comment&quot;&gt;// 1ï¸âƒ£ï¼šå½“å‰çš„data&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// when setData is called, we set the pending data and actual data swap happens on the main&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// thread&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;@SuppressWarnings(&amp;quot;WeakerAccess&amp;quot;)&lt;/span&gt; &lt;span class=&quot;comment&quot;&gt;/* synthetic access */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;volatile&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;Object&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;mPendingData&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; NOT_SET; &lt;span class=&quot;comment&quot;&gt;// 2ï¸âƒ£ï¼šç»™å¤šçº¿ç¨‹ä½¿ç”¨çš„ï¼Œåœ¨4ï¸âƒ£mPostValueRunnableä¸­ä½¿ç”¨&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; mVersion; &lt;span class=&quot;comment&quot;&gt;// 3ï¸âƒ£ï¼šmVersionæ˜¯æ•°æ®ç‰ˆæœ¬&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;boolean&lt;/span&gt; mDispatchingValue;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;@SuppressWarnings(&amp;quot;FieldCanBeLocal&amp;quot;)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;boolean&lt;/span&gt; mDispatchInvalidated;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;Runnable&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;mPostValueRunnable&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;title class_&quot;&gt;Runnable&lt;/span&gt;() &amp;#123;&lt;span class=&quot;comment&quot;&gt;// 4ï¸âƒ£mPostValueRunnableï¼Œåœ¨ä¸»çº¿ç¨‹ä¸­å°†mPendingDataè®¾ç½®ä¸ºå½“å‰å€¼&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;meta&quot;&gt;@SuppressWarnings(&amp;quot;unchecked&amp;quot;)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;meta&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title function_&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        Object newValue;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;synchronized&lt;/span&gt; (mDataLock) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            newValue = mPendingData;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            mPendingData = NOT_SET;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        setValue((T) newValue);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="Android" scheme="https://jingtianer.github.io/home/categories/Android/"/>
    
    <category term="æ‰‹æ’¸Androidæºç " scheme="https://jingtianer.github.io/home/categories/Android/%E6%89%8B%E6%92%B8Android%E6%BA%90%E7%A0%81/"/>
    
    
    <category term="Android-å®˜æ–¹æºç " scheme="https://jingtianer.github.io/home/tags/Android-%E5%AE%98%E6%96%B9%E6%BA%90%E7%A0%81/"/>
    
  </entry>
  
  <entry>
    <title>åŸºç¡€03-Lifecycle</title>
    <link href="https://jingtianer.github.io/home/2024/07/31/Android%E9%AB%98%E7%BA%A7/%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/%E5%9F%BA%E7%A1%8003-Lifecycle/"/>
    <id>https://jingtianer.github.io/home/2024/07/31/Android%E9%AB%98%E7%BA%A7/%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/%E5%9F%BA%E7%A1%8003-Lifecycle/</id>
    <published>2024-07-31T13:15:36.000Z</published>
    <updated>2025-04-15T02:37:55.588Z</updated>
    
    <content type="html"><![CDATA[<h2 id="lifeCycleçš„Observer"><a href="#lifeCycleçš„Observer" class="headerlink" title="lifeCycleçš„Observer"></a>lifeCycleçš„Observer</h2><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">LifecycleObserver</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DefaultLifecycleObserver</span> : <span class="type">LifecycleObserver</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Notifies that `ON_CREATE` event occurred.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * This method will be called after the [LifecycleOwner]&#x27;s `onCreate`</span></span><br><span class="line"><span class="comment">     * method returns.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> owner the component, whose state was changed</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(owner: <span class="type">LifecycleOwner</span>)</span></span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Notifies that `ON_START` event occurred.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * This method will be called after the [LifecycleOwner]&#x27;s `onStart` method returns.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> owner the component, whose state was changed</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">fun</span> <span class="title">onStart</span><span class="params">(owner: <span class="type">LifecycleOwner</span>)</span></span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Notifies that `ON_RESUME` event occurred.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * This method will be called after the [LifecycleOwner]&#x27;s `onResume`</span></span><br><span class="line"><span class="comment">     * method returns.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> owner the component, whose state was changed</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">fun</span> <span class="title">onResume</span><span class="params">(owner: <span class="type">LifecycleOwner</span>)</span></span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Notifies that `ON_PAUSE` event occurred.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * This method will be called before the [LifecycleOwner]&#x27;s `onPause` method</span></span><br><span class="line"><span class="comment">     * is called.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> owner the component, whose state was changed</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">fun</span> <span class="title">onPause</span><span class="params">(owner: <span class="type">LifecycleOwner</span>)</span></span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Notifies that `ON_STOP` event occurred.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * This method will be called before the [LifecycleOwner]&#x27;s `onStop` method</span></span><br><span class="line"><span class="comment">     * is called.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> owner the component, whose state was changed</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">fun</span> <span class="title">onStop</span><span class="params">(owner: <span class="type">LifecycleOwner</span>)</span></span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Notifies that `ON_DESTROY` event occurred.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * This method will be called before the [LifecycleOwner]&#x27;s `onDestroy` method</span></span><br><span class="line"><span class="comment">     * is called.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> owner the component, whose state was changed</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">fun</span> <span class="title">onDestroy</span><span class="params">(owner: <span class="type">LifecycleOwner</span>)</span></span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">fun</span> <span class="keyword">interface</span> LifecycleEventObserver : LifecycleObserver &#123;</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Called when a state transition event happens.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> source The source of the event</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> event The event</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">fun</span> <span class="title">onStateChanged</span><span class="params">(source: <span class="type">LifecycleOwner</span>, event: <span class="type">Lifecycle</span>.<span class="type">Event</span>)</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨<code>lifecycle.addObserver()</code>æ—¶ï¼Œå¯ä»¥ä¼ å…¥<code>LifecycleEventObserver</code>æˆ–<code>DefaultLifecycleObserver</code>ï¼Œä¸€ä¸ªé€šè¿‡<code>event</code>è·å–å½“å‰çŠ¶æ€ï¼Œä¸€ä¸ªé€šè¿‡ä¸åŒçš„å›è°ƒå‡½æ•°è·å–å½“å‰çŠ¶æ€</li></ul><h2 id="Activityæ ‘"><a href="#Activityæ ‘" class="headerlink" title="Activityæ ‘"></a>Activityæ ‘</h2><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Activity -- AccountAuthenticatorActivity</span><br><span class="line">         |- ActivityGroup -- TabActivity</span><br><span class="line">         |- ExpandableListActivity</span><br><span class="line">         |- LauncherActivity</span><br><span class="line">         |- ListActivity -- PreferenceActivity</span><br><span class="line">         |- NativeActivity</span><br><span class="line">         |- androidx.core.app.ComponentActivity -- androidx.activity.ComponentActivity -- FragmentActivity -- AppCompatActivity</span><br><span class="line">                                                |- PreviewActivity</span><br><span class="line">         |- BootstrapActivity</span><br><span class="line">         |- EmptyActivity</span><br><span class="line">         |- EmptyFloatingActivity</span><br></pre></td></tr></table></figure><h2 id="LifecycleOwner"><a href="#LifecycleOwner" class="headerlink" title="LifecycleOwner"></a>LifecycleOwner</h2><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">LifecycleOwner</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns the Lifecycle of the provider.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> The lifecycle of the provider.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">val</span> lifecycle: Lifecycle</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>androidx.core.app.ComponentActivity</code>å’Œ<code>androidx.activity.ComponentActivity</code>éƒ½å£°æ˜äº†å¯¹<code>LifecycleOwner</code>çš„å®ç°</p><p>å¯ä»¥æ‹¿åˆ°<code>lifecycle</code>çš„<code>Activity</code>æœ‰</p><ul><li>androidx.core.app.ComponentActivity</li><li>androidx.activity.ComponentActivity</li><li>FragmentActivity</li><li>AppCompatActivity</li><li>PreviewActivity</li></ul><h2 id="androidx-core-app-ComponentActivityä¸­çš„lifecycle"><a href="#androidx-core-app-ComponentActivityä¸­çš„lifecycle" class="headerlink" title="androidx.core.app.ComponentActivityä¸­çš„lifecycle"></a>androidx.core.app.ComponentActivityä¸­çš„lifecycle</h2><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Suppress(<span class="string">&quot;LeakingThis&quot;</span>)</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">val</span> lifecycleRegistry = LifecycleRegistry(<span class="keyword">this</span>)</span><br><span class="line"><span class="keyword">override</span> <span class="keyword">val</span> lifecycle: Lifecycle</span><br><span class="line">    <span class="keyword">get</span>() = lifecycleRegistry</span><br><span class="line"><span class="meta">@CallSuper</span></span><br><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onSaveInstanceState</span><span class="params">(outState: <span class="type">Bundle</span>)</span></span> &#123;</span><br><span class="line">    lifecycleRegistry.currentState = Lifecycle.State.CREATED</span><br><span class="line">    <span class="keyword">super</span>.onSaveInstanceState(outState)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å¾ˆæ„å¤–çš„æ˜¯<code>ComponentActivity</code>å¹¶ä¸æ˜¯åœ¨æ¯ä¸ªç”Ÿå‘½å‘¨æœŸå›è°ƒå‡½æ•°ä¸­è°ƒç”¨<code>lifecycleRegistry</code>çš„<code>setCurrentState</code>ï¼Œä»è€Œåˆ†å‘ç”Ÿå‘½å‘¨æœŸ</li></ul><h2 id="LifecycleRegistry"><a href="#LifecycleRegistry" class="headerlink" title="LifecycleRegistry"></a>LifecycleRegistry</h2><h3 id="addObserver"><a href="#addObserver" class="headerlink" title="addObserver"></a>addObserver</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">addObserver</span><span class="params">(observer: <span class="type">LifecycleObserver</span>)</span></span> &#123;</span><br><span class="line">    enforceMainThreadIfNeeded(<span class="string">&quot;addObserver&quot;</span>)</span><br><span class="line">    <span class="keyword">val</span> initialState = <span class="keyword">if</span> (state == State.DESTROYED) State.DESTROYED <span class="keyword">else</span> State.INITIALIZED</span><br><span class="line">    <span class="keyword">val</span> statefulObserver = ObserverWithState(observer, initialState)</span><br><span class="line">    <span class="keyword">val</span> previous = observerMap.putIfAbsent(observer, statefulObserver)</span><br><span class="line">    <span class="keyword">if</span> (previous != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">val</span> lifecycleOwner = lifecycleOwner.<span class="keyword">get</span>()</span><br><span class="line">        ?: <span class="comment">// it is null we should be destroyed. Fallback quickly</span></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">val</span> isReentrance = addingObserverCounter != <span class="number">0</span> || handlingEvent</span><br><span class="line">    <span class="keyword">var</span> targetState = calculateTargetState(observer)</span><br><span class="line">    addingObserverCounter++</span><br><span class="line">    <span class="keyword">while</span> (statefulObserver.state &lt; targetState &amp;&amp; observerMap.contains(observer)</span><br><span class="line">    ) &#123;</span><br><span class="line">        pushParentState(statefulObserver.state)</span><br><span class="line">        <span class="keyword">val</span> event = Event.upFrom(statefulObserver.state)</span><br><span class="line">            ?: <span class="keyword">throw</span> IllegalStateException(<span class="string">&quot;no event up from <span class="subst">$&#123;statefulObserver.state&#125;</span>&quot;</span>)</span><br><span class="line">        statefulObserver.dispatchEvent(lifecycleOwner, event)</span><br><span class="line">        popParentState()</span><br><span class="line">        <span class="comment">// mState / subling may have been changed recalculate</span></span><br><span class="line">        targetState = calculateTargetState(observer)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!isReentrance) &#123;</span><br><span class="line">        <span class="comment">// we do sync only on the top level.</span></span><br><span class="line">        sync()</span><br><span class="line">    &#125;</span><br><span class="line">    addingObserverCounter--</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>è¿™é‡Œçœ‹åˆ°<code>addObserver</code>é¦–å…ˆå°†observeråŒ…è£…æˆ<code>ObserverWithState</code>ï¼Œå¹¶å°†å…¶åŠ å…¥åˆ°<code>observerMap</code></li><li>åŠ å…¥åç«‹åˆ»è°ƒç”¨<code>dispatchEvent</code>å°†æœ€æ–°çš„çŠ¶æ€ä¼ é€’å‡ºå»</li></ul><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">sync</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> lifecycleOwner = lifecycleOwner.<span class="keyword">get</span>()</span><br><span class="line">        ?: <span class="keyword">throw</span> IllegalStateException(</span><br><span class="line">            <span class="string">&quot;LifecycleOwner of this LifecycleRegistry is already &quot;</span> +</span><br><span class="line">                <span class="string">&quot;garbage collected. It is too late to change lifecycle state.&quot;</span></span><br><span class="line">        )</span><br><span class="line">    <span class="keyword">while</span> (!isSynced) &#123;</span><br><span class="line">        newEventOccurred = <span class="literal">false</span></span><br><span class="line">        <span class="keyword">if</span> (state &lt; observerMap.eldest()!!.value.state) &#123;</span><br><span class="line">            backwardPass(lifecycleOwner)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">val</span> newest = observerMap.newest()</span><br><span class="line">        <span class="keyword">if</span> (!newEventOccurred &amp;&amp; newest != <span class="literal">null</span> &amp;&amp; state &gt; newest.value.state) &#123;</span><br><span class="line">            forwardPass(lifecycleOwner)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    newEventOccurred = <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>è¿™é‡Œçœ‹åˆ°<code>sync</code>ä¼šè°ƒç”¨<code>backwardPass</code>å’Œ<code>forwardPass</code></li></ul><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">forwardPass</span><span class="params">(lifecycleOwner: <span class="type">LifecycleOwner</span>)</span></span> &#123;</span><br><span class="line">    <span class="meta">@Suppress()</span></span><br><span class="line">    <span class="keyword">val</span> ascendingIterator: Iterator&lt;Map.Entry&lt;LifecycleObserver, ObserverWithState&gt;&gt; =</span><br><span class="line">        observerMap.iteratorWithAdditions()</span><br><span class="line">    <span class="keyword">while</span> (ascendingIterator.hasNext() &amp;&amp; !newEventOccurred) &#123;</span><br><span class="line">        <span class="keyword">val</span> (key, observer) = ascendingIterator.next()</span><br><span class="line">        <span class="keyword">while</span> (observer.state &lt; state &amp;&amp; !newEventOccurred &amp;&amp; observerMap.contains(key)</span><br><span class="line">        ) &#123;</span><br><span class="line">            pushParentState(observer.state)</span><br><span class="line">            <span class="keyword">val</span> event = Event.upFrom(observer.state)</span><br><span class="line">                ?: <span class="keyword">throw</span> IllegalStateException(<span class="string">&quot;no event up from <span class="subst">$&#123;observer.state&#125;</span>&quot;</span>)</span><br><span class="line">            observer.dispatchEvent(lifecycleOwner, event)</span><br><span class="line">            popParentState()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">backwardPass</span><span class="params">(lifecycleOwner: <span class="type">LifecycleOwner</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> descendingIterator = observerMap.descendingIterator()</span><br><span class="line">    <span class="keyword">while</span> (descendingIterator.hasNext() &amp;&amp; !newEventOccurred) &#123;</span><br><span class="line">        <span class="keyword">val</span> (key, observer) = descendingIterator.next()</span><br><span class="line">        <span class="keyword">while</span> (observer.state &gt; state &amp;&amp; !newEventOccurred &amp;&amp; observerMap.contains(key)</span><br><span class="line">        ) &#123;</span><br><span class="line">            <span class="keyword">val</span> event = Event.downFrom(observer.state)</span><br><span class="line">                ?: <span class="keyword">throw</span> IllegalStateException(<span class="string">&quot;no event down from <span class="subst">$&#123;observer.state&#125;</span>&quot;</span>)</span><br><span class="line">            pushParentState(event.targetState)</span><br><span class="line">            observer.dispatchEvent(lifecycleOwner, event)</span><br><span class="line">            popParentState()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>è¿™é‡Œçœ‹åˆ°<code>sync</code>è¢«è°ƒç”¨åï¼Œå°±ä¼šæ ¹æ®<code>observer</code>çš„æƒ…å†µå’Œ<code>state</code>çš„ä¸åŒï¼ŒæŒ‰ç…§éœ€è¦å°†<code>state</code>çš„å˜åŒ–ä¼ é€’ç»™<code>observer</code></li></ul><h3 id="ObserverWithState"><a href="#ObserverWithState" class="headerlink" title="ObserverWithState"></a>ObserverWithState</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title class_">ObserverWithState</span>(observer: LifecycleObserver?, initialState: State) &#123;</span><br><span class="line">    <span class="keyword">var</span> state: State</span><br><span class="line">    <span class="keyword">var</span> lifecycleObserver: LifecycleEventObserver</span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span> &#123;</span><br><span class="line">        lifecycleObserver = Lifecycling.lifecycleEventObserver(observer!!)</span><br><span class="line">        state = initialState</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">dispatchEvent</span><span class="params">(owner: <span class="type">LifecycleOwner</span>?, event: <span class="type">Event</span>)</span></span> &#123;</span><br><span class="line">        <span class="keyword">val</span> newState = event.targetState</span><br><span class="line">        state = min(state, newState)</span><br><span class="line">        lifecycleObserver.onStateChanged(owner!!, event)</span><br><span class="line">        state = newState</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>é¦–å…ˆè¿™é‡Œçœ‹åˆ°ä¸€ä¸ªå…³é”®çš„å‡½æ•°è°ƒç”¨<code>onStateChanged</code>ï¼Œä¹Ÿå°±æ˜¯å½“<code>dispatchEvent</code>è¢«è°ƒç”¨æ—¶ï¼Œ<code>state</code>çš„æ”¹å˜å°±ä¼šä¼ é€’ç»™<code>observer</code></li></ul><h3 id="setCurrentStateä½œç”¨"><a href="#setCurrentStateä½œç”¨" class="headerlink" title="setCurrentStateä½œç”¨"></a>setCurrentStateä½œç”¨</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="keyword">var</span> currentState: State</span><br><span class="line">    <span class="keyword">get</span>() = state</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">        * Moves the Lifecycle to the given state and dispatches necessary events to the observers.</span></span><br><span class="line"><span class="comment">        *</span></span><br><span class="line"><span class="comment">        * <span class="doctag">@param</span> state new state</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">    <span class="keyword">set</span>(state) &#123;</span><br><span class="line">        enforceMainThreadIfNeeded(<span class="string">&quot;setCurrentState&quot;</span>)</span><br><span class="line">        moveToState(state)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">moveToState</span><span class="params">(next: <span class="type">State</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (state == next) &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    check(!(state == State.INITIALIZED &amp;&amp; next == State.DESTROYED)) &#123;</span><br><span class="line">        <span class="string">&quot;no event down from <span class="variable">$state</span> in component <span class="subst">$&#123;lifecycleOwner.get()&#125;</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    state = next</span><br><span class="line">    <span class="keyword">if</span> (handlingEvent || addingObserverCounter != <span class="number">0</span>) &#123;</span><br><span class="line">        newEventOccurred = <span class="literal">true</span></span><br><span class="line">        <span class="comment">// we will figure out what to do on upper level.</span></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    handlingEvent = <span class="literal">true</span></span><br><span class="line">    sync()</span><br><span class="line">    handlingEvent = <span class="literal">false</span></span><br><span class="line">    <span class="keyword">if</span> (state == State.DESTROYED) &#123;</span><br><span class="line">        observerMap = FastSafeIterableMap()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å¯ä»¥çœ‹åˆ°è¿™é‡Œå¯¹<code>state</code>è¿›è¡Œä¸€å®šé€»è¾‘åˆ¤æ–­åï¼Œè°ƒç”¨äº†<code>sync</code>ï¼Œä¹Ÿå°±æ˜¯å½“å‰<code>state</code>çš„æ”¹å˜ä¼šä¼ é€’ç»™<code>observer</code></li><li><code>activity</code>ä¼ é€’<code>state</code>çš„æ–¹å¼çœ‹èµ·æ¥è¿˜æ˜¯é€šè¿‡<code>setCurrentState</code>ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰åœ¨<code>CompinentActivity</code>ä¸­çš„å„ä¸ªç”Ÿå‘½å‘¨æœŸå‡½æ•°ä¸­è°ƒç”¨</li></ul><h3 id="ObserverWithStateå¦‚ä½•å¤„ç†ä¸¤ç§LifecycleObserver"><a href="#ObserverWithStateå¦‚ä½•å¤„ç†ä¸¤ç§LifecycleObserver" class="headerlink" title="ObserverWithStateå¦‚ä½•å¤„ç†ä¸¤ç§LifecycleObserver"></a>ObserverWithStateå¦‚ä½•å¤„ç†ä¸¤ç§LifecycleObserver</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">init</span> &#123;</span><br><span class="line">    lifecycleObserver = Lifecycling.lifecycleEventObserver(observer!!)</span><br><span class="line">    state = initialState</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°æ„é€ å‡½æ•°ä¸­å°†<code>observer</code>é€šè¿‡<code>Lifecycling.lifecycleEventObserver</code>å¯¹<code>observer</code>è¿›è¡Œäº†åŒ…è£…</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">fun</span> <span class="title">lifecycleEventObserver</span><span class="params">(`<span class="keyword">object</span>`: <span class="type">Any</span>)</span></span>: LifecycleEventObserver &#123;</span><br><span class="line">    <span class="keyword">val</span> isLifecycleEventObserver = `<span class="keyword">object</span>` <span class="keyword">is</span> LifecycleEventObserver</span><br><span class="line">    <span class="keyword">val</span> isDefaultLifecycleObserver = `<span class="keyword">object</span>` <span class="keyword">is</span> DefaultLifecycleObserver</span><br><span class="line">    <span class="keyword">if</span> (isLifecycleEventObserver &amp;&amp; isDefaultLifecycleObserver) &#123;</span><br><span class="line">        <span class="keyword">return</span> DefaultLifecycleObserverAdapter(</span><br><span class="line">            `<span class="keyword">object</span>` <span class="keyword">as</span> DefaultLifecycleObserver,</span><br><span class="line">            `<span class="keyword">object</span>` <span class="keyword">as</span> LifecycleEventObserver</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (isDefaultLifecycleObserver) &#123;</span><br><span class="line">        <span class="keyword">return</span> DefaultLifecycleObserverAdapter(`<span class="keyword">object</span>` <span class="keyword">as</span> DefaultLifecycleObserver, <span class="literal">null</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (isLifecycleEventObserver) &#123;</span><br><span class="line">        <span class="keyword">return</span> `<span class="keyword">object</span>` <span class="keyword">as</span> LifecycleEventObserver</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">val</span> klass: Class&lt;*&gt; = `<span class="keyword">object</span>`.javaClass</span><br><span class="line">    <span class="keyword">val</span> type = getObserverConstructorType(klass)</span><br><span class="line">    <span class="keyword">if</span> (type == GENERATED_CALLBACK) &#123;</span><br><span class="line">        <span class="keyword">val</span> constructors = classToAdapters[klass]!!</span><br><span class="line">        <span class="keyword">if</span> (constructors.size == <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">val</span> generatedAdapter = createGeneratedAdapter(</span><br><span class="line">                constructors[<span class="number">0</span>], `<span class="keyword">object</span>`</span><br><span class="line">            )</span><br><span class="line">            <span class="keyword">return</span> SingleGeneratedAdapterObserver(generatedAdapter)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">val</span> adapters: Array&lt;GeneratedAdapter&gt; = Array(constructors.size) &#123; i -&gt;</span><br><span class="line">            createGeneratedAdapter(constructors[i], `<span class="keyword">object</span>`)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> CompositeGeneratedAdaptersObserver(adapters)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ReflectiveGenericLifecycleObserver(`<span class="keyword">object</span>`)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>å¯ä»¥çœ‹åˆ°è¿™é‡Œä¼šåˆ¤æ–­<code>observer</code>çš„ç±»å‹ï¼Œå¦‚æœæ˜¯<code>DefaultLifecycleObserver</code>ï¼Œåˆ™ä¼šä½¿ç”¨<code>DefaultLifecycleObserverAdapter</code>å¯¹<code>observer</code>è¿›è¡Œé€‚é…</p></li><li><p>è¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼Œé€‚é…å™¨è€ƒè™‘åˆ°äº†<code>Observer</code>å³æ˜¯<code>LifecycleEventObserver</code>åˆæ˜¯<code>DefaultLifecycleObserver</code>çš„æƒ…å†µ</p></li></ul><h4 id="DefaultLifecycleObserverAdapter"><a href="#DefaultLifecycleObserverAdapter" class="headerlink" title="DefaultLifecycleObserverAdapter"></a>DefaultLifecycleObserverAdapter</h4><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title class_">DefaultLifecycleObserverAdapter</span>(</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> defaultLifecycleObserver: DefaultLifecycleObserver,</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> lifecycleEventObserver: LifecycleEventObserver?</span><br><span class="line">) : LifecycleEventObserver &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onStateChanged</span><span class="params">(source: <span class="type">LifecycleOwner</span>, event: <span class="type">Lifecycle</span>.<span class="type">Event</span>)</span></span> &#123;</span><br><span class="line">        <span class="keyword">when</span> (event) &#123;</span><br><span class="line">            Lifecycle.Event.ON_CREATE -&gt; defaultLifecycleObserver.onCreate(source)</span><br><span class="line">            Lifecycle.Event.ON_START -&gt; defaultLifecycleObserver.onStart(source)</span><br><span class="line">            Lifecycle.Event.ON_RESUME -&gt; defaultLifecycleObserver.onResume(source)</span><br><span class="line">            Lifecycle.Event.ON_PAUSE -&gt; defaultLifecycleObserver.onPause(source)</span><br><span class="line">            Lifecycle.Event.ON_STOP -&gt; defaultLifecycleObserver.onStop(source)</span><br><span class="line">            Lifecycle.Event.ON_DESTROY -&gt; defaultLifecycleObserver.onDestroy(source)</span><br><span class="line">            Lifecycle.Event.ON_ANY -&gt;</span><br><span class="line">                <span class="keyword">throw</span> IllegalArgumentException(<span class="string">&quot;ON_ANY must not been send by anybody&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        lifecycleEventObserver?.onStateChanged(source, event)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>è¿™é‡Œå°±å¾ˆæ¸…æ™°äº†ï¼Œ<code>DefaultLifecycleObserverAdapter</code>æ ¹æ®å½“å‰çš„<code>state</code>è°ƒç”¨<code>DefaultLifecycleObserver</code>çš„å„ä¸ªå›è°ƒ</li></ul><h3 id="handleLifecycleEvent"><a href="#handleLifecycleEvent" class="headerlink" title="handleLifecycleEvent"></a>handleLifecycleEvent</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * Sets the current state and notifies the observers.</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * Note that if the `currentState` is the same state as the last call to this method,</span></span><br><span class="line"><span class="comment">    * calling this method has no effect.</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> event The event that was received</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"><span class="keyword">open</span> <span class="function"><span class="keyword">fun</span> <span class="title">handleLifecycleEvent</span><span class="params">(event: <span class="type">Event</span>)</span></span> &#123;</span><br><span class="line">    enforceMainThreadIfNeeded(<span class="string">&quot;handleLifecycleEvent&quot;</span>)</span><br><span class="line">    moveToState(event.targetState)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>è¿™é‡Œçœ‹åˆ°<code>handleLifecycleEvent</code>ä¹Ÿæœ‰è®¾ç½®<code>state</code>çš„ä½œç”¨</li></ul><h2 id="Activityç”Ÿå‘½å‘¨æœŸç›¸å…³å‡½æ•°"><a href="#Activityç”Ÿå‘½å‘¨æœŸç›¸å…³å‡½æ•°" class="headerlink" title="Activityç”Ÿå‘½å‘¨æœŸç›¸å…³å‡½æ•°"></a>Activityç”Ÿå‘½å‘¨æœŸç›¸å…³å‡½æ•°</h2><h3 id="å›è°ƒç»“æ„å®šä¹‰"><a href="#å›è°ƒç»“æ„å®šä¹‰" class="headerlink" title="å›è°ƒç»“æ„å®šä¹‰"></a>å›è°ƒç»“æ„å®šä¹‰</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> ArrayList&lt;Application.ActivityLifecycleCallbacks&gt; mActivityLifecycleCallbacks =</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Application.ActivityLifecycleCallbacks&gt;();</span><br></pre></td></tr></table></figure><p>æ­¤å¤„å®šä¹‰äº†ä¸€ä¸ªå›è°ƒçš„æ¥å£<code>List</code></p><h3 id="æ³¨å†Œä¸åˆ é™¤"><a href="#æ³¨å†Œä¸åˆ é™¤" class="headerlink" title="æ³¨å†Œä¸åˆ é™¤"></a>æ³¨å†Œä¸åˆ é™¤</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">registerActivityLifecycleCallbacks</span><span class="params">(</span></span><br><span class="line"><span class="params">        <span class="meta">@NonNull</span> Application.ActivityLifecycleCallbacks callback)</span> &#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (mActivityLifecycleCallbacks) &#123;</span><br><span class="line">        mActivityLifecycleCallbacks.add(callback);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">unregisterActivityLifecycleCallbacks</span><span class="params">(</span></span><br><span class="line"><span class="params">        <span class="meta">@NonNull</span> Application.ActivityLifecycleCallbacks callback)</span> &#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (mActivityLifecycleCallbacks) &#123;</span><br><span class="line">        mActivityLifecycleCallbacks.remove(callback);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å›è°ƒlistè½¬æ•°ç»„"><a href="#å›è°ƒlistè½¬æ•°ç»„" class="headerlink" title="å›è°ƒlistè½¬æ•°ç»„"></a>å›è°ƒ<code>list</code>è½¬æ•°ç»„</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Object[] collectActivityLifecycleCallbacks() &#123;</span><br><span class="line">    Object[] callbacks = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">synchronized</span> (mActivityLifecycleCallbacks) &#123;</span><br><span class="line">        <span class="keyword">if</span> (mActivityLifecycleCallbacks.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            callbacks = mActivityLifecycleCallbacks.toArray();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> callbacks;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ä¸‹é¢ä»‹ç»çš„<code>dispatchActivityXXX</code>å‡½æ•°å°†è°ƒç”¨<code>collectActivityLifecycleCallbacks</code>è·å–æ‰€æœ‰<code>callbacks</code>ï¼Œç„¶åè°ƒç”¨<code>callbacks</code>çš„<code>onActivityXXX</code>å‡½æ•°</li></ul><h3 id="dispatchActivityPreCreated"><a href="#dispatchActivityPreCreated" class="headerlink" title="dispatchActivityPreCreated"></a>dispatchActivityPreCreated</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">dispatchActivityPreCreated</span><span class="params">(<span class="meta">@Nullable</span> Bundle savedInstanceState)</span> &#123;</span><br><span class="line">    getApplication().dispatchActivityPreCreated(<span class="built_in">this</span>, savedInstanceState);</span><br><span class="line">    Object[] callbacks = collectActivityLifecycleCallbacks();</span><br><span class="line">    <span class="keyword">if</span> (callbacks != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; callbacks.length; i++) &#123;</span><br><span class="line">            ((Application.ActivityLifecycleCallbacks) callbacks[i]).onActivityPreCreated(<span class="built_in">this</span>,</span><br><span class="line">                    savedInstanceState);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="dispatchActivityCreated"><a href="#dispatchActivityCreated" class="headerlink" title="dispatchActivityCreated"></a>dispatchActivityCreated</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">dispatchActivityCreated</span><span class="params">(<span class="meta">@Nullable</span> Bundle savedInstanceState)</span> &#123;</span><br><span class="line">    getApplication().dispatchActivityCreated(<span class="built_in">this</span>, savedInstanceState);</span><br><span class="line">    Object[] callbacks = collectActivityLifecycleCallbacks();</span><br><span class="line">    <span class="keyword">if</span> (callbacks != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; callbacks.length; i++) &#123;</span><br><span class="line">            ((Application.ActivityLifecycleCallbacks) callbacks[i]).onActivityCreated(<span class="built_in">this</span>,</span><br><span class="line">                    savedInstanceState);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="dispatchActivityPostCreated"><a href="#dispatchActivityPostCreated" class="headerlink" title="dispatchActivityPostCreated"></a>dispatchActivityPostCreated</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">dispatchActivityPostCreated</span><span class="params">(<span class="meta">@Nullable</span> Bundle savedInstanceState)</span> &#123;</span><br><span class="line">    Object[] callbacks = collectActivityLifecycleCallbacks();</span><br><span class="line">    <span class="keyword">if</span> (callbacks != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; callbacks.length; i++) &#123;</span><br><span class="line">            ((Application.ActivityLifecycleCallbacks) callbacks[i]).onActivityPostCreated(<span class="built_in">this</span>,</span><br><span class="line">                    savedInstanceState);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    getApplication().dispatchActivityPostCreated(<span class="built_in">this</span>, savedInstanceState);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>æ¯æ®µä»£ç å‡ ä¹æ˜¯ä¸€æ ·çš„ï¼Œå°±ä¸å…¨è´´ä¸Šæ¥äº†</li><li>æ²¡è´´ä¸Šæ¥çš„è¿˜æœ‰<ul><li>dispatchActivityPreStarted, dispatchActivityStarted, dispatchActivityPostStarted</li><li>dispatchActivityPreResumed, dispatchActivityResumed, dispatchActivityPostResumed</li><li>dispatchActivityPrePaused, dispatchActivityPaused, dispatchActivityPostPaused</li><li>dispatchActivitySaveInstanceState, dispatchActivitySaveInstanceState, dispatchActivityPostSaveInstanceState</li><li>dispatchActivityPreDestroyed, dispatchActivityDestroyed, dispatchActivityPostDestroyed</li><li>dispatchActivityConfigurationChanged</li></ul></li></ul><h2 id="ReportFragment"><a href="#ReportFragment" class="headerlink" title="ReportFragment"></a>ReportFragment</h2><ul><li>reportFragmentè´Ÿè´£ä¼ é€’Activityçš„ç”Ÿå‘½å‘¨æœŸ</li></ul><h3 id="ReportFragmentçš„åˆå§‹åŒ–"><a href="#ReportFragmentçš„åˆå§‹åŒ–" class="headerlink" title="ReportFragmentçš„åˆå§‹åŒ–"></a>ReportFragmentçš„åˆå§‹åŒ–</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">    ReportFragment.injectIfNeededIn(<span class="keyword">this</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">injectIfNeededIn</span><span class="params">(activity: <span class="type">Activity</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= <span class="number">29</span>) &#123;</span><br><span class="line">        <span class="comment">// On API 29+, we can register for the correct Lifecycle callbacks directly</span></span><br><span class="line">        LifecycleCallbacks.registerIn(activity)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Prior to API 29 and to maintain compatibility with older versions of</span></span><br><span class="line">    <span class="comment">// ProcessLifecycleOwner (which may not be updated when lifecycle-runtime is updated and</span></span><br><span class="line">    <span class="comment">// need to support activities that don&#x27;t extend from FragmentActivity from support lib),</span></span><br><span class="line">    <span class="comment">// use a framework fragment to get the correct timing of Lifecycle events</span></span><br><span class="line">    <span class="keyword">val</span> manager = activity.fragmentManager</span><br><span class="line">    <span class="keyword">if</span> (manager.findFragmentByTag(REPORT_FRAGMENT_TAG) == <span class="literal">null</span>) &#123;</span><br><span class="line">        manager.beginTransaction().add(ReportFragment(), REPORT_FRAGMENT_TAG).commit()</span><br><span class="line">        <span class="comment">// Hopefully, we are the first to make a transaction.</span></span><br><span class="line">        manager.executePendingTransactions()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>api</code>29ä¹‹åï¼Œä¼šä½¿ç”¨<code>LifecycleCallbacks.registerIn</code></li><li>å¦å¤–è¿˜ä¼šä½¿ç”¨<code>ReportFragment</code>æ¥æŠ¥å‘Š<code>activity</code>çš„ç”Ÿå‘½å‘¨æœŸ</li></ul><h3 id="ReportFragmentåˆ†å‘ç”Ÿå‘½å‘¨æœŸ-API-29ä¹‹å‰"><a href="#ReportFragmentåˆ†å‘ç”Ÿå‘½å‘¨æœŸ-API-29ä¹‹å‰" class="headerlink" title="ReportFragmentåˆ†å‘ç”Ÿå‘½å‘¨æœŸ(API 29ä¹‹å‰)"></a>ReportFragmentåˆ†å‘ç”Ÿå‘½å‘¨æœŸ(API 29ä¹‹å‰)</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">var</span> processListener: ActivityInitializationListener? = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">dispatchCreate</span><span class="params">(listener: <span class="type">ActivityInitializationListener</span>?)</span></span> &#123;</span><br><span class="line">    listener?.onCreate()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">dispatchStart</span><span class="params">(listener: <span class="type">ActivityInitializationListener</span>?)</span></span> &#123;</span><br><span class="line">    listener?.onStart()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">dispatchResume</span><span class="params">(listener: <span class="type">ActivityInitializationListener</span>?)</span></span> &#123;</span><br><span class="line">    listener?.onResume()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onActivityCreated</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.onActivityCreated(savedInstanceState)</span><br><span class="line">    dispatchCreate(processListener)</span><br><span class="line">    dispatch(Lifecycle.Event.ON_CREATE)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onStart</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.onStart()</span><br><span class="line">    dispatchStart(processListener)</span><br><span class="line">    dispatch(Lifecycle.Event.ON_START)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onResume</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.onResume()</span><br><span class="line">    dispatchResume(processListener)</span><br><span class="line">    dispatch(Lifecycle.Event.ON_RESUME)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onPause</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.onPause()</span><br><span class="line">    dispatch(Lifecycle.Event.ON_PAUSE)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onStop</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.onStop()</span><br><span class="line">    dispatch(Lifecycle.Event.ON_STOP)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onDestroy</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.onDestroy()</span><br><span class="line">    dispatch(Lifecycle.Event.ON_DESTROY)</span><br><span class="line">    <span class="comment">// just want to be sure that we won&#x27;t leak reference to an activity</span></span><br><span class="line">    processListener = <span class="literal">null</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å¯ä»¥çœ‹åˆ°ï¼Œå½“<code>Fragment</code>çš„å£°æ˜å‘¨æœŸå‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œä¼šè°ƒç”¨<code>dispatch</code>ï¼Œå°†<code>activity</code>çš„ç”Ÿå‘½å‘¨æœŸè¿›è¡Œä¼ é€’</li></ul><h3 id="dispatch"><a href="#dispatch" class="headerlink" title="dispatch"></a>dispatch</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">dispatch</span><span class="params">(event: <span class="type">Lifecycle</span>.<span class="type">Event</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (Build.VERSION.SDK_INT &lt; <span class="number">29</span>) &#123;</span><br><span class="line">        <span class="comment">// Only dispatch events from ReportFragment on API levels prior</span></span><br><span class="line">        <span class="comment">// to API 29. On API 29+, this is handled by the ActivityLifecycleCallbacks</span></span><br><span class="line">        <span class="comment">// added in ReportFragment.injectIfNeededIn</span></span><br><span class="line">        dispatch(activity, event)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">internal</span> <span class="function"><span class="keyword">fun</span> <span class="title">dispatch</span><span class="params">(activity: <span class="type">Activity</span>, event: <span class="type">Lifecycle</span>.<span class="type">Event</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (activity <span class="keyword">is</span> LifecycleRegistryOwner) &#123;</span><br><span class="line">        activity.lifecycle.handleLifecycleEvent(event)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (activity <span class="keyword">is</span> LifecycleOwner) &#123;</span><br><span class="line">        <span class="keyword">val</span> lifecycle = (activity <span class="keyword">as</span> LifecycleOwner).lifecycle</span><br><span class="line">        <span class="keyword">if</span> (lifecycle <span class="keyword">is</span> LifecycleRegistry) &#123;</span><br><span class="line">            lifecycle.handleLifecycleEvent(event)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ä»…åœ¨<code>api 29</code>ä¹‹å‰é€šè¿‡<code>ReportFragment</code>æ¥è¿›è¡Œ<code>activity</code>çš„ç”Ÿå‘½å‘¨æœŸä¼ é€’</li><li>è¿™é‡Œå°±å¯ä»¥çœ‹åˆ°ä¸Šé¢åˆ†æçš„<code>LifecycleRegistry</code>ç±»äº†ï¼Œè·å–<code>activity</code>ä¸­çš„<code>lifecycle</code>å†è°ƒç”¨<code>handleLifecycleEvent</code>æ¥æ›´æ–°<code>activity</code>çš„ç”Ÿå‘½å‘¨æœŸï¼Œè¿›è€Œå°†ç”Ÿå‘½å‘¨æœŸæ”¹å˜ä¼ é€’ç»™<code>listener</code></li></ul><h2 id="API-29åŠä»¥åActivityåˆ†å‘ç”Ÿå‘½å‘¨æœŸ"><a href="#API-29åŠä»¥åActivityåˆ†å‘ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="API 29åŠä»¥åActivityåˆ†å‘ç”Ÿå‘½å‘¨æœŸ"></a>API 29åŠä»¥åActivityåˆ†å‘ç”Ÿå‘½å‘¨æœŸ</h2><h3 id="å›åˆ°ReportFragment"><a href="#å›åˆ°ReportFragment" class="headerlink" title="å›åˆ°ReportFragment"></a>å›åˆ°<code>ReportFragment</code></h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">injectIfNeededIn</span><span class="params">(activity: <span class="type">Activity</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= <span class="number">29</span>) &#123;</span><br><span class="line">        <span class="comment">// On API 29+, we can register for the correct Lifecycle callbacks directly</span></span><br><span class="line">        LifecycleCallbacks.registerIn(activity)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¤§äºç­‰äº<code>Api 29</code>æ—¶ï¼Œä¼šè°ƒç”¨<code>registerIn</code></p><h3 id="registerIn"><a href="#registerIn" class="headerlink" title="registerIn"></a><code>registerIn</code></h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@JvmStatic</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">registerIn</span><span class="params">(activity: <span class="type">Activity</span>)</span></span> &#123;</span><br><span class="line">    activity.registerActivityLifecycleCallbacks(LifecycleCallbacks())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>è¿™é‡Œçœ‹åˆ°ï¼Œè°ƒç”¨äº†<a href="#activity%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E7%9B%B8%E5%85%B3%E5%87%BD%E6%95%B0">activity</a>çš„<code>registerActivityLifecycleCallbacks</code>ï¼Œ<code>activity</code>ä¼šåœ¨å‘ç”Ÿç”Ÿå‘½å‘¨æœŸæ”¹å˜æ—¶è°ƒç”¨å›è°ƒ<code>LifecycleCallbacks</code></li></ul><h3 id="LifecycleCallbacks"><a href="#LifecycleCallbacks" class="headerlink" title="LifecycleCallbacks"></a>LifecycleCallbacks</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title class_">LifecycleCallbacks</span> : <span class="type">Application.ActivityLifecycleCallbacks</span> &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onActivityCreated</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">        activity: <span class="type">Activity</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        bundle: <span class="type">Bundle</span>?</span></span></span><br><span class="line"><span class="params"><span class="function">    )</span></span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onActivityPostCreated</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">        activity: <span class="type">Activity</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        savedInstanceState: <span class="type">Bundle</span>?</span></span></span><br><span class="line"><span class="params"><span class="function">    )</span></span> &#123;</span><br><span class="line">        dispatch(activity, Lifecycle.Event.ON_CREATE)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onActivityStarted</span><span class="params">(activity: <span class="type">Activity</span>)</span></span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onActivityPostStarted</span><span class="params">(activity: <span class="type">Activity</span>)</span></span> &#123;</span><br><span class="line">        dispatch(activity, Lifecycle.Event.ON_START)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onActivityResumed</span><span class="params">(activity: <span class="type">Activity</span>)</span></span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onActivityPostResumed</span><span class="params">(activity: <span class="type">Activity</span>)</span></span> &#123;</span><br><span class="line">        dispatch(activity, Lifecycle.Event.ON_RESUME)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onActivityPrePaused</span><span class="params">(activity: <span class="type">Activity</span>)</span></span> &#123;</span><br><span class="line">        dispatch(activity, Lifecycle.Event.ON_PAUSE)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onActivityPaused</span><span class="params">(activity: <span class="type">Activity</span>)</span></span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onActivityPreStopped</span><span class="params">(activity: <span class="type">Activity</span>)</span></span> &#123;</span><br><span class="line">        dispatch(activity, Lifecycle.Event.ON_STOP)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onActivityStopped</span><span class="params">(activity: <span class="type">Activity</span>)</span></span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onActivitySaveInstanceState</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">        activity: <span class="type">Activity</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        bundle: <span class="type">Bundle</span></span></span></span><br><span class="line"><span class="params"><span class="function">    )</span></span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onActivityPreDestroyed</span><span class="params">(activity: <span class="type">Activity</span>)</span></span> &#123;</span><br><span class="line">        dispatch(activity, Lifecycle.Event.ON_DESTROY)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onActivityDestroyed</span><span class="params">(activity: <span class="type">Activity</span>)</span></span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">companion</span> <span class="keyword">object</span> &#123;</span><br><span class="line">        <span class="meta">@JvmStatic</span></span><br><span class="line">        <span class="function"><span class="keyword">fun</span> <span class="title">registerIn</span><span class="params">(activity: <span class="type">Activity</span>)</span></span> &#123;</span><br><span class="line">            activity.registerActivityLifecycleCallbacks(LifecycleCallbacks())</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>è¿™é‡Œçœ‹åˆ°<code>LifecycleCallbacks</code>è°ƒç”¨äº†<a href="#dispatch">dispatch()</a>å‡½æ•°ï¼Œå°†<code>activity</code>çš„ç”Ÿå‘½å‘¨æœŸè¿›è¡Œäº†åˆ†å‘</li></ul><h2 id="Fragmentçš„lifecycle"><a href="#Fragmentçš„lifecycle" class="headerlink" title="Fragmentçš„lifecycle"></a>Fragmentçš„lifecycle</h2><h3 id="å®ç°LifecycleOwner"><a href="#å®ç°LifecycleOwner" class="headerlink" title="å®ç°LifecycleOwner"></a>å®ç°<code>LifecycleOwner</code></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Fragment</span> <span class="keyword">implements</span> <span class="title class_">ComponentCallbacks</span>, OnCreateContextMenuListener, LifecycleOwner,</span><br><span class="line">        ViewModelStoreOwner, HasDefaultViewModelProviderFactory, SavedStateRegistryOwner,</span><br><span class="line">        ActivityResultCaller &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@NonNull</span></span><br><span class="line">    <span class="keyword">public</span> Lifecycle <span class="title function_">getLifecycle</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> mLifecycleRegistry;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="åˆå§‹åŒ–Lifecycle"><a href="#åˆå§‹åŒ–Lifecycle" class="headerlink" title="åˆå§‹åŒ–Lifecycle"></a>åˆå§‹åŒ–<code>Lifecycle</code></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">Fragment</span><span class="params">()</span> &#123;</span><br><span class="line">    initLifecycle();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">initLifecycle</span><span class="params">()</span> &#123;</span><br><span class="line">    mLifecycleRegistry = <span class="keyword">new</span> <span class="title class_">LifecycleRegistry</span>(<span class="built_in">this</span>);</span><br><span class="line">    mSavedStateRegistryController = SavedStateRegistryController.create(<span class="built_in">this</span>);</span><br><span class="line">    <span class="comment">// The default factory depends on the SavedStateRegistry so it</span></span><br><span class="line">    <span class="comment">// needs to be reset when the SavedStateRegistry is reset</span></span><br><span class="line">    mDefaultFactory = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (!mOnPreAttachedListeners.contains(mSavedStateAttachListener)) &#123;</span><br><span class="line">        registerOnPreAttachListener(mSavedStateAttachListener);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä¼ é€’äº‹ä»¶"><a href="#ä¼ é€’äº‹ä»¶" class="headerlink" title="ä¼ é€’äº‹ä»¶"></a>ä¼ é€’äº‹ä»¶</h3><p><code>fragment</code>çš„ç”Ÿå‘½å‘¨æœŸä¼ é€’æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯åœ¨<code>fragment</code>å„ä¸ªç”Ÿå‘½å‘¨æœŸæ—¶è°ƒç”¨<code>handleLifecycleEvent</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">performCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">    mChildFragmentManager.noteStateNotSaved();</span><br><span class="line">    mState = CREATED;</span><br><span class="line">    mCalled = <span class="literal">false</span>;</span><br><span class="line">    mLifecycleRegistry.addObserver(<span class="keyword">new</span> <span class="title class_">LifecycleEventObserver</span>() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onStateChanged</span><span class="params">(<span class="meta">@NonNull</span> LifecycleOwner source,</span></span><br><span class="line"><span class="params">                <span class="meta">@NonNull</span> Lifecycle.Event event)</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (event == Lifecycle.Event.ON_STOP) &#123;</span><br><span class="line">                <span class="keyword">if</span> (mView != <span class="literal">null</span>) &#123;</span><br><span class="line">                    mView.cancelPendingInputEvents();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    onCreate(savedInstanceState);</span><br><span class="line">    mIsCreated = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">if</span> (!mCalled) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SuperNotCalledException</span>(<span class="string">&quot;Fragment &quot;</span> + <span class="built_in">this</span></span><br><span class="line">                + <span class="string">&quot; did not call through to super.onCreate()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    mLifecycleRegistry.handleLifecycleEvent(Lifecycle.Event.ON_CREATE);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">performStart</span><span class="params">()</span> &#123;</span><br><span class="line">    mChildFragmentManager.noteStateNotSaved();</span><br><span class="line">    mChildFragmentManager.execPendingActions(<span class="literal">true</span>);</span><br><span class="line">    mState = STARTED;</span><br><span class="line">    mCalled = <span class="literal">false</span>;</span><br><span class="line">    onStart();</span><br><span class="line">    <span class="keyword">if</span> (!mCalled) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SuperNotCalledException</span>(<span class="string">&quot;Fragment &quot;</span> + <span class="built_in">this</span></span><br><span class="line">                + <span class="string">&quot; did not call through to super.onStart()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    mLifecycleRegistry.handleLifecycleEvent(Lifecycle.Event.ON_START);</span><br><span class="line">    <span class="keyword">if</span> (mView != <span class="literal">null</span>) &#123;</span><br><span class="line">        mViewLifecycleOwner.handleLifecycleEvent(Lifecycle.Event.ON_START);</span><br><span class="line">    &#125;</span><br><span class="line">    mChildFragmentManager.dispatchStart();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">performResume</span><span class="params">()</span> &#123;</span><br><span class="line">    mChildFragmentManager.noteStateNotSaved();</span><br><span class="line">    mChildFragmentManager.execPendingActions(<span class="literal">true</span>);</span><br><span class="line">    mState = RESUMED;</span><br><span class="line">    mCalled = <span class="literal">false</span>;</span><br><span class="line">    onResume();</span><br><span class="line">    <span class="keyword">if</span> (!mCalled) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SuperNotCalledException</span>(<span class="string">&quot;Fragment &quot;</span> + <span class="built_in">this</span></span><br><span class="line">                + <span class="string">&quot; did not call through to super.onResume()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    mLifecycleRegistry.handleLifecycleEvent(Lifecycle.Event.ON_RESUME);</span><br><span class="line">    <span class="keyword">if</span> (mView != <span class="literal">null</span>) &#123;</span><br><span class="line">        mViewLifecycleOwner.handleLifecycleEvent(Lifecycle.Event.ON_RESUME);</span><br><span class="line">    &#125;</span><br><span class="line">    mChildFragmentManager.dispatchResume();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">performPause</span><span class="params">()</span> &#123;</span><br><span class="line">    mChildFragmentManager.dispatchPause();</span><br><span class="line">    <span class="keyword">if</span> (mView != <span class="literal">null</span>) &#123;</span><br><span class="line">        mViewLifecycleOwner.handleLifecycleEvent(Lifecycle.Event.ON_PAUSE);</span><br><span class="line">    &#125;</span><br><span class="line">    mLifecycleRegistry.handleLifecycleEvent(Lifecycle.Event.ON_PAUSE);</span><br><span class="line">    mState = AWAITING_ENTER_EFFECTS;</span><br><span class="line">    mCalled = <span class="literal">false</span>;</span><br><span class="line">    onPause();</span><br><span class="line">    <span class="keyword">if</span> (!mCalled) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SuperNotCalledException</span>(<span class="string">&quot;Fragment &quot;</span> + <span class="built_in">this</span></span><br><span class="line">                + <span class="string">&quot; did not call through to super.onPause()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">performStop</span><span class="params">()</span> &#123;</span><br><span class="line">    mChildFragmentManager.dispatchStop();</span><br><span class="line">    <span class="keyword">if</span> (mView != <span class="literal">null</span>) &#123;</span><br><span class="line">        mViewLifecycleOwner.handleLifecycleEvent(Lifecycle.Event.ON_STOP);</span><br><span class="line">    &#125;</span><br><span class="line">    mLifecycleRegistry.handleLifecycleEvent(Lifecycle.Event.ON_STOP);</span><br><span class="line">    mState = ACTIVITY_CREATED;</span><br><span class="line">    mCalled = <span class="literal">false</span>;</span><br><span class="line">    onStop();</span><br><span class="line">    <span class="keyword">if</span> (!mCalled) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SuperNotCalledException</span>(<span class="string">&quot;Fragment &quot;</span> + <span class="built_in">this</span></span><br><span class="line">                + <span class="string">&quot; did not call through to super.onStop()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">performDestroy</span><span class="params">()</span> &#123;</span><br><span class="line">    mChildFragmentManager.dispatchDestroy();</span><br><span class="line">    mLifecycleRegistry.handleLifecycleEvent(Lifecycle.Event.ON_DESTROY);</span><br><span class="line">    mState = ATTACHED;</span><br><span class="line">    mCalled = <span class="literal">false</span>;</span><br><span class="line">    mIsCreated = <span class="literal">false</span>;</span><br><span class="line">    onDestroy();</span><br><span class="line">    <span class="keyword">if</span> (!mCalled) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SuperNotCalledException</span>(<span class="string">&quot;Fragment &quot;</span> + <span class="built_in">this</span></span><br><span class="line">                + <span class="string">&quot; did not call through to super.onDestroy()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;lifeCycleçš„Observer&quot;&gt;&lt;a href=&quot;#lifeCycleçš„Observer&quot; class=&quot;headerlink&quot; title=&quot;lifeCycleçš„Observer&quot;&gt;&lt;/a&gt;lifeCycleçš„Observer&lt;/h2&gt;&lt;figure class=&quot;highlight kotlin&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;74&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;75&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;76&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;77&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;78&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;interface&lt;/span&gt; &lt;span class=&quot;title class_&quot;&gt;LifecycleObserver&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;interface&lt;/span&gt; &lt;span class=&quot;title class_&quot;&gt;DefaultLifecycleObserver&lt;/span&gt; : &lt;span class=&quot;type&quot;&gt;LifecycleObserver&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     * Notifies that `ON_CREATE` event occurred.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     *&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     *&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     * This method will be called after the [LifecycleOwner]&amp;#x27;s `onCreate`&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     * method returns.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     *&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     * &lt;span class=&quot;doctag&quot;&gt;@param&lt;/span&gt; owner the component, whose state was changed&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onCreate&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(owner: &lt;span class=&quot;type&quot;&gt;LifecycleOwner&lt;/span&gt;)&lt;/span&gt;&lt;/span&gt; &amp;#123;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     * Notifies that `ON_START` event occurred.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     *&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     *&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     * This method will be called after the [LifecycleOwner]&amp;#x27;s `onStart` method returns.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     *&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     * &lt;span class=&quot;doctag&quot;&gt;@param&lt;/span&gt; owner the component, whose state was changed&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onStart&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(owner: &lt;span class=&quot;type&quot;&gt;LifecycleOwner&lt;/span&gt;)&lt;/span&gt;&lt;/span&gt; &amp;#123;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     * Notifies that `ON_RESUME` event occurred.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     *&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     *&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     * This method will be called after the [LifecycleOwner]&amp;#x27;s `onResume`&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     * method returns.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     *&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     * &lt;span class=&quot;doctag&quot;&gt;@param&lt;/span&gt; owner the component, whose state was changed&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onResume&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(owner: &lt;span class=&quot;type&quot;&gt;LifecycleOwner&lt;/span&gt;)&lt;/span&gt;&lt;/span&gt; &amp;#123;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     * Notifies that `ON_PAUSE` event occurred.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     *&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     *&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     * This method will be called before the [LifecycleOwner]&amp;#x27;s `onPause` method&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     * is called.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     *&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     * &lt;span class=&quot;doctag&quot;&gt;@param&lt;/span&gt; owner the component, whose state was changed&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onPause&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(owner: &lt;span class=&quot;type&quot;&gt;LifecycleOwner&lt;/span&gt;)&lt;/span&gt;&lt;/span&gt; &amp;#123;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     * Notifies that `ON_STOP` event occurred.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     *&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     *&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     * This method will be called before the [LifecycleOwner]&amp;#x27;s `onStop` method&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     * is called.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     *&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     * &lt;span class=&quot;doctag&quot;&gt;@param&lt;/span&gt; owner the component, whose state was changed&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onStop&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(owner: &lt;span class=&quot;type&quot;&gt;LifecycleOwner&lt;/span&gt;)&lt;/span&gt;&lt;/span&gt; &amp;#123;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     * Notifies that `ON_DESTROY` event occurred.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     *&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     *&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     * This method will be called before the [LifecycleOwner]&amp;#x27;s `onDestroy` method&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     * is called.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     *&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     * &lt;span class=&quot;doctag&quot;&gt;@param&lt;/span&gt; owner the component, whose state was changed&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onDestroy&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(owner: &lt;span class=&quot;type&quot;&gt;LifecycleOwner&lt;/span&gt;)&lt;/span&gt;&lt;/span&gt; &amp;#123;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;interface&lt;/span&gt; LifecycleEventObserver : LifecycleObserver &amp;#123;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     * Called when a state transition event happens.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     *&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     * &lt;span class=&quot;doctag&quot;&gt;@param&lt;/span&gt; source The source of the event&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     * &lt;span class=&quot;doctag&quot;&gt;@param&lt;/span&gt; event The event&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onStateChanged&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(source: &lt;span class=&quot;type&quot;&gt;LifecycleOwner&lt;/span&gt;, event: &lt;span class=&quot;type&quot;&gt;Lifecycle&lt;/span&gt;.&lt;span class=&quot;type&quot;&gt;Event&lt;/span&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;ul&gt;
&lt;li&gt;å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨&lt;code&gt;lifecycle.addObserver()&lt;/code&gt;æ—¶ï¼Œå¯ä»¥ä¼ å…¥&lt;code&gt;LifecycleEventObserver&lt;/code&gt;æˆ–&lt;code&gt;DefaultLifecycleObserver&lt;/code&gt;ï¼Œä¸€ä¸ªé€šè¿‡&lt;code&gt;event&lt;/code&gt;è·å–å½“å‰çŠ¶æ€ï¼Œä¸€ä¸ªé€šè¿‡ä¸åŒçš„å›è°ƒå‡½æ•°è·å–å½“å‰çŠ¶æ€&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;Activityæ ‘&quot;&gt;&lt;a href=&quot;#Activityæ ‘&quot; class=&quot;headerlink&quot; title=&quot;Activityæ ‘&quot;&gt;&lt;/a&gt;Activityæ ‘&lt;/h2&gt;&lt;figure class=&quot;highlight text&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Activity -- AccountAuthenticatorActivity&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         |- ActivityGroup -- TabActivity&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         |- ExpandableListActivity&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         |- LauncherActivity&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         |- ListActivity -- PreferenceActivity&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         |- NativeActivity&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         |- androidx.core.app.ComponentActivity -- androidx.activity.ComponentActivity -- FragmentActivity -- AppCompatActivity&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                                |- PreviewActivity&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         |- BootstrapActivity&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         |- EmptyActivity&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         |- EmptyFloatingActivity&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h2 id=&quot;LifecycleOwner&quot;&gt;&lt;a href=&quot;#LifecycleOwner&quot; class=&quot;headerlink&quot; title=&quot;LifecycleOwner&quot;&gt;&lt;/a&gt;LifecycleOwner&lt;/h2&gt;</summary>
    
    
    
    <category term="Android" scheme="https://jingtianer.github.io/home/categories/Android/"/>
    
    <category term="æ‰‹æ’¸Androidæºç " scheme="https://jingtianer.github.io/home/categories/Android/%E6%89%8B%E6%92%B8Android%E6%BA%90%E7%A0%81/"/>
    
    
    <category term="Android-å®˜æ–¹æºç " scheme="https://jingtianer.github.io/home/tags/Android-%E5%AE%98%E6%96%B9%E6%BA%90%E7%A0%81/"/>
    
  </entry>
  
  <entry>
    <title>åŸºç¡€02-viewModel</title>
    <link href="https://jingtianer.github.io/home/2024/07/31/Android%E9%AB%98%E7%BA%A7/%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/%E5%9F%BA%E7%A1%8002-viewModel/"/>
    <id>https://jingtianer.github.io/home/2024/07/31/Android%E9%AB%98%E7%BA%A7/%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/%E5%9F%BA%E7%A1%8002-viewModel/</id>
    <published>2024-07-31T13:15:36.000Z</published>
    <updated>2025-04-15T02:37:55.588Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ViewModelç®€ä»‹"><a href="#ViewModelç®€ä»‹" class="headerlink" title="ViewModelç®€ä»‹"></a>ViewModelç®€ä»‹</h2><p>åœ¨äº†è§£ViewModelä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹MVC, MVP, MVVMçš„å‘å±•<a href="https://www.geeksforgeeks.org/difference-between-mvc-mvp-and-mvvm-architecture-pattern-in-android/">Difference Between MVC, MVP and MVVM Architecture Pattern in Android</a></p><h2 id="ViewModelStoreOwner"><a href="#ViewModelStoreOwner" class="headerlink" title="ViewModelStoreOwner"></a><a href="https://developer.android.com/reference/kotlin/androidx/lifecycle/ViewModelStoreOwner">ViewModelStoreOwner</a></h2><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">ViewModelStoreOwner</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The owned [ViewModelStore]</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">val</span> viewModelStore: ViewModelStore</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å®ç°äº†<code>ViewModelStoreOwner</code>çš„ç±»ä¼šæœ‰ä¸€ä¸ª<code>viewModelStore</code>å±æ€§</li><li>åœ¨åˆ›å»º<code>ViewModel</code>æ—¶ä¼šä¼ é€’è¿™ä¸ªå˜é‡ï¼Œå…·ä½“ä¼ é€’æ–¹å¼åœ¨è§<a href="#by-viewmodels">by viewModels()</a></li><li>å®ç°äº†<code>ViewModelStoreOwner</code>çš„ç›´æ¥å­ç±»æœ‰ï¼š <a href="https://developer.android.com/reference/androidx/activity/ComponentActivity">ComponentActivity</a>, <a href="https://developer.android.com/reference/androidx/fragment/app/Fragment">Fragment</a> å’Œ <a href="https://developer.android.com/reference/androidx/navigation/NavBackStackEntry">NavBackStackEntry</a></li></ul><h2 id="ViewModelStore"><a href="#ViewModelStore" class="headerlink" title="ViewModelStore"></a>ViewModelStore</h2><p>å®é™…ä¸Šå°±æ˜¯ç»´æŠ¤äº†ä¸€ä¸ª<code>MutableMap&lt;String, ViewModel&gt;</code></p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">open</span> <span class="keyword">class</span> <span class="title class_">ViewModelStore</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> map = mutableMapOf&lt;String, ViewModel&gt;()</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@hide</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RestrictTo(RestrictTo.Scope.LIBRARY_GROUP)</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">put</span><span class="params">(key: <span class="type">String</span>, viewModel: <span class="type">ViewModel</span>)</span></span> &#123;</span><br><span class="line">        <span class="keyword">val</span> oldViewModel = map.put(key, viewModel)</span><br><span class="line">        oldViewModel?.onCleared()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns the `ViewModel` mapped to the given `key` or null if none exists.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@hide</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RestrictTo(RestrictTo.Scope.LIBRARY_GROUP)</span></span><br><span class="line">    <span class="keyword">operator</span> <span class="function"><span class="keyword">fun</span> <span class="title">get</span><span class="params">(key: <span class="type">String</span>)</span></span>: ViewModel? &#123;</span><br><span class="line">        <span class="keyword">return</span> map[key]</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@hide</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RestrictTo(RestrictTo.Scope.LIBRARY_GROUP)</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">keys</span><span class="params">()</span></span>: Set&lt;String&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> HashSet(map.keys)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Clears internal storage and notifies `ViewModel`s that they are no longer used.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">clear</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (vm <span class="keyword">in</span> map.values) &#123;</span><br><span class="line">            vm.clear()</span><br><span class="line">        &#125;</span><br><span class="line">        map.clear()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‘ç°å°±æ˜¯åœ¨å¯¹mapè¯»å†™ï¼Œæ³¨æ„åˆ°putæ–¹æ³•ä¼šè°ƒç”¨åŒkeyå€¼çš„æ—§ViewModelçš„<code>onCleared</code></p><ul><li><code>onCleared</code>å¹¶ä¸æ‰§è¡Œä»»ä½•æ“ä½œï¼Œæ˜¯æä¾›ç»™å­ç±»è¿›è¡Œå›æ”¶èµ„æºçš„å›è°ƒã€‚<code>ViewModel</code>çœŸæ­£è¿›è¡Œèµ„æºå›æ”¶ï¼ˆè°ƒç”¨<code>Closeable</code>çš„<code>close</code>æ–¹æ³•ï¼‰çš„å‡½æ•°æ˜¯<code>clear</code>ï¼Œputä¸­å¹¶æ²¡æœ‰è°ƒç”¨ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆå¥‡æ€ªçš„é—®é¢˜ï¼Œå…·ä½“çš„åŸå› åœ¨<a href="#a-viewmodelstoreput%E9%97%AE%E9%A2%98">ä¸‹é¢</a>ä¼šè§£é‡Š</li><li>é‚£ä¹ˆè¿™ä¸ªkeyæ˜¯ä»€ä¹ˆå‘¢ï¼Œ<a href="#viewmodelprovider%E7%9A%84get%E6%96%B9%E6%B3%95">ä¸‹é¢</a>å†çœ‹å§</li></ul><h2 id="by-viewModels"><a href="#by-viewModels" class="headerlink" title="by viewModels()"></a><code>by viewModels()</code></h2><h3 id="ComponentActivityçš„viewModels"><a href="#ComponentActivityçš„viewModels" class="headerlink" title="ComponentActivityçš„viewModels()"></a><code>ComponentActivity</code>çš„<code>viewModels()</code></h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MainThread</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;<span class="keyword">reified</span> VM : ViewModel&gt;</span> ComponentActivity.<span class="title">viewModels</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">noinline</span> extrasProducer: (() -&gt; <span class="type">CreationExtras</span>)? = <span class="literal">null</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">noinline</span> factoryProducer: (() -&gt; <span class="type">Factory</span>)? = <span class="literal">null</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>: Lazy&lt;VM&gt; &#123;</span><br><span class="line">    <span class="keyword">val</span> factoryPromise = factoryProducer ?: &#123;</span><br><span class="line">        defaultViewModelProviderFactory</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> ViewModelLazy(</span><br><span class="line">        VM::<span class="keyword">class</span>,</span><br><span class="line">        &#123; viewModelStore &#125;, <span class="comment">// 1ï¸âƒ£ viewModelStoreçš„ä¼ é€’åœ¨è¿™é‡Œ</span></span><br><span class="line">        factoryPromise, </span><br><span class="line">        &#123; extrasProducer?.invoke() ?: <span class="keyword">this</span>.defaultViewModelCreationExtras &#125;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°<code>viewModels()</code>å®é™…ä¸Šæ˜¯<code>ComponentActivity</code>çš„ä¸€ä¸ªæ‰©å±•æ–¹æ³•ï¼Œè¿”å›äº†<code>ViewModelLazy</code>å¯¹<code>ViewModel</code>çš„å±æ€§è¿›è¡Œä»£ç†</p><h2 id="ViewModelLazy"><a href="#ViewModelLazy" class="headerlink" title="ViewModelLazy"></a>ViewModelLazy</h2><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ViewModelLazy</span>&lt;<span class="type">VM : ViewModel</span>&gt; <span class="meta">@JvmOverloads</span> <span class="keyword">constructor</span>(</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> viewModelClass: KClass&lt;VM&gt;,</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> storeProducer: () -&gt; ViewModelStore,</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> factoryProducer: () -&gt; ViewModelProvider.Factory,</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> extrasProducer: () -&gt; CreationExtras = &#123; CreationExtras.Empty &#125;</span><br><span class="line">) : Lazy&lt;VM&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> cached: VM? = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">val</span> value: VM</span><br><span class="line">        <span class="keyword">get</span>() &#123;</span><br><span class="line">            <span class="keyword">val</span> viewModel = cached</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">if</span> (viewModel == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">val</span> factory = factoryProducer()</span><br><span class="line">                <span class="keyword">val</span> store = storeProducer()</span><br><span class="line">                ViewModelProvider(</span><br><span class="line">                    store,</span><br><span class="line">                    factory,</span><br><span class="line">                    extrasProducer()</span><br><span class="line">                ).<span class="keyword">get</span>(viewModelClass.java).also &#123;</span><br><span class="line">                    cached = it</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                viewModel</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">isInitialized</span><span class="params">()</span></span>: <span class="built_in">Boolean</span> = cached != <span class="literal">null</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°å½“å±æ€§é¦–æ¬¡<code>get</code>æ—¶ä¼šæ„é€ <code>ViewModelProvider</code>å¹¶è°ƒç”¨<code>get</code>æ–¹æ³•è·å–<code>viewModel</code>å¯¹è±¡</p><h2 id="ViewModelProvider"><a href="#ViewModelProvider" class="headerlink" title="ViewModelProvider"></a>ViewModelProvider</h2><h3 id="ViewModelProviderçš„getæ–¹æ³•"><a href="#ViewModelProviderçš„getæ–¹æ³•" class="headerlink" title="ViewModelProviderçš„getæ–¹æ³•"></a><code>ViewModelProvider</code>çš„<code>get</code>æ–¹æ³•</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MainThread</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">open</span> <span class="keyword">operator</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;T : ViewModel&gt;</span> <span class="title">get</span><span class="params">(modelClass: <span class="type">Class</span>&lt;<span class="type">T</span>&gt;)</span></span>: T &#123;</span><br><span class="line">    <span class="keyword">val</span> canonicalName = modelClass.canonicalName</span><br><span class="line">        ?: <span class="keyword">throw</span> IllegalArgumentException(<span class="string">&quot;Local and anonymous classes can not be ViewModels&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">get</span>(<span class="string">&quot;<span class="variable">$DEFAULT_KEY</span>:<span class="variable">$canonicalName</span>&quot;</span>, modelClass)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">open</span> <span class="keyword">operator</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;T : ViewModel&gt;</span> <span class="title">get</span><span class="params">(key: <span class="type">String</span>, modelClass: <span class="type">Class</span>&lt;<span class="type">T</span>&gt;)</span></span>: T &#123;</span><br><span class="line">    <span class="keyword">val</span> viewModel = store[key] <span class="comment">// 1ï¸âƒ£ ä»storeä¸­å–viewModel</span></span><br><span class="line">    <span class="keyword">if</span> (modelClass.isInstance(viewModel)) &#123; <span class="comment">// 2ï¸âƒ£ åˆ¤æ–­åˆæ³•æ€§</span></span><br><span class="line">        (factory <span class="keyword">as</span>? OnRequeryFactory)?.onRequery(viewModel!!)</span><br><span class="line">        <span class="keyword">return</span> viewModel <span class="keyword">as</span> T</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="meta">@Suppress(<span class="string">&quot;ControlFlowWithEmptyBody&quot;</span>)</span></span><br><span class="line">        <span class="keyword">if</span> (viewModel != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// <span class="doctag">TODO:</span> log a warning.</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">val</span> extras = MutableCreationExtras(defaultCreationExtras)</span><br><span class="line">    extras[VIEW_MODEL_KEY] = key</span><br><span class="line">    <span class="comment">// AGP has some desugaring issues associated with compileOnly dependencies so we need to</span></span><br><span class="line">    <span class="comment">// fall back to the other create method to keep from crashing.</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">try</span> &#123;</span><br><span class="line">        factory.create(modelClass, extras) <span class="comment">// 3ï¸âƒ£ é€šè¿‡factoryåˆ›å»ºViewModel</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> (e: AbstractMethodError) &#123; <span class="comment">// 3ï¸âƒ£ é€šè¿‡factoryåˆ›å»ºViewModel</span></span><br><span class="line">        factory.create(modelClass)</span><br><span class="line">    &#125;.also &#123; store.put(key, it) &#125; <span class="comment">// 4ï¸âƒ£ å­˜å…¥store</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>1ï¸âƒ£ ä»<code>store</code>ä¸­å–<code>viewModel</code>ï¼Œè¿™ä¸ª<code>store</code>å°±æ˜¯ä¸Šé¢æåˆ°çš„<a href="#viewmodelstore">ViewModelStore</a>, è¿™é‡Œå¯ä»¥çœ‹åˆ°å…¶<code>key</code>å°±æ˜¯ç±»å</li><li>2ï¸âƒ£ åˆ¤æ–­åˆæ³•æ€§ï¼Œ<code>isInstance</code>å‡½æ•°é¦–å…ˆåˆ¤ç©ºï¼Œå…¶æ¬¡åˆ¤æ–­æ˜¯å¦ä¸ºå¯¹åº”çš„ç±»å‹ï¼Œè¿™ä¸€æ­¥çš„åˆ¤ç©ºæ˜¯ä¸ºäº†åˆ¤æ–­æ˜¯å¦éœ€è¦æ„é€ <code>ViewModel</code>å®ä¾‹ï¼Œé¿å…è¿”å›ç©ºï¼›è¿™ä¸€æ­¥çš„åˆ¤æ–­ç±»å‹åˆ™æ˜¯ä¸ºäº†æé«˜å®‰å…¨æ€§ï¼Œè¿”å›æ—¶å¼ºè½¬ä¸ä¼šå¼ºè½¬å¤±è´¥</li><li>3ï¸âƒ£ é€šè¿‡<code>factory</code>åˆ›å»ºï¼Œè¿™ä¸€æ­¥æ˜¾è€Œæ˜“è§ï¼Œåˆ›å»ºæ–°çš„å®ä¾‹ã€‚è¿™é‡Œçš„<code>factory</code>é»˜è®¤å€¼æ˜¯é€šè¿‡<code>ComponentActivity</code>æ„é€ çš„<code>SavedStateViewModelFactory</code></li><li>4ï¸âƒ£ å­˜å…¥<code>store</code>ï¼Œåœ¨åˆ›å»ºåå­˜å…¥<code>store</code>ä¸­</li></ul><h3 id="A-ViewModelStore-put-é—®é¢˜"><a href="#A-ViewModelStore-put-é—®é¢˜" class="headerlink" title="A: ViewModelStore.put()é—®é¢˜"></a>A: ViewModelStore.put()é—®é¢˜</h3><blockquote><p>è¿™é‡Œå¯ä»¥æ¨æµ‹ï¼Œå¦‚æœåŒä¸€ä¸ª<code>ViewModelStoreOwner</code>ä¸­å£°æ˜äº†å¤šä¸ªåŒç±»å‹çš„<code>ViewModel</code>ï¼Œæ ¹æ®2ï¸âƒ£çš„åˆ¤æ–­ï¼Œä»–ä»¬ä¼šæ˜¯åŒä¸€ä¸ªå®ä¾‹ã€‚<code>ViewModelStore.put</code>æ—¶ä¸€èˆ¬ä¸ä¼šå­˜åœ¨åŒkeyå€¼çš„<code>ViewModel</code>å¯¹è±¡ï¼Œæ‰€ä»¥é‚£é‡Œæ˜¯å¦è°ƒç”¨<code>clear</code>è¿›è¡Œèµ„æºå›æ”¶ä¹Ÿå°±ä¸æ˜¯å¾ˆé‡è¦äº†ã€‚</p></blockquote><h2 id="ViewModel"><a href="#ViewModel" class="headerlink" title="ViewModel"></a>ViewModel</h2><p>ViewModelç±»å®é™…ä¸Šä¸æ˜¯å®é™…å®ç°ï¼ŒæŒæœ‰<code>ViewModelImpl</code>çš„å®ä¾‹ï¼Œå¯¹å…¶æ–¹æ³•è¿›è¡Œä»£ç†</p><h3 id="ç±»å®šä¹‰"><a href="#ç±»å®šä¹‰" class="headerlink" title="ç±»å®šä¹‰"></a>ç±»å®šä¹‰</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">actual</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">ViewModel</span></span><br></pre></td></tr></table></figure><p>å‡ ä¸ªæ³¨æ„çš„ç‚¹ï¼š</p><ul><li>actual: ä»‹ç»çœ‹<a href="https://www.baeldung.com/kotlin/actual-expect-keywords">è¿™é‡Œ</a>, å¤§æ¦‚æ˜¯å’Œè·¨ç«¯ç›¸å…³çš„ã€‚</li><li>abstract</li></ul><h3 id="clearæ–¹æ³•"><a href="#clearæ–¹æ³•" class="headerlink" title="clearæ–¹æ³•"></a>clearæ–¹æ³•</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">actual</span> <span class="keyword">open</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCleared</span><span class="params">()</span></span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@MainThread</span></span><br><span class="line"><span class="keyword">internal</span> <span class="keyword">actual</span> <span class="function"><span class="keyword">fun</span> <span class="title">clear</span><span class="params">()</span></span> &#123;</span><br><span class="line">    impl?.clear()</span><br><span class="line">    onCleared()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>è¿™é‡Œå¯ä»¥çœ‹åˆ°ç¨æœ‰ä¸åŒçš„æ˜¯ï¼Œé™¤äº†ä»£ç†è°ƒç”¨<code>ViewModelImpl</code>çš„<code>clear</code>æ–¹æ³•ï¼Œè¿˜è°ƒç”¨äº†é’©å­æ–¹æ³•<code>onCleared</code></li><li>å¦å¤–å¾ˆæœ‰è¶£çš„æ˜¯<code>ViewModelImpl</code>å’Œ<code>ViewModel</code>å¹¶æ²¡æœ‰ç»§æ‰¿å…³ç³»ï¼Œä¹Ÿæ²¡æœ‰ç»§æ‰¿ç›¸åŒçš„æ¥å£</li></ul><h2 id="ViewModelImpl"><a href="#ViewModelImpl" class="headerlink" title="ViewModelImpl"></a>ViewModelImpl</h2><h3 id="å…³é”®çš„å±æ€§"><a href="#å…³é”®çš„å±æ€§" class="headerlink" title="å…³é”®çš„å±æ€§"></a>å…³é”®çš„å±æ€§</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">val</span> keyToCloseables = mutableMapOf&lt;String, AutoCloseable&gt;()</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@see</span> [keyToCloseables]</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">val</span> closeables = mutableSetOf&lt;AutoCloseable&gt;()</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ç»´æŠ¤äº†ä¸€ä¸ªmapå’Œä¸€ä¸ªsetï¼Œä¿å­˜<code>AutoCloseable</code></p><h3 id="addCloseable"><a href="#addCloseable" class="headerlink" title="addCloseable"></a>addCloseable</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">addCloseable</span><span class="params">(key: <span class="type">String</span>, closeable: <span class="type">AutoCloseable</span>)</span></span> &#123;</span><br><span class="line">    <span class="comment">// Although no logic should be done after user calls onCleared(), we will</span></span><br><span class="line">    <span class="comment">// ensure that if it has already been called, the closeable attempting to</span></span><br><span class="line">    <span class="comment">// be added will be closed immediately to ensure there will be no leaks.</span></span><br><span class="line">    <span class="keyword">if</span> (isCleared) &#123;</span><br><span class="line">        closeWithRuntimeException(closeable)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> oldCloseable = synchronized(lock) &#123; keyToCloseables.put(key, closeable) &#125;</span><br><span class="line">    closeWithRuntimeException(oldCloseable)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** <span class="doctag">@see</span> [ViewModel.addCloseable] */</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">addCloseable</span><span class="params">(closeable: <span class="type">AutoCloseable</span>)</span></span> &#123;</span><br><span class="line">    <span class="comment">// Although no logic should be done after user calls onCleared(), we will</span></span><br><span class="line">    <span class="comment">// ensure that if it has already been called, the closeable attempting to</span></span><br><span class="line">    <span class="comment">// be added will be closed immediately to ensure there will be no leaks.</span></span><br><span class="line">    <span class="keyword">if</span> (isCleared) &#123;</span><br><span class="line">        closeWithRuntimeException(closeable)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    synchronized(lock) &#123; closeables += closeable &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å¯ä»¥çœ‹åˆ°ä¸¤ä¸ªå‡½æ•°ï¼Œä¸€ä¸ªæ˜¯æ·»åŠ åˆ°mapä¸­ï¼Œä¸€ä¸ªæ˜¯æ·»åŠ åˆ°setä¸­</li><li>å¦‚æœå½“å‰ViewModelå·²ç»è¢«clearäº†ï¼Œé‚£ä¹ˆä¼šè°ƒç”¨<code>closeWithRuntimeException</code>ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šè°ƒç”¨å…¶closeæ–¹æ³•ï¼Œå¹¶å°†closeæ—¶å‡ºç°çš„å¼‚å¸¸è½¬æ¢ä¸º<code>RuntimeException</code>æŠ›å‡º</li><li>å¦‚æœmapä¸­æœ‰åŒkeyå€¼çš„closeableï¼Œé‚£ä¹ˆä¹Ÿä¼šè°ƒç”¨<code>closeWithRuntimeException</code>å°†å…¶å…³é—­</li><li>è¿™ä¸¤ä¸ªå‡½æ•°ä¹Ÿå¯ä»¥æä¾›ç»™ç”¨æˆ·ä½¿ç”¨</li></ul><h3 id="æ„é€ æ–¹æ³•"><a href="#æ„é€ æ–¹æ³•" class="headerlink" title="æ„é€ æ–¹æ³•"></a>æ„é€ æ–¹æ³•</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">constructor</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">constructor</span>(viewModelScope: CoroutineScope) &#123;</span><br><span class="line">    addCloseable(VIEW_MODEL_SCOPE_KEY, viewModelScope.asCloseable())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">constructor</span>(<span class="keyword">vararg</span> closeables: AutoCloseable) &#123;</span><br><span class="line">    <span class="keyword">this</span>.closeables += closeables</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">constructor</span>(viewModelScope: CoroutineScope, <span class="keyword">vararg</span> closeables: AutoCloseable) &#123;</span><br><span class="line">    addCloseable(VIEW_MODEL_SCOPE_KEY, viewModelScope.asCloseable())</span><br><span class="line">    <span class="keyword">this</span>.closeables += closeables</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å¯ä»¥çœ‹åˆ°ï¼Œåªå…è®¸ä¼ é€’ä¸€ä¸ª<code>CoroutineScope</code>ï¼Œä¼šå°†å…¶è½¬åŒ–ä¸ºcloseableï¼Œå­˜åˆ°mapä¸­</li><li>çœ‹ä¸Šå»åªå…è®¸ä¼ é€’ä¸€ä¸ª<code>CoroutineScope</code>ï¼Œä½†æ˜¯è¿˜æ˜¯å¯ä»¥é€šè¿‡ç›¸åŒçš„æ–¹æ³•ä¼ é€’å¤šä¸ªç”¨<code>CloseableCoroutineScope</code>åŒ…è£…è¿‡çš„Scopeå¯¹è±¡</li><li>è¿™ä¸ªæ„é€ å…è®¸ä¼ é€’ä¸€ä¸ª<code>CoroutineScope</code>å®Œå…¨æ˜¯ä¸ºäº†å°†å…¶è½¬åŒ–ä¸ºCloseableå¯¹è±¡ï¼Œæ²¡æœ‰åˆ«çš„æ„ä¹‰ï¼Œæ„Ÿè§‰å¾ˆå¤šä½™ã€‚</li></ul><h3 id="clear"><a href="#clear" class="headerlink" title="clear"></a>clear</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MainThread</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">clear</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (isCleared) <span class="keyword">return</span> <span class="comment">// 1ï¸âƒ£</span></span><br><span class="line"></span><br><span class="line">    isCleared = <span class="literal">true</span> <span class="comment">// 2ï¸âƒ£</span></span><br><span class="line">    synchronized(lock) &#123;</span><br><span class="line">        <span class="keyword">for</span> (closeable <span class="keyword">in</span> keyToCloseables.values) &#123;</span><br><span class="line">            closeWithRuntimeException(closeable)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (closeable <span class="keyword">in</span> closeables) &#123;</span><br><span class="line">            closeWithRuntimeException(closeable)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// Clear only resources without keys to prevent accidental recreation of resources.</span></span><br><span class="line">        <span class="comment">// For example, `viewModelScope` would be recreated leading to unexpected behaviour.</span></span><br><span class="line">        closeables.clear()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>@MainThread</code>æ ‡æ˜è¯¥æ–¹æ³•åº”è¯¥è¢«åœ¨ä¸»çº¿ç¨‹è°ƒç”¨</li><li>æ–¹æ³•å…¶å®å°±æ˜¯æŠŠæ‰€æœ‰closeableå…³æ‰ï¼Œå†æŠŠsetæ¸…ç©ºï¼Œä½†æ˜¯mapå´æ²¡æœ‰æ¸…ç©ºï¼Ÿ</li><li>å¯ä»¥çœ‹åˆ°1ï¸âƒ£å’Œ2ï¸âƒ£å¹¶ä¸æ˜¯åŸå­çš„ï¼Œå¦‚æœclearè¢«å¤šä¸ªçº¿ç¨‹åŒæ—¶è°ƒç”¨ï¼Œæœ‰å¯èƒ½å­˜åœ¨mapé‡Œçš„closeableè¢«closeä¸¤æ¬¡çš„æƒ…å†µã€‚</li></ul><h2 id="SavedStateViewModelFactory"><a href="#SavedStateViewModelFactory" class="headerlink" title="SavedStateViewModelFactory"></a>SavedStateViewModelFactory</h2><h3 id="createæ–¹æ³•"><a href="#createæ–¹æ³•" class="headerlink" title="createæ–¹æ³•"></a>createæ–¹æ³•</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;T : ViewModel&gt;</span> <span class="title">create</span><span class="params">(modelClass: <span class="type">Class</span>&lt;<span class="type">T</span>&gt;, extras: <span class="type">CreationExtras</span>)</span></span>: T &#123; <span class="comment">// 1ï¸âƒ£</span></span><br><span class="line">    <span class="keyword">val</span> key = extras[ViewModelProvider.NewInstanceFactory.VIEW_MODEL_KEY]</span><br><span class="line">        ?: <span class="keyword">throw</span> IllegalStateException(</span><br><span class="line">            <span class="string">&quot;VIEW_MODEL_KEY must always be provided by ViewModelProvider&quot;</span></span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">if</span> (extras[SAVED_STATE_REGISTRY_OWNER_KEY] != <span class="literal">null</span> &amp;&amp;</span><br><span class="line">        extras[VIEW_MODEL_STORE_OWNER_KEY] != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">val</span> application = extras[ViewModelProvider.AndroidViewModelFactory.APPLICATION_KEY]</span><br><span class="line">        <span class="keyword">val</span> isAndroidViewModel = AndroidViewModel::<span class="keyword">class</span>.java.isAssignableFrom(modelClass)</span><br><span class="line">        <span class="keyword">val</span> <span class="keyword">constructor</span>: Constructor&lt;T&gt;? = <span class="keyword">if</span> (isAndroidViewModel &amp;&amp; application != <span class="literal">null</span>) &#123;</span><br><span class="line">            findMatchingConstructor(modelClass, ANDROID_VIEWMODEL_SIGNATURE)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            findMatchingConstructor(modelClass, VIEWMODEL_SIGNATURE)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// doesn&#x27;t need SavedStateHandle</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">constructor</span> == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> factory.create(modelClass, extras)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">val</span> viewModel = <span class="keyword">if</span> (isAndroidViewModel &amp;&amp; application != <span class="literal">null</span>) &#123;</span><br><span class="line">            newInstance(modelClass, <span class="keyword">constructor</span>, application, extras.createSavedStateHandle())</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            newInstance(modelClass, <span class="keyword">constructor</span>, extras.createSavedStateHandle())</span><br><span class="line">        &#125;</span><br><span class="line">        viewModel</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">val</span> viewModel = <span class="keyword">if</span> (lifecycle != <span class="literal">null</span>) &#123;</span><br><span class="line">            create(key, modelClass)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> IllegalStateException(<span class="string">&quot;SAVED_STATE_REGISTRY_OWNER_KEY and&quot;</span> +</span><br><span class="line">                <span class="string">&quot;VIEW_MODEL_STORE_OWNER_KEY must be provided in the creation extras to&quot;</span> +</span><br><span class="line">                <span class="string">&quot;successfully create a ViewModel.&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        viewModel</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * Creates a new instance of the given `Class`.</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> key a key associated with the requested ViewModel</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> modelClass a `Class` whose instance is requested</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> a newly created ViewModel</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@throws</span> UnsupportedOperationException if the there is no lifecycle</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="type">&lt;T : ViewModel&gt;</span> <span class="title">create</span><span class="params">(key: <span class="type">String</span>, modelClass: <span class="type">Class</span>&lt;<span class="type">T</span>&gt;)</span></span>: T &#123; <span class="comment">// 2ï¸âƒ£</span></span><br><span class="line">    <span class="comment">// empty constructor was called.</span></span><br><span class="line">    <span class="keyword">val</span> lifecycle = lifecycle</span><br><span class="line">        ?: <span class="keyword">throw</span> UnsupportedOperationException(</span><br><span class="line">            <span class="string">&quot;SavedStateViewModelFactory constructed with empty constructor supports only &quot;</span> +</span><br><span class="line">                <span class="string">&quot;calls to create(modelClass: Class&lt;T&gt;, extras: CreationExtras).&quot;</span></span><br><span class="line">        )</span><br><span class="line">    <span class="keyword">val</span> isAndroidViewModel = AndroidViewModel::<span class="keyword">class</span>.java.isAssignableFrom(modelClass)</span><br><span class="line">    <span class="keyword">val</span> <span class="keyword">constructor</span>: Constructor&lt;T&gt;? = <span class="keyword">if</span> (isAndroidViewModel &amp;&amp; application != <span class="literal">null</span>) &#123;</span><br><span class="line">        findMatchingConstructor(modelClass, ANDROID_VIEWMODEL_SIGNATURE)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        findMatchingConstructor(modelClass, VIEWMODEL_SIGNATURE)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// doesn&#x27;t need SavedStateHandle</span></span><br><span class="line">    <span class="keyword">constructor</span></span><br><span class="line">        ?: <span class="comment">// If you are using a stateful constructor and no application is available, we</span></span><br><span class="line">        <span class="comment">// use an instance factory instead.</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">if</span> (application != <span class="literal">null</span>) factory.create(modelClass)</span><br><span class="line">        <span class="keyword">else</span> instance.create(modelClass)</span><br><span class="line">    <span class="keyword">val</span> controller = LegacySavedStateHandleController.create(</span><br><span class="line">        savedStateRegistry!!, lifecycle, key, defaultArgs</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">val</span> viewModel: T = <span class="keyword">if</span> (isAndroidViewModel &amp;&amp; application != <span class="literal">null</span>) &#123;</span><br><span class="line">        newInstance(modelClass, <span class="keyword">constructor</span>, application!!, controller.handle)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        newInstance(modelClass, <span class="keyword">constructor</span>, controller.handle)</span><br><span class="line">    &#125;</span><br><span class="line">    viewModel.setTagIfAbsent(</span><br><span class="line">        AbstractSavedStateViewModelFactory.TAG_SAVED_STATE_HANDLE_CONTROLLER, controller</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">return</span> viewModel</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>1ï¸âƒ£å’Œ2ï¸âƒ£å¤§ä½“æµç¨‹ä¸Šéƒ½æ˜¯è·å–æ„é€ å‡½æ•°ï¼Œåˆ›å»ºå®ä¾‹å¯¹è±¡</li><li>åŒºåˆ«åœ¨äº<code>newInstance</code>çš„ç¬¬å››ä¸ªå‚æ•°ä¸åŒï¼Œä¸€ä¸ªé€šè¿‡<code>extras</code>è·å–ï¼Œä¸€ä¸ªé€šè¿‡<code>LegacySavedStateHandleController</code>è·å¾—ï¼Œçœ‹èµ·æ¥å¾ˆå¤æ‚ï¼Œä½†æ˜¯çœ‹ä¸€ä¸‹è¿™ä¸ª<code>newInstance</code>çš„å®ç°å°±ä¼šå‘ç°ï¼Œç¬¬å››ä¸ªå‚æ•°å®é™…ä¸Šå°±æ˜¯æ„é€ å‡½æ•°çš„å‚æ•°</li></ul><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">internal</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;T : ViewModel?&gt;</span> <span class="title">newInstance</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    modelClass: <span class="type">Class</span>&lt;<span class="type">T</span>&gt;,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">constructor</span>: <span class="type">Constructor</span>&lt;<span class="type">T</span>&gt;,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">vararg</span> params: <span class="type">Any</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>: T &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">constructor</span>.newInstance(*params)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e: IllegalAccessException) &#123;</span><br><span class="line">        <span class="keyword">throw</span> RuntimeException(<span class="string">&quot;Failed to access <span class="variable">$modelClass</span>&quot;</span>, e)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e: InstantiationException) &#123;</span><br><span class="line">        <span class="keyword">throw</span> RuntimeException(<span class="string">&quot;A <span class="variable">$modelClass</span> cannot be instantiated.&quot;</span>, e)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e: InvocationTargetException) &#123;</span><br><span class="line">        <span class="keyword">throw</span> RuntimeException(</span><br><span class="line">            <span class="string">&quot;An exception happened in constructor of <span class="variable">$modelClass</span>&quot;</span>, e.cause</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="viewModelStoreä½•æ—¶è¢«clear"><a href="#viewModelStoreä½•æ—¶è¢«clear" class="headerlink" title="viewModelStoreä½•æ—¶è¢«clear"></a>viewModelStoreä½•æ—¶è¢«clear</h2><p>åœ¨ComponentActivtyçš„åˆå§‹åŒ–æ—¶ï¼Œä¼šçœ‹åˆ°ä¸‹é¢è¿™æ®µä»£ç </p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">lifecycle.addObserver(LifecycleEventObserver &#123; _, event -&gt;</span><br><span class="line">    <span class="keyword">if</span> (event == Lifecycle.Event.ON_DESTROY) &#123;</span><br><span class="line">        <span class="comment">// Clear out the available context</span></span><br><span class="line">        contextAwareHelper.clearAvailableContext()</span><br><span class="line">        <span class="comment">// And clear the ViewModelStore</span></span><br><span class="line">        <span class="keyword">if</span> (!isChangingConfigurations) &#123;</span><br><span class="line">            viewModelStore.clear()</span><br><span class="line">        &#125;</span><br><span class="line">        reportFullyDrawnExecutor.activityDestroyed()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>å¦‚æœActivityç”Ÿå‘½å‘¨æœŸåˆ°äº†<code>ON_DESTROY</code>ï¼Œä¸”ä¸æ˜¯å¤œé—´æ¨¡å¼æ”¹å˜ç­‰æƒ…å†µï¼Œå°±ä¼šå°†viewModelæ¸…ç©ºï¼Œåšåˆ°äº†ç•Œé¢å’Œæ•°æ®åˆ†ç¦»ã€‚</p><h2 id="CoroutineScopeæ˜¯å¦‚ä½•å˜æˆCloseableçš„"><a href="#CoroutineScopeæ˜¯å¦‚ä½•å˜æˆCloseableçš„" class="headerlink" title="CoroutineScopeæ˜¯å¦‚ä½•å˜æˆCloseableçš„"></a>CoroutineScopeæ˜¯å¦‚ä½•å˜æˆCloseableçš„</h2><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">internal</span> <span class="function"><span class="keyword">fun</span> CoroutineScope.<span class="title">asCloseable</span><span class="params">()</span></span> = CloseableCoroutineScope(coroutineScope = <span class="keyword">this</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * [CoroutineScope] that provides a method to [close] it, causing the rejection of any new tasks and</span></span><br><span class="line"><span class="comment"> * cleanup of all underlying resources associated with the scope.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title class_">CloseableCoroutineScope</span>(</span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">val</span> coroutineContext: CoroutineContext,</span><br><span class="line">) : AutoCloseable, CoroutineScope &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">constructor</span>(coroutineScope: CoroutineScope) : <span class="keyword">this</span>(coroutineScope.coroutineContext)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">close</span><span class="params">()</span></span> = coroutineContext.cancel()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><code>CloseableCoroutineScope</code>å®ç°äº†<code>AutoCloseable</code>, åœ¨closeæ–¹æ³•ä¸­å°†åç¨‹cancelæ‰</p></blockquote><h2 id="CreationExtras"><a href="#CreationExtras" class="headerlink" title="CreationExtras"></a>CreationExtras</h2><p>åœ¨<a href="#create%E6%96%B9%E6%B3%95">SavedStateViewModelFactoryçš„createæ–¹æ³•</a>ä¸­ï¼Œå¯ä»¥çœ‹åˆ°factoryä¼šæ‹¿åˆ°ä¸€ä¸ª<code>CreationExtras</code><br>åœ¨<a href="#by-viewmodels">by viewModels()</a>æ—¶ï¼Œä¼šä¼ é€’ä¸€ä¸ªæ„é€ <code>CreationExtras</code>çš„å‡½æ•°ï¼Œå¦‚æœæ²¡æä¾›ï¼Œå°±ä½¿ç”¨é»˜è®¤<code>ComponentActivity</code>æä¾›çš„<code>defaultViewModelCreationExtras</code></p><h3 id="é»˜è®¤çš„CreationExtras"><a href="#é»˜è®¤çš„CreationExtras" class="headerlink" title="é»˜è®¤çš„CreationExtras"></a>é»˜è®¤çš„<code>CreationExtras</code></h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="keyword">val</span> defaultViewModelCreationExtras: CreationExtras</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">        * &#123;<span class="doctag">@inheritDoc</span>&#125;</span></span><br><span class="line"><span class="comment">        *</span></span><br><span class="line"><span class="comment">        * The extras of [getIntent] when this is first called will be used as</span></span><br><span class="line"><span class="comment">        * the defaults to any [androidx.lifecycle.SavedStateHandle] passed to a view model</span></span><br><span class="line"><span class="comment">        * created using this extra.</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">    <span class="keyword">get</span>() &#123;</span><br><span class="line">        <span class="keyword">val</span> extras = MutableCreationExtras()</span><br><span class="line">        <span class="keyword">if</span> (application != <span class="literal">null</span>) &#123;</span><br><span class="line">            extras[APPLICATION_KEY] = application</span><br><span class="line">        &#125;</span><br><span class="line">        extras[SAVED_STATE_REGISTRY_OWNER_KEY] = <span class="keyword">this</span></span><br><span class="line">        extras[VIEW_MODEL_STORE_OWNER_KEY] = <span class="keyword">this</span></span><br><span class="line">        <span class="keyword">val</span> intentExtras = intent?.extras</span><br><span class="line">        <span class="keyword">if</span> (intentExtras != <span class="literal">null</span>) &#123;</span><br><span class="line">            extras[DEFAULT_ARGS_KEY] = intentExtras</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> extras</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°é‡Œé¢å­˜äº†å½“å‰çš„Applicationå¯¹è±¡ï¼Œè¿˜æœ‰ä¸¤ä¸ªthisï¼Œè¿˜ä¼šå°†<code>intent.extra</code>æ”¾è¿›å»</p><blockquote><p>MutableCreationExtraså…¶å®ä¹Ÿæ˜¯ç»´æŠ¤äº†ä¸€ä¸ªmap</p></blockquote><h2 id="ç»™ViewModelä¼ å‚"><a href="#ç»™ViewModelä¼ å‚" class="headerlink" title="ç»™ViewModelä¼ å‚"></a>ç»™ViewModelä¼ å‚</h2><ul><li>å‰é¢æåˆ°æˆ‘ä»¬å¯ä»¥æŒ‡å®š<code>Factory</code>å’Œ<code>CreationExtras</code></li><li>å¯ä»¥è‡ªå·±ç¼–å†™<code>Factory</code>ï¼Œä»<code>CreationExtras</code>ä¸­è·å–å‚æ•°ï¼Œä¸‹é¢æ˜¯ç¤ºä¾‹ä»£ç <figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MainViewModel</span>(</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> coroutineScope: CoroutineScope = CloseableCoroutineScope(), </span><br><span class="line">    param1: String, </span><br><span class="line">    param2: <span class="built_in">Int</span></span><br><span class="line">) : ViewModel(coroutineScope) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">companion</span> <span class="keyword">object</span> &#123;</span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;T : ViewModel&gt;</span> <span class="title">create</span><span class="params">(modelClass: <span class="type">Class</span>&lt;<span class="type">T</span>&gt;, extras: <span class="type">CreationExtras</span>)</span></span>: T &#123;</span><br><span class="line">            <span class="keyword">val</span> param1 = extras[MY_PARAM_KEY1]!!</span><br><span class="line">            <span class="keyword">val</span> param2 = extras[MY_PARAM_KEY2]!!</span><br><span class="line">            <span class="keyword">return</span> MainViewModel(param1 = param1, param2 = param2) <span class="keyword">as</span> T</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">val</span> MY_PARAM_KEY1 = <span class="keyword">object</span> : CreationExtras.Key&lt;String&gt; &#123;&#125;</span><br><span class="line">        <span class="keyword">val</span> MY_PARAM_KEY2 = <span class="keyword">object</span> : CreationExtras.Key&lt;<span class="built_in">Int</span>&gt; &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyActivity</span> : <span class="type">AppCompatActivity</span>() &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> viewModel : MainViewModel <span class="keyword">by</span> viewModels(&#123;</span><br><span class="line">        <span class="keyword">return</span><span class="symbol">@viewModels</span> MutableCreationExtras().apply &#123;</span><br><span class="line">            <span class="keyword">set</span>(MainViewModel.MY_PARAM_KEY1, <span class="string">&quot;1&quot;</span>)</span><br><span class="line">            <span class="keyword">set</span>(MainViewModel.MY_PARAM_KEY2, <span class="number">2</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)&#123;</span><br><span class="line">        <span class="keyword">return</span><span class="symbol">@viewModels</span> MainViewModel.Factory</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Fragment-viewModels"><a href="#Fragment-viewModels" class="headerlink" title="Fragment.viewModels"></a>Fragment.viewModels</h2><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MainThread</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;<span class="keyword">reified</span> VM : ViewModel&gt;</span> Fragment.<span class="title">viewModels</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">noinline</span> ownerProducer: () -&gt; <span class="type">ViewModelStoreOwner</span> = &#123; this &#125;,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">noinline</span> extrasProducer: (() -&gt; <span class="type">CreationExtras</span>)? = <span class="literal">null</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">noinline</span> factoryProducer: (() -&gt; <span class="type">Factory</span>)? = <span class="literal">null</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>: Lazy&lt;VM&gt; &#123;</span><br><span class="line">    <span class="keyword">val</span> owner <span class="keyword">by</span> lazy(LazyThreadSafetyMode.NONE) &#123; ownerProducer() &#125;</span><br><span class="line">    <span class="keyword">return</span> createViewModelLazy(</span><br><span class="line">        VM::<span class="keyword">class</span>,</span><br><span class="line">        &#123; owner.viewModelStore &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            extrasProducer?.invoke()</span><br><span class="line">            ?: (owner <span class="keyword">as</span>? HasDefaultViewModelProviderFactory)?.defaultViewModelCreationExtras</span><br><span class="line">            ?: CreationExtras.Empty</span><br><span class="line">        &#125;,</span><br><span class="line">        factoryProducer ?: &#123;</span><br><span class="line">            (owner <span class="keyword">as</span>? HasDefaultViewModelProviderFactory)?.defaultViewModelProviderFactory</span><br><span class="line">                ?: defaultViewModelProviderFactory</span><br><span class="line">        &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>æ”¯æŒåˆ›å»º&#x2F;è·å–å…¶ä»–<code>owner</code>çš„<code>ViewModel</code></li><li>å’Œ<code>ComponentActivity</code>ä¸€æ ·ï¼Œ<code>createViewModelLazy</code>çš„è¿”å›çš„ä¹Ÿæ˜¯<code>ViewModelLazy</code>ç±»</li></ul><h2 id="Fragment-activityViewModels"><a href="#Fragment-activityViewModels" class="headerlink" title="Fragment.activityViewModels"></a>Fragment.activityViewModels</h2><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MainThread</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;<span class="keyword">reified</span> VM : ViewModel&gt;</span> Fragment.<span class="title">activityViewModels</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">noinline</span> extrasProducer: (() -&gt; <span class="type">CreationExtras</span>)? = <span class="literal">null</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">noinline</span> factoryProducer: (() -&gt; <span class="type">Factory</span>)? = <span class="literal">null</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>: Lazy&lt;VM&gt; = createViewModelLazy(</span><br><span class="line">    VM::<span class="keyword">class</span>, &#123; requireActivity().viewModelStore &#125;,</span><br><span class="line">    &#123; extrasProducer?.invoke() ?: requireActivity().defaultViewModelCreationExtras &#125;,</span><br><span class="line">    factoryProducer ?: &#123; requireActivity().defaultViewModelProviderFactory &#125;</span><br><span class="line"></span><br><span class="line">)</span><br></pre></td></tr></table></figure><ul><li>è·å–<code>activity</code>çš„<code>viewModelStore</code></li></ul><h2 id="è·å–çˆ¶fragmentçš„viewModel"><a href="#è·å–çˆ¶fragmentçš„viewModel" class="headerlink" title="è·å–çˆ¶fragmentçš„viewModel"></a>è·å–çˆ¶fragmentçš„viewModel</h2><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> parentFragmentViewModel:XXXViewModel <span class="keyword">by</span> viewModels(ownerProducer = &#123; requireParentFragment() &#125;)</span><br></pre></td></tr></table></figure><h2 id="navigationå›¾çš„viewModel"><a href="#navigationå›¾çš„viewModel" class="headerlink" title="navigationå›¾çš„viewModel"></a>navigationå›¾çš„viewModel</h2><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> naviViewModel : MainViewModel <span class="keyword">by</span> navGraphViewModels(R.id.xxx)</span><br><span class="line"><span class="keyword">val</span> naviViewModel1 : MainViewModel <span class="keyword">by</span> viewModels(ownerProducer = &#123; findNavController().getBackStackEntry(R.id.xxx) &#125;)</span><br></pre></td></tr></table></figure><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MainThread</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;<span class="keyword">reified</span> VM : ViewModel&gt;</span> Fragment.<span class="title">navGraphViewModels</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="meta">@IdRes</span> navGraphId: <span class="type">Int</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">noinline</span> extrasProducer: (() -&gt; <span class="type">CreationExtras</span>)? = <span class="literal">null</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">noinline</span> factoryProducer: (() -&gt; <span class="type">ViewModelProvider</span>.<span class="type">Factory</span>)? = <span class="literal">null</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>: Lazy&lt;VM&gt; &#123;</span><br><span class="line">    <span class="keyword">val</span> backStackEntry <span class="keyword">by</span> lazy &#123;</span><br><span class="line">        findNavController().getBackStackEntry(navGraphId)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">val</span> storeProducer: () -&gt; ViewModelStore = &#123;</span><br><span class="line">        backStackEntry.viewModelStore</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> createViewModelLazy(</span><br><span class="line">        VM::<span class="keyword">class</span>, storeProducer,</span><br><span class="line">        &#123; extrasProducer?.invoke() ?: backStackEntry.defaultViewModelCreationExtras &#125;,</span><br><span class="line">        factoryProducer ?: &#123; backStackEntry.defaultViewModelProviderFactory &#125;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>navGraphViewModelså…¶å®å°±æ˜¯è°ƒç”¨äº†<code>findNavController().getBackStackEntry(navGraphId)</code>ï¼Œç„¶åè·å–å…¶<code>viewModelStore</code></li></ul><h2 id="élazyè·å–çš„viewModel"><a href="#élazyè·å–çš„viewModel" class="headerlink" title="élazyè·å–çš„viewModel"></a>élazyè·å–çš„viewModel</h2><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> viewModel = ViewModelProvider(<span class="keyword">this</span>.viewModelStore, ViewModelProvider.NewInstanceFactory.instance)[MainViewModel::<span class="keyword">class</span>.java]</span><br><span class="line"><span class="keyword">val</span> viewModel = ViewModelProvider(<span class="keyword">this</span>.viewModelStore, MainViewModel.Factory, MutableCreationExtras().apply &#123;</span><br><span class="line">    <span class="keyword">set</span>(MainViewModel.MY_PARAM_KEY1, <span class="string">&quot;1&quot;</span>)</span><br><span class="line">    <span class="keyword">set</span>(MainViewModel.MY_PARAM_KEY2, <span class="number">2</span>)</span><br><span class="line">&#125;)[MainViewModel::<span class="keyword">class</span>.java]</span><br></pre></td></tr></table></figure><h2 id="Composeè·å–viewModel"><a href="#Composeè·å–viewModel" class="headerlink" title="Composeè·å–viewModel"></a>Composeè·å–viewModel</h2><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">Greeting</span><span class="params">(string: <span class="type">String</span>, modifier: <span class="type">Modifier</span> = Modifier, vm : <span class="type">MainViewModel</span> = viewModel()</span></span>) &#123;</span><br><span class="line">    Text(</span><br><span class="line">        text = string,</span><br><span class="line">        modifier = modifier</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;<span class="keyword">reified</span> VM : ViewModel&gt;</span> <span class="title">viewModel</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    viewModelStoreOwner: <span class="type">ViewModelStoreOwner</span> = checkNotNull(LocalViewModelStoreOwner.current)</span></span> &#123;</span><br><span class="line">        <span class="string">&quot;No ViewModelStoreOwner was provided via LocalViewModelStoreOwner&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    key: String? = <span class="literal">null</span>,</span><br><span class="line">    factory: ViewModelProvider.Factory? = <span class="literal">null</span>,</span><br><span class="line">    extras: CreationExtras = <span class="keyword">if</span> (viewModelStoreOwner <span class="keyword">is</span> HasDefaultViewModelProviderFactory) &#123;</span><br><span class="line">        viewModelStoreOwner.defaultViewModelCreationExtras</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        CreationExtras.Empty</span><br><span class="line">    &#125;</span><br><span class="line">): VM = viewModel(VM::<span class="keyword">class</span>, viewModelStoreOwner, key, factory, extras)</span><br></pre></td></tr></table></figure><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Suppress(<span class="string">&quot;MissingJvmstatic&quot;</span>)</span></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;VM : ViewModel&gt;</span> <span class="title">viewModel</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    modelClass: <span class="type">KClass</span>&lt;<span class="type">VM</span>&gt;,</span></span></span><br><span class="line"><span class="params"><span class="function">    viewModelStoreOwner: <span class="type">ViewModelStoreOwner</span> = checkNotNull(LocalViewModelStoreOwner.current)</span></span> &#123;</span><br><span class="line">        <span class="string">&quot;No ViewModelStoreOwner was provided via LocalViewModelStoreOwner&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    key: String? = <span class="literal">null</span>,</span><br><span class="line">    factory: ViewModelProvider.Factory? = <span class="literal">null</span>,</span><br><span class="line">    extras: CreationExtras = <span class="keyword">if</span> (viewModelStoreOwner <span class="keyword">is</span> HasDefaultViewModelProviderFactory) &#123;</span><br><span class="line">        viewModelStoreOwner.defaultViewModelCreationExtras</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        CreationExtras.Empty</span><br><span class="line">    &#125;</span><br><span class="line">): VM = viewModelStoreOwner.<span class="keyword">get</span>(modelClass, key, factory, extras)</span><br></pre></td></tr></table></figure><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">internal</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;VM : ViewModel&gt;</span> ViewModelStoreOwner.<span class="title">get</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    modelClass: <span class="type">KClass</span>&lt;<span class="type">VM</span>&gt;,</span></span></span><br><span class="line"><span class="params"><span class="function">    key: <span class="type">String</span>? = <span class="literal">null</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    factory: <span class="type">ViewModelProvider</span>.<span class="type">Factory</span>? = <span class="literal">null</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    extras: <span class="type">CreationExtras</span> = <span class="keyword">if</span> (this <span class="keyword">is</span> HasDefaultViewModelProviderFactory)</span></span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.defaultViewModelCreationExtras</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        CreationExtras.Empty</span><br><span class="line">    &#125;</span><br><span class="line">): VM &#123;</span><br><span class="line">    <span class="keyword">val</span> provider = <span class="keyword">if</span> (factory != <span class="literal">null</span>) &#123;</span><br><span class="line">        ViewModelProvider.create(<span class="keyword">this</span>.viewModelStore, factory, extras)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">this</span> <span class="keyword">is</span> HasDefaultViewModelProviderFactory) &#123;</span><br><span class="line">        ViewModelProvider.create(<span class="keyword">this</span>.viewModelStore, <span class="keyword">this</span>.defaultViewModelProviderFactory, extras)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        ViewModelProvider.create(<span class="keyword">this</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">if</span> (key != <span class="literal">null</span>) &#123;</span><br><span class="line">        provider[key, modelClass]</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        provider[modelClass]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">HasDefaultViewModelProviderFactory</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns the default [ViewModelProvider.Factory] that should be</span></span><br><span class="line"><span class="comment">     * used when no custom `Factory` is provided to the</span></span><br><span class="line"><span class="comment">     * [ViewModelProvider] constructors.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">val</span> defaultViewModelProviderFactory: ViewModelProvider.Factory</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns the default [CreationExtras] that should be passed into</span></span><br><span class="line"><span class="comment">     * [ViewModelProvider.Factory.create] when no overriding</span></span><br><span class="line"><span class="comment">     * [CreationExtras] were passed to the [ViewModelProvider] constructors.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">val</span> defaultViewModelCreationExtras: CreationExtras</span><br><span class="line">        <span class="keyword">get</span>() = CreationExtras.Empty</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>store</code>æ¥è‡ª<code>LocalViewModelStoreOwner.current</code></li><li>factoryå’Œextrasæ¥è‡ª<code>HasDefaultViewModelProviderFactory</code></li></ul><h2 id="å¤‡å¿˜å•"><a href="#å¤‡å¿˜å•" class="headerlink" title="å¤‡å¿˜å•"></a>å¤‡å¿˜å•</h2><p><a href="https://developer.android.com/topic/libraries/architecture/viewmodel/viewmodel-cheatsheet?hl=zh-cn"><img src="https://developer.android.com/static/images/topic/libraries/architecture/viewmodel-apis-cheatsheet.png?hl=zh-cn"></a></p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;ViewModelç®€ä»‹&quot;&gt;&lt;a href=&quot;#ViewModelç®€ä»‹&quot; class=&quot;headerlink&quot; title=&quot;ViewModelç®€ä»‹&quot;&gt;&lt;/a&gt;ViewModelç®€ä»‹&lt;/h2&gt;&lt;p&gt;åœ¨äº†è§£ViewModelä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹MVC, MVP, MVVMçš„å‘å±•&lt;a href=&quot;https://www.geeksforgeeks.org/difference-between-mvc-mvp-and-mvvm-architecture-pattern-in-android/&quot;&gt;Difference Between MVC, MVP and MVVM Architecture Pattern in Android&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;ViewModelStoreOwner&quot;&gt;&lt;a href=&quot;#ViewModelStoreOwner&quot; class=&quot;headerlink&quot; title=&quot;ViewModelStoreOwner&quot;&gt;&lt;/a&gt;&lt;a href=&quot;https://developer.android.com/reference/kotlin/androidx/lifecycle/ViewModelStoreOwner&quot;&gt;ViewModelStoreOwner&lt;/a&gt;&lt;/h2&gt;&lt;figure class=&quot;highlight kotlin&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;interface&lt;/span&gt; &lt;span class=&quot;title class_&quot;&gt;ViewModelStoreOwner&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     * The owned [ViewModelStore]&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;val&lt;/span&gt; viewModelStore: ViewModelStore&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;ul&gt;
&lt;li&gt;å®ç°äº†&lt;code&gt;ViewModelStoreOwner&lt;/code&gt;çš„ç±»ä¼šæœ‰ä¸€ä¸ª&lt;code&gt;viewModelStore&lt;/code&gt;å±æ€§&lt;/li&gt;
&lt;li&gt;åœ¨åˆ›å»º&lt;code&gt;ViewModel&lt;/code&gt;æ—¶ä¼šä¼ é€’è¿™ä¸ªå˜é‡ï¼Œå…·ä½“ä¼ é€’æ–¹å¼åœ¨è§&lt;a href=&quot;#by-viewmodels&quot;&gt;by viewModels()&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;å®ç°äº†&lt;code&gt;ViewModelStoreOwner&lt;/code&gt;çš„ç›´æ¥å­ç±»æœ‰ï¼š &lt;a href=&quot;https://developer.android.com/reference/androidx/activity/ComponentActivity&quot;&gt;ComponentActivity&lt;/a&gt;, &lt;a href=&quot;https://developer.android.com/reference/androidx/fragment/app/Fragment&quot;&gt;Fragment&lt;/a&gt; å’Œ &lt;a href=&quot;https://developer.android.com/reference/androidx/navigation/NavBackStackEntry&quot;&gt;NavBackStackEntry&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;ViewModelStore&quot;&gt;&lt;a href=&quot;#ViewModelStore&quot; class=&quot;headerlink&quot; title=&quot;ViewModelStore&quot;&gt;&lt;/a&gt;ViewModelStore&lt;/h2&gt;</summary>
    
    
    
    <category term="Android" scheme="https://jingtianer.github.io/home/categories/Android/"/>
    
    <category term="æ‰‹æ’¸Androidæºç " scheme="https://jingtianer.github.io/home/categories/Android/%E6%89%8B%E6%92%B8Android%E6%BA%90%E7%A0%81/"/>
    
    
    <category term="Android-å®˜æ–¹æºç " scheme="https://jingtianer.github.io/home/tags/Android-%E5%AE%98%E6%96%B9%E6%BA%90%E7%A0%81/"/>
    
  </entry>
  
  <entry>
    <title>MIUISupermarketç§»æ¤</title>
    <link href="https://jingtianer.github.io/home/2024/07/13/misc/MIUISupermarket%E7%A7%BB%E6%A4%8D/"/>
    <id>https://jingtianer.github.io/home/2024/07/13/misc/MIUISupermarket%E7%A7%BB%E6%A4%8D/</id>
    <published>2024-07-13T03:28:00.000Z</published>
    <updated>2025-04-15T02:37:55.625Z</updated>
    
    <content type="html"><![CDATA[<h2 id="VerifyError"><a href="#VerifyError" class="headerlink" title="VerifyError"></a>VerifyError</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java.lang.VerifyError: Verifier rejected <span class="keyword">class</span> <span class="title class_">com</span>.xiaomi.market.util.UIUtils: <span class="keyword">void</span> com.xiaomi.market.util.UIUtils.setStatusBarDarkMode(android.app.Activity, <span class="type">boolean</span>) failed to verify: <span class="keyword">void</span> com.xiaomi.market.util.UIUtils.setStatusBarDarkMode(android.app.Activity, <span class="type">boolean</span>): [<span class="number">0x15</span>] type Undefined unexpected as arg to <span class="keyword">if</span>-eqz/<span class="keyword">if</span>-nez (declaration of <span class="string">&#x27;com.xiaomi.market.util.UIUtils&#x27;</span> appears in /data/app/~~pH0reBrzyfvMag1T-TAoDw==/com.xiaomi.market-EzZXS_MznmhQs5NCCbvqfA==/base.apk!classes2.dex)</span><br></pre></td></tr></table></figure><ul><li>ä¸€èˆ¬å‡ºç°VerifyErroréƒ½æ˜¯å› ä¸ºå¯¹smaliä»£ç ä¿®æ”¹ï¼Œå¯¼è‡´æ— æ³•é€šè¿‡éªŒè¯ã€‚å½“å‰é‡åˆ°è¿‡çš„æƒ…å†µæœ‰ï¼š<ul><li>æ’å…¥ä»£ç æ—¶æ— æ„è¦†ç›–äº†ä¸‹é¢ä¼šç”¨åˆ°çš„å¯„å­˜å™¨çš„å€¼ï¼Œå¯¼è‡´å¯„å­˜å™¨ç±»å‹ä¸åŒ¹é…ç­‰é—®é¢˜ã€‚</li><li>å¯¹æ–¹æ³•å‚æ•°ç±»å‹ä¿®æ”¹ä½†æœªä¿®æ”¹è°ƒç”¨æ—¶ä¼ å…¥çš„å‚æ•°</li><li>ä¼ é€’å‚æ•°æ—¶ä¼ é€’äº†ç±»å‹ä¸åŒ¹é…çš„å‚æ•°</li></ul></li></ul><h2 id="ClassNotFound"><a href="#ClassNotFound" class="headerlink" title="ClassNotFound"></a>ClassNotFound</h2><p>åœ¨xiaomiå•†åº—ä¸­ä½¿ç”¨äº†<code>Lmiui/os/Build</code>ç±»ï¼Œè¯¥ç±»ç»§æ‰¿<code>Landroid/os/Build</code>ï¼Œä¸”å­˜åœ¨äºå°ç±³ç³»ç»Ÿä¸­ï¼Œå¯¼è‡´ç±»æ‰¾ä¸åˆ°ã€‚å¯¼è‡´è¿è¡Œæ—¶é—ªé€€ã€‚</p><p>å¯¹äºè¿™ç±»å°ç±³ç³»ç»Ÿä¸­æ‰èƒ½è·å–åˆ°çš„ç±»ï¼Œé‡‡ç”¨ç­‰ä»·æ›¿æ¢çš„æ–¹æ³•è¿›è¡Œä¿®å¤ã€‚å¦‚åœ¨<code>Lmiui/os/Build</code>ä¸­æœ‰ï¼š</p><ul><li>IS_INTERNATIONAL_BUILD</li><li>IS_ALPHA_BUILD</li><li>IS_DEVELOPMENT_VERSION</li><li>IS_INTERNATIONAL_BUILD</li><li>getRegion()<br>ç­‰å­—æ®µå’Œæ–¹æ³•ï¼Œå¯ä»¥åœ¨miuiä¸­æŸ¥çœ‹ä¸€ä¸‹å¯¹åº”çš„å€¼ï¼Œç„¶åæ‰‹åŠ¨ä¿®æ”¹smaliä»£ç ï¼Œå°†å€¼æ›¿æ¢ä¸ºå¯¹åº”çš„å€¼ã€‚</li></ul><h2 id="Dexæ–¹æ³•æ•°é™åˆ¶"><a href="#Dexæ–¹æ³•æ•°é™åˆ¶" class="headerlink" title="Dexæ–¹æ³•æ•°é™åˆ¶"></a>Dexæ–¹æ³•æ•°é™åˆ¶</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">org.jf.util.ExceptionWithContext: Error <span class="keyword">while</span> writing instruction at code offset <span class="number">0x2</span></span><br></pre></td></tr></table></figure><p>åœ¨apktoolsæ‰“åŒ…smaliæ—¶æŠ¥é”™ï¼Œ<br>å¯¹smaliä¿®æ”¹æ—¶æ·»åŠ äº†å¾ˆå¤šæ–¹æ³•ï¼Œå¯¼è‡´ä¸€ä¸ªdexå†…æ–¹æ³•æ•°è¶…è¿‡65,535ï¼Œå¯¼è‡´æ‰“åŒ…å¤±è´¥ã€‚</p><p>è§£å†³æ–¹æ³•ï¼šåœ¨smaliæºç ç›®å½•ä¸­æ–°å»ºæ–‡<code>sources_dex$&#123;n&#125;</code>ç›®å½•ï¼Œå°†ä»£ç æ”¾å…¥è¯¥ä½ç½®ï¼Œé‡æ–°ç¼–è¯‘ï¼Œå³å¯å°†ä»£ç æ‰“åŒ…å…¥æ–°çš„dexæ–‡ä»¶ä¸­ã€‚</p><h2 id="åº”ç”¨æ— æ³•å®‰è£…"><a href="#åº”ç”¨æ— æ³•å®‰è£…" class="headerlink" title="åº”ç”¨æ— æ³•å®‰è£…"></a>åº”ç”¨æ— æ³•å®‰è£…</h2><p>MIUIé­”æ”¹äº†PackageInstaller<br>å½“ä½¿ç”¨packageinstallerè·å–sessionå†™å…¥å®‰è£…åŒ…åï¼Œä½¿ç”¨commitä¼ å…¥ä¸€ä¸ªPendingIntentå¯¹è±¡ï¼Œç”¨äºæ¥æ”¶åº”ç”¨å®‰è£…ç»“æœçš„å¹¿æ’­ã€‚è€Œè¯¥é€šçŸ¥çš„å†…å®¹è¢«é­”æ”¹ï¼Œå¯¼è‡´æ”¶åˆ°åŸç”Ÿç³»ç»Ÿçš„å¹¿æ’­æ—¶ï¼Œæ— æ³•æ­£ç¡®å¤„ç†åç»­çš„é€»è¾‘ï¼Œå¯¼è‡´å®‰è£…å¤±è´¥ã€‚</p><ul><li>ä¸­é—´è¿˜å°è¯•è¿‡ä½¿ç”¨<code>ACTION_VIEW</code>æˆ–<code>ACTION_INSTALL_PACKAGE</code>startActivityå¯åŠ¨å®‰è£…å™¨ï¼Œä½†è¿™ä¸¤ä¸ªACTIONåœ¨å®‰å“10åè¢«åºŸå¼ƒäº†ï¼Œå¯¼è‡´æ²¡æœ‰Activityå“åº”è¯¥Intentï¼Œæ— æ³•è¿›è¡Œå®‰è£…ã€‚</li><li>ä½¿ç”¨<code>ACTION</code>å®‰è£…apkæ—¶ï¼Œå¦‚æœapkæ–‡ä»¶åœ¨ç§æœ‰å­˜å‚¨ç©ºé—´å†…ï¼Œè¦ä½¿ç”¨FileProviderã€‚</li></ul><h2 id="æœªè§£å†³çš„é—®é¢˜"><a href="#æœªè§£å†³çš„é—®é¢˜" class="headerlink" title="æœªè§£å†³çš„é—®é¢˜"></a>æœªè§£å†³çš„é—®é¢˜</h2><ul><li>æ— æ³•å¸è½½</li><li>æ— æ³•æš‚åœä»»åŠ¡</li><li>å®‰è£…åæ²¡æœ‰è°ƒç”¨sessionçš„abandon()æ–¹æ³•</li><li>é¦–é¡µé¡¶éƒ¨æ ‡é¢˜æ ä¸ç³»ç»ŸçŠ¶æ€æ ä¹‹é—´å­˜åœ¨ç©ºç™½éƒ¨åˆ†</li></ul><h2 id="å¦å¤–"><a href="#å¦å¤–" class="headerlink" title="å¦å¤–"></a>å¦å¤–</h2><p>ä¸­é—´è¿˜æœ‰ä¸€ä¸ªMIUISettingsProviderçš„ç±»æ‰¾ä¸åˆ°ï¼Œæˆ‘å½“æ—¶ç›´æ¥æŠŠmiuiä¸­çš„SettingsProvideræ›¿æ¢åˆ°PixelOSçš„SettingsProviderä¸­ï¼Œå¯¼æ‰‹æœºè‡´å˜ç –ï¼Œæ•‘ç –æ•‘äº†å¥½ä¹…ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;VerifyError&quot;&gt;&lt;a href=&quot;#VerifyError&quot; class=&quot;headerlink&quot; title=&quot;VerifyError&quot;&gt;&lt;/a&gt;VerifyError&lt;/h2&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;java.lang.VerifyError: Verifier rejected &lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title class_&quot;&gt;com&lt;/span&gt;.xiaomi.market.util.UIUtils: &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; com.xiaomi.market.util.UIUtils.setStatusBarDarkMode(android.app.Activity, &lt;span class=&quot;type&quot;&gt;boolean&lt;/span&gt;) failed to verify: &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; com.xiaomi.market.util.UIUtils.setStatusBarDarkMode(android.app.Activity, &lt;span class=&quot;type&quot;&gt;boolean&lt;/span&gt;): [&lt;span class=&quot;number&quot;&gt;0x15&lt;/span&gt;] type Undefined unexpected as arg to &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;-eqz/&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;-nez (declaration of &lt;span class=&quot;string&quot;&gt;&amp;#x27;com.xiaomi.market.util.UIUtils&amp;#x27;&lt;/span&gt; appears in /data/app/~~pH0reBrzyfvMag1T-TAoDw==/com.xiaomi.market-EzZXS_MznmhQs5NCCbvqfA==/base.apk!classes2.dex)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;ul&gt;
&lt;li&gt;ä¸€èˆ¬å‡ºç°VerifyErroréƒ½æ˜¯å› ä¸ºå¯¹smaliä»£ç ä¿®æ”¹ï¼Œå¯¼è‡´æ— æ³•é€šè¿‡éªŒè¯ã€‚å½“å‰é‡åˆ°è¿‡çš„æƒ…å†µæœ‰ï¼š&lt;ul&gt;
&lt;li&gt;æ’å…¥ä»£ç æ—¶æ— æ„è¦†ç›–äº†ä¸‹é¢ä¼šç”¨åˆ°çš„å¯„å­˜å™¨çš„å€¼ï¼Œå¯¼è‡´å¯„å­˜å™¨ç±»å‹ä¸åŒ¹é…ç­‰é—®é¢˜ã€‚&lt;/li&gt;
&lt;li&gt;å¯¹æ–¹æ³•å‚æ•°ç±»å‹ä¿®æ”¹ä½†æœªä¿®æ”¹è°ƒç”¨æ—¶ä¼ å…¥çš„å‚æ•°&lt;/li&gt;
&lt;li&gt;ä¼ é€’å‚æ•°æ—¶ä¼ é€’äº†ç±»å‹ä¸åŒ¹é…çš„å‚æ•°&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;ClassNotFound&quot;&gt;&lt;a href=&quot;#ClassNotFound&quot; class=&quot;headerlink&quot; title=&quot;ClassNotFound&quot;&gt;&lt;/a&gt;ClassNotFound&lt;/h2&gt;&lt;p&gt;åœ¨xiaomiå•†åº—ä¸­ä½¿ç”¨äº†&lt;code&gt;Lmiui/os/Build&lt;/code&gt;ç±»ï¼Œè¯¥ç±»ç»§æ‰¿&lt;code&gt;Landroid/os/Build&lt;/code&gt;ï¼Œä¸”å­˜åœ¨äºå°ç±³ç³»ç»Ÿä¸­ï¼Œå¯¼è‡´ç±»æ‰¾ä¸åˆ°ã€‚å¯¼è‡´è¿è¡Œæ—¶é—ªé€€ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºè¿™ç±»å°ç±³ç³»ç»Ÿä¸­æ‰èƒ½è·å–åˆ°çš„ç±»ï¼Œé‡‡ç”¨ç­‰ä»·æ›¿æ¢çš„æ–¹æ³•è¿›è¡Œä¿®å¤ã€‚å¦‚åœ¨&lt;code&gt;Lmiui/os/Build&lt;/code&gt;ä¸­æœ‰ï¼š&lt;/p&gt;</summary>
    
    
    
    <category term="misc" scheme="https://jingtianer.github.io/home/categories/misc/"/>
    
    
    <category term="hexo" scheme="https://jingtianer.github.io/home/tags/hexo/"/>
    
  </entry>
  
  <entry>
    <title>åŸºç¡€01-Context</title>
    <link href="https://jingtianer.github.io/home/2024/07/01/Android%E9%AB%98%E7%BA%A7/%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/%E5%9F%BA%E7%A1%8001-Context/"/>
    <id>https://jingtianer.github.io/home/2024/07/01/Android%E9%AB%98%E7%BA%A7/%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/%E5%9F%BA%E7%A1%8001-Context/</id>
    <published>2024-07-01T13:15:36.000Z</published>
    <updated>2025-04-15T02:37:55.587Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å¤§çº²"><a href="#å¤§çº²" class="headerlink" title="å¤§çº²"></a>å¤§çº²</h2><ul><li>Contextç±»<ul><li>æ³¨è§£<ul><li>ç”¨äºæ ‡æ³¨æ–‡ä»¶ã€SharedPreferencesã€æ•°æ®åº“çš„æ‰“å¼€æ–¹å¼çš„æ³¨è§£</li><li>ç”¨äºæ ‡æ³¨bindServiceæ—¶ï¼Œserviceçš„flagsçš„æ³¨è§£</li><li>ç”¨äºæ ‡æ³¨registerReceiveræ—¶ï¼Œreceiverçš„flagsçš„æ³¨è§£</li><li>ç”¨äºæ ‡æ³¨getServiceæ—¶ï¼ŒservicesNameçš„æ³¨è§£</li><li>ç”¨äºæ ‡æ³¨createPackageContextã€createPackageContextAsUserã€createContextAsUserã€createApplicationContextæ—¶çš„flagsçš„æ³¨è§£</li></ul></li><li>å¸¸é‡å®šä¹‰<ul><li>å¯¹åº”ä¸Šé¢æ³¨è§£ä¸­é™åˆ¶çš„å¸¸é‡</li><li>WAL</li></ul></li></ul></li></ul><h2 id="Contextç±»"><a href="#Contextç±»" class="headerlink" title="Contextç±»"></a>Contextç±»</h2><p>Contextæ˜¯æŠ½è±¡ç±»ï¼Œå…·ä½“å®ç°åœ¨ContextImplï¼ŒApplicationï¼ŒServiceï¼ŒActivityéƒ½ç›´æ¥æˆ–é—´æ¥ç»§æ‰¿è‡ªContextWrapperï¼ŒContextWrapperé€šè¿‡ä»£ç†çš„æ–¹å¼è°ƒç”¨çœŸæ­£çš„ContextImplã€‚</p><h3 id="æ³¨è§£"><a href="#æ³¨è§£" class="headerlink" title="æ³¨è§£"></a>æ³¨è§£</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** <span class="doctag">@hide</span> */</span></span><br><span class="line"><span class="meta">@IntDef(flag = true, prefix = &#123; &quot;MODE_&quot; &#125;, value = &#123;</span></span><br><span class="line"><span class="meta">        MODE_PRIVATE,</span></span><br><span class="line"><span class="meta">        MODE_WORLD_READABLE,</span></span><br><span class="line"><span class="meta">        MODE_WORLD_WRITEABLE,</span></span><br><span class="line"><span class="meta">        MODE_APPEND,</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.SOURCE)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> FileMode &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** <span class="doctag">@hide</span> */</span></span><br><span class="line"><span class="meta">@IntDef(flag = true, prefix = &#123; &quot;MODE_&quot; &#125;, value = &#123;</span></span><br><span class="line"><span class="meta">        MODE_PRIVATE,</span></span><br><span class="line"><span class="meta">        MODE_WORLD_READABLE,</span></span><br><span class="line"><span class="meta">        MODE_WORLD_WRITEABLE,</span></span><br><span class="line"><span class="meta">        MODE_MULTI_PROCESS,</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.SOURCE)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> PreferencesMode &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** <span class="doctag">@hide</span> */</span></span><br><span class="line"><span class="meta">@IntDef(flag = true, prefix = &#123; &quot;MODE_&quot; &#125;, value = &#123;</span></span><br><span class="line"><span class="meta">        MODE_PRIVATE,</span></span><br><span class="line"><span class="meta">        MODE_WORLD_READABLE,</span></span><br><span class="line"><span class="meta">        MODE_WORLD_WRITEABLE,</span></span><br><span class="line"><span class="meta">        MODE_ENABLE_WRITE_AHEAD_LOGGING,</span></span><br><span class="line"><span class="meta">        MODE_NO_LOCALIZED_COLLATORS,</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.SOURCE)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> DatabaseMode &#123;&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** <span class="doctag">@hide</span> */</span></span><br><span class="line"><span class="meta">@IntDef(flag = true, prefix = &#123; &quot;BIND_&quot; &#125;, value = &#123;</span></span><br><span class="line"><span class="meta">        BIND_AUTO_CREATE,</span></span><br><span class="line"><span class="meta">        BIND_DEBUG_UNBIND,</span></span><br><span class="line"><span class="meta">        BIND_NOT_FOREGROUND,</span></span><br><span class="line"><span class="meta">        BIND_ABOVE_CLIENT,</span></span><br><span class="line"><span class="meta">        BIND_ALLOW_OOM_MANAGEMENT,</span></span><br><span class="line"><span class="meta">        BIND_WAIVE_PRIORITY,</span></span><br><span class="line"><span class="meta">        BIND_IMPORTANT,</span></span><br><span class="line"><span class="meta">        BIND_ADJUST_WITH_ACTIVITY,</span></span><br><span class="line"><span class="meta">        BIND_NOT_PERCEPTIBLE,</span></span><br><span class="line"><span class="meta">        BIND_INCLUDE_CAPABILITIES</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.SOURCE)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> BindServiceFlags &#123;&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** <span class="doctag">@hide</span> */</span></span><br><span class="line"><span class="meta">@IntDef(flag = true, prefix = &#123; &quot;RECEIVER_VISIBLE_&quot; &#125;, value = &#123;</span></span><br><span class="line"><span class="meta">        RECEIVER_VISIBLE_TO_INSTANT_APPS</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.SOURCE)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> RegisterReceiverFlags &#123;&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** <span class="doctag">@hide</span> */</span></span><br><span class="line"><span class="meta">@StringDef(suffix = &#123; &quot;_SERVICE&quot; &#125;, value = &#123;</span></span><br><span class="line"><span class="meta">        POWER_SERVICE,</span></span><br><span class="line"><span class="meta">        //@hide: POWER_STATS_SERVICE,</span></span><br><span class="line"><span class="meta">        WINDOW_SERVICE,</span></span><br><span class="line"><span class="meta">        LAYOUT_INFLATER_SERVICE,</span></span><br><span class="line"><span class="meta">        ACCOUNT_SERVICE,</span></span><br><span class="line"><span class="meta">        ACTIVITY_SERVICE,</span></span><br><span class="line"><span class="meta">        ALARM_SERVICE,</span></span><br><span class="line"><span class="meta">        NOTIFICATION_SERVICE,</span></span><br><span class="line"><span class="meta">        ACCESSIBILITY_SERVICE,</span></span><br><span class="line"><span class="meta">        CAPTIONING_SERVICE,</span></span><br><span class="line"><span class="meta">        KEYGUARD_SERVICE,</span></span><br><span class="line"><span class="meta">        LOCATION_SERVICE,</span></span><br><span class="line"><span class="meta">        //@hide: COUNTRY_DETECTOR,</span></span><br><span class="line"><span class="meta">        SEARCH_SERVICE,</span></span><br><span class="line"><span class="meta">        SENSOR_SERVICE,</span></span><br><span class="line"><span class="meta">        SENSOR_PRIVACY_SERVICE,</span></span><br><span class="line"><span class="meta">        STORAGE_SERVICE,</span></span><br><span class="line"><span class="meta">        STORAGE_STATS_SERVICE,</span></span><br><span class="line"><span class="meta">        WALLPAPER_SERVICE,</span></span><br><span class="line"><span class="meta">        TIME_ZONE_RULES_MANAGER_SERVICE,</span></span><br><span class="line"><span class="meta">        VIBRATOR_MANAGER_SERVICE,</span></span><br><span class="line"><span class="meta">        VIBRATOR_SERVICE,</span></span><br><span class="line"><span class="meta">        //@hide: STATUS_BAR_SERVICE,</span></span><br><span class="line"><span class="meta">        CONNECTIVITY_SERVICE,</span></span><br><span class="line"><span class="meta">        PAC_PROXY_SERVICE,</span></span><br><span class="line"><span class="meta">        VCN_MANAGEMENT_SERVICE,</span></span><br><span class="line"><span class="meta">        //@hide: IP_MEMORY_STORE_SERVICE,</span></span><br><span class="line"><span class="meta">        IPSEC_SERVICE,</span></span><br><span class="line"><span class="meta">        VPN_MANAGEMENT_SERVICE,</span></span><br><span class="line"><span class="meta">        TEST_NETWORK_SERVICE,</span></span><br><span class="line"><span class="meta">        //@hide: UPDATE_LOCK_SERVICE,</span></span><br><span class="line"><span class="meta">        //@hide: NETWORKMANAGEMENT_SERVICE,</span></span><br><span class="line"><span class="meta">        NETWORK_STATS_SERVICE,</span></span><br><span class="line"><span class="meta">        //@hide: NETWORK_POLICY_SERVICE,</span></span><br><span class="line"><span class="meta">        WIFI_SERVICE,</span></span><br><span class="line"><span class="meta">        WIFI_AWARE_SERVICE,</span></span><br><span class="line"><span class="meta">        WIFI_P2P_SERVICE,</span></span><br><span class="line"><span class="meta">        WIFI_SCANNING_SERVICE,</span></span><br><span class="line"><span class="meta">        //@hide: LOWPAN_SERVICE,</span></span><br><span class="line"><span class="meta">        //@hide: WIFI_RTT_SERVICE,</span></span><br><span class="line"><span class="meta">        //@hide: ETHERNET_SERVICE,</span></span><br><span class="line"><span class="meta">        WIFI_RTT_RANGING_SERVICE,</span></span><br><span class="line"><span class="meta">        NSD_SERVICE,</span></span><br><span class="line"><span class="meta">        AUDIO_SERVICE,</span></span><br><span class="line"><span class="meta">        AUTH_SERVICE,</span></span><br><span class="line"><span class="meta">        FINGERPRINT_SERVICE,</span></span><br><span class="line"><span class="meta">        //@hide: FACE_SERVICE,</span></span><br><span class="line"><span class="meta">        BIOMETRIC_SERVICE,</span></span><br><span class="line"><span class="meta">        MEDIA_ROUTER_SERVICE,</span></span><br><span class="line"><span class="meta">        TELEPHONY_SERVICE,</span></span><br><span class="line"><span class="meta">        TELEPHONY_SUBSCRIPTION_SERVICE,</span></span><br><span class="line"><span class="meta">        CARRIER_CONFIG_SERVICE,</span></span><br><span class="line"><span class="meta">        EUICC_SERVICE,</span></span><br><span class="line"><span class="meta">        //@hide: MMS_SERVICE,</span></span><br><span class="line"><span class="meta">        TELECOM_SERVICE,</span></span><br><span class="line"><span class="meta">        CLIPBOARD_SERVICE,</span></span><br><span class="line"><span class="meta">        INPUT_METHOD_SERVICE,</span></span><br><span class="line"><span class="meta">        TEXT_SERVICES_MANAGER_SERVICE,</span></span><br><span class="line"><span class="meta">        TEXT_CLASSIFICATION_SERVICE,</span></span><br><span class="line"><span class="meta">        APPWIDGET_SERVICE,</span></span><br><span class="line"><span class="meta">        //@hide: VOICE_INTERACTION_MANAGER_SERVICE,</span></span><br><span class="line"><span class="meta">        //@hide: BACKUP_SERVICE,</span></span><br><span class="line"><span class="meta">        REBOOT_READINESS_SERVICE,</span></span><br><span class="line"><span class="meta">        ROLLBACK_SERVICE,</span></span><br><span class="line"><span class="meta">        DROPBOX_SERVICE,</span></span><br><span class="line"><span class="meta">        //@hide: DEVICE_IDLE_CONTROLLER,</span></span><br><span class="line"><span class="meta">        //@hide: POWER_WHITELIST_MANAGER,</span></span><br><span class="line"><span class="meta">        DEVICE_POLICY_SERVICE,</span></span><br><span class="line"><span class="meta">        UI_MODE_SERVICE,</span></span><br><span class="line"><span class="meta">        DOWNLOAD_SERVICE,</span></span><br><span class="line"><span class="meta">        NFC_SERVICE,</span></span><br><span class="line"><span class="meta">        BLUETOOTH_SERVICE,</span></span><br><span class="line"><span class="meta">        //@hide: SIP_SERVICE,</span></span><br><span class="line"><span class="meta">        USB_SERVICE,</span></span><br><span class="line"><span class="meta">        LAUNCHER_APPS_SERVICE,</span></span><br><span class="line"><span class="meta">        //@hide: SERIAL_SERVICE,</span></span><br><span class="line"><span class="meta">        //@hide: HDMI_CONTROL_SERVICE,</span></span><br><span class="line"><span class="meta">        INPUT_SERVICE,</span></span><br><span class="line"><span class="meta">        DISPLAY_SERVICE,</span></span><br><span class="line"><span class="meta">        //@hide COLOR_DISPLAY_SERVICE,</span></span><br><span class="line"><span class="meta">        USER_SERVICE,</span></span><br><span class="line"><span class="meta">        RESTRICTIONS_SERVICE,</span></span><br><span class="line"><span class="meta">        APP_OPS_SERVICE,</span></span><br><span class="line"><span class="meta">        ROLE_SERVICE,</span></span><br><span class="line"><span class="meta">        //@hide ROLE_CONTROLLER_SERVICE,</span></span><br><span class="line"><span class="meta">        CAMERA_SERVICE,</span></span><br><span class="line"><span class="meta">        //@hide: PLATFORM_COMPAT_SERVICE,</span></span><br><span class="line"><span class="meta">        //@hide: PLATFORM_COMPAT_NATIVE_SERVICE,</span></span><br><span class="line"><span class="meta">        PRINT_SERVICE,</span></span><br><span class="line"><span class="meta">        CONSUMER_IR_SERVICE,</span></span><br><span class="line"><span class="meta">        //@hide: TRUST_SERVICE,</span></span><br><span class="line"><span class="meta">        TV_INPUT_SERVICE,</span></span><br><span class="line"><span class="meta">        //@hide: TV_TUNER_RESOURCE_MGR_SERVICE,</span></span><br><span class="line"><span class="meta">        //@hide: NETWORK_SCORE_SERVICE,</span></span><br><span class="line"><span class="meta">        USAGE_STATS_SERVICE,</span></span><br><span class="line"><span class="meta">        MEDIA_SESSION_SERVICE,</span></span><br><span class="line"><span class="meta">        MEDIA_COMMUNICATION_SERVICE,</span></span><br><span class="line"><span class="meta">        BATTERY_SERVICE,</span></span><br><span class="line"><span class="meta">        JOB_SCHEDULER_SERVICE,</span></span><br><span class="line"><span class="meta">        //@hide: PERSISTENT_DATA_BLOCK_SERVICE,</span></span><br><span class="line"><span class="meta">        //@hide: OEM_LOCK_SERVICE,</span></span><br><span class="line"><span class="meta">        MEDIA_PROJECTION_SERVICE,</span></span><br><span class="line"><span class="meta">        MIDI_SERVICE,</span></span><br><span class="line"><span class="meta">        RADIO_SERVICE,</span></span><br><span class="line"><span class="meta">        HARDWARE_PROPERTIES_SERVICE,</span></span><br><span class="line"><span class="meta">        //@hide: SOUND_TRIGGER_SERVICE,</span></span><br><span class="line"><span class="meta">        SHORTCUT_SERVICE,</span></span><br><span class="line"><span class="meta">        //@hide: CONTEXTHUB_SERVICE,</span></span><br><span class="line"><span class="meta">        SYSTEM_HEALTH_SERVICE,</span></span><br><span class="line"><span class="meta">        //@hide: INCIDENT_SERVICE,</span></span><br><span class="line"><span class="meta">        //@hide: INCIDENT_COMPANION_SERVICE,</span></span><br><span class="line"><span class="meta">        //@hide: STATS_COMPANION_SERVICE,</span></span><br><span class="line"><span class="meta">        COMPANION_DEVICE_SERVICE,</span></span><br><span class="line"><span class="meta">        CROSS_PROFILE_APPS_SERVICE,</span></span><br><span class="line"><span class="meta">        //@hide: SYSTEM_UPDATE_SERVICE,</span></span><br><span class="line"><span class="meta">        //@hide: TIME_DETECTOR_SERVICE,</span></span><br><span class="line"><span class="meta">        //@hide: TIME_ZONE_DETECTOR_SERVICE,</span></span><br><span class="line"><span class="meta">        PERMISSION_SERVICE,</span></span><br><span class="line"><span class="meta">        LIGHTS_SERVICE,</span></span><br><span class="line"><span class="meta">        //@hide: PEOPLE_SERVICE,</span></span><br><span class="line"><span class="meta">        //@hide: DEVICE_STATE_SERVICE,</span></span><br><span class="line"><span class="meta">        //@hide: SPEECH_RECOGNITION_SERVICE,</span></span><br><span class="line"><span class="meta">        UWB_SERVICE,</span></span><br><span class="line"><span class="meta">        MEDIA_METRICS_SERVICE,</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.SOURCE)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> ServiceName &#123;&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** <span class="doctag">@hide</span> */</span></span><br><span class="line"><span class="meta">@IntDef(flag = true, prefix = &#123; &quot;CONTEXT_&quot; &#125;, value = &#123;</span></span><br><span class="line"><span class="meta">        CONTEXT_INCLUDE_CODE,</span></span><br><span class="line"><span class="meta">        CONTEXT_IGNORE_SECURITY,</span></span><br><span class="line"><span class="meta">        CONTEXT_RESTRICTED,</span></span><br><span class="line"><span class="meta">        CONTEXT_DEVICE_PROTECTED_STORAGE,</span></span><br><span class="line"><span class="meta">        CONTEXT_CREDENTIAL_PROTECTED_STORAGE,</span></span><br><span class="line"><span class="meta">        CONTEXT_REGISTER_PACKAGE,</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.SOURCE)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> CreatePackageOptions &#123;&#125;</span><br></pre></td></tr></table></figure><h2 id="å¸¸é‡å®šä¹‰"><a href="#å¸¸é‡å®šä¹‰" class="headerlink" title="å¸¸é‡å®šä¹‰"></a>å¸¸é‡å®šä¹‰</h2><p>æ–‡ä»¶åˆ›å»ºã€SPã€æ•°æ®åº“å…±äº«çš„çš„flags</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é»˜è®¤å€¼ï¼Œåªèƒ½å¯¹å½“å‰app(ç›¸åŒuser-idçš„è¿›ç¨‹)å¯è§</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">MODE_PRIVATE</span> <span class="operator">=</span> <span class="number">0x0000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…è®¸å…¶ä»–appè¯»ï¼Œå·²å¼ƒç”¨ï¼Œå¼ºåˆ¶ä½¿ç”¨ä¼šæŠ›å‡ºSecurityException</span></span><br><span class="line"><span class="meta">@Deprecated</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">MODE_WORLD_READABLE</span> <span class="operator">=</span> <span class="number">0x0001</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// å…è®¸å…¶ä»–appå†™ï¼Œå·²å¼ƒç”¨ï¼Œå¼ºåˆ¶ä½¿ç”¨ä¼šæŠ›å‡ºSecurityException</span></span><br><span class="line"><span class="meta">@Deprecated</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">MODE_WORLD_WRITEABLE</span> <span class="operator">=</span> <span class="number">0x0002</span>;</span><br></pre></td></tr></table></figure><p>æ–‡ä»¶åˆ›å»ºçš„flag</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// appendï¼Œè€Œä¸æ˜¯è¦†ç›–</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">MODE_APPEND</span> <span class="operator">=</span> <span class="number">0x8000</span>;</span><br></pre></td></tr></table></figure><p>SPåŠ è½½çš„flag</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸å»ºè®®ä½¿ç”¨ï¼Œæ²¡æœ‰è¿›ç¨‹åŒæ­¥çš„æœºåˆ¶</span></span><br><span class="line"><span class="comment">// ä¸ºäº†ä¸€ä¸ªappæœ‰å¤šä¸ªè¿›ç¨‹æ—¶ä½¿ç”¨</span></span><br><span class="line"><span class="comment">// è·¨è¿›ç¨‹æ•°æ®ç®¡ç†æ–¹æ³•å¯ä»¥ç”¨ContentProvider</span></span><br><span class="line"><span class="meta">@Deprecated</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">MODE_MULTI_PROCESS</span> <span class="operator">=</span> <span class="number">0x0004</span>;</span><br></pre></td></tr></table></figure><p>æ•°æ®åº“çš„flag</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// write-ahead logging, WAL</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * According To: https://www.w3cschool.cn/doc_postgresql_9_4/postgresql_9_4-wal-intro.html</span></span><br><span class="line"><span class="comment"> * Briefly, WAL&#x27;s central concept is that changes to data files (where tables and indexes reside) </span></span><br><span class="line"><span class="comment"> * must be written only after those changes have been logged, </span></span><br><span class="line"><span class="comment"> * that is, after log records describing the changes have been flushed to permanent storage.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// åœ¨å¯¹æ•°æ®è¿›è¡Œå†™æ“ä½œå‰ï¼Œå¯¹å†™æ“ä½œçš„logè¦å…ˆå†™å…¥åˆ°æŒä¹…åŒ–å­˜å‚¨è®¾å¤‡</span></span><br><span class="line"><span class="comment">// å¯ç”¨WAL</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">MODE_ENABLE_WRITE_AHEAD_LOGGING</span> <span class="operator">=</span> <span class="number">0x0008</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯ç”¨æœ¬åœ°åŒ–çš„æ“ä½œ</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">MODE_NO_LOCALIZED_COLLATORS</span> <span class="operator">=</span> <span class="number">0x0010</span>;</span><br></pre></td></tr></table></figure><ul><li>bindServiceçš„flags</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;Note that prior to &#123;<span class="doctag">@link</span> android.os.Build.VERSION_CODES#ICE_CREAM_SANDWICH&#125;,</span></span><br><span class="line"><span class="comment"> * not supplying this flag would also impact how important the system</span></span><br><span class="line"><span class="comment"> * consider&#x27;s the target service&#x27;s process to be.  When set, the only way</span></span><br><span class="line"><span class="comment"> * for it to be raised was by binding from a service in which case it will</span></span><br><span class="line"><span class="comment"> * only be important when that activity is in the foreground.  Now to</span></span><br><span class="line"><span class="comment"> * achieve this behavior you must explicitly supply the new flag</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@link</span> #BIND_ADJUST_WITH_ACTIVITY&#125;.  For compatibility, old applications</span></span><br><span class="line"><span class="comment"> * that don&#x27;t specify &#123;<span class="doctag">@link</span> #BIND_AUTO_CREATE&#125; will automatically have</span></span><br><span class="line"><span class="comment"> * the flags &#123;<span class="doctag">@link</span> #BIND_WAIVE_PRIORITY&#125; and</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@link</span> #BIND_ADJUST_WITH_ACTIVITY&#125; set for them in order to achieve</span></span><br><span class="line"><span class="comment"> * the same result.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// è‡ªåŠ¨åˆ›å»ºservice</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">BIND_AUTO_CREATE</span> <span class="operator">=</span> <span class="number">0x0001</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// debugï¼Œæ‰“å°è°ƒç”¨æ ˆ</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">BIND_DEBUG_UNBIND</span> <span class="operator">=</span> <span class="number">0x0002</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸å…è®¸å°†serviceè¿›ç¨‹æå‡åˆ°å‰å°ï¼Œç»‘å®šæ—¶åœ¨å‰å°è€Œç›®æ ‡ä¸ºåå°æ—¶æœ‰æ•ˆ</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">BIND_NOT_FOREGROUND</span> <span class="operator">=</span> <span class="number">0x0004</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Serviceçš„é‡è¦ç¨‹åº¦é«˜äºå®¢æˆ·ç«¯ï¼ŒOOMæ—¶æœ‰é™æ€æ‰appè€Œä¸æ˜¯service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">BIND_ABOVE_CLIENT</span> <span class="operator">=</span> <span class="number">0x0008</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Flag for &#123;<span class="doctag">@link</span> #bindService&#125;: allow the process hosting the bound</span></span><br><span class="line"><span class="comment"> * service to go through its normal memory management.  It will be</span></span><br><span class="line"><span class="comment"> * treated more like a running service, allowing the system to</span></span><br><span class="line"><span class="comment"> * (temporarily) expunge the process if low on memory or for some other</span></span><br><span class="line"><span class="comment"> * whim it may have, and being more aggressive about making it a candidate</span></span><br><span class="line"><span class="comment"> * to be killed (and restarted) if running for a long time.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">BIND_ALLOW_OOM_MANAGEMENT</span> <span class="operator">=</span> <span class="number">0x0010</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Flag for &#123;<span class="doctag">@link</span> #bindService&#125;: don&#x27;t impact the scheduling or</span></span><br><span class="line"><span class="comment"> * memory management priority of the target service&#x27;s hosting process.</span></span><br><span class="line"><span class="comment"> * Allows the service&#x27;s process to be managed on the background LRU list</span></span><br><span class="line"><span class="comment"> * just like a regular application process in the background.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">BIND_WAIVE_PRIORITY</span> <span class="operator">=</span> <span class="number">0x0020</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Flag for &#123;<span class="doctag">@link</span> #bindService&#125;: this service is very important to</span></span><br><span class="line"><span class="comment"> * the client, so should be brought to the foreground process level</span></span><br><span class="line"><span class="comment"> * when the client is.  Normally a process can only be raised to the</span></span><br><span class="line"><span class="comment"> * visibility level by a client, even if that client is in the foreground.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">BIND_IMPORTANT</span> <span class="operator">=</span> <span class="number">0x0040</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Flag for &#123;<span class="doctag">@link</span> #bindService&#125;: If binding from an activity, allow the</span></span><br><span class="line"><span class="comment"> * target service&#x27;s process importance to be raised based on whether the</span></span><br><span class="line"><span class="comment"> * activity is visible to the user, regardless whether another flag is</span></span><br><span class="line"><span class="comment"> * used to reduce the amount that the client process&#x27;s overall importance</span></span><br><span class="line"><span class="comment"> * is used to impact it.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">BIND_ADJUST_WITH_ACTIVITY</span> <span class="operator">=</span> <span class="number">0x0080</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Flag for &#123;<span class="doctag">@link</span> #bindService&#125;: If binding from an app that is visible or user-perceptible,</span></span><br><span class="line"><span class="comment"> * lower the target service&#x27;s importance to below the perceptible level. This allows</span></span><br><span class="line"><span class="comment"> * the system to (temporarily) expunge the bound process from memory to make room for more</span></span><br><span class="line"><span class="comment"> * important user-perceptible processes.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">BIND_NOT_PERCEPTIBLE</span> <span class="operator">=</span> <span class="number">0x00000100</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Flag for &#123;<span class="doctag">@link</span> #bindService&#125;: If binding from an app that has specific capabilities</span></span><br><span class="line"><span class="comment"> * due to its foreground state such as an activity or foreground service, then this flag will</span></span><br><span class="line"><span class="comment"> * allow the bound app to get the same capabilities, as long as it has the required permissions</span></span><br><span class="line"><span class="comment"> * as well.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * If binding from a top app and its target SDK version is at or above</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@link</span> android.os.Build.VERSION_CODES#R&#125;, the app needs to</span></span><br><span class="line"><span class="comment"> * explicitly use BIND_INCLUDE_CAPABILITIES flag to pass all capabilities to the service so the</span></span><br><span class="line"><span class="comment"> * other app can have while-use-use access such as location, camera, microphone from background.</span></span><br><span class="line"><span class="comment"> * If binding from a top app and its target SDK version is below</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@link</span> android.os.Build.VERSION_CODES#R&#125;, BIND_INCLUDE_CAPABILITIES is implicit.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">BIND_INCLUDE_CAPABILITIES</span> <span class="operator">=</span> <span class="number">0x000001000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/***********    Public flags above this line ***********/</span></span><br><span class="line"><span class="comment">/***********    Hidden flags below this line ***********/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Flag for &#123;<span class="doctag">@link</span> #bindService&#125;: This flag is only intended to be used by the system to</span></span><br><span class="line"><span class="comment"> * indicate that a service binding is not considered as real package component usage and should</span></span><br><span class="line"><span class="comment"> * not generate a &#123;<span class="doctag">@link</span> android.app.usage.UsageEvents.Event#APP_COMPONENT_USED&#125; event in usage</span></span><br><span class="line"><span class="comment"> * stats.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@hide</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">BIND_NOT_APP_COMPONENT_USAGE</span> <span class="operator">=</span> <span class="number">0x00008000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Flag for &#123;<span class="doctag">@link</span> #bindService&#125;: allow the process hosting the target service to be treated</span></span><br><span class="line"><span class="comment"> * as if it&#x27;s as important as a perceptible app to the user and avoid the oom killer killing</span></span><br><span class="line"><span class="comment"> * this process in low memory situations until there aren&#x27;t any other processes left but the</span></span><br><span class="line"><span class="comment"> * ones which are user-perceptible.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@hide</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">BIND_ALMOST_PERCEPTIBLE</span> <span class="operator">=</span> <span class="number">0x000010000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Flag for &#123;<span class="doctag">@link</span> #bindService&#125;: allow the process hosting the target service to gain</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@link</span> ActivityManager#PROCESS_CAPABILITY_NETWORK&#125;, which allows it be able</span></span><br><span class="line"><span class="comment"> * to access network regardless of any power saving restrictions.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@hide</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">BIND_BYPASS_POWER_NETWORK_RESTRICTIONS</span> <span class="operator">=</span> <span class="number">0x00020000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Do not use. This flag is no longer needed nor used.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@hide</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SystemApi</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">BIND_ALLOW_FOREGROUND_SERVICE_STARTS_FROM_BACKGROUND</span> <span class="operator">=</span> <span class="number">0x00040000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Flag for &#123;<span class="doctag">@link</span> #bindService&#125;: This flag is intended to be used only by the system to adjust</span></span><br><span class="line"><span class="comment"> * the scheduling policy for IMEs (and any other out-of-process user-visible components that</span></span><br><span class="line"><span class="comment"> * work closely with the top app) so that UI hosted in such services can have the same</span></span><br><span class="line"><span class="comment"> * scheduling policy (e.g. SCHED_FIFO when it is enabled and TOP_APP_PRIORITY_BOOST otherwise)</span></span><br><span class="line"><span class="comment"> * as the actual top-app.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@hide</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">BIND_SCHEDULE_LIKE_TOP_APP</span> <span class="operator">=</span> <span class="number">0x00080000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Flag for &#123;<span class="doctag">@link</span> #bindService&#125;: allow background activity starts from the bound service&#x27;s</span></span><br><span class="line"><span class="comment"> * process.</span></span><br><span class="line"><span class="comment"> * This flag is only respected if the caller is holding</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@link</span> android.Manifest.permission#START_ACTIVITIES_FROM_BACKGROUND&#125;.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@hide</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SystemApi</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">BIND_ALLOW_BACKGROUND_ACTIVITY_STARTS</span> <span class="operator">=</span> <span class="number">0x00100000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@hide</span> Flag for &#123;<span class="doctag">@link</span> #bindService&#125;: the service being bound to represents a</span></span><br><span class="line"><span class="comment"> * protected system component, so must have association restrictions applied to it.</span></span><br><span class="line"><span class="comment"> * That is, a system config must have one or more allow-association tags limiting</span></span><br><span class="line"><span class="comment"> * which packages it can interact with.  If it does not have any such association</span></span><br><span class="line"><span class="comment"> * restrictions, a default empty set will be created.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">BIND_RESTRICT_ASSOCIATIONS</span> <span class="operator">=</span> <span class="number">0x00200000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@hide</span> Flag for &#123;<span class="doctag">@link</span> #bindService&#125;: allows binding to a service provided</span></span><br><span class="line"><span class="comment"> * by an instant app. Note that the caller may not have access to the instant</span></span><br><span class="line"><span class="comment"> * app providing the service which is a violation of the instant app sandbox.</span></span><br><span class="line"><span class="comment"> * This flag is intended ONLY for development/testing and should be used with</span></span><br><span class="line"><span class="comment"> * great care. Only the system is allowed to use this flag.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">BIND_ALLOW_INSTANT</span> <span class="operator">=</span> <span class="number">0x00400000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@hide</span> Flag for &#123;<span class="doctag">@link</span> #bindService&#125;: like &#123;<span class="doctag">@link</span> #BIND_NOT_FOREGROUND&#125;, but puts it</span></span><br><span class="line"><span class="comment"> * up in to the important background state (instead of transient).</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">BIND_IMPORTANT_BACKGROUND</span> <span class="operator">=</span> <span class="number">0x00800000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@hide</span> Flag for &#123;<span class="doctag">@link</span> #bindService&#125;: allows application hosting service to manage whitelists</span></span><br><span class="line"><span class="comment"> * such as temporary allowing a &#123;<span class="doctag">@code</span> PendingIntent&#125; to bypass Power Save mode.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">BIND_ALLOW_WHITELIST_MANAGEMENT</span> <span class="operator">=</span> <span class="number">0x01000000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@hide</span> Flag for &#123;<span class="doctag">@link</span> #bindService&#125;: Like &#123;<span class="doctag">@link</span> #BIND_FOREGROUND_SERVICE&#125;,</span></span><br><span class="line"><span class="comment"> * but only applies while the device is awake.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">BIND_FOREGROUND_SERVICE_WHILE_AWAKE</span> <span class="operator">=</span> <span class="number">0x02000000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@hide</span> Flag for &#123;<span class="doctag">@link</span> #bindService&#125;: For only the case where the binding</span></span><br><span class="line"><span class="comment"> * is coming from the system, set the process state to FOREGROUND_SERVICE</span></span><br><span class="line"><span class="comment"> * instead of the normal maximum of IMPORTANT_FOREGROUND.  That is, this is</span></span><br><span class="line"><span class="comment"> * saying that the process shouldn&#x27;t participate in the normal power reduction</span></span><br><span class="line"><span class="comment"> * modes (removing network access etc).</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">BIND_FOREGROUND_SERVICE</span> <span class="operator">=</span> <span class="number">0x04000000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@hide</span> Flag for &#123;<span class="doctag">@link</span> #bindService&#125;: Treat the binding as hosting</span></span><br><span class="line"><span class="comment"> * an activity, an unbinding as the activity going in the background.</span></span><br><span class="line"><span class="comment"> * That is, when unbinding, the process when empty will go on the activity</span></span><br><span class="line"><span class="comment"> * LRU list instead of the regular one, keeping it around more aggressively</span></span><br><span class="line"><span class="comment"> * than it otherwise would be.  This is intended for use with IMEs to try</span></span><br><span class="line"><span class="comment"> * to keep IME processes around for faster keyboard switching.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">BIND_TREAT_LIKE_ACTIVITY</span> <span class="operator">=</span> <span class="number">0x08000000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@hide</span> An idea that is not yet implemented.</span></span><br><span class="line"><span class="comment"> * Flag for &#123;<span class="doctag">@link</span> #bindService&#125;: If binding from an activity, consider</span></span><br><span class="line"><span class="comment"> * this service to be visible like the binding activity is.  That is,</span></span><br><span class="line"><span class="comment"> * it will be treated as something more important to keep around than</span></span><br><span class="line"><span class="comment"> * invisible background activities.  This will impact the number of</span></span><br><span class="line"><span class="comment"> * recent activities the user can switch between without having them</span></span><br><span class="line"><span class="comment"> * restart.  There is no guarantee this will be respected, as the system</span></span><br><span class="line"><span class="comment"> * tries to balance such requests from one app vs. the importance of</span></span><br><span class="line"><span class="comment"> * keeping other apps around.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">BIND_VISIBLE</span> <span class="operator">=</span> <span class="number">0x10000000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@hide</span></span></span><br><span class="line"><span class="comment"> * Flag for &#123;<span class="doctag">@link</span> #bindService&#125;: Consider this binding to be causing the target</span></span><br><span class="line"><span class="comment"> * process to be showing UI, so it will be do a UI_HIDDEN memory trim when it goes</span></span><br><span class="line"><span class="comment"> * away.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">BIND_SHOWING_UI</span> <span class="operator">=</span> <span class="number">0x20000000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Flag for &#123;<span class="doctag">@link</span> #bindService&#125;: Don&#x27;t consider the bound service to be</span></span><br><span class="line"><span class="comment"> * visible, even if the caller is visible.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@hide</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">BIND_NOT_VISIBLE</span> <span class="operator">=</span> <span class="number">0x40000000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Flag for &#123;<span class="doctag">@link</span> #bindService&#125;: The service being bound is an</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@link</span> android.R.attr#isolatedProcess isolated&#125;,</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@link</span> android.R.attr#externalService external&#125; service.  This binds the service into the</span></span><br><span class="line"><span class="comment"> * calling application&#x27;s package, rather than the package in which the service is declared.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * When using this flag, the code for the service being bound will execute under the calling</span></span><br><span class="line"><span class="comment"> * application&#x27;s package name and user ID.  Because the service must be an isolated process,</span></span><br><span class="line"><span class="comment"> * it will not have direct access to the application&#x27;s data, though.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * The purpose of this flag is to allow applications to provide services that are attributed</span></span><br><span class="line"><span class="comment"> * to the app using the service, rather than the application providing the service.</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">BIND_EXTERNAL_SERVICE</span> <span class="operator">=</span> <span class="number">0x80000000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * These bind flags reduce the strength of the binding such that we shouldn&#x27;t</span></span><br><span class="line"><span class="comment"> * consider it as pulling the process up to the level of the one that is bound to it.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@hide</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">BIND_REDUCTION_FLAGS</span> <span class="operator">=</span></span><br><span class="line">        Context.BIND_ALLOW_OOM_MANAGEMENT | Context.BIND_WAIVE_PRIORITY</span><br><span class="line">                | Context.BIND_NOT_PERCEPTIBLE | Context.BIND_NOT_VISIBLE;</span><br></pre></td></tr></table></figure><p>registerReceiverçš„flags</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Flag for &#123;<span class="doctag">@link</span> #registerReceiver&#125;: The receiver can receive broadcasts from Instant Apps.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// æ˜¯å¦å¯ä»¥è¢«Instant Appsæ¥æ”¶åˆ°ï¼ˆgoogleçš„å°ç¨‹åºå§ï¼‰</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">RECEIVER_VISIBLE_TO_INSTANT_APPS</span> <span class="operator">=</span> <span class="number">0x1</span>;</span><br></pre></td></tr></table></figure><p>getServiceçš„serviceName</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure><h2 id="æ–¹æ³•"><a href="#æ–¹æ³•" class="headerlink" title="æ–¹æ³•"></a>æ–¹æ³•</h2><h3 id="éƒ¨åˆ†getæ–¹æ³•"><a href="#éƒ¨åˆ†getæ–¹æ³•" class="headerlink" title="éƒ¨åˆ†getæ–¹æ³•"></a>éƒ¨åˆ†getæ–¹æ³•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> AssetManager <span class="title function_">getAssets</span><span class="params">()</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> Resources <span class="title function_">getResources</span><span class="params">()</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> PackageManager <span class="title function_">getPackageManager</span><span class="params">()</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> ContentResolver <span class="title function_">getContentResolver</span><span class="params">()</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> Looper <span class="title function_">getMainLooper</span><span class="params">()</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> Context <span class="title function_">getApplicationContext</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> Executor <span class="title function_">getMainExecutor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// This is pretty inefficient, which is why ContextImpl overrides it</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">HandlerExecutor</span>(<span class="keyword">new</span> <span class="title class_">Handler</span>(getMainLooper()));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> ClassLoader <span class="title function_">getClassLoader</span><span class="params">()</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> String <span class="title function_">getPackageName</span><span class="params">()</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> String <span class="title function_">getBasePackageName</span><span class="params">()</span>;</span><br><span class="line"><span class="meta">@NonNull</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getOpPackageName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;Not implemented. Must override in a subclass.&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> ApplicationInfo <span class="title function_">getApplicationInfo</span><span class="params">()</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> String <span class="title function_">getPackageResourcePath</span><span class="params">()</span>;</span><br><span class="line"><span class="comment">// è¿”å›åº”ç”¨åŒ…çš„å®Œæ•´è·¯å¾„</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> String <span class="title function_">getPackageCodePath</span><span class="params">()</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="systemService"><a href="#systemService" class="headerlink" title="systemService"></a>systemService</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="meta">@Nullable</span> String <span class="title function_">getSystemServiceName</span><span class="params">(<span class="meta">@NonNull</span> Class&lt;?&gt; serviceClass)</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="meta">@Nullable</span> Object <span class="title function_">getSystemService</span><span class="params">(<span class="meta">@ServiceName</span> <span class="meta">@NonNull</span> String name)</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="meta">@Nullable</span> &lt;T&gt; T <span class="title function_">getSystemService</span><span class="params">(<span class="meta">@NonNull</span> Class&lt;T&gt; serviceClass)</span> &#123; <span class="comment">// ä¹Ÿå¯ä»¥é€šè¿‡Classå¯¹è±¡è·å–</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">serviceName</span> <span class="operator">=</span> getSystemServiceName(serviceClass);</span><br><span class="line">        <span class="keyword">return</span> serviceName != <span class="literal">null</span> ? (T)getSystemService(serviceName) : <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Viewç›¸å…³"><a href="#Viewç›¸å…³" class="headerlink" title="Viewç›¸å…³"></a>Viewç›¸å…³</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¿”å›è¿›ç¨‹ä¸­å”¯ä¸€çš„View ID</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getNextAutofillId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (sLastAutofillId == View.LAST_APP_AUTOFILL_ID - <span class="number">1</span>) &#123;</span><br><span class="line">                sLastAutofillId = View.NO_ID;</span><br><span class="line">        &#125;</span><br><span class="line">        sLastAutofillId++;</span><br><span class="line">        <span class="keyword">return</span> sLastAutofillId;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ä¼šæœ‰å¹¶å‘é—®é¢˜å—ï¼Ÿï¼Ÿ</span></span><br></pre></td></tr></table></figure><h3 id="ComponentCallbacks"><a href="#ComponentCallbacks" class="headerlink" title="ComponentCallbacks"></a>ComponentCallbacks</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">registerComponentCallbacks</span><span class="params">(ComponentCallbacks callback)</span> &#123;</span><br><span class="line">        getApplicationContext().registerComponentCallbacks(callback);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">unregisterComponentCallbacks</span><span class="params">(ComponentCallbacks callback)</span> &#123;</span><br><span class="line">        getApplicationContext().unregisterComponentCallbacks(callback);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// CallbackåŒ…æ‹¬:</span></span><br><span class="line"><span class="comment">// onConfigurationChanged</span></span><br><span class="line"><span class="comment">// onLowMemory: è°ƒç”¨æ—¶æœºæ²¡æœ‰æ˜ç¡®å®šä¹‰ï¼Œä¸€èˆ¬åœ¨å†…å­˜ä¸è¶³ï¼Œæ‰€æœ‰åå°è¿›ç¨‹è¢«killä¹‹åï¼Œprocesses hosting serviceå’Œå‰å°ç”¨æˆ·ç•Œé¢è¢«killä¹‹å‰ã€‚</span></span><br></pre></td></tr></table></figure><h3 id="èµ„æºç›¸å…³"><a href="#èµ„æºç›¸å…³" class="headerlink" title="èµ„æºç›¸å…³"></a>èµ„æºç›¸å…³</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@NonNull</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> CharSequence <span class="title function_">getText</span><span class="params">(<span class="meta">@StringRes</span> <span class="type">int</span> resId)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> getResources().getText(resId);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@NonNull</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> String <span class="title function_">getString</span><span class="params">(<span class="meta">@StringRes</span> <span class="type">int</span> resId)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> getResources().getString(resId);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@NonNull</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> String <span class="title function_">getString</span><span class="params">(<span class="meta">@StringRes</span> <span class="type">int</span> resId, Object... formatArgs)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> getResources().getString(resId, formatArgs);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ColorInt</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">getColor</span><span class="params">(<span class="meta">@ColorRes</span> <span class="type">int</span> id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> getResources().getColor(id, getTheme());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> Drawable <span class="title function_">getDrawable</span><span class="params">(<span class="meta">@DrawableRes</span> <span class="type">int</span> id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> getResources().getDrawable(id, getTheme());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@NonNull</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> ColorStateList <span class="title function_">getColorStateList</span><span class="params">(<span class="meta">@ColorRes</span> <span class="type">int</span> id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> getResources().getColorStateList(id, getTheme());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä¸»é¢˜ç›¸å…³"><a href="#ä¸»é¢˜ç›¸å…³" class="headerlink" title="ä¸»é¢˜ç›¸å…³"></a>ä¸»é¢˜ç›¸å…³</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">setTheme</span><span class="params">(<span class="meta">@StyleRes</span> <span class="type">int</span> resid)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** <span class="doctag">@hide</span> Needed for some internal implementation...  not public because</span></span><br><span class="line"><span class="comment"> * you can&#x27;t assume this actually means anything. */</span></span><br><span class="line"><span class="meta">@UnsupportedAppUsage</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getThemeResId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ViewDebug</span>.ExportedProperty(deepExport = <span class="literal">true</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> Resources.Theme <span class="title function_">getTheme</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@NonNull</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> TypedArray <span class="title function_">obtainStyledAttributes</span><span class="params">(<span class="meta">@NonNull</span> <span class="meta">@StyleableRes</span> <span class="type">int</span>[] attrs)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> getTheme().obtainStyledAttributes(attrs);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@NonNull</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> TypedArray <span class="title function_">obtainStyledAttributes</span><span class="params">(<span class="meta">@StyleRes</span> <span class="type">int</span> resid,</span></span><br><span class="line"><span class="params">        <span class="meta">@NonNull</span> <span class="meta">@StyleableRes</span> <span class="type">int</span>[] attrs)</span> <span class="keyword">throws</span> Resources.NotFoundException &#123;</span><br><span class="line">        <span class="keyword">return</span> getTheme().obtainStyledAttributes(resid, attrs);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@NonNull</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> TypedArray <span class="title function_">obtainStyledAttributes</span><span class="params">(</span></span><br><span class="line"><span class="params">        <span class="meta">@Nullable</span> AttributeSet set, <span class="meta">@NonNull</span> <span class="meta">@StyleableRes</span> <span class="type">int</span>[] attrs)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> getTheme().obtainStyledAttributes(set, attrs, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@NonNull</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> TypedArray <span class="title function_">obtainStyledAttributes</span><span class="params">(<span class="meta">@Nullable</span> AttributeSet set,</span></span><br><span class="line"><span class="params">        <span class="meta">@NonNull</span> <span class="meta">@StyleableRes</span> <span class="type">int</span>[] attrs, <span class="meta">@AttrRes</span> <span class="type">int</span> defStyleAttr,</span></span><br><span class="line"><span class="params">        <span class="meta">@StyleRes</span> <span class="type">int</span> defStyleRes)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> getTheme().obtainStyledAttributes(</span><br><span class="line">        set, attrs, defStyleAttr, defStyleRes);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="SP"><a href="#SP" class="headerlink" title="SP"></a>SP</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> SharedPreferences <span class="title function_">getSharedPreferences</span><span class="params">(String name, <span class="meta">@PreferencesMode</span> <span class="type">int</span> mode)</span>;</span><br><span class="line"><span class="meta">@SuppressWarnings(&quot;HiddenAbstractMethod&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> SharedPreferences <span class="title function_">getSharedPreferences</span><span class="params">(File file, <span class="meta">@PreferencesMode</span> <span class="type">int</span> mode)</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="type">boolean</span> <span class="title function_">moveSharedPreferencesFrom</span><span class="params">(Context sourceContext, String name)</span>; <span class="comment">// å°†ä¸€ä¸ªcontextä¸­çš„spç§»åŠ¨åˆ°å½“å‰contextä¸­</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="type">boolean</span> <span class="title function_">deleteSharedPreferences</span><span class="params">(String name)</span>;</span><br></pre></td></tr></table></figure><h3 id="æ–‡ä»¶"><a href="#æ–‡ä»¶" class="headerlink" title="æ–‡ä»¶"></a>æ–‡ä»¶</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ‰“å¼€ç§æœ‰æ–‡ä»¶çš„æµ</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> FileInputStream <span class="title function_">openFileInput</span><span class="params">(String name)</span></span><br><span class="line">        <span class="keyword">throws</span> FileNotFoundException;</span><br><span class="line"><span class="comment">// è¯»å†™è¯¥æ–‡ä»¶ä¸éœ€è¦é¢å¤–çš„æƒé™</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> FileOutputStream <span class="title function_">openFileOutput</span><span class="params">(String name, <span class="meta">@FileMode</span> <span class="type">int</span> mode)</span></span><br><span class="line">        <span class="keyword">throws</span> FileNotFoundException;</span><br><span class="line"><span class="comment">// è¿”å›ï¼Œæ˜¯å¦æˆåŠŸåˆ é™¤</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="type">boolean</span> <span class="title function_">deleteFile</span><span class="params">(String name)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿”å›æ–‡ä»¶çš„ç»å¯¹è·¯å¾„ï¼ˆé€šè¿‡openFileOutputåˆ›å»ºçš„ï¼‰</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> File <span class="title function_">getFileStreamPath</span><span class="params">(String name)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿”å›spçš„è·¯å¾„</span></span><br><span class="line"><span class="meta">@SuppressWarnings(&quot;HiddenAbstractMethod&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> File <span class="title function_">getSharedPreferencesPath</span><span class="params">(String name)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿”å›appç§æœ‰æ–‡ä»¶çš„å­˜å‚¨ä½ç½®</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> File <span class="title function_">getDataDir</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿”å›openFileOutputåˆ›å»ºæ–‡ä»¶çš„ç›®å½•</span></span><br><span class="line"><span class="comment">// å¸è½½åä¼šåˆ é™¤</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> File <span class="title function_">getFilesDir</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@NonNull</span></span><br><span class="line"><span class="meta">@TestApi</span></span><br><span class="line"><span class="keyword">public</span> File <span class="title function_">getCrateDir</span><span class="params">(<span class="meta">@NonNull</span> String crateId)</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;Not implemented. Must override in a subclass.&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿”å›ç›®å½•ï¼Œè¯¥ç›®å½•ä¸‹çš„æ–‡ä»¶ä¸ä¼šè¢«å¤‡ä»½</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> File <span class="title function_">getNoBackupFilesDir</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿”å›å…±äº«å­˜å‚¨ç›®å½•</span></span><br><span class="line"><span class="comment">// æ¯ä¸ªç”¨æˆ·éƒ½æœ‰ç‹¬ç«‹çš„å…±äº«å­˜å‚¨ç›®å½•</span></span><br><span class="line"><span class="comment">// åº”ç”¨å¸è½½åä¹Ÿä¼šåˆ é™¤ï¼Œå±äºè¯¥app</span></span><br><span class="line"><span class="comment">// android.os.Environment#getExternalStoragePublicDirectory æä¾›çš„ç›®å½•æ˜¯æ‰€æœ‰appå…±äº«çš„ï¼Œ</span></span><br><span class="line"><span class="comment">// å…¶ä»–åº”ç”¨å¦‚æœæœ‰æƒé™WRITE_EXTERNAL_STORAGEï¼Œä¹Ÿå¯ä»¥å¯¹æ–‡ä»¶è¿›è¡Œè¯»å†™</span></span><br><span class="line"><span class="comment">// MediaScanner</span></span><br><span class="line"><span class="comment">// These files are internal to the application, and not typically visible to the user as media.</span></span><br><span class="line"><span class="comment">// å‚æ•°æ˜¯ç›®å½•ç±»å‹ï¼Œandroid.os.Environment#DIRECTORY_XXX</span></span><br><span class="line"><span class="comment">// è¿”å›çš„ç›®å½•ä¼šè¢«è‡ªåŠ¨åˆ›å»º</span></span><br><span class="line"><span class="comment">// ä¸è¦ä½¿ç”¨ç»å¯¹è·¯å¾„ï¼Œæ–‡ä»¶æ‰€åœ¨ä½ç½®å¯èƒ½ä¼šæ”¹å˜</span></span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> File <span class="title function_">getExternalFilesDir</span><span class="params">(<span class="meta">@Nullable</span> String type)</span>;</span><br><span class="line"><span class="comment">// ç±»ä¼¼äºgetExternalFilesDirï¼Œè¿”å›æ‰€æœ‰shared/external storage devicesçš„ç»å¯¹è·¯å¾„</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> File[] getExternalFilesDirs(String type);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®‰å“Nä¹‹å‰ï¼Œéœ€è¦æƒé™READ_EXTERNAL_STORAGE</span></span><br><span class="line"><span class="comment">// è¿”å›OBBæ–‡ä»¶çš„ä½ç½®ï¼Œå¦‚æœæ²¡æœ‰OBBï¼Œè¿”å›ç›®å½•å¯èƒ½ä¸å­˜åœ¨</span></span><br><span class="line"><span class="comment">// OBB: å®‰å“æ¸¸æˆé€šç”¨æ•°æ®åŒ…</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> File <span class="title function_">getObbDir</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> File[] getObbDirs();</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿”å›ç¼“å­˜ç›®å½•</span></span><br><span class="line"><span class="comment">// ç³»ç»Ÿä¼šåœ¨éœ€è¦æ—¶åˆ é™¤è¯¥ç›®å½•ä¸‹çš„æ–‡ä»¶</span></span><br><span class="line"><span class="comment">// é€šè¿‡StorageManager#getCacheQuotaByteså¯ä»¥è·å–cacheçš„é…é¢ï¼ˆå¯èƒ½éšæ—¶é—´å˜åŒ–ï¼‰ï¼Œå¦‚æœè¶…è¿‡é…é¢ï¼Œå¯èƒ½ä¼šè¢«ä¼˜å…ˆåˆ é™¤</span></span><br><span class="line"><span class="comment">// é€šè¿‡StorageManager#setCacheBehaviorGroup StorageManager#setCacheBehaviorTombstoneå¯ä»¥è®¾ç½®ç¼“å­˜çš„åˆ é™¤ç­–ç•¥</span></span><br><span class="line"><span class="comment">// è¯»å†™ä¸éœ€è¦æƒé™</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> File <span class="title function_">getCacheDir</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿”å›ä»£ç ç¼“å­˜ç›®å½•</span></span><br><span class="line"><span class="comment">// åº”ç”¨å‡çº§ï¼Œå¹³å°å‡çº§ä¼šåˆ é™¤</span></span><br><span class="line"><span class="comment">// å­˜å‚¨ç¼–è¯‘çš„æˆ–ç”Ÿæˆçš„ä¼˜åŒ–çš„ä»£ç </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> File <span class="title function_">getCodeCacheDir</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * If a shared storage device is emulated (as determined by</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@link</span> Environment#isExternalStorageEmulated(File)&#125;), its contents are</span></span><br><span class="line"><span class="comment"> * backed by a private user data partition, which means there is little</span></span><br><span class="line"><span class="comment"> * benefit to storing data here instead of the private directory returned by</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@link</span> #getCacheDir()&#125;.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// å¸è½½ååˆ é™¤</span></span><br><span class="line"><span class="comment">// ä¸ä¼šè¢«è‡ªåŠ¨åˆ é™¤ï¼Œé™¤éç³»ç»Ÿåœ¨JELLY_BEAN_MR1åŠä»¥åï¼Œä¸”Environment#isExternalStorageEmulated(File)è¿”å›true</span></span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> File <span class="title function_">getExternalCacheDir</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Returns absolute path to application-specific directory in the preloaded cache.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;Files stored in the cache directory can be deleted when the device runs low on storage.</span></span><br><span class="line"><span class="comment"> * There is no guarantee when these files will be deleted.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@hide</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SuppressWarnings(&quot;HiddenAbstractMethod&quot;)</span></span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="meta">@SystemApi</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> File <span class="title function_">getPreloadsFileCache</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> File[] getExternalCacheDirs();</span><br><span class="line"></span><br><span class="line"><span class="comment">// å­˜å‚¨åª’ä½“æ–‡ä»¶çš„ä½ç½®ï¼Œä¼šè‡ªåŠ¨è¢«æ‰«æï¼Œä»¤å…¶ä»–appå¯è§</span></span><br><span class="line"><span class="comment">// å¼ƒç”¨ï¼šä»å®‰å“Qå¼€å§‹ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡MediaStoreæ’å…¥å†…å®¹ï¼Œä¸éœ€è¦æƒé™</span></span><br><span class="line"><span class="comment">// å¸è½½åä¼šè¢«åˆ é™¤</span></span><br><span class="line"><span class="meta">@Deprecated</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> File[] getExternalMediaDirs();</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿”å›appä¸­è¯¥Contextå¯¹åº”çš„æ‰€æœ‰ç§æœ‰æ–‡ä»¶çš„åå­—</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> String[] fileList();</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯»æ‰¾/åˆ›å»ºä¸€ä¸ªæ–°çš„ç§æœ‰æ–‡ä»¶ç›®å½•</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> File <span class="title function_">getDir</span><span class="params">(String name, <span class="meta">@FileMode</span> <span class="type">int</span> mode)</span>;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;å¤§çº²&quot;&gt;&lt;a href=&quot;#å¤§çº²&quot; class=&quot;headerlink&quot; title=&quot;å¤§çº²&quot;&gt;&lt;/a&gt;å¤§çº²&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;Contextç±»&lt;ul&gt;
&lt;li&gt;æ³¨è§£&lt;ul&gt;
&lt;li&gt;ç”¨äºæ ‡æ³¨æ–‡ä»¶ã€SharedPreferencesã€æ•°æ®åº“çš„æ‰“å¼€æ–¹å¼çš„æ³¨è§£&lt;/li&gt;
&lt;li&gt;ç”¨äºæ ‡æ³¨bindServiceæ—¶ï¼Œserviceçš„flagsçš„æ³¨è§£&lt;/li&gt;
&lt;li&gt;ç”¨äºæ ‡æ³¨registerReceiveræ—¶ï¼Œreceiverçš„flagsçš„æ³¨è§£&lt;/li&gt;
&lt;li&gt;ç”¨äºæ ‡æ³¨getServiceæ—¶ï¼ŒservicesNameçš„æ³¨è§£&lt;/li&gt;
&lt;li&gt;ç”¨äºæ ‡æ³¨createPackageContextã€createPackageContextAsUserã€createContextAsUserã€createApplicationContextæ—¶çš„flagsçš„æ³¨è§£&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å¸¸é‡å®šä¹‰&lt;ul&gt;
&lt;li&gt;å¯¹åº”ä¸Šé¢æ³¨è§£ä¸­é™åˆ¶çš„å¸¸é‡&lt;/li&gt;
&lt;li&gt;WAL&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;Contextç±»&quot;&gt;&lt;a href=&quot;#Contextç±»&quot; class=&quot;headerlink&quot; title=&quot;Contextç±»&quot;&gt;&lt;/a&gt;Contextç±»&lt;/h2&gt;&lt;p&gt;Contextæ˜¯æŠ½è±¡ç±»ï¼Œå…·ä½“å®ç°åœ¨ContextImplï¼ŒApplicationï¼ŒServiceï¼ŒActivityéƒ½ç›´æ¥æˆ–é—´æ¥ç»§æ‰¿è‡ªContextWrapperï¼ŒContextWrapperé€šè¿‡ä»£ç†çš„æ–¹å¼è°ƒç”¨çœŸæ­£çš„ContextImplã€‚&lt;/p&gt;
&lt;h3 id=&quot;æ³¨è§£&quot;&gt;&lt;a href=&quot;#æ³¨è§£&quot; class=&quot;headerlink&quot; title=&quot;æ³¨è§£&quot;&gt;&lt;/a&gt;æ³¨è§£&lt;/h3&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/** &lt;span class=&quot;doctag&quot;&gt;@hide&lt;/span&gt; */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;@IntDef(flag = true, prefix = &amp;#123; &amp;quot;MODE_&amp;quot; &amp;#125;, value = &amp;#123;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;        MODE_PRIVATE,&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;        MODE_WORLD_READABLE,&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;        MODE_WORLD_WRITEABLE,&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;        MODE_APPEND,&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;&amp;#125;)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;@Retention(RetentionPolicy.SOURCE)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;meta&quot;&gt;@interface&lt;/span&gt; FileMode &amp;#123;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/** &lt;span class=&quot;doctag&quot;&gt;@hide&lt;/span&gt; */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;@IntDef(flag = true, prefix = &amp;#123; &amp;quot;MODE_&amp;quot; &amp;#125;, value = &amp;#123;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;        MODE_PRIVATE,&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;        MODE_WORLD_READABLE,&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;        MODE_WORLD_WRITEABLE,&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;        MODE_MULTI_PROCESS,&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;&amp;#125;)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;@Retention(RetentionPolicy.SOURCE)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;meta&quot;&gt;@interface&lt;/span&gt; PreferencesMode &amp;#123;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/** &lt;span class=&quot;doctag&quot;&gt;@hide&lt;/span&gt; */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;@IntDef(flag = true, prefix = &amp;#123; &amp;quot;MODE_&amp;quot; &amp;#125;, value = &amp;#123;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;        MODE_PRIVATE,&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;        MODE_WORLD_READABLE,&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;        MODE_WORLD_WRITEABLE,&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;        MODE_ENABLE_WRITE_AHEAD_LOGGING,&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;        MODE_NO_LOCALIZED_COLLATORS,&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;&amp;#125;)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;@Retention(RetentionPolicy.SOURCE)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;meta&quot;&gt;@interface&lt;/span&gt; DatabaseMode &amp;#123;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="Android" scheme="https://jingtianer.github.io/home/categories/Android/"/>
    
    <category term="æ‰‹æ’¸Androidæºç " scheme="https://jingtianer.github.io/home/categories/Android/%E6%89%8B%E6%92%B8Android%E6%BA%90%E7%A0%81/"/>
    
    
    <category term="Android-å®˜æ–¹æºç " scheme="https://jingtianer.github.io/home/tags/Android-%E5%AE%98%E6%96%B9%E6%BA%90%E7%A0%81/"/>
    
  </entry>
  
  <entry>
    <title>01-layout</title>
    <link href="https://jingtianer.github.io/home/2024/05/20/Android%E9%AB%98%E7%BA%A7/%E6%96%87%E6%A1%A3%E9%98%85%E8%AF%BB/01-layout/"/>
    <id>https://jingtianer.github.io/home/2024/05/20/Android%E9%AB%98%E7%BA%A7/%E6%96%87%E6%A1%A3%E9%98%85%E8%AF%BB/01-layout/</id>
    <published>2024-05-20T13:15:36.000Z</published>
    <updated>2025-04-15T02:37:55.587Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ID"><a href="#ID" class="headerlink" title="ID"></a>ID</h2><p>åˆ›å»º RelativeLayout æ—¶ï¼Œè¯·åŠ¡å¿…ä¸ºè§†å›¾å¯¹è±¡å®šä¹‰ IDã€‚åœ¨ç›¸å¯¹å¸ƒå±€ä¸­ï¼ŒåŒçº§è§†å›¾å¯ä»¥å®šä¹‰å…¶ç›¸å¯¹äºé€šè¿‡å”¯ä¸€ ID å¼•ç”¨çš„å¦ä¸€ä¸ªåŒçº§è§†å›¾çš„å¸ƒå±€ã€‚</p><h3 id="findViewById"><a href="#findViewById" class="headerlink" title="findViewById"></a>findViewById</h3><p>ID ä¸å¿…åœ¨æ•´ä¸ªæ ‘çŠ¶ç»“æ„ä¸­å…·æœ‰å”¯ä¸€æ€§ï¼Œä½†åœ¨æ‚¨æœç´¢çš„æ ‘çŠ¶ç»“æ„éƒ¨åˆ†ä¸­å¿…é¡»æ˜¯å”¯ä¸€çš„ã€‚å®ƒé€šå¸¸å¯èƒ½æ˜¯æ•´ä¸ªæ ‘ï¼Œå› æ­¤æœ€å¥½å°½å¯èƒ½ä½¿å…¶å…·æœ‰å”¯ä¸€æ€§ã€‚</p><ul><li><code>findViewById</code>æ˜¯Viewçš„æ–¹æ³•</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Finds the first descendant view with the given ID, the view itself if</span></span><br><span class="line"><span class="comment"> * the ID matches &#123;<span class="doctag">@link</span> #getId()&#125;, or &#123;<span class="doctag">@code</span> null&#125; if the ID is invalid</span></span><br><span class="line"><span class="comment"> * (&lt; 0) or there is no matching view in the hierarchy.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;strong&gt;Note:&lt;/strong&gt; In most cases -- depending on compiler support --</span></span><br><span class="line"><span class="comment"> * the resulting view is automatically cast to the target class type. If</span></span><br><span class="line"><span class="comment"> * the target class type is unconstrained, an explicit cast may be</span></span><br><span class="line"><span class="comment"> * necessary.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id the ID to search for</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> a view with given ID if found, or &#123;<span class="doctag">@code</span> null&#125; otherwise</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> View#requireViewById(int)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> &lt;T <span class="keyword">extends</span> <span class="title class_">View</span>&gt; T <span class="title function_">findViewById</span><span class="params">(<span class="meta">@IdRes</span> <span class="type">int</span> id)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (id == NO_ID) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> findViewTraversal(id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>åœ¨Activityä¸­ï¼Œ<code>findViewById</code>æ˜¯è°ƒç”¨windowçš„<code>findViewById</code></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Finds a view that was identified by the &#123;<span class="doctag">@code</span> android:id&#125; XML attribute</span></span><br><span class="line"><span class="comment"> * that was processed in &#123;<span class="doctag">@link</span> #onCreate&#125;.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;strong&gt;Note:&lt;/strong&gt; In most cases -- depending on compiler support --</span></span><br><span class="line"><span class="comment"> * the resulting view is automatically cast to the target class type. If</span></span><br><span class="line"><span class="comment"> * the target class type is unconstrained, an explicit cast may be</span></span><br><span class="line"><span class="comment"> * necessary.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id the ID to search for</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> a view with given ID if found, or &#123;<span class="doctag">@code</span> null&#125; otherwise</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> View#findViewById(int)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> Activity#requireViewById(int)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="keyword">public</span> &lt;T <span class="keyword">extends</span> <span class="title class_">View</span>&gt; T <span class="title function_">findViewById</span><span class="params">(<span class="meta">@IdRes</span> <span class="type">int</span> id)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> getWindow().findViewById(id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Windowè°ƒç”¨DecorView</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Finds a view that was identified by the &#123;<span class="doctag">@code</span> android:id&#125; XML attribute</span></span><br><span class="line"><span class="comment"> * that was processed in &#123;<span class="doctag">@link</span> android.app.Activity#onCreate&#125;.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * This will implicitly call &#123;<span class="doctag">@link</span> #getDecorView&#125; with all of the associated side-effects.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;strong&gt;Note:&lt;/strong&gt; In most cases -- depending on compiler support --</span></span><br><span class="line"><span class="comment"> * the resulting view is automatically cast to the target class type. If</span></span><br><span class="line"><span class="comment"> * the target class type is unconstrained, an explicit cast may be</span></span><br><span class="line"><span class="comment"> * necessary.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id the ID to search for</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> a view with given ID if found, or &#123;<span class="doctag">@code</span> null&#125; otherwise</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> View#findViewById(int)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> Window#requireViewById(int)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="keyword">public</span> &lt;T <span class="keyword">extends</span> <span class="title class_">View</span>&gt; T <span class="title function_">findViewById</span><span class="params">(<span class="meta">@IdRes</span> <span class="type">int</span> id)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> getDecorView().findViewById(id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å¸ƒå±€å‚æ•°"><a href="#å¸ƒå±€å‚æ•°" class="headerlink" title="å¸ƒå±€å‚æ•°"></a>å¸ƒå±€å‚æ•°</h2><p>æ¯ä¸ª ViewGroup ç±»éƒ½ä¼šå®ç°ä¸€ä¸ªæ‰©å±• ViewGroup.LayoutParams çš„åµŒå¥—ç±»ã€‚æ­¤å­ç±»åŒ…å«çš„å±æ€§ç±»å‹ä¼šæ ¹æ®éœ€è¦ä¸ºè§†å›¾ç»„å®šä¹‰æ¯ä¸ªå­è§†å›¾çš„å°ºå¯¸å’Œä½ç½®ã€‚å¦‚å›¾ 2 æ‰€ç¤ºï¼Œçˆ¶è§†å›¾ç»„ä¼šä¸ºæ¯ä¸ªå­è§†å›¾ï¼ˆåŒ…æ‹¬å­è§†å›¾ç»„ï¼‰å®šä¹‰å¸ƒå±€å‚æ•°ã€‚</p><p>æ‰€æœ‰è§†å›¾ç»„éƒ½ä½¿ç”¨ layout_width å’Œ layout_height åŒ…å«å®½åº¦å’Œé«˜åº¦ï¼Œå¹¶ä¸”æ¯ä¸ªè§†å›¾éƒ½å¿…é¡»å®šä¹‰å®ƒä»¬ã€‚è®¸å¤š LayoutParams åŒ…å«å¯é€‰çš„å¤–è¾¹è·å’Œè¾¹æ¡†ã€‚</p><p>æ‚¨å¯ä»¥æŒ‡å®šå…·æœ‰ç¡®åˆ‡å°ºå¯¸çš„å®½åº¦å’Œé«˜åº¦ï¼Œä½†æ‚¨å¯èƒ½ä¸å¸Œæœ›ç»å¸¸è¿™æ ·åšã€‚æ›´å¸¸è§çš„æƒ…å†µæ˜¯ï¼Œæ‚¨ä¼šä½¿ç”¨ä»¥ä¸‹æŸä¸ªå¸¸é‡æ¥è®¾ç½®å®½åº¦æˆ–é«˜åº¦ï¼š</p><ul><li>wrap_contentï¼šå‘ŠçŸ¥è§†å›¾å°†å…¶å¤§å°è°ƒæ•´ä¸ºå†…å®¹æ‰€éœ€çš„å°ºå¯¸ã€‚</li><li>match_parentï¼šå‘ŠçŸ¥è§†å›¾å°½å¯èƒ½é‡‡ç”¨å…¶çˆ¶è§†å›¾ç»„å…è®¸çš„æœ€å¤§å°ºå¯¸ã€‚</li></ul><blockquote><p>æœ€å¥½ä½¿ç”¨dpï¼Œå¯†åº¦æ— å…³åƒç´ </p></blockquote><h2 id="å¸ƒå±€ä½ç½®"><a href="#å¸ƒå±€ä½ç½®" class="headerlink" title="å¸ƒå±€ä½ç½®"></a>å¸ƒå±€ä½ç½®</h2><p><code>getLeft()</code>, <code>getTop()</code>, <code>getRight()</code>, <code>getBottom()</code>è¡¨ç¤ºè·å–ç›¸å¯¹äºå…¶çˆ¶viewçš„ä½ç½®åæ ‡</p><p><code>getRight()</code> <code>-</code> <code>getLeft()</code> <code>==</code> <code>getWidth()</code><br><code>getBottom()</code> <code>-</code> <code>getTop()</code> <code>==</code> <code>getHeight()</code></p><h2 id="å°ºå¯¸-å†…å¤–è¾¹è·"><a href="#å°ºå¯¸-å†…å¤–è¾¹è·" class="headerlink" title="å°ºå¯¸, å†…å¤–è¾¹è·"></a>å°ºå¯¸, å†…å¤–è¾¹è·</h2><p>margin(å¤–è¾¹è·)å’Œpadding(å†…è¾¹è·)çš„åŒºåˆ«</p><ul><li>marginæŒ‡çš„æ˜¯åœ¨viewçš„è¾¹ç•Œä¹‹å¤–çš„é¢å¤–ç©ºé—´ï¼Œç”¨äºåˆ†éš”çˆ¶å¸ƒå±€ï¼Œæˆ–çˆ¶å¸ƒå±€ä¸­å…¶ä»–ç›¸é‚»view</li><li>marginçš„é¢œè‰²ä¸å—viewçš„å½±å“</li><li>paddingæ˜¯åœ¨viewè¾¹ç•Œå†…éƒ¨çš„é¢å¤–ç©ºé—´</li><li>paddingçš„é¢œè‰²å—viewçš„èƒŒæ™¯çš„å½±å“</li></ul><h2 id="è‡ªé€‚åº”å¸ƒå±€"><a href="#è‡ªé€‚åº”å¸ƒå±€" class="headerlink" title="è‡ªé€‚åº”å¸ƒå±€"></a>è‡ªé€‚åº”å¸ƒå±€</h2><ul><li>ä½¿ç”¨ConstraintLayout</li><li>å¯¹åˆ—è¡¨-è¯¦æƒ…ç•Œé¢ä½¿ç”¨ SlidingPaneLayout<ul><li>æ ¹æ®è®¾å¤‡å°ºå¯¸è‡ªåŠ¨å†³å®šèœå•å’Œcontentæ˜¯å¹¶æ’æ˜¾ç¤ºè¿˜æ˜¯å±‚å æ˜¾ç¤º</li></ul></li></ul><h3 id="å¤‡ç”¨èµ„æº"><a href="#å¤‡ç”¨èµ„æº" class="headerlink" title="å¤‡ç”¨èµ„æº"></a>å¤‡ç”¨èµ„æº</h3><p>å¯¹èµ„æºç›®å½•&#x2F;å¸ƒå±€æ–‡ä»¶çš„æ–‡ä»¶ååæ·»åŠ é™å®šç¬¦ï¼Œå¯è§„å®šè‡ªæ„¿é™åˆ¶åº”ç”¨çš„å±å¹•å°ºå¯¸ï¼Œè¯­è¨€ï¼Œå±å¹•æ–¹å‘ï¼Œå¦‚æœ‰å¤šç§é™åˆ¶ï¼Œéœ€è¦æŒ‰ç…§<a href="https://developer.android.com/guide/topics/resources/providing-resources?hl=zh-cn#table2">è¡¨æ ¼</a>ä¸­çš„é¡ºåºç»™å‡ºã€‚</p><p>åœ¨<a href="https://developer.android.com/guide/topics/resources/providing-resources?hl=zh-cn#table2">è¡¨æ ¼</a>ä¸­è¶Šé å‰çš„ä¼˜å…ˆçº§è¶Šé«˜</p><p>ç³»ç»Ÿé€‰æ‹©åˆé€‚çš„èµ„æºæ—¶ï¼Œé¦–å…ˆæ’é™¤ä¸è®¾å¤‡é…ç½®ç›¸å†²çªçš„èµ„æºæ–‡ä»¶ï¼ˆå¦‚è¯­è¨€ã€åƒç´ å¯†åº¦ï¼‰ï¼Œç„¶åæŒ‰ç…§<a href="https://developer.android.com/guide/topics/resources/providing-resources?hl=zh-cn#table2">è¡¨æ ¼</a>çš„é¡ºåºä¾æ¬¡å¯»æ‰¾æ˜¯å¦æœ‰ç›®å½•åŒ…å«è¯¥é™å®šç¬¦ï¼Œå¦‚æœæœ‰ï¼Œåˆ™æŠŠä¸å«æœ‰é™å®šç¬¦çš„ç›®å½•æ’é™¤</p><h3 id="fragment"><a href="#fragment" class="headerlink" title="fragment"></a>fragment</h3><p>ä½¿ç”¨ fragment å°†ç•Œé¢ç»„ä»¶æ¨¡å—åŒ–</p><ul><li>å¯¹äºæŠ˜å å±ã€å¤§å°ºå¯¸è®¾å¤‡ï¼Œå¯ä»¥ç”¨fragmentå°†uiæ¨¡å—åŒ–ï¼Œé¿å…é‡å¤çš„uiåŠ è½½</li></ul><h3 id="activity-åµŒå…¥"><a href="#activity-åµŒå…¥" class="headerlink" title="activity åµŒå…¥"></a>activity åµŒå…¥</h3><p>ä½¿ç”¨ActivityåµŒå…¥ï¼Œå¯åœ¨å¤§å°ºå¯¸è®¾å¤‡ä¸Šåœ¨å±å¹•ä¸Šå¹¶æ’æ˜¾ç¤ºActivityï¼Œåœ¨å°å°ºå¯¸å±å¹•ä¸Šå±‚å æ˜¾ç¤º</p><h2 id="çº¿æ€§å¸ƒå±€"><a href="#çº¿æ€§å¸ƒå±€" class="headerlink" title="çº¿æ€§å¸ƒå±€"></a>çº¿æ€§å¸ƒå±€</h2><h3 id="å‡ç­‰åˆ†å¸ƒ"><a href="#å‡ç­‰åˆ†å¸ƒ" class="headerlink" title="å‡ç­‰åˆ†å¸ƒ"></a>å‡ç­‰åˆ†å¸ƒ</h3><p>è‹¥è¦åˆ›å»ºçº¿æ€§å¸ƒå±€ï¼Œè®©æ¯ä¸ªå­é¡¹åœ¨å±å¹•ä¸Šå æ®ç›¸åŒå¤§å°çš„ç©ºé—´</p><ul><li><code>android:layout_height=&quot;0dp&quot;</code> or <code>android:layout_width=&quot;0dp&quot;</code></li><li><code>android:layout_weight=&quot;1&quot;</code></li></ul><h3 id="ä¸ç­‰åˆ†å¸ƒ"><a href="#ä¸ç­‰åˆ†å¸ƒ" class="headerlink" title="ä¸ç­‰åˆ†å¸ƒ"></a>ä¸ç­‰åˆ†å¸ƒ</h3><ul><li>weightä¸º0,åˆ™åªå æ®æ‰€éœ€çš„å¤§å°</li><li>ä¸ä¸º0ï¼Œæ¯ä¸ªå æ®å‰©ä½™ç©ºé—´çš„ $ weight_i &#x2F; \sum_{j&#x3D;1}^{N}{weight_j} $</li></ul><h2 id="ä¼˜åŒ–å¸ƒå±€"><a href="#ä¼˜åŒ–å¸ƒå±€" class="headerlink" title="ä¼˜åŒ–å¸ƒå±€"></a>ä¼˜åŒ–å¸ƒå±€</h2><ul><li>å‡å°‘å¸ƒå±€å±‚æ¬¡<ul><li>åˆå¹¶</li><li>ä½¿ç”¨ConstraintLayout</li></ul></li><li>é€šè¿‡includeæ ‡ç­¾é‡å¤ä½¿ç”¨å¸ƒå±€<ul><li>å­å¸ƒå±€çš„æ ¹å¸ƒå±€å¯ä»¥ä½¿ç”¨mergeæ ‡ç­¾ï¼Œä¸çˆ¶å¸ƒå±€åˆå¹¶</li></ul></li><li>ä½¿ç”¨ViewStub<ul><li>åŠ¨æ€å°†ViewStubæ›¿æ¢ä¸ºå¯¹åº”çš„view</li><li>é€šè¿‡ViewStub.inflateæ›¿æ¢view</li></ul></li></ul><h2 id="è‡ªå®šä¹‰ç»„ä»¶"><a href="#è‡ªå®šä¹‰ç»„ä»¶" class="headerlink" title="è‡ªå®šä¹‰ç»„ä»¶"></a>è‡ªå®šä¹‰ç»„ä»¶</h2><h3 id="è‡ªå®šä¹‰å±æ€§"><a href="#è‡ªå®šä¹‰å±æ€§" class="headerlink" title="è‡ªå®šä¹‰å±æ€§"></a>è‡ªå®šä¹‰å±æ€§</h3><ul><li>åˆ›å»º<code>res/values/attrs.xml</code></li><li>æè¿°å±æ€§ä»¥åŠå±æ€§çš„å–å€¼</li><li>è·å–å±æ€§å€¼<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">init</span> &#123;</span><br><span class="line">    context.theme.obtainStyledAttributes(</span><br><span class="line">            attrs,</span><br><span class="line">            R.styleable.PieChart,</span><br><span class="line">            <span class="number">0</span>, <span class="number">0</span>).apply &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            mShowText = getBoolean(R.styleable.PieChart_showText, <span class="literal">false</span>)</span><br><span class="line">            textPos = getInteger(R.styleable.PieChart_labelPosition, <span class="number">0</span>)</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            recycle()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="onMeasure"><a href="#onMeasure" class="headerlink" title="onMeasure"></a>onMeasure</h3><ul><li><p>è·å–parenté™åˆ¶çš„å¤§å°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">widthMode</span> <span class="operator">=</span> MeasureSpec.getMode(widthMeasureSpec);</span><br><span class="line"><span class="type">int</span> <span class="variable">widthSize</span> <span class="operator">=</span> MeasureSpec.getSize(widthMeasureSpec);</span><br><span class="line"><span class="type">int</span> <span class="variable">heightMode</span> <span class="operator">=</span> MeasureSpec.getMode(heightMeasureSpec);</span><br><span class="line"><span class="type">int</span> <span class="variable">heightSize</span> <span class="operator">=</span> MeasureSpec.getSize(heightMeasureSpec);</span><br></pre></td></tr></table></figure><blockquote><p>Modeæ˜¯MeasureSpec</p></blockquote></li><li><p>è°ƒç”¨childçš„measure, å‚æ•°è¡¨ç¤ºå¯¹childå¤§å°çš„é™åˆ¶</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * This is called to find out how big a view should be. The parent</span></span><br><span class="line"><span class="comment"> * supplies constraint information in the width and height parameters.</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * The actual measurement work of a view is performed in</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@link</span> #onMeasure(int, int)&#125;, called by this method. Therefore, only</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@link</span> #onMeasure(int, int)&#125; can and must be overridden by subclasses.</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> widthMeasureSpec Horizontal space requirements as imposed by the</span></span><br><span class="line"><span class="comment"> *        parent</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> heightMeasureSpec Vertical space requirements as imposed by the</span></span><br><span class="line"><span class="comment"> *        parent</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> #onMeasure(int, int)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">measure</span><span class="params">(<span class="type">int</span> widthMeasureSpec, <span class="type">int</span> heightMeasureSpec)</span> &#123;</span><br></pre></td></tr></table></figure><h3 id="onLayout"><a href="#onLayout" class="headerlink" title="onLayout"></a>onLayout</h3><p>éå†childï¼Œè°ƒç”¨childçš„layoutæ–¹æ³•ï¼Œå‚æ•°è¡¨ç¤ºå…¶å¸ƒå±€ç›¸å¯¹äºçˆ¶å¸ƒå±€çš„ä½ç½®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Assign a size and position to a view and all of its</span></span><br><span class="line"><span class="comment"> * descendants</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;This is the second phase of the layout mechanism.</span></span><br><span class="line"><span class="comment"> * (The first is measuring). In this phase, each parent calls</span></span><br><span class="line"><span class="comment"> * layout on all of its children to position them.</span></span><br><span class="line"><span class="comment"> * This is typically done using the child measurements</span></span><br><span class="line"><span class="comment"> * that were stored in the measure pass().&lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;Derived classes should not override this method.</span></span><br><span class="line"><span class="comment"> * Derived classes with children should override</span></span><br><span class="line"><span class="comment"> * onLayout. In that method, they should</span></span><br><span class="line"><span class="comment"> * call layout on each of their children.&lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> l Left position, relative to parent</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> t Top position, relative to parent</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> r Right position, relative to parent</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> b Bottom position, relative to parent</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SuppressWarnings(&#123;&quot;unchecked&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">layout</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> t, <span class="type">int</span> r, <span class="type">int</span> b)</span> &#123;</span><br></pre></td></tr></table></figure><h3 id="onDraw"><a href="#onDraw" class="headerlink" title="onDraw"></a>onDraw</h3><p>ç»™ä½ Canvaså»ç»˜å›¾</p><h2 id="æ²‰æµ¸æ¨¡å¼"><a href="#æ²‰æµ¸æ¨¡å¼" class="headerlink" title="æ²‰æµ¸æ¨¡å¼"></a>æ²‰æµ¸æ¨¡å¼</h2><h3 id="ç³»ç»Ÿè¾¹è¡¬åŒº"><a href="#ç³»ç»Ÿè¾¹è¡¬åŒº" class="headerlink" title="ç³»ç»Ÿè¾¹è¡¬åŒº"></a>ç³»ç»Ÿè¾¹è¡¬åŒº</h3><ul><li>ç³»ç»Ÿæ è¾¹è¡¬åŒºï¼šçŠ¶æ€æ +å¯¼èˆªæ¡&#x2F;æŒ‰é’®</li><li>ç³»ç»Ÿæ‰‹åŠ¿è¾¹è¡¬åŒºï¼šæ‰‹åŠ¿å¯¼èˆªåŒº</li></ul><h3 id="åœ†è§’"><a href="#åœ†è§’" class="headerlink" title="åœ†è§’"></a>åœ†è§’</h3><ul><li>è·å–è®¾å¤‡åœ†è§’çš„åœ†å¿ƒå’ŒåŠå¾„<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åœ¨ä¸€ä¸ªviewä¸­</span></span><br><span class="line"><span class="keyword">val</span> insets = rootWindowInsets</span><br><span class="line"><span class="keyword">val</span> topRight = insets.getRoundedCorner(RoundedCorner.POSITION_TOP_RIGHT) ?: <span class="keyword">return</span></span><br><span class="line"><span class="comment">// åœ¨activityä¸­</span></span><br><span class="line"><span class="keyword">val</span> rootWindowInsets = rootView.rootWindowInsets</span><br></pre></td></tr></table></figure></li></ul>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;ID&quot;&gt;&lt;a href=&quot;#ID&quot; class=&quot;headerlink&quot; title=&quot;ID&quot;&gt;&lt;/a&gt;ID&lt;/h2&gt;&lt;p&gt;åˆ›å»º RelativeLayout æ—¶ï¼Œè¯·åŠ¡å¿…ä¸ºè§†å›¾å¯¹è±¡å®šä¹‰ IDã€‚åœ¨ç›¸å¯¹å¸ƒå±€ä¸­ï¼ŒåŒçº§è§†å›¾å¯ä»¥å®šä¹‰å…¶ç›¸å¯¹äºé€šè¿‡å”¯ä¸€ ID å¼•ç”¨çš„å¦ä¸€ä¸ªåŒçº§è§†å›¾çš„å¸ƒå±€ã€‚&lt;/p&gt;
&lt;h3 id=&quot;findViewById&quot;&gt;&lt;a href=&quot;#findViewById&quot; class=&quot;headerlink&quot; title=&quot;findViewById&quot;&gt;&lt;/a&gt;findViewById&lt;/h3&gt;&lt;p&gt;ID ä¸å¿…åœ¨æ•´ä¸ªæ ‘çŠ¶ç»“æ„ä¸­å…·æœ‰å”¯ä¸€æ€§ï¼Œä½†åœ¨æ‚¨æœç´¢çš„æ ‘çŠ¶ç»“æ„éƒ¨åˆ†ä¸­å¿…é¡»æ˜¯å”¯ä¸€çš„ã€‚å®ƒé€šå¸¸å¯èƒ½æ˜¯æ•´ä¸ªæ ‘ï¼Œå› æ­¤æœ€å¥½å°½å¯èƒ½ä½¿å…¶å…·æœ‰å”¯ä¸€æ€§ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;findViewById&lt;/code&gt;æ˜¯Viewçš„æ–¹æ³•&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt; * Finds the first descendant view with the given ID, the view itself if&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt; * the ID matches &amp;#123;&lt;span class=&quot;doctag&quot;&gt;@link&lt;/span&gt; #getId()&amp;#125;, or &amp;#123;&lt;span class=&quot;doctag&quot;&gt;@code&lt;/span&gt; null&amp;#125; if the ID is invalid&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt; * (&amp;lt; 0) or there is no matching view in the hierarchy.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt; * &amp;lt;p&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt; * &amp;lt;strong&amp;gt;Note:&amp;lt;/strong&amp;gt; In most cases -- depending on compiler support --&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt; * the resulting view is automatically cast to the target class type. If&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt; * the target class type is unconstrained, an explicit cast may be&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt; * necessary.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt; *&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt; * &lt;span class=&quot;doctag&quot;&gt;@param&lt;/span&gt; id the ID to search for&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt; * &lt;span class=&quot;doctag&quot;&gt;@return&lt;/span&gt; a view with given ID if found, or &amp;#123;&lt;span class=&quot;doctag&quot;&gt;@code&lt;/span&gt; null&amp;#125; otherwise&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt; * &lt;span class=&quot;doctag&quot;&gt;@see&lt;/span&gt; View#requireViewById(int)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt; */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;@Nullable&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; &amp;lt;T &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title class_&quot;&gt;View&lt;/span&gt;&amp;gt; T &lt;span class=&quot;title function_&quot;&gt;findViewById&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;meta&quot;&gt;@IdRes&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; id)&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (id == NO_ID) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;null&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; findViewTraversal(id);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="Android" scheme="https://jingtianer.github.io/home/categories/Android/"/>
    
    
    <category term="Android-å®˜æ–¹æ–‡æ¡£" scheme="https://jingtianer.github.io/home/tags/Android-%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3/"/>
    
  </entry>
  
  <entry>
    <title>gitçš„ä½¿ç”¨</title>
    <link href="https://jingtianer.github.io/home/2024/05/07/misc/git%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
    <id>https://jingtianer.github.io/home/2024/05/07/misc/git%E7%9A%84%E4%BD%BF%E7%94%A8/</id>
    <published>2024-05-07T13:15:36.000Z</published>
    <updated>2025-04-15T02:37:55.626Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ç‰ˆæœ¬æ§åˆ¶å‘å±•å†å²"><a href="#ç‰ˆæœ¬æ§åˆ¶å‘å±•å†å²" class="headerlink" title="ç‰ˆæœ¬æ§åˆ¶å‘å±•å†å²"></a>ç‰ˆæœ¬æ§åˆ¶å‘å±•å†å²</h2><h3 id="æœ¬åœ°ä»£ç ç‰ˆæœ¬æ§åˆ¶"><a href="#æœ¬åœ°ä»£ç ç‰ˆæœ¬æ§åˆ¶" class="headerlink" title="æœ¬åœ°ä»£ç ç‰ˆæœ¬æ§åˆ¶"></a>æœ¬åœ°ä»£ç ç‰ˆæœ¬æ§åˆ¶</h3><p>RCS: åªèƒ½ä¿å­˜æœ¬åœ°çš„å˜åŒ–æƒ…å†µï¼Œæ— æ³•ååŒåˆä½œ</p><h3 id="é›†ä¸­å¼ç‰ˆæœ¬æ§åˆ¶"><a href="#é›†ä¸­å¼ç‰ˆæœ¬æ§åˆ¶" class="headerlink" title="é›†ä¸­å¼ç‰ˆæœ¬æ§åˆ¶"></a>é›†ä¸­å¼ç‰ˆæœ¬æ§åˆ¶</h3><p>SVN: è¿œç«¯æœåŠ¡å™¨ç»´æŠ¤ç‰ˆæœ¬ï¼Œæœ¬åœ°ä¸ä¿å­˜ä»£ç ç‰ˆæœ¬</p><h3 id="åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶"><a href="#åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶" class="headerlink" title="åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶"></a>åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶</h3><p>git: æ¯ä¸ªä»“åº“éƒ½è®°å½•ç‰ˆæœ¬å†å²ï¼Œè§£å†³ä¸€ä¸ªæœåŠ¡å™¨æŒ‚æ‰å¯¼è‡´æ‰€æœ‰å†å²ç‰ˆæœ¬ä¸¢å¤±çš„é—®é¢˜</p><h2 id="cherry-pick"><a href="#cherry-pick" class="headerlink" title="cherry-pick"></a>cherry-pick</h2><h2 id="fast-forward"><a href="#fast-forward" class="headerlink" title="fast-forward"></a>fast-forward</h2>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;ç‰ˆæœ¬æ§åˆ¶å‘å±•å†å²&quot;&gt;&lt;a href=&quot;#ç‰ˆæœ¬æ§åˆ¶å‘å±•å†å²&quot; class=&quot;headerlink&quot; title=&quot;ç‰ˆæœ¬æ§åˆ¶å‘å±•å†å²&quot;&gt;&lt;/a&gt;ç‰ˆæœ¬æ§åˆ¶å‘å±•å†å²&lt;/h2&gt;&lt;h3 id=&quot;æœ¬åœ°ä»£ç ç‰ˆæœ¬æ§åˆ¶&quot;&gt;&lt;a href=&quot;#æœ¬åœ°ä»£ç ç‰ˆæœ¬æ§åˆ¶&quot; class=&quot;headerlink&quot; title=&quot;æœ¬åœ°ä»£ç ç‰ˆæœ¬æ§åˆ¶&quot;&gt;&lt;/a&gt;æœ¬åœ°ä»£ç ç‰ˆæœ¬æ§åˆ¶&lt;/h3&gt;&lt;p&gt;RCS: åªèƒ½ä¿å­˜æœ¬åœ°çš„å˜åŒ–æƒ…å†µï¼Œæ— æ³•ååŒåˆä½œ&lt;/p&gt;
&lt;h3 id=&quot;é›†ä¸­å¼ç‰ˆæœ¬æ§åˆ¶&quot;&gt;&lt;a href=&quot;#é›†ä¸­å¼ç‰ˆæœ¬æ§åˆ¶&quot; class=&quot;headerlink&quot; title=&quot;é›†ä¸­å¼ç‰ˆæœ¬æ§åˆ¶&quot;&gt;&lt;/a&gt;é›†ä¸­å¼ç‰ˆæœ¬æ§åˆ¶&lt;/h3&gt;&lt;p&gt;SVN: è¿œç«¯æœåŠ¡å™¨ç»´æŠ¤ç‰ˆæœ¬ï¼Œæœ¬åœ°ä¸ä¿å­˜ä»£ç ç‰ˆæœ¬&lt;/p&gt;
&lt;h3 id=&quot;åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶&quot;&gt;&lt;a href=&quot;#åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶&quot; class=&quot;headerlink&quot; title=&quot;åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶&quot;&gt;&lt;/a&gt;åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶&lt;/h3&gt;</summary>
    
    
    
    <category term="git" scheme="https://jingtianer.github.io/home/categories/git/"/>
    
    
    <category term="git" scheme="https://jingtianer.github.io/home/tags/git/"/>
    
  </entry>
  
  <entry>
    <title>01-Flutter-å¿«é€Ÿå…¥é—¨å®æˆ˜</title>
    <link href="https://jingtianer.github.io/home/2024/04/24/Android%E9%AB%98%E7%BA%A7/flutter%E5%85%A5%E9%97%A8/01-Flutter-%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8%E5%AE%9E%E6%88%98/"/>
    <id>https://jingtianer.github.io/home/2024/04/24/Android%E9%AB%98%E7%BA%A7/flutter%E5%85%A5%E9%97%A8/01-Flutter-%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8%E5%AE%9E%E6%88%98/</id>
    <published>2024-04-24T13:15:36.000Z</published>
    <updated>2025-04-15T02:37:55.587Z</updated>
    
    <content type="html"><![CDATA[<h2 id="flutter"><a href="#flutter" class="headerlink" title="flutter"></a>flutter</h2><ul><li>everything is a widget</li></ul><h2 id="widget"><a href="#widget" class="headerlink" title="widget"></a>widget</h2><p>åœ¨flutterä¸­ï¼Œæ‰€æœ‰çœ‹å¾—è§çš„çœ‹ä¸è§çš„ä¸œè¥¿éƒ½æ˜¯widget</p><h2 id="ç›®å½•ç»“æ„"><a href="#ç›®å½•ç»“æ„" class="headerlink" title="ç›®å½•ç»“æ„"></a>ç›®å½•ç»“æ„</h2><ul><li>android:</li><li>ios:</li><li>lib: dartæ–‡ä»¶ï¼Œä¸šåŠ¡é€»è¾‘</li><li>lib&#x2F;main.dart: å…¥å£</li><li>pubspec.yaml: å·¥ç¨‹ä¿¡æ¯ä»¥åŠä¾èµ–</li></ul><h2 id="ä¾èµ–å£°æ˜"><a href="#ä¾èµ–å£°æ˜" class="headerlink" title="ä¾èµ–å£°æ˜"></a>ä¾èµ–å£°æ˜</h2><p>pubspec.yamlä¸­</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">dependencies:</span></span><br><span class="line">    <span class="attr">package_name:</span> [<span class="string">version_code</span>]</span><br><span class="line">    <span class="attr">package_name:</span> <span class="string">^[version_code]</span></span><br><span class="line">    <span class="comment"># ^çš„ä½œç”¨æ˜¯è®©ç³»ç»Ÿé€‰æ‹©æ›´é«˜ä¸”ä¸version_codeç›¸å…¼å®¹çš„ç‰ˆæœ¬</span></span><br><span class="line">    <span class="attr">packge_name:</span> [<span class="string">git_url</span>]</span><br><span class="line">    <span class="attr">packge_name:</span> [<span class="string">local</span> <span class="string">path</span>]</span><br><span class="line"><span class="attr">dev_dependencies:</span></span><br><span class="line">    <span class="comment"># ä»…åœ¨å¼€å‘æ—¶ä¾èµ–ï¼Œåœ¨releaseæ—¶ä¸æ‰“åŒ…</span></span><br><span class="line">    <span class="attr">package_name:</span> <span class="string">param</span></span><br></pre></td></tr></table></figure><h2 id="å¸ƒå±€"><a href="#å¸ƒå±€" class="headerlink" title="å¸ƒå±€"></a>å¸ƒå±€</h2><p>æœ¬èŠ‚å†…å®¹æ¥è‡ª<a href="https://docs.flutter.dev/ui/layout">fluuter docs&#x2F;ui&#x2F;layout</a></p><h3 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><ul><li><a href="https://docs.flutter.dev/ui/widgets/layout">flutterä¸­çš„layout</a></li><li>å¸¸è§layout<ul><li>Center</li><li>Container</li><li>Baseline</li><li>Row</li><li>Column</li><li>Stack</li><li>Table</li></ul></li></ul><h3 id="å°†å°éƒ¨ä»¶æ·»åŠ åˆ°å¸ƒå±€"><a href="#å°†å°éƒ¨ä»¶æ·»åŠ åˆ°å¸ƒå±€" class="headerlink" title="å°†å°éƒ¨ä»¶æ·»åŠ åˆ°å¸ƒå±€"></a>å°†å°éƒ¨ä»¶æ·»åŠ åˆ°å¸ƒå±€</h3><ul><li>child: å”¯ä¸€å­widget</li><li>children: å¤šä¸ªåˆ—è¡¨å‹çš„å­widget(å¦‚Row, Column, Stack)</li></ul><h3 id="buildæ–¹æ³•"><a href="#buildæ–¹æ³•" class="headerlink" title="buildæ–¹æ³•"></a>buildæ–¹æ³•</h3><p>å¤§å¤šæ•°widgetséƒ½æœ‰buildæ–¹æ³•,flutter appæœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªwidget,é€šè¿‡buildæ–¹æ³•å®ä¾‹åŒ–å¹¶è¿”å›ä¸€ä¸ªwidgetå°±ä¼šæ˜¾ç¤ºè¯¥widget</p><h3 id="App"><a href="#App" class="headerlink" title="App"></a>App</h3><ul><li>CupertinoApp: iosé£æ ¼çš„app<ul><li>themeä¼ å…¥CupertinoThemeData</li><li>homeå±æ€§ç”¨CupertinoPageScaffold</li><li><a href="https://api.flutter.dev/flutter/cupertino/cupertino-library.html">å…¨éƒ¨Cupertino lib</a></li></ul></li><li>MaterialApp: Materialé£æ ¼çš„app<ul><li>homeç”¨Scaffold</li><li>å¯ä»¥ä½¿ç”¨ActionButton, SneakBar</li></ul></li><li>Container: å¦‚æœä¸éœ€è¦Materialé£æ ¼æˆ–iosé£æ ¼ï¼Œç›´æ¥è¿”å›Container</li></ul><h3 id="Rowå’ŒColum"><a href="#Rowå’ŒColum" class="headerlink" title="Rowå’ŒColum"></a>Rowå’ŒColum</h3><p><img src="https://docs.flutter.dev/assets/images/docs/ui/layout/row-diagram.png" alt="rowä¸»è½´äº¤å‰è½´"><br><img src="https://docs.flutter.dev/assets/images/docs/ui/layout/column-diagram.png" alt="columnä¸»è½´äº¤å‰è½´"></p><h4 id="ä¸»è½´å’Œäº¤å‰è½´-main-axis-cross-axis"><a href="#ä¸»è½´å’Œäº¤å‰è½´-main-axis-cross-axis" class="headerlink" title="ä¸»è½´å’Œäº¤å‰è½´(main axis, cross axis)"></a>ä¸»è½´å’Œäº¤å‰è½´(main axis, cross axis)</h4><ul><li>rowçš„ä¸»è½´å’Œäº¤å‰è½´åˆ†åˆ«æ˜¯æ°´å¹³çš„å’Œå‚ç›´çš„</li><li>columnçš„ä¸»è½´å’Œäº¤å‰è½´åè¿‡æ¥</li><li><code>MainAxisAlignment</code>å’Œ<code>CrossAxisAlignment</code>æä¾›äº†æ§åˆ¶å¯¹é½æ–¹å¼çš„å¸¸é‡</li></ul><h4 id="å¤šä¸ªchildrençš„å¤§å°"><a href="#å¤šä¸ªchildrençš„å¤§å°" class="headerlink" title="å¤šä¸ªchildrençš„å¤§å°"></a>å¤šä¸ªchildrençš„å¤§å°</h4><ul><li>ä½¿ç”¨Expanded: è®©å­widgeté€‚åº”row&#x2F;columnçš„å¤§å°ï¼Œä½¿ç”¨Expandedçš„å±æ€§flexåˆ¶å®šå…¶å¤§å°çš„æƒé‡</li><li>ä½¿ç”¨<code>mainAxisSize: MainAxisSize.min</code>æ§åˆ¶å¤§å°ï¼Œè®©å…¶ç´§å‡‘çš„è´´åœ¨ä¸€èµ·</li></ul><h3 id="å¸¸ç”¨å¸ƒå±€å°ç»„ä»¶"><a href="#å¸¸ç”¨å¸ƒå±€å°ç»„ä»¶" class="headerlink" title="å¸¸ç”¨å¸ƒå±€å°ç»„ä»¶"></a>å¸¸ç”¨å¸ƒå±€å°ç»„ä»¶</h3><blockquote><p><strong>æ ‡å‡†å°ç»„ä»¶</strong><br>Containerï¼šå‘å°éƒ¨ä»¶æ·»åŠ å¡«å……ã€è¾¹è·ã€è¾¹æ¡†ã€èƒŒæ™¯é¢œè‰²æˆ–å…¶ä»–è£…é¥°ã€‚<br>GridViewï¼šå°†å°éƒ¨ä»¶å¸ƒç½®ä¸ºå¯æ»šåŠ¨ç½‘æ ¼ã€‚<br>ListViewï¼šå°†å°éƒ¨ä»¶å¸ƒç½®ä¸ºå¯æ»šåŠ¨åˆ—è¡¨ã€‚<br>Stackï¼šå°†ä¸€ä¸ªå°éƒ¨ä»¶é‡å åœ¨å¦ä¸€ä¸ªå°éƒ¨ä»¶ä¹‹ä¸Šã€‚</p></blockquote><blockquote><p><strong>materialå¸ƒå±€å°ç»„ä»¶</strong><br>Cardï¼šå°†ç›¸å…³ä¿¡æ¯ç»„ç»‡åˆ°å¸¦æœ‰åœ†è§’å’Œé˜´å½±çš„æ¡†ä¸­ã€‚<br>ListTileï¼šå°†æœ€å¤š 3 è¡Œæ–‡æœ¬ä»¥åŠå¯é€‰çš„å‰å¯¼å’Œå°¾éšå›¾æ ‡ç»„ç»‡æˆä¸€è¡Œã€‚</p></blockquote><h3 id="çº¦æŸConstraints"><a href="#çº¦æŸConstraints" class="headerlink" title="çº¦æŸConstraints"></a>çº¦æŸConstraints</h3><p><a href="https://docs.flutter.dev/ui/layout/constraints">Understanding constraints</a><br>Flutterçš„å¸ƒå±€å¼•æ“è¢«è®¾è®¡ä¸ºä¸€æ¬¡é€šè¿‡çš„è¿‡ç¨‹ã€‚è¿™æ„å‘³ç€Flutterå¯ä»¥éå¸¸æœ‰æ•ˆåœ°å¸ƒå±€å…¶å°éƒ¨ä»¶ï¼Œä½†ä¹Ÿå­˜åœ¨ä¸€äº›é™åˆ¶: </p><ul><li>å°éƒ¨ä»¶åªèƒ½åœ¨çˆ¶éƒ¨ä»¶ç»™å®ƒçš„çº¦æŸèŒƒå›´å†…å†³å®šè‡ªå·±çš„å¤§å°ã€‚è¿™æ„å‘³ç€ä¸€ä¸ªå°éƒ¨ä»¶é€šå¸¸ä¸èƒ½æœ‰å®ƒæƒ³è¦çš„å¤§å°ã€‚ </li><li>å°éƒ¨ä»¶ä¸èƒ½çŸ¥é“ä¹Ÿä¸èƒ½å†³å®šå®ƒè‡ªå·±åœ¨å±å¹•ä¸Šçš„ä½ç½®ï¼Œå› ä¸ºå†³å®šå°éƒ¨ä»¶ä½ç½®çš„æ˜¯å°éƒ¨ä»¶çš„çˆ¶ç»„ä»¶ã€‚ </li><li>å› ä¸ºçˆ¶å…ƒç´ çš„å¤§å°å’Œä½ç½®ä¹Ÿä¾èµ–äºå®ƒè‡ªå·±çš„çˆ¶å…ƒç´ ï¼Œæ‰€ä»¥ä¸è€ƒè™‘æ•´ä¸ªæ ‘ï¼Œå°±ä¸å¯èƒ½ç²¾ç¡®åœ°å®šä¹‰ä»»ä½•å°éƒ¨ä»¶çš„å¤§å°å’Œä½ç½®ã€‚ </li><li>å¦‚æœå­å…ƒç´ æƒ³è¦ä¸çˆ¶å…ƒç´ ä¸åŒçš„å¤§å°ï¼Œå¹¶ä¸”çˆ¶å…ƒç´ æ²¡æœ‰è¶³å¤Ÿçš„ä¿¡æ¯æ¥å¯¹é½å®ƒï¼Œé‚£ä¹ˆå­å…ƒç´ çš„å¤§å°å¯èƒ½ä¼šè¢«å¿½ç•¥ã€‚åœ¨å®šä¹‰alignmentæ—¶è¦æ˜ç¡®ã€‚</li></ul><h4 id="ç‰¹æ€§"><a href="#ç‰¹æ€§" class="headerlink" title="ç‰¹æ€§"></a>ç‰¹æ€§</h4><ul><li>è‹¥å±å¹•æ˜¯çˆ¶å¸ƒå±€ï¼Œæ— è®ºè¯¥widgetæ˜¯å¦å®šä¹‰å…¶å¤§å°ã€å®½åº¦ï¼Œè¯¥widgetä¼šå¼ºåˆ¶é“ºæ»¡å±å¹•</li><li>å¯¹äºAlign, Center, å­widgetçš„å¤§å°ä¸èƒ½è¶…è¿‡çˆ¶widgetçš„æƒ…å†µä¸‹ï¼Œå­widgetå¯ä»¥æ‹¥æœ‰ä»»æ„çš„å¤§å°</li><li>å¦‚æœçˆ¶widgetæ²¡æœ‰å¤§å°ï¼Œä»–çš„å¤§å°ç”±å­widgetå†³å®š</li><li>ConstrainedBox<ul><li>å¦‚æœConstrainedBoxï¼ˆå¯ä»¥æŒ‡å®šå­widgetçš„å®½åº¦é«˜åº¦çš„èŒƒå›´ï¼‰çš„çˆ¶widgetæ˜¯å±å¹•ã€‚<ul><li>å±å¹•ä¼šçº¦æŸwidgetå¤§å°æ­£å¥½ç­‰äºå±å¹•</li></ul></li><li>ConstrainedBoxåªèƒ½ä»çˆ¶widgetçš„çº¦æŸä¸­æ–½åŠ çº¦æŸã€‚ä¹Ÿå°±æ˜¯å¦‚æœå­widgetçš„çº¦æŸä¸åœ¨çˆ¶widgetçš„çº¦æŸèŒƒå›´å†…ï¼Œé‚£ä¹ˆå°±åªèƒ½ä¾ç…§çˆ¶widgetçš„çº¦æŸ</li><li>å¦‚æœå­widgetè¦æ±‚çš„å¤§å°è¶…è¿‡äº†ConstrainedBoxçš„é™åˆ¶ï¼Œåªèƒ½å–é™åˆ¶çš„æœ€å¤§å€¼ï¼Œè‹¥å°äºæœ€ä½é™åˆ¶ï¼Œåˆ™åªèƒ½æ˜¯æœ€å°å€¼</li></ul></li><li>UnconstrainedBox<ul><li>å…è®¸å­widgetæ‹¥æœ‰ä»»ä½•å¤§å°ï¼Œå¦‚æœå­widgetå¤§å°è¶…è¿‡UnconstrainedBoxï¼Œåˆ™ä¼šåœ¨å±å¹•ä¸Šæ˜¾ç¤ºâ€overflow warningâ€</li><li>å¦‚æœå­widgetè¦æ±‚å¤§å°ä¸º<code>double.infinity</code>ï¼Œåˆ™ä¸ä¼šæ˜¾ç¤ºä»»ä½•å†…å®¹ï¼Œä¸”ä¼šåœ¨consoleä¸­æç¤ºerrorä¿¡æ¯</li></ul></li><li>OverflowBox<ul><li>å…è®¸å­widgetæ‹¥æœ‰ä»»ä½•å¤§å°ï¼Œå¦‚æœå­widgetå¤§å°è¶…è¿‡UnconstrainedBoxï¼Œåˆ™ä¼šå°½é‡æ˜¾ç¤ºå­widgetçš„å†…å®¹ï¼Œä¸ä¼šå‡ºç°â€overflow warningâ€</li></ul></li><li>LimitedBox<ul><li>é™åˆ¶å­widgetçš„å¤§å°èŒƒå›´ï¼Œä½†ä»…åœ¨å­widgetè®¾ç½®ä¸º<code>double.infinity</code>æ—¶ç”Ÿæ•ˆï¼Œå¦‚æœè®¾ç½®ä¸æ˜¯<code>double.infinity</code>ä¹Ÿä¸åœ¨LimitedBoxé™åˆ¶çš„èŒƒå›´å†…ï¼Œåˆ™æ˜¾ç¤ºå­widgetè¦æ±‚çš„å¤§å°è€Œä¸åº”ç”¨LimitedBoxçš„é™åˆ¶</li></ul></li><li>FittedBox<ul><li>çˆ¶widgetæ˜¯screen,å­widgetæ˜¯Text<ul><li>Textæ ¹æ®å­—ä½“å¤§å°ï¼Œå­—ç¬¦ï¼Œé•¿åº¦è®¡ç®—å‡ºå®½åº¦(intrinsic)åï¼Œæ ¹æ®è‡ªèº«å®½åº¦ç¼©æ”¾Textå¡«å……ç©ºç™½ï¼Œè¶…è¿‡åˆ™ç¼©å°</li></ul></li><li>çˆ¶widgetæ˜¯Centerï¼ˆå…è®¸å­widgetæœ‰è‡ªå·±çš„å¤§å°ï¼‰,å­widgetæ˜¯Text<ul><li>Textæ ¹æ®å­—ä½“å¤§å°ï¼Œå­—ç¬¦ï¼Œé•¿åº¦è®¡ç®—å‡ºå®½åº¦(intrinsic)åï¼Œå¦‚æœå¯ä»¥ï¼ŒFittedBoxå…ˆè®©è‡ªå·±çš„å¤§å°é€‚åº”Textï¼Œè‹¥ä¸è¡Œï¼Œåˆ™ç¼©æ”¾Text</li></ul></li><li>åªèƒ½ç¼©æ”¾æœ‰è¾¹ç•Œçš„ï¼Œé•¿å®½ä¸æ˜¯æ— ç©·çš„widgetï¼Œå¦åˆ™ä»€ä¹ˆéƒ½ä¸ä¼šæ˜¾ç¤ºï¼Œä¸”åœ¨consoleä¸­æŠ¥å‘Šé”™è¯¯ã€‚</li></ul></li><li>Center+Text<ul><li>ä¸ç¼©æ”¾ï¼Œæ–‡å­—å¤ªé•¿å°±break line</li></ul></li><li>Row<ul><li>ç±»ä¼¼äºUnconstrainedBox</li><li>widgetç”±ExpandedåŒ…è£¹ï¼Œåˆ™ä¸å…è®¸å­widgetè‡ªå®šä¹‰å®½åº¦ï¼Œç”±å…¶ä»–childrenå†³å®šå®½åº¦</li><li>å¦‚æœæ‰€æœ‰childrenéƒ½è¢«ExpandedåŒ…è£¹ï¼Œé‚£ä¹ˆå¤§å®¶éƒ½æŒ‰ç…§Expandä¸­åˆ†é…çš„æ¯”ä¾‹å†³å®šå…¶å®½åº¦</li><li>Flexibleå…è®¸å®ƒçš„å­æ§ä»¶å…·æœ‰ä¸Flexibleç›¸åŒæˆ–æ›´å°çš„å®½åº¦ï¼Œè€ŒExpandedåˆ™å¼ºåˆ¶å®ƒçš„å­æ§ä»¶å…·æœ‰ä¸Expandedå®Œå…¨ç›¸åŒçš„å®½åº¦</li></ul></li><li>Scaffold<ul><li>é€šè¿‡<code>SizedBox.expand</code>åŒ…è£¹å­widgetï¼Œå¯ä»¥è®©å­widgetä¸Scaffoldæœ‰ç›¸åŒçš„å¤§å°</li></ul></li></ul><h4 id="æ¾ç´§çº¦æŸ-Tight-Loose-Constraints"><a href="#æ¾ç´§çº¦æŸ-Tight-Loose-Constraints" class="headerlink" title="æ¾ç´§çº¦æŸ(Tight Loose Constraints)"></a>æ¾ç´§çº¦æŸ(Tight Loose Constraints)</h4><ul><li>Tight Constraints<ul><li>æœ€å¤§å®½åº¦&#x3D;æœ€å°å®½åº¦, æœ€å¤§é•¿åº¦&#x3D;æœ€å°é•¿åº¦</li></ul></li><li>Losse Constraints<ul><li>æœ€å°å®½åº¦ &#x3D; 0, æœ€å°é•¿åº¦ &#x3D; 0</li><li>æœ€å¤§å®½åº¦ !&#x3D; 0, æœ€å¤§é•¿åº¦ !&#x3D; 0</li><li><blockquote><p>Centerå°±æ˜¯æŠŠæ”¶åˆ°çš„tightçº¦æŸè½¬æ¢æˆlooseçº¦æŸ</p></blockquote></li></ul></li></ul><h4 id="æ— é™çº¦æŸ-unbounded-constraint"><a href="#æ— é™çº¦æŸ-unbounded-constraint" class="headerlink" title="æ— é™çº¦æŸ(unbounded constraint)"></a>æ— é™çº¦æŸ(unbounded constraint)</h4><ul><li>æœ€å¤§å®½åº¦ &#x3D; double.infinite, æœ€å¤§é•¿åº¦ &#x3D; double.infinite</li><li>ä¸€èˆ¬æƒ…å†µä¸‹ä¼šå¯¼è‡´consoleä¸­å‡ºç°error</li><li>ç”¨äºListViewç­‰ScrollViewçš„å­ç±»<ul><li>æ»‘åŠ¨æ–¹å‘ä¸Šçš„é•¿&#x2F;å®½æ— é™</li></ul></li></ul><h4 id="Flex"><a href="#Flex" class="headerlink" title="Flex"></a>Flex</h4><ul><li>Flex Box(Row æˆ– Column)</li><li>è‹¥ä¸»è½´ä¸Šæ‹¥æœ‰æœ‰é™çº¦æŸï¼Œåˆ™ç»å¯èƒ½çš„å¤§</li><li>è‹¥ä¸»è½´ä¸Šæ‹¥æœ‰æ— é™çº¦æŸï¼Œæ¯ä¸ªå­©å­çš„flexå€¼å¿…é¡»ä¸º0ï¼Œä¹Ÿå°±æ˜¯ä¸èƒ½åœ¨å¯æ»‘åŠ¨widgetæˆ–flex boxä¸­ä½¿ç”¨Expand</li><li>äº¤å‰è½´æ–¹å‘ä¸èƒ½æ— é™ï¼Œå¦åˆ™æ— æ³•align children</li></ul><h3 id="Stack"><a href="#Stack" class="headerlink" title="Stack"></a>Stack</h3><ul><li><p>å¸¸è§å±æ€§</p><ul><li>alignment<ul><li>ä¼ å…¥åæ ‡å€¼<ul><li>åŸç‚¹åœ¨widgetä¸­å¿ƒ</li><li>æ°´å¹³å‘å³ä¸ºxè½´ï¼Œx&#x3D;[-1, 1] ä»å·¦åˆ°å³</li><li>ç«–ç›´å‘ä¸‹ä¸ºyè½´ï¼Œy&#x3D;[-1, 1] ä»ä¸Šåˆ°ä¸‹</li></ul></li></ul></li><li>fit<ul><li>ä¼ å…¥StackFit</li><li>å€¼æœ‰: loose, expand, passthrough</li></ul></li><li>overflow<ul><li>ç©ºé—´æº¢å‡ºçš„æ“ä½œ: clip &#x2F; visible</li></ul></li></ul></li><li><p>position</p><ul><li>ä¸€ä¸ªwidget, å’Œstackæ­é…ä½¿ç”¨</li><li>ç¡®å®šstackä¸­å­widgetçš„ä½ç½®</li></ul></li></ul><blockquote><p>ContaineråŒ…æ‹¬äº†: SizedBox, Center, Padding, DecoratedBox, ConstrainedBoxçš„åŠŸèƒ½</p></blockquote><h2 id="StateFull-StateLess"><a href="#StateFull-StateLess" class="headerlink" title="StateFull&#x2F;StateLess"></a>StateFull&#x2F;StateLess</h2><ul><li>didUpdatedWidget<ul><li>widgetå‚æ•°å‘ç”Ÿæ”¹å˜æ—¶è§¦å‘</li></ul></li></ul><h2 id="Animation"><a href="#Animation" class="headerlink" title="Animation"></a>Animation</h2><h2 id="InheritedWidget"><a href="#InheritedWidget" class="headerlink" title="InheritedWidget"></a>InheritedWidget</h2><ul><li>ofæ–¹æ³•ï¼Œä»å½“å‰widgetå‘ä¸ŠæŸ¥æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°è¯¥ç±»å‹çš„ä¸ªWidget<ul><li>ä¸å…è®¸åœ¨initStateè°ƒç”¨ofæ–¹æ³•</li></ul></li></ul><h3 id="è‡ªä¸Šè€Œä¸‹ä¼ é€’çŠ¶æ€"><a href="#è‡ªä¸Šè€Œä¸‹ä¼ é€’çŠ¶æ€" class="headerlink" title="è‡ªä¸Šè€Œä¸‹ä¼ é€’çŠ¶æ€"></a>è‡ªä¸Šè€Œä¸‹ä¼ é€’çŠ¶æ€</h3><h4 id="åœ¨çˆ¶widgetä¸­"><a href="#åœ¨çˆ¶widgetä¸­" class="headerlink" title="åœ¨çˆ¶widgetä¸­"></a>åœ¨çˆ¶widgetä¸­</h4><ul><li>updateShouldNotify<ul><li>æ˜¯å¦å‘ä¸‹ä¼ é€’å˜åŒ–</li></ul></li></ul><h4 id="åœ¨å­widgetä¸­"><a href="#åœ¨å­widgetä¸­" class="headerlink" title="åœ¨å­widgetä¸­"></a>åœ¨å­widgetä¸­</h4><ul><li>didChangeDepandencies<ul><li>çŠ¶æ€åŒæ­¥</li><li>è‹¥ä¸€ä¸ªå­widgeté€šè¿‡ofè·å–è¿‡æˆ‘çš„å±æ€§ï¼Œé‚£ä¹ˆæˆ‘çš„å±æ€§å˜åŒ–æ—¶ï¼Œéƒ½ä¼šé‡æ–°buildè¿™äº›å­widget</li><li>åœ¨é‡æ–°buildä¹‹å‰ï¼Œä¼šè§¦å‘didChangeDepandencies</li><li>initStateåä¹Ÿä¼šè°ƒç”¨ä¸€æ¬¡didChangeDepandencies</li></ul></li></ul><h3 id="è‡ªä¸‹è€Œä¸Šçš„æ¶ˆæ¯ä¼ é€’"><a href="#è‡ªä¸‹è€Œä¸Šçš„æ¶ˆæ¯ä¼ é€’" class="headerlink" title="è‡ªä¸‹è€Œä¸Šçš„æ¶ˆæ¯ä¼ é€’"></a>è‡ªä¸‹è€Œä¸Šçš„æ¶ˆæ¯ä¼ é€’</h3><p>çˆ¶widgetç”¨<code>NotificationListener&lt;XXXNotification&gt;</code>åŒ…è£…<br>å­widgetä¸­éœ€è¦ä¼ é€’æ¶ˆæ¯æ—¶ï¼Œåˆ›å»ºä¸€ä¸ª<code>XXXNotification</code>ï¼Œå¹¶è°ƒç”¨dispatch</p><h2 id="é¡µé¢è·³è½¬"><a href="#é¡µé¢è·³è½¬" class="headerlink" title="é¡µé¢è·³è½¬"></a>é¡µé¢è·³è½¬</h2><p>Navigator</p><ul><li>push(Widget)<ul><li>widgetæ ˆä¸­åŠ å…¥ä¸€ä¸ªwidget</li></ul></li><li>pop<ul><li>å¼¹å‡ºä¸€ä¸ªwidget</li></ul></li></ul>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;flutter&quot;&gt;&lt;a href=&quot;#flutter&quot; class=&quot;headerlink&quot; title=&quot;flutter&quot;&gt;&lt;/a&gt;flutter&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;everything is a widget&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;widget&quot;&gt;&lt;a href=&quot;#widget&quot; class=&quot;headerlink&quot; title=&quot;widget&quot;&gt;&lt;/a&gt;widget&lt;/h2&gt;&lt;p&gt;åœ¨flutterä¸­ï¼Œæ‰€æœ‰çœ‹å¾—è§çš„çœ‹ä¸è§çš„ä¸œè¥¿éƒ½æ˜¯widget&lt;/p&gt;
&lt;h2 id=&quot;ç›®å½•ç»“æ„&quot;&gt;&lt;a href=&quot;#ç›®å½•ç»“æ„&quot; class=&quot;headerlink&quot; title=&quot;ç›®å½•ç»“æ„&quot;&gt;&lt;/a&gt;ç›®å½•ç»“æ„&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;android:&lt;/li&gt;
&lt;li&gt;ios:&lt;/li&gt;
&lt;li&gt;lib: dartæ–‡ä»¶ï¼Œä¸šåŠ¡é€»è¾‘&lt;/li&gt;
&lt;li&gt;lib&amp;#x2F;main.dart: å…¥å£&lt;/li&gt;
&lt;li&gt;pubspec.yaml: å·¥ç¨‹ä¿¡æ¯ä»¥åŠä¾èµ–&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="Android" scheme="https://jingtianer.github.io/home/categories/Android/"/>
    
    
    <category term="Flutter" scheme="https://jingtianer.github.io/home/tags/Flutter/"/>
    
  </entry>
  
  <entry>
    <title>22-Gradle</title>
    <link href="https://jingtianer.github.io/home/2024/04/23/Android%E9%AB%98%E7%BA%A7/Android%20%E9%AB%98%E7%BA%A7%E5%BC%80%E5%8F%91%E7%93%B6%E9%A2%88%E7%AA%81%E7%A0%B4%E7%B3%BB%E5%88%97%E8%AF%BE/22Gradle/"/>
    <id>https://jingtianer.github.io/home/2024/04/23/Android%E9%AB%98%E7%BA%A7/Android%20%E9%AB%98%E7%BA%A7%E5%BC%80%E5%8F%91%E7%93%B6%E9%A2%88%E7%AA%81%E7%A0%B4%E7%B3%BB%E5%88%97%E8%AF%BE/22Gradle/</id>
    <published>2024-04-23T13:15:36.000Z</published>
    <updated>2025-04-15T02:37:55.586Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æ ¸å¿ƒæ¦‚å¿µ"><a href="#æ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="æ ¸å¿ƒæ¦‚å¿µ"></a>æ ¸å¿ƒæ¦‚å¿µ</h2><ul><li>é¡¹ç›®<ul><li>Gradleé¡¹ç›®æ˜¯ä¸€ä¸ªå¯ä»¥æ„å»ºçš„è½¯ä»¶ï¼Œä¾‹å¦‚åº”ç”¨ç¨‹åºæˆ–åº“ã€‚</li><li>åŒ…æ‹¬ä¸€ä¸ª<code>æ ¹é¡¹ç›®</code>å’Œä»»æ„æ•°é‡çš„<code>å­é¡¹ç›®</code>ã€‚</li></ul></li><li>æ„å»ºè„šæœ¬<ul><li>æ„å»ºè„šæœ¬å‘ Gradle è¯¦ç»†ä»‹ç»äº†æ„å»ºé¡¹ç›®æ‰€éœ€é‡‡å–çš„æ­¥éª¤ã€‚</li><li>æ¯ä¸ªé¡¹ç›®å¯ä»¥åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªæ„å»ºè„šæœ¬ã€‚</li></ul></li><li>ä¾èµ–ç®¡ç†<ul><li>ä¾èµ–ç®¡ç†æ˜¯ä¸€ç§ç”¨äºå£°æ˜å’Œè§£æé¡¹ç›®æ‰€éœ€çš„å¤–éƒ¨èµ„æºçš„è‡ªåŠ¨åŒ–æŠ€æœ¯ã€‚</li><li>æ¯ä¸ªé¡¹ç›®é€šå¸¸éƒ½åŒ…å«è®¸å¤šå¤–éƒ¨ä¾èµ–é¡¹ï¼ŒGradle å°†åœ¨æ„å»ºè¿‡ç¨‹ä¸­è§£å†³è¿™äº›ä¾èµ–é¡¹ã€‚</li></ul></li><li>ä»»åŠ¡<ul><li>ä»»åŠ¡æ˜¯åŸºæœ¬çš„å·¥ä½œå•å…ƒï¼Œä¾‹å¦‚ç¼–è¯‘ä»£ç æˆ–è¿è¡Œæµ‹è¯•ã€‚</li><li>æ¯ä¸ªé¡¹ç›®éƒ½åŒ…å«åœ¨æ„å»ºè„šæœ¬æˆ–æ’ä»¶ä¸­å®šä¹‰çš„ä¸€ä¸ªæˆ–å¤šä¸ªä»»åŠ¡ã€‚</li></ul></li><li>æ’ä»¶<ul><li>æ’ä»¶ç”¨äºæ‰©å±• Gradle çš„åŠŸèƒ½ï¼Œå¹¶å¯é€‰æ‹©å‘é¡¹ç›®è´¡çŒ®ä»»åŠ¡ã€‚</li></ul></li></ul><h2 id="Gradle-é¡¹ç›®ç»“æ„"><a href="#Gradle-é¡¹ç›®ç»“æ„" class="headerlink" title="Gradle é¡¹ç›®ç»“æ„"></a>Gradle é¡¹ç›®ç»“æ„</h2><table><thead><tr><th>æ–‡ä»¶&#x2F;ç›®å½•åç§°</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>gradlew&#x2F;gradlew.bat</td><td>Gradle åŒ…è£…è„šæœ¬</td></tr><tr><td>build.gradle(.kts)</td><td>é¡¹ç›®çš„ Gradle æ„å»ºè„šæœ¬</td></tr><tr><td>settings.gradle(.kts)</td><td>Gradle è®¾ç½®æ–‡ä»¶ç”¨äºå®šä¹‰æ ¹é¡¹ç›®åç§°å’Œå­é¡¹ç›®</td></tr><tr><td>src</td><td>é¡¹ç›®&#x2F;å­é¡¹ç›®çš„æºç ã€èµ„æº</td></tr></tbody></table><h2 id="ä½¿ç”¨gradle-gradlewç¼–è¯‘"><a href="#ä½¿ç”¨gradle-gradlewç¼–è¯‘" class="headerlink" title="ä½¿ç”¨gradle&#x2F;gradlewç¼–è¯‘"></a>ä½¿ç”¨gradle&#x2F;gradlewç¼–è¯‘</h2><ul><li><p>ç¼–è¯‘</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./gradlew build</span><br></pre></td></tr></table></figure></li><li><p>ç¼–è¯‘å•ä¸ªä»»åŠ¡</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./gradlew :taskname</span><br><span class="line">./gradlew taskname</span><br></pre></td></tr></table></figure><blockquote><p>ç¼–è¯‘å•ä¸ªä»»åŠ¡ä»¥åŠå…¨éƒ¨ä¾èµ–</p></blockquote></li><li><p>ç¼–è¯‘å¤šé¡¹ç›®å·¥ç¨‹ä¸­çš„ä»»åŠ¡</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./gradlew :subproject:taskName</span><br><span class="line">./gradlew subproject:taskName</span><br></pre></td></tr></table></figure><blockquote><p><code>:</code>ç›¸å½“äºåˆ†éš”ç¬¦ï¼Œç¬¬ä¸€ä¸ªå†’å·å¯ä»¥çœç•¥</p></blockquote></li><li><p>æ¸…ç†äº§ç‰©</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./gradlew clean</span><br></pre></td></tr></table></figure></li><li><p>æ‰§è¡Œå¤šä¸ªä»»åŠ¡</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./gradlew clean build</span><br></pre></td></tr></table></figure></li></ul><h2 id="settings-gradle"><a href="#settings-gradle" class="headerlink" title="settings.gradle"></a>settings.gradle</h2><ul><li>å•å·¥ç¨‹: optional</li><li>å¤šå·¥ç¨‹: mandatory<ul><li>è¦å£°æ˜æ‰€æœ‰å­å·¥ç¨‹</li></ul></li></ul><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">rootProject.name = <span class="string">&#x27;root-project&#x27;</span>   </span><br><span class="line"><span class="comment">// å®šä¹‰å·¥ç¨‹å</span></span><br><span class="line">include(<span class="string">&#x27;sub-project-a&#x27;</span>)            </span><br><span class="line">include(<span class="string">&#x27;sub-project-b&#x27;</span>)</span><br><span class="line">include(<span class="string">&#x27;sub-project-c&#x27;</span>)</span><br><span class="line"><span class="comment">// å£°æ˜å­å·¥ç¨‹</span></span><br></pre></td></tr></table></figure><h3 id="Settingså¯¹è±¡"><a href="#Settingså¯¹è±¡" class="headerlink" title="Settingså¯¹è±¡"></a>Settingså¯¹è±¡</h3><h4 id="Settingså¯¹è±¡çš„å±æ€§"><a href="#Settingså¯¹è±¡çš„å±æ€§" class="headerlink" title="Settingså¯¹è±¡çš„å±æ€§"></a>Settingså¯¹è±¡çš„å±æ€§</h4><ul><li>buildCache: ç¼–è¯‘ç¼“å­˜é…ç½®</li><li>plugins: åº”ç”¨è¯¥è®¾ç½®çš„æ’ä»¶</li><li>rootDir: ç¼–è¯‘çš„æ ¹ç›®å½•, æ ¹é¡¹ç›®çš„ç›®å½•</li><li>rootProject: æ ¹é¡¹ç›®</li><li>settings: å½“å‰Settingså¯¹è±¡</li></ul><h4 id="Settingså¯¹è±¡çš„æ–¹æ³•"><a href="#Settingså¯¹è±¡çš„æ–¹æ³•" class="headerlink" title="Settingså¯¹è±¡çš„æ–¹æ³•"></a>Settingså¯¹è±¡çš„æ–¹æ³•</h4><ul><li>include(): å®šä¹‰è‡ªé¡¹ç›®</li><li>includeBuild(): çœ‹ä¸æ‡‚</li></ul>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;æ ¸å¿ƒæ¦‚å¿µ&quot;&gt;&lt;a href=&quot;#æ ¸å¿ƒæ¦‚å¿µ&quot; class=&quot;headerlink&quot; title=&quot;æ ¸å¿ƒæ¦‚å¿µ&quot;&gt;&lt;/a&gt;æ ¸å¿ƒæ¦‚å¿µ&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;é¡¹ç›®&lt;ul&gt;
&lt;li&gt;Gradleé¡¹ç›®æ˜¯ä¸€ä¸ªå¯ä»¥æ„å»ºçš„è½¯ä»¶ï¼Œä¾‹å¦‚åº”ç”¨ç¨‹åºæˆ–åº“ã€‚&lt;/li&gt;
&lt;li&gt;åŒ…æ‹¬ä¸€ä¸ª&lt;code&gt;æ ¹é¡¹ç›®&lt;/code&gt;å’Œä»»æ„æ•°é‡çš„&lt;code&gt;å­é¡¹ç›®&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æ„å»ºè„šæœ¬&lt;ul&gt;
&lt;li&gt;æ„å»ºè„šæœ¬å‘ Gradle è¯¦ç»†ä»‹ç»äº†æ„å»ºé¡¹ç›®æ‰€éœ€é‡‡å–çš„æ­¥éª¤ã€‚&lt;/li&gt;
&lt;li&gt;æ¯ä¸ªé¡¹ç›®å¯ä»¥åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªæ„å»ºè„šæœ¬ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ä¾èµ–ç®¡ç†&lt;ul&gt;
&lt;li&gt;ä¾èµ–ç®¡ç†æ˜¯ä¸€ç§ç”¨äºå£°æ˜å’Œè§£æé¡¹ç›®æ‰€éœ€çš„å¤–éƒ¨èµ„æºçš„è‡ªåŠ¨åŒ–æŠ€æœ¯ã€‚&lt;/li&gt;
&lt;li&gt;æ¯ä¸ªé¡¹ç›®é€šå¸¸éƒ½åŒ…å«è®¸å¤šå¤–éƒ¨ä¾èµ–é¡¹ï¼ŒGradle å°†åœ¨æ„å»ºè¿‡ç¨‹ä¸­è§£å†³è¿™äº›ä¾èµ–é¡¹ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ä»»åŠ¡&lt;ul&gt;
&lt;li&gt;ä»»åŠ¡æ˜¯åŸºæœ¬çš„å·¥ä½œå•å…ƒï¼Œä¾‹å¦‚ç¼–è¯‘ä»£ç æˆ–è¿è¡Œæµ‹è¯•ã€‚&lt;/li&gt;
&lt;li&gt;æ¯ä¸ªé¡¹ç›®éƒ½åŒ…å«åœ¨æ„å»ºè„šæœ¬æˆ–æ’ä»¶ä¸­å®šä¹‰çš„ä¸€ä¸ªæˆ–å¤šä¸ªä»»åŠ¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æ’ä»¶&lt;ul&gt;
&lt;li&gt;æ’ä»¶ç”¨äºæ‰©å±• Gradle çš„åŠŸèƒ½ï¼Œå¹¶å¯é€‰æ‹©å‘é¡¹ç›®è´¡çŒ®ä»»åŠ¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;Gradle-é¡¹ç›®ç»“æ„&quot;&gt;&lt;a href=&quot;#Gradle-é¡¹ç›®ç»“æ„&quot; class=&quot;headerlink&quot; title=&quot;Gradle é¡¹ç›®ç»“æ„&quot;&gt;&lt;/a&gt;Gradle é¡¹ç›®ç»“æ„&lt;/h2&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æ–‡ä»¶&amp;#x2F;ç›®å½•åç§°&lt;/th&gt;
&lt;th&gt;ä½œç”¨&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;gradlew&amp;#x2F;gradlew.bat&lt;/td&gt;
&lt;td&gt;Gradle åŒ…è£…è„šæœ¬&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;build.gradle(.kts)&lt;/td&gt;
&lt;td&gt;é¡¹ç›®çš„ Gradle æ„å»ºè„šæœ¬&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;settings.gradle(.kts)&lt;/td&gt;
&lt;td&gt;Gradle è®¾ç½®æ–‡ä»¶ç”¨äºå®šä¹‰æ ¹é¡¹ç›®åç§°å’Œå­é¡¹ç›®&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;src&lt;/td&gt;
&lt;td&gt;é¡¹ç›®&amp;#x2F;å­é¡¹ç›®çš„æºç ã€èµ„æº&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;h2 id=&quot;ä½¿ç”¨gradle-gradlewç¼–è¯‘&quot;&gt;&lt;a href=&quot;#ä½¿ç”¨gradle-gradlewç¼–è¯‘&quot; class=&quot;headerlink&quot; title=&quot;ä½¿ç”¨gradle&amp;#x2F;gradlewç¼–è¯‘&quot;&gt;&lt;/a&gt;ä½¿ç”¨gradle&amp;#x2F;gradlewç¼–è¯‘&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;p&gt;ç¼–è¯‘&lt;/p&gt;
&lt;figure class=&quot;highlight sh&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;./gradlew build&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;ç¼–è¯‘å•ä¸ªä»»åŠ¡&lt;/p&gt;
&lt;figure class=&quot;highlight sh&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;./gradlew :taskname&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;./gradlew taskname&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;blockquote&gt;
&lt;p&gt;ç¼–è¯‘å•ä¸ªä»»åŠ¡ä»¥åŠå…¨éƒ¨ä¾èµ–&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;ç¼–è¯‘å¤šé¡¹ç›®å·¥ç¨‹ä¸­çš„ä»»åŠ¡&lt;/p&gt;
&lt;figure class=&quot;highlight sh&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;./gradlew :subproject:taskName&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;./gradlew subproject:taskName&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;code&gt;:&lt;/code&gt;ç›¸å½“äºåˆ†éš”ç¬¦ï¼Œç¬¬ä¸€ä¸ªå†’å·å¯ä»¥çœç•¥&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;æ¸…ç†äº§ç‰©&lt;/p&gt;
&lt;figure class=&quot;highlight sh&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;./gradlew clean&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;æ‰§è¡Œå¤šä¸ªä»»åŠ¡&lt;/p&gt;
&lt;figure class=&quot;highlight sh&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;./gradlew clean build&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="Android" scheme="https://jingtianer.github.io/home/categories/Android/"/>
    
    <category term="gradle" scheme="https://jingtianer.github.io/home/categories/Android/gradle/"/>
    
    
    <category term="Android" scheme="https://jingtianer.github.io/home/tags/Android/"/>
    
    <category term="gradle" scheme="https://jingtianer.github.io/home/tags/gradle/"/>
    
  </entry>
  
  <entry>
    <title>gallery</title>
    <link href="https://jingtianer.github.io/home/2024/04/23/gallery/index/"/>
    <id>https://jingtianer.github.io/home/2024/04/23/gallery/index/</id>
    <published>2024-04-22T16:38:11.000Z</published>
    <updated>2025-04-15T02:37:55.619Z</updated>
    
    <content type="html"><![CDATA[<head>    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.js"></script>    <script src="https://cdnjs.cloudflare.com/ajax/libs/galleria/1.5.7/galleria.min.js"></script></head><style>    .galleria{         width: 100%;         height: 100vh;     }</style><div class="galleria">    <img src="/home/images/gallery/gallery9.jpeg">    <img src="/home/images/gallery/gallery13.jpeg">    <img src="/home/images/gallery/gallery14.jpeg">    <img src="/home/images/gallery/gallery15.jpeg">    <img src="/home/images/gallery/gallery16.jpeg">    <img src="/home/images/gallery/gallery17.jpeg">    <img src="/home/images/gallery/gallery18.jpeg">    <img src="/home/images/gallery/gallery19.jpeg">    <img src="/home/images/gallery/gallery20.jpeg">    <img src="/home/images/gallery/gallery21.jpeg">    <img src="/home/images/gallery/gallery8.jpeg">    <img src="/home/images/gallery/gallery22.jpeg">    <img src="/home/images/gallery/gallery24.jpeg">    <img src="/home/images/gallery/gallery23.jpeg">    <img src="/home/images/gallery/gallery27.jpeg">    <img src="/home/images/gallery/gallery28.jpeg">    <img src="/home/images/gallery/gallery29.jpeg">    <img src="/home/images/gallery/gallery30.jpeg">    <img src="/home/images/gallery/gallery12.jpeg">    <img src="/home/images/gallery/gallery31.png">    <img src="/home/images/gallery/gallery25.jpeg">    <img src="/home/images/gallery/gallery26.jpeg">    <img src="/home/images/gallery/gallery10.jpeg">    <img src="/home/images/gallery/gallery11.jpeg">    <img src="/home/images/gallery/gallery1.jpeg">    <img src="/home/images/gallery/gallery2.jpeg">    <img src="/home/images/gallery/gallery3.jpeg">    <img src="/home/images/gallery/gallery4.jpeg">    <img src="/home/images/gallery/gallery32.jpeg">    <img src="/home/images/gallery/gallery5.jpeg">    <img src="/home/images/gallery/gallery6.jpeg">    <img src="/home/images/gallery/gallery7.jpeg"></div><script>(function() {    Galleria.loadTheme('https://cdnjs.cloudflare.com/ajax/libs/galleria/1.5.7/themes/classic/galleria.classic.min.js');    Galleria.run('.galleria', {        extend: function() {            var gallery = this; // "this" is the gallery instance            $('.galleria').click(function() {                console.log("click");                gallery.playToggle(1000).toggleFullscreen(); // call the play method            });        }    });}());</script>]]></content>
    
    
      
      
    <summary type="html">&lt;head&gt;
    &lt;script src=&quot;https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.js&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;https://cdnjs.cloudflare.com/aj</summary>
      
    
    
    
    <category term="gallery" scheme="https://jingtianer.github.io/home/categories/gallery/"/>
    
    
    <category term="gallery" scheme="https://jingtianer.github.io/home/tags/gallery/"/>
    
  </entry>
  
  <entry>
    <title>ç‰›å®¢åˆ·é¢˜-1</title>
    <link href="https://jingtianer.github.io/home/2024/03/27/%E7%89%9B%E5%AE%A2/%E7%89%9B%E5%AE%A2%E5%88%B7%E9%A2%98-1/"/>
    <id>https://jingtianer.github.io/home/2024/03/27/%E7%89%9B%E5%AE%A2/%E7%89%9B%E5%AE%A2%E5%88%B7%E9%A2%98-1/</id>
    <published>2024-03-27T13:15:36.000Z</published>
    <updated>2025-04-15T02:37:55.628Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å°ç±³2019ç§‹æ‹›å®‰å“å¼€å‘ç¬”è¯•é¢˜ï¼ˆBï¼‰"><a href="#å°ç±³2019ç§‹æ‹›å®‰å“å¼€å‘ç¬”è¯•é¢˜ï¼ˆBï¼‰" class="headerlink" title="å°ç±³2019ç§‹æ‹›å®‰å“å¼€å‘ç¬”è¯•é¢˜ï¼ˆBï¼‰"></a>å°ç±³2019ç§‹æ‹›å®‰å“å¼€å‘ç¬”è¯•é¢˜ï¼ˆBï¼‰</h2><h3 id="21-æœ€å°‘ç«‹æ–¹æ•°ä¹‹å’Œ"><a href="#21-æœ€å°‘ç«‹æ–¹æ•°ä¹‹å’Œ" class="headerlink" title="21. æœ€å°‘ç«‹æ–¹æ•°ä¹‹å’Œ"></a>21. æœ€å°‘ç«‹æ–¹æ•°ä¹‹å’Œ</h3><p>ç»™å‡ºä¸€ä¸ªæ•°å­—Nï¼ˆ<code>0&lt;N&lt;1000000</code>ï¼‰,å°†Nå†™æˆç«‹æ–¹æ•°å’Œçš„å½¢å¼ï¼Œæ±‚å‡ºéœ€è¦çš„æœ€å°‘ç«‹æ–¹æ•°ä¸ªæ•°ã€‚<br>ä¾‹å¦‚N&#x3D;17ï¼Œ1+8+8 &#x3D; 17ï¼Œæœ€å°‘éœ€è¦3ä¸ªç«‹æ–¹æ•°ï¼Œåˆ™è¾“å‡º3ã€‚<br>N&#x3D; 28,1+1+1+1+8+8+8&#x3D;28, éœ€è¦7ä¸ªç«‹æ–¹æ•°ï¼Œ1+27&#x3D;28,éœ€è¦2ä¸ªç«‹æ–¹æ•°ï¼Œæ‰€ä»¥æœ€å°‘ç«‹æ–¹æ•°ä¸º2ï¼Œåˆ™è¾“å‡º2ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// æ³¨æ„ç±»åå¿…é¡»ä¸º Main, ä¸è¦æœ‰ä»»ä½• package xxx ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> List&lt;Integer&gt; cubs;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> cubNum;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        cubs = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Integer&gt;();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i*i*i &lt;= <span class="number">1000000</span>; i++) &#123;</span><br><span class="line">            cubs.add(i*i*i);</span><br><span class="line">        &#125;</span><br><span class="line">        cubNum = cubs.size();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">in</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        <span class="comment">// æ³¨æ„ hasNext å’Œ hasNextLine çš„åŒºåˆ«</span></span><br><span class="line">        <span class="keyword">while</span> (in.hasNextInt()) &#123; <span class="comment">// æ³¨æ„ while å¤„ç†å¤šä¸ª case</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> in.nextInt();</span><br><span class="line">            <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> Collections.binarySearch(cubs, n);</span><br><span class="line">            <span class="keyword">if</span>(index &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                index = -index - <span class="number">2</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(index &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;unreachable&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">int</span>[] dp = <span class="keyword">new</span> <span class="title class_">int</span>[n+<span class="number">1</span>];</span><br><span class="line">            Arrays.fill(dp, Integer.MAX_VALUE);</span><br><span class="line">            dp[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">1</span>; j &lt;= index+<span class="number">1</span>; j++) &#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> cubs.get(j-<span class="number">1</span>); i &lt;= n; i++) &#123;</span><br><span class="line">                    dp[i] = Math.min(dp[i], dp[i - cubs.get(j-<span class="number">1</span>)] + <span class="number">1</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(dp[n]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®Œå…¨èƒŒåŒ…ï¼Œä»æ‰€æœ‰ç«‹æ–¹æ•°é‡Œé€‰æ•°ï¼Œå–æ•°ç›®æœ€å°çš„æƒ…å†µ</p><h3 id="èµ„äº§åŒ…æ‰“åŒ…"><a href="#èµ„äº§åŒ…æ‰“åŒ…" class="headerlink" title="èµ„äº§åŒ…æ‰“åŒ…"></a>èµ„äº§åŒ…æ‰“åŒ…</h3><p>åœ¨é‡‘èèµ„äº§äº¤æ˜“ä¸­ï¼Œç»å¸¸æ¶‰åŠåˆ°èµ„äº§åŒ…çš„æŒ‘é€‰æ‰“åŒ…ã€‚åœ¨èµ„äº§åŒ…æ‰“åŒ…è¿‡ç¨‹ä¸­ï¼Œæ¯ç§ç±»å‹çš„èµ„äº§æœ‰å›ºå®šçš„æ•°é‡ä¸ä»·å€¼ï¼Œéœ€é€‰æ‹©æŸå‡ ç§èµ„äº§æ‰“åŒ…ï¼Œä½¿å¾—èµ„äº§åŒ…æ€»ä»·å€¼æœ€å¤§ã€‚æ‰“åŒ…æ—¶æ¯ç§èµ„äº§åªèƒ½æ•´ä½“æ‰“åŒ…ï¼Œä¸èƒ½åˆ†å‰²ã€‚å‡è®¾ç°æœ‰å¯å®¹çº³Mæ¡èµ„äº§çš„èµ„äº§åŒ…ï¼Œå¦å¤–æœ‰Nç§èµ„äº§ã€‚èµ„äº§Naæ•°é‡ä¸ºTaæ¡ï¼Œæ€»ä»·å€¼ä¸ºVaå…ƒï¼›èµ„äº§Nbæ•°é‡ä¸ºTbæ¡ï¼Œæ€»ä»·å€¼ä¸ºVbå…ƒï¼›èµ„äº§Ncæ•°é‡ä¸ºTcæ¡ï¼Œæ€»ä»·å€¼ä¸ºVcå…ƒâ€¦â€¦ï¼›èµ„äº§Nnæ•°é‡ä¸ºTnï¼Œæ€»ä»·å€¼ä¸ºVnã€‚ç¼–å†™ç®—æ³•ï¼ŒæŒ‘é€‰å“ªäº›ç±»å‹èµ„äº§æ”¾å…¥èµ„äº§åŒ…å¯ä½¿å¾—èµ„äº§åŒ…æ€»ä»·å€¼æœ€å¤§ï¼Ÿ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ³¨æ„ç±»åå¿…é¡»ä¸º Main, ä¸è¦æœ‰ä»»ä½• package xxx ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">in</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        <span class="keyword">while</span> (in.hasNext()) &#123;</span><br><span class="line">            String[] input = in.nextLine().split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">            <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">            <span class="type">int</span> <span class="variable">W</span> <span class="operator">=</span> Integer.parseInt(input[index++], <span class="number">10</span>);</span><br><span class="line">            <span class="type">int</span> <span class="variable">N</span> <span class="operator">=</span> Integer.parseInt(input[index++], <span class="number">10</span>);</span><br><span class="line">            <span class="type">int</span>[][] properties = <span class="keyword">new</span> <span class="title class_">int</span>[N][<span class="number">2</span>];</span><br><span class="line">            String[] weights = input[index++].split(<span class="string">&quot; &quot;</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; N; i++) &#123;</span><br><span class="line">                properties[i][<span class="number">0</span>] = Integer.parseInt(weights[i], <span class="number">10</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            String[] values = input[index++].split(<span class="string">&quot; &quot;</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; N; i++) &#123;</span><br><span class="line">                properties[i][<span class="number">1</span>] = Integer.parseInt(values[i], <span class="number">10</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">int</span>[] dp = <span class="keyword">new</span> <span class="title class_">int</span>[W + <span class="number">1</span>];</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= N; i++) &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> W; j &gt;= properties[i - <span class="number">1</span>][<span class="number">0</span>]; j--) &#123;</span><br><span class="line">                    dp[j] = Math.max(dp[j],</span><br><span class="line">                                        dp[j - properties[i - <span class="number">1</span>][<span class="number">0</span>]] + properties[i - <span class="number">1</span>][<span class="number">1</span>]);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(dp[W]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>0-1èƒŒåŒ…ï¼Œè¦æ³¨æ„0-1èƒŒåŒ…å’Œå®Œå…¨èƒŒåŒ…çš„åŒºåˆ«</p></blockquote><ul><li>æ— å‹ç¼©æƒ…å†µ<ul><li>0-1èƒŒåŒ…è½¬ç§»æ–¹ç¨‹ä¸ºï¼š<ul><li><code>dp[i][j] = max(dp[i][j], dp[i-1][j-wi]+vi)</code> (å½“j &gt;&#x3D; wiæ—¶)</li><li><code>dp[i][j] = dp[i][j]</code> (å½“j &lt; wiæ—¶)</li></ul></li><li>å®Œå…¨èƒŒåŒ…è½¬ç§»æ–¹ç¨‹ä¸ºï¼š<ul><li><code>dp[i][j] = max(dp[i][j], dp[i][j-wi]+vi)</code> (å½“j &gt;&#x3D; wiæ—¶) <strong>è¿™é‡Œæ˜¯dp[i]</strong></li><li><code>dp[i][j] = dp[i][j]</code> (å½“j &lt; wiæ—¶)</li></ul></li></ul></li><li>æœ‰å‹ç¼©æƒ…å†µ<ul><li>0-1èƒŒåŒ…å¯¹å®¹é‡æ˜¯é€†å‘éå†</li><li>å®Œå…¨èƒŒåŒ…æ˜¯æ­£å‘éå†</li></ul></li></ul><h3 id="superå’Œthiså…³é”®å­—"><a href="#superå’Œthiså…³é”®å­—" class="headerlink" title="superå’Œthiså…³é”®å­—"></a>superå’Œthiså…³é”®å­—</h3><ul><li>this()å’Œsuper()ä¸å¯ä»¥åŒæ—¶å‡ºç°åœ¨åŒä¸€ä¸ªæ„é€ å‡½æ•°ä¸­</li><li>this()æˆ–super()è¦æ”¾åœ¨æ„é€ å‡½æ•°ç¬¬ä¸€è¡Œ</li></ul><h3 id="Androidæ•°æ®å­˜å‚¨æ–¹å¼"><a href="#Androidæ•°æ®å­˜å‚¨æ–¹å¼" class="headerlink" title="Androidæ•°æ®å­˜å‚¨æ–¹å¼"></a>Androidæ•°æ®å­˜å‚¨æ–¹å¼</h3><ul><li>SharedPreference</li><li>File</li><li>SQLite</li><li>Content Provider</li><li>ç½‘ç»œ</li></ul><blockquote><p>é¢˜ç›®ä¸­è¯´Bundleä¹Ÿå¯ä»¥ï¼Œä½†æ˜¯åº”è¯¥ä¸å¯¹<br>Bundleæ˜¯å¯ä»¥åºåˆ—åŒ–ï¼Œä½†æ˜¯ä¸€èˆ¬ä¸ä½œä¸ºå­˜å‚¨æ•°æ®çš„æ–¹å¼</p></blockquote><h3 id="å¹¿æ’­"><a href="#å¹¿æ’­" class="headerlink" title="å¹¿æ’­"></a>å¹¿æ’­</h3><blockquote><p><strong>Ã—</strong> å½“é™æ€æ³¨å†Œçš„å¹¿æ’­è®¾ç½®çš„ä¼˜å…ˆçº§é«˜äºåŠ¨æ€æ³¨å†Œçš„å¹¿æ’­æ—¶ï¼Œé™æ€æ³¨å†Œå°†å…ˆæ¥æ”¶åˆ°å¹¿æ’­</p></blockquote><ul><li>åŠ¨æ€å¹¿æ’­è·ŸéšActivity&#x2F;Applicationçš„ç”Ÿå‘½å‘¨æœŸï¼Œé™æ€å¹¿æ’­ä¸å—é™åˆ¶ã€‚</li><li>éæœ‰åºå¹¿æ’­çš„æƒ…å†µä¸‹ï¼ŒåŠ¨æ€å¹¿æ’­æ€»æ˜¯è¦ä¼˜å…ˆäºé™æ€å¹¿æ’­</li><li>æ¯æ¬¡å¹¿æ’­è¢«æ¥æ”¶åä¼šé‡æ–°åˆ›å»ºBroadcastReceiverå¯¹è±¡ï¼Œå¹¶åœ¨onReceiveæ–¹æ³•ä¸­æ‰§è¡Œå®Œæ—¶é”€æ¯</li></ul><h3 id="AndroidåŠ¨ç”»åˆ†ç±»"><a href="#AndroidåŠ¨ç”»åˆ†ç±»" class="headerlink" title="AndroidåŠ¨ç”»åˆ†ç±»"></a>AndroidåŠ¨ç”»åˆ†ç±»</h3><h3 id="IntentServiceï¼ˆå·²ç»å¼ƒç”¨ï¼‰"><a href="#IntentServiceï¼ˆå·²ç»å¼ƒç”¨ï¼‰" class="headerlink" title="IntentServiceï¼ˆå·²ç»å¼ƒç”¨ï¼‰"></a>IntentServiceï¼ˆå·²ç»å¼ƒç”¨ï¼‰</h3><ul><li>å¯¹Serviceçš„åŒ…è£…</li><li>é»˜è®¤å®ç°onBindï¼Œè¿”å›null</li><li>åŒ…å«ä¸€ä¸ªHandlerThread(çš„looper)ï¼Œï¼ˆServiceæœ¬èº«ä¸åŒ…æ‹¬çº¿ç¨‹ï¼Œè¿è¡Œåœ¨ä¸»çº¿ç¨‹ï¼‰</li><li>æŒæœ‰ä¸€ä¸ªhandlerï¼Œæ¯æ¬¡startæŠŠintentæ”¾å…¥msgçš„objé‡Œï¼Œç”¨handlerå‘é€</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Deprecated</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">IntentService</span> <span class="keyword">extends</span> <span class="title class_">Service</span> &#123;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">ServiceHandler</span> <span class="keyword">extends</span> <span class="title class_">Handler</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ServiceHandler</span><span class="params">(Looper looper)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(looper);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleMessage</span><span class="params">(Message msg)</span> &#123;</span><br><span class="line">        onHandleIntent((Intent)msg.obj);</span><br><span class="line">        stopSelf(msg.arg1);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WorkerThread</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">onHandleIntent</span><span class="params">(<span class="meta">@Nullable</span> Intent intent)</span>; <span class="comment">//è¿è¡Œåœ¨WorkerThreadä¸­</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onStart</span><span class="params">(<span class="meta">@Nullable</span> Intent intent, <span class="type">int</span> startId)</span> &#123;</span><br><span class="line">    <span class="type">Message</span> <span class="variable">msg</span> <span class="operator">=</span> mServiceHandler.obtainMessage();</span><br><span class="line">    msg.arg1 = startId;</span><br><span class="line">    msg.obj = intent;</span><br><span class="line">    mServiceHandler.sendMessage(msg);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">onStartCommand</span><span class="params">(<span class="meta">@Nullable</span> Intent intent, <span class="type">int</span> flags, <span class="type">int</span> startId)</span> &#123;</span><br><span class="line">    onStart(intent, startId);</span><br><span class="line">    <span class="keyword">return</span> mRedelivery ? START_REDELIVER_INTENT : START_NOT_STICKY;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å°ç±³2019ç§‹æ‹›å®‰å“å¼€å‘ç¬”è¯•é¢˜ï¼ˆAï¼‰"><a href="#å°ç±³2019ç§‹æ‹›å®‰å“å¼€å‘ç¬”è¯•é¢˜ï¼ˆAï¼‰" class="headerlink" title="å°ç±³2019ç§‹æ‹›å®‰å“å¼€å‘ç¬”è¯•é¢˜ï¼ˆAï¼‰"></a>å°ç±³2019ç§‹æ‹›å®‰å“å¼€å‘ç¬”è¯•é¢˜ï¼ˆAï¼‰</h2><h3 id="è¿›åˆ¶é—´è½¬æ¢"><a href="#è¿›åˆ¶é—´è½¬æ¢" class="headerlink" title="è¿›åˆ¶é—´è½¬æ¢"></a>è¿›åˆ¶é—´è½¬æ¢</h3><p>è®¾è®¡ä¸€ä¸ªå‡½æ•°ï¼Œ å¯ä»¥å°†ä»»æ„åè¿›åˆ¶çš„æ•°ï¼Œ è½¬æ¢æˆä»»æ„2åˆ°9çš„è¿›åˆ¶è¡¨ç¤ºçš„å½¢å¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ³¨æ„ç±»åå¿…é¡»ä¸º Main, ä¸è¦æœ‰ä»»ä½• package xxx ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">in</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        <span class="comment">// æ³¨æ„ hasNext å’Œ hasNextLine çš„åŒºåˆ«</span></span><br><span class="line">        <span class="keyword">while</span> (in.hasNext()) &#123; <span class="comment">// æ³¨æ„ while å¤„ç†å¤šä¸ª case</span></span><br><span class="line">            <span class="type">long</span> <span class="variable">n</span> <span class="operator">=</span> in.nextLong();</span><br><span class="line">            <span class="type">int</span> <span class="variable">base</span> <span class="operator">=</span> in.nextInt();</span><br><span class="line">            <span class="keyword">if</span>(n == <span class="number">0</span>) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;0&quot;</span>);</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">            <span class="keyword">while</span>(n &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                sb.append(n % base);</span><br><span class="line">                n /= base;</span><br><span class="line">            &#125;</span><br><span class="line">            sb.reverse();</span><br><span class="line">            System.out.println(sb);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="CCNumber"><a href="#CCNumber" class="headerlink" title="CCNumber"></a>CCNumber</h3><p>CCæœ€è¿‘å¯¹ä¸€ç§æ•´æ•°æ¯”è¾ƒæ„Ÿå…´è¶£ï¼Œæˆ‘ä»¬æš‚ä¸”æŠŠè¿™ç§æ•´æ•°ç§°ä¸ºC Number, C Numberæ˜¯æŒ‡ä¸€ä¸ªæ•´æ•°<br>{C0, C1 â€¦ Cn-1} (C0 &gt; 0 , n &gt;&#x3D; 3)ï¼Œ å­˜åœ¨ä¸€ä¸ªCmï¼ˆ<code>0&lt;m&lt;n-1</code>ï¼‰æ»¡è¶³ä»¥ä¸‹æ¡ä»¶:</p><ul><li>Ci-1 &lt; Ci (<code>0&lt;i&lt;=m</code>), Ciä»£è¡¨è¿™ä¸ªæ•´æ•°ä¸­çš„ç¬¬iä½æ•°å­—</li><li>Ci&gt;Ci+1(<code>m&lt;=i&lt;n-1</code>)</li><li>å¦‚æœä¸€ä¸ªæ•´æ•°é‡Œé¢æœ‰ç›¸é‚»çš„2ä¸ªC Numberçš„è¯ï¼Œæˆ‘ä»¬ç§°è¿™ä¸ªæ•´æ•°ä¸ºCC Numberï¼ˆ2ä¸ªC Numberä¸å¯ä»¥æœ‰å…¬ç”¨çš„æ•°å­—Ciï¼Œå¹¶ä¸”2ä¸ªC Numberè¦ç´§ç´§ç›¸é‚»ï¼‰ã€‚</li></ul><p>è¯·åœ¨[A,B]åŒºé—´å†…æ‰¾å‡ºæ‰¾å‡ºscoreæœ€å¤§çš„CCNumber å¹¶è¾“å‡ºè¿™ä¸ªscore.(scoreï¼šCC Numberä¸­æ‰€æœ‰æ•°å­—çš„å’Œ)</p><h3 id="Activityè·³è½¬"><a href="#Activityè·³è½¬" class="headerlink" title="Activityè·³è½¬"></a>Activityè·³è½¬</h3><p>FirstActivityè·³è½¬åˆ°SecondActivityåï¼Œç„¶åç‚¹å‡»è¿”å›é”®ï¼Œä»¥ä¸‹æ‰§è¡Œé¡ºåºä¸å¯èƒ½å‡ºç°çš„æ˜¯ï¼š</p><p><code>SecondActivityçš„onPause()</code>-&gt;<code>SecondActivityçš„onStop()</code>-&gt;<code>SecondActivityçš„onDestroy()</code>-&gt;<code>FirstActivityçš„onRestart()</code>-&gt;<code>FirstActivityçš„onResume()</code></p><p>ä¸ä¼šåœ¨ä¸‹ä¸€ä¸ªActivityå¯è§å‰ï¼ŒæŠŠå½“å‰Activityå˜æˆä¸å¯è§çš„ï¼Œï¼ˆè¿›å…¥stop&#x2F;destroyï¼‰</p><h3 id="ANR"><a href="#ANR" class="headerlink" title="ANR"></a>ANR</h3><p>inputäº‹ä»¶åœ¨5så†…æ²¡æœ‰å¤„ç†å®Œæˆä¼šå‘ç”ŸANR<br>å‰å°å¹¿æ’­çš„onReceiveå¤„ç†äº‹åŠ¡æ—¶è¶…è¿‡10sä¼šå‘ç”ŸANR<br>åå°Serviceåœ¨200så†…æ²¡æœ‰å¤„ç†å®Œæˆä¼šå‘ç”ŸANR<br>å‰å°Serviceåœ¨20så†…æ²¡æœ‰å¤„ç†å®Œæˆä¼šå‘ç”ŸANR<br>åœ¨Activityä¸­ï¼ŒMainçº¿ç¨‹æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯åœ¨5ç§’å†…æ²¡æœ‰å¾—åˆ°å“åº”</p><h3 id="APPè¿›ç¨‹"><a href="#APPè¿›ç¨‹" class="headerlink" title="APPè¿›ç¨‹"></a>APPè¿›ç¨‹</h3><ul><li>ä¸€ä¸ªAPPå¯ä»¥è¿è¡Œåœ¨å¤šä¸ªè¿›ç¨‹<ul><li>åœ¨Activity&#x2F;Serviceä¸­æ·»åŠ ä¸åŒçš„è¿›ç¨‹å<code>android:process=&quot;processName&quot;</code></li><li>æ¯ä¸ªè¿›ç¨‹ä¼šæœ‰ä¸€ä¸ªApplicationå¯¹è±¡</li></ul></li><li>å¤šä¸ªAPPå¯ä»¥è¿è¡Œåœ¨åŒä¸€è¿›ç¨‹<ul><li>åœ¨Manifestä¸­æ·»åŠ <code>android:sharedUserId=&lt;java package&gt;</code></li><li>åœ¨Manifestä¸­æ·»åŠ <code>android:sharedUserLabel=@string/id</code></li><li>åœ¨Applicationä¸­æ·»åŠ <code>android:process=&quot;processName&quot;</code></li></ul></li></ul><h2 id="é¡ºä¸°ç§‘æŠ€2019ç§‹æ‹›å®‰å“å¼€å‘å·¥ç¨‹å¸ˆç¬”è¯•å®¢è§‚é¢˜åˆé›†"><a href="#é¡ºä¸°ç§‘æŠ€2019ç§‹æ‹›å®‰å“å¼€å‘å·¥ç¨‹å¸ˆç¬”è¯•å®¢è§‚é¢˜åˆé›†" class="headerlink" title="é¡ºä¸°ç§‘æŠ€2019ç§‹æ‹›å®‰å“å¼€å‘å·¥ç¨‹å¸ˆç¬”è¯•å®¢è§‚é¢˜åˆé›†"></a>é¡ºä¸°ç§‘æŠ€2019ç§‹æ‹›å®‰å“å¼€å‘å·¥ç¨‹å¸ˆç¬”è¯•å®¢è§‚é¢˜åˆé›†</h2><h3 id="select-intoå’Œinsert-into"><a href="#select-intoå’Œinsert-into" class="headerlink" title="select intoå’Œinsert into"></a>select intoå’Œinsert into</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> xxx <span class="keyword">INTO</span> target_table <span class="keyword">FROM</span> origin_table</span><br></pre></td></tr></table></figure><ul><li>è¦æ±‚æ‰§è¡Œå‰è¡¨ä¸å­˜åœ¨ï¼Œä¼šè‡ªåŠ¨åˆ›å»º</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> target_table (filed1, field2, ...) <span class="keyword">VALUES</span> (val1, val2, ...)</span><br></pre></td></tr></table></figure><ul><li>è¦æ±‚æ‰§è¡Œå‰è¡¨å·²ç»å­˜åœ¨</li></ul><h3 id="EventBus"><a href="#EventBus" class="headerlink" title="EventBus"></a>EventBus</h3><h3 id="ç®€å•å®ç°ä¸€å¥—viewçš„æ³¨å…¥æ¡†æ¶ï¼ˆï¼‰"><a href="#ç®€å•å®ç°ä¸€å¥—viewçš„æ³¨å…¥æ¡†æ¶ï¼ˆï¼‰" class="headerlink" title="ç®€å•å®ç°ä¸€å¥—viewçš„æ³¨å…¥æ¡†æ¶ï¼ˆï¼‰"></a>ç®€å•å®ç°ä¸€å¥—viewçš„æ³¨å…¥æ¡†æ¶ï¼ˆï¼‰</h3><h2 id="åº¦å°æ»¡æ ¡æ‹›Androidç ”å‘å·¥ç¨‹å¸ˆç¬¬2æ‰¹"><a href="#åº¦å°æ»¡æ ¡æ‹›Androidç ”å‘å·¥ç¨‹å¸ˆç¬¬2æ‰¹" class="headerlink" title="åº¦å°æ»¡æ ¡æ‹›Androidç ”å‘å·¥ç¨‹å¸ˆç¬¬2æ‰¹"></a>åº¦å°æ»¡æ ¡æ‹›Androidç ”å‘å·¥ç¨‹å¸ˆç¬¬2æ‰¹</h2><h3 id="è¿‘ä¼¼å‘¨æœŸä¸²"><a href="#è¿‘ä¼¼å‘¨æœŸä¸²" class="headerlink" title="è¿‘ä¼¼å‘¨æœŸä¸²"></a>è¿‘ä¼¼å‘¨æœŸä¸²</h3><p>å°æ˜å‘ç°æœ‰çš„å­—ç¬¦ä¸²ä¸­è•´å«ç€ä¸€äº›è§„å¾‹ï¼Œä½†æ˜¯å®ƒä»¬åˆå’Œæ™®é€šçš„å‘¨æœŸä¸²æœ‰ç‚¹ä¸ä¸€æ ·ã€‚ä¾‹å¦‚:ABCABDABDABEã€‚å¦‚æœä»¥3ä¸ºå‘¨æœŸï¼Œå¯ä»¥çœ‹åˆ°å…¶ä¸­ åŒ…å«â€œABCâ€ã€â€œABDâ€å’Œâ€œABEâ€ç­‰å­ä¸²ï¼Œå…¶ä¸­â€œABDâ€å‡ºç°äº†ä¸¤æ¬¡ã€‚ è¿™äº›å­ä¸²ä¸¤ä¸¤ä¹‹é—´æœ€å¤šåªæœ‰æŸä¸€ä½ä¸Šçš„å­—ç¬¦ä¸ç›¸åŒï¼Œå…¶ä»–ä½ç½®ä¸Šçš„å­—ç¬¦éƒ½ä¸€æ ·ã€‚å°æ˜å°†å…¶ç§°ä¸ºâ€œè¿‘ä¼¼ä¸²â€ï¼Œç”±å¤šä¸ªâ€œè¿‘ä¼¼ä¸²â€ç»„æˆçš„å­—ç¬¦ä¸²ç§°ä¸ºâ€œè¿‘ ä¼¼å‘¨æœŸä¸²â€ã€‚â€œè¿‘ä¼¼å‘¨æœŸä¸²â€ä¸­çš„æ¯ä¸€ä¸ªâ€œè¿‘ä¼¼ä¸²â€çš„é•¿åº¦éœ€å¤§äºç­‰äº2ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯â€œABCABBACDâ€å¹¶ä¸æ˜¯ä¸€ä¸ªâ€œè¿‘ä¼¼å‘¨æœŸä¸²â€ã€‚å¦‚æœä»¥3ä¸ºå‘¨æœŸï¼Œå…¶å­ä¸²åŒ… æ‹¬â€œABCâ€ã€â€œABBâ€å’Œâ€œACDâ€ï¼Œâ€œABBâ€ä¸â€œACDâ€ã€â€œABCâ€ä¸â€œACDâ€å‡å­˜åœ¨ä¸¤ä¸ªä½ç½®ä¸Šçš„å­—ç¬¦ä¸ç›¸åŒï¼Œå› æ­¤ä¸æ˜¯â€œè¿‘ä¼¼å‘¨æœŸä¸²â€ã€‚ç‰¹åˆ« çš„ï¼Œâ€œAAAAAAâ€ä¹Ÿæ˜¯ä¸€ä¸ªâ€œè¿‘ä¼¼å‘¨æœŸä¸²â€ï¼Œå› ä¸ºå®ƒæ»¡è¶³ä¸Šè¿°â€œè¿‘ä¼¼å‘¨æœŸä¸²â€çš„å®šä¹‰ã€‚ ç°åœ¨ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¯·ç¼–å†™ä¸€ä¸ªç¨‹åºåˆ¤æ–­è¯¥å­—ç¬¦ä¸²æ˜¯å¦æ˜¯ä»¥3ä¸ºå‘¨æœŸçš„â€œè¿‘ä¼¼å‘¨æœŸä¸²â€ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// æ³¨æ„ç±»åå¿…é¡»ä¸º Main, ä¸è¦æœ‰ä»»ä½• package xxx ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">in</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        <span class="comment">// æ³¨æ„ hasNext å’Œ hasNextLine çš„åŒºåˆ«</span></span><br><span class="line">        <span class="keyword">while</span> (in.hasNextInt()) &#123; <span class="comment">// æ³¨æ„ while å¤„ç†å¤šä¸ª case</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> in.nextInt();</span><br><span class="line">            <span class="keyword">while</span>(n-- &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> in.nextLine();</span><br><span class="line">                <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">                <span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">while</span>(i &lt; s.length()) &#123;</span><br><span class="line">                    ans = ans ^ ((s.charAt(i) - <span class="string">&#x27;A&#x27;</span>) &lt;&lt; <span class="number">2</span>) + ((s.charAt(i+<span class="number">1</span>) - <span class="string">&#x27;A&#x27;</span>) &lt;&lt; <span class="number">1</span>) + (s.charAt(i+<span class="number">2</span>) - <span class="string">&#x27;A&#x27;</span>);</span><br><span class="line">                    i += <span class="number">3</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>((ans &amp; (ans-<span class="number">1</span>)) != <span class="number">0</span>) &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;No&quot;</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;Yes&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="DNS"><a href="#DNS" class="headerlink" title="DNS"></a>DNS</h3><p>DNSè¾…åŠ©æœåŠ¡å™¨ä¸DNSä¸»æœåŠ¡å™¨é€šè®¯æ—¶ä½¿ç”¨TCPåè®®</p><h2 id="Androidé¢˜åº“"><a href="#Androidé¢˜åº“" class="headerlink" title="Androidé¢˜åº“"></a>Androidé¢˜åº“</h2><h3 id="onNewIntent-çš„è§¦å‘æ—¶æœº"><a href="#onNewIntent-çš„è§¦å‘æ—¶æœº" class="headerlink" title="onNewIntent()çš„è§¦å‘æ—¶æœº"></a>onNewIntent()çš„è§¦å‘æ—¶æœº</h3><h3 id="è®¾å¤‡ç®¡ç†å™¨æƒé™"><a href="#è®¾å¤‡ç®¡ç†å™¨æƒé™" class="headerlink" title="è®¾å¤‡ç®¡ç†å™¨æƒé™"></a>è®¾å¤‡ç®¡ç†å™¨æƒé™</h3><h3 id="sleep-wait-yield-joinçš„åŒºåˆ«"><a href="#sleep-wait-yield-joinçš„åŒºåˆ«" class="headerlink" title="sleep,wait,yield,joinçš„åŒºåˆ«"></a>sleep,wait,yield,joinçš„åŒºåˆ«</h3><p>sleep,yield: è®©æ¸¡cpuä½¿ç”¨æƒï¼Œä¸é‡Šæ”¾é”<br>wait: ç›¸å½“äºæ¡ä»¶å˜é‡ï¼Œé‡Šæ”¾é”<br>join: åº•å±‚è°ƒç”¨äº†wait</p><h3 id="Hookæ¡†æ¶"><a href="#Hookæ¡†æ¶" class="headerlink" title="Hookæ¡†æ¶"></a>Hookæ¡†æ¶</h3><p>xposed,Substrate,Cydia,frida</p><h3 id="dex"><a href="#dex" class="headerlink" title="dex"></a>dex</h3><h3 id="ç„¦ç‚¹"><a href="#ç„¦ç‚¹" class="headerlink" title="ç„¦ç‚¹"></a>ç„¦ç‚¹</h3><p>toastæ²¡æœ‰ç„¦ç‚¹</p><h3 id="Viewç»˜åˆ¶æµç¨‹"><a href="#Viewç»˜åˆ¶æµç¨‹" class="headerlink" title="Viewç»˜åˆ¶æµç¨‹"></a>Viewç»˜åˆ¶æµç¨‹</h3><h3 id="ContentProvider"><a href="#ContentProvider" class="headerlink" title="ContentProvider"></a>ContentProvider</h3><h3 id="drawable-xxhdpiç­‰ç›®å½•"><a href="#drawable-xxhdpiç­‰ç›®å½•" class="headerlink" title="drawable-xxhdpiç­‰ç›®å½•"></a>drawable-xxhdpiç­‰ç›®å½•</h3><h2 id="æºç¨‹ç¬”è¯•"><a href="#æºç¨‹ç¬”è¯•" class="headerlink" title="æºç¨‹ç¬”è¯•"></a>æºç¨‹ç¬”è¯•</h2><h3 id="ç®—æ³•1"><a href="#ç®—æ³•1" class="headerlink" title="ç®—æ³•1"></a>ç®—æ³•1</h3><ul><li><p>ç»™nä¸ªæ•°<code>1 &lt;= ai &lt;= 1e6</code>ï¼Œ æ±‚<code>PI(ai!)</code>aiçš„é˜¶ä¹˜çš„ç§¯ä¸­å› æ•°çš„ä¸ªæ•°</p></li><li><p>åˆ†è§£è´¨å› æ•°</p></li><li><p>è´¨å› æ•°å‡ºç°æ¬¡æ•°+1çš„ç§¯å°±æ˜¯åŸæ¥æ•°å­—çš„å› æ•°ä¸ªæ•°</p></li><li><p>å¯¹æ•°ç»„æ’åºï¼Œè®¡ç®—æ¯ä¸ªæ•°åœ¨é˜¶ä¹˜ä¸­å‡ºç°çš„æ¬¡æ•°ï¼Œè®¡ç®—æ¯ä¸ªæ•°çš„è´¨å› æ•°ï¼Œè´¨å› æ•°ä¸ªæ•°ä¸ºå‡ºç°æ¬¡æ•°</p></li><li><p>è®¡ç®—æ‰€æœ‰æ•°çš„è´¨å› æ•°å‡ºç°æ¬¡æ•°*è¯¥æ•°åœ¨é˜¶ä¹˜ä¸­å‡ºç°çš„æ¬¡æ•°</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.util.function.UnaryOperator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">MOD</span> <span class="operator">=</span> <span class="number">1000000000</span> + <span class="number">7</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">MAX_VAL</span> <span class="operator">=</span> <span class="number">1000000</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> &lt;K, V&gt; <span class="keyword">void</span> <span class="title function_">mapReplace</span><span class="params">(Map&lt;K, V&gt; map, K key, V def, UnaryOperator&lt;V&gt; operator)</span> &#123;</span><br><span class="line">        <span class="type">V</span> <span class="variable">old</span> <span class="operator">=</span> map.get(key);</span><br><span class="line">        map.put(key, operator.apply(old == <span class="literal">null</span> ? def : old));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        List&lt;Integer&gt; primes = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(List.of(<span class="number">2</span>, <span class="number">3</span>));</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">5</span>; i &lt;= MAX_VAL; i+=<span class="number">2</span>) &#123;</span><br><span class="line">            <span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">3</span>; j*j &lt;= i; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span>(i % j == <span class="number">0</span>) &#123;</span><br><span class="line">                    flag = <span class="literal">false</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (flag) &#123;</span><br><span class="line">                primes.add(i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span>(scanner.hasNext()) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> scanner.nextInt();</span><br><span class="line">            <span class="type">int</span>[] arr = <span class="keyword">new</span> <span class="title class_">int</span>[n];</span><br><span class="line">            Map&lt;Integer, Integer&gt; cnt = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">                arr[i] = scanner.nextInt();</span><br><span class="line">            &#125;</span><br><span class="line">            Arrays.sort(arr);</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">1</span>; j &lt;= arr.length; j++) &#123;</span><br><span class="line">                <span class="keyword">final</span> <span class="type">int</span> <span class="variable">incr</span> <span class="operator">=</span> (arr.length - j + <span class="number">1</span>);</span><br><span class="line">                <span class="keyword">if</span>(Collections.binarySearch(primes, arr[j-<span class="number">1</span>]) &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                    mapReplace(cnt, arr[j-<span class="number">1</span>], <span class="number">0</span>, (old) -&gt; (old + incr) % MOD);</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= primes.size(); i++) &#123;</span><br><span class="line">                    <span class="type">int</span> <span class="variable">val</span> <span class="operator">=</span> arr[j-<span class="number">1</span>];</span><br><span class="line">                    <span class="type">int</span> <span class="variable">prime</span> <span class="operator">=</span> primes.get(i-<span class="number">1</span>);</span><br><span class="line">                    <span class="keyword">while</span>(val % prime == <span class="number">0</span>) &#123;</span><br><span class="line">                        val = val / prime;</span><br><span class="line">                        mapReplace(cnt, prime, <span class="number">0</span>, (old) -&gt; (old + incr) % MOD);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">long</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">var</span> entry : cnt.entrySet()) &#123;</span><br><span class="line">                ans = (ans * (entry.getValue() + <span class="number">1</span>)) % MOD;</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(ans);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åˆ·é¢˜"><a href="#åˆ·é¢˜" class="headerlink" title="åˆ·é¢˜"></a>åˆ·é¢˜</h2><!-- å°çº¢ä¹¦ --><h3 id="è´¦å·"><a href="#è´¦å·" class="headerlink" title="è´¦å·"></a>è´¦å·</h3><p>å¡”å­å“¥æœ‰nä¸ªè´¦å·ï¼Œæ¯ä¸ªè´¦å·ç²‰ä¸æ•°ä¸ºai</p><p>è¿™å¤©ä»–åˆåˆ›å»ºäº†ä¸€ä¸ªæ–°è´¦å·ï¼Œä»–å¸Œæœ›æ–°è´¦å·çš„ç²‰ä¸æ•°æ°å¥½ç­‰äºxã€‚<br>ä¸ºæ­¤ä»–å¯ä»¥å‘è‡ªå·±å·²æœ‰è´¦å·çš„ç²‰ä¸ä»¬æ¨èè‡ªå·±çš„æ–°è´¦å·ï¼Œè¿™æ ·ä»¥æ¥æ–°è´¦å·å°±å¾—åˆ°äº†ä¹‹å‰ç²‰ä¸çš„å…³æ³¨ã€‚<br>ä»–æƒ³çŸ¥é“ï¼Œä»–æœ€å°‘éœ€è¦åœ¨å‡ ä¸ªæ—§è´¦å·å‘â€œæ¨èæ–°è´¦å·â€çš„æ–‡ç« ï¼Œå¯ä»¥ä½¿å¾—ä»–çš„æ–°è´¦å·ç²‰ä¸æ•°æ°å¥½ä¸º xï¼Œé™¤æ­¤ä»¥å¤–ï¼Œä»–å¯ä»¥æœ€å¤šä»ä¸­é€‰æ‹©ä¸€ä¸ªè´¦å·å¤šæ¬¡å‘â€œæ¨èæ–°è´¦å·â€çš„æ–‡ç« ã€‚</p><p>å‡è®¾ä¸€ä¸ªæ—§è´¦å·ç²‰ä¸æ•°ä¸ºaiï¼Œå¦‚æœä»…æ¨èä¸€æ¬¡ï¼Œé‚£ä¹ˆæ–°è´¦å·ç²‰ä¸æ•°å¢åŠ ai&#x2F;2ï¼Œå¦‚æœå¤šä»¥æ¨èï¼Œåˆ™ç²‰ä¸æ•°å¢åŠ ai</p><blockquote><p>è¯»é¢˜è¯»é”™äº†ï¼Œåªèƒ½é€‰<strong>ä¸€ä¸ª</strong>è´¦å·æ¨å¹¿å¤šæ¬¡</p></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> n, x;</span><br><span class="line">    <span class="keyword">while</span>(cin &gt;&gt; n &gt;&gt; x) &#123;</span><br><span class="line">        <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">accounts</span><span class="params">(n)</span></span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            cin &gt;&gt; accounts[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">dp</span><span class="params">(x+<span class="number">1</span>, n+<span class="number">1</span>)</span></span>; <span class="comment">// ä¸€æ¬¡</span></span><br><span class="line">        <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">dp1</span><span class="params">(x+<span class="number">1</span>, n+<span class="number">1</span>)</span></span>; <span class="comment">// æœ‰æŸä¸€ä¸ªè´¦å·æ˜¯å¤šæ¬¡çš„æƒ…å†µ</span></span><br><span class="line">        dp[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">        dp1[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j = x; j &gt;= <span class="number">1</span>; j--) &#123;</span><br><span class="line">                <span class="keyword">if</span>(j &gt;= accounts[i<span class="number">-1</span>]) dp1[j] = <span class="built_in">min</span>(dp1[j], dp[j - accounts[i<span class="number">-1</span>]] + <span class="number">1</span>); <span class="comment">// è¯¥è´¦å·å¤šæ¬¡å‘å¸ƒ</span></span><br><span class="line">                <span class="keyword">if</span>(j &gt;= accounts[i<span class="number">-1</span>]/<span class="number">2</span>) dp1[j] = <span class="built_in">min</span>(dp1[j], dp1[j - accounts[i<span class="number">-1</span>]/<span class="number">2</span>] + <span class="number">1</span>); <span class="comment">// ä¸Šä¸€ä¸ªè´¦å·å¤šæ¬¡å‘å¸ƒï¼Œè¯¥è´¦å·ä¸å¤šæ¬¡å‘å¸ƒ</span></span><br><span class="line">                <span class="keyword">if</span>(j &gt;= accounts[i<span class="number">-1</span>]/<span class="number">2</span>) dp[j] = <span class="built_in">min</span>(dp[j], dp[j - accounts[i<span class="number">-1</span>]/<span class="number">2</span>] + <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        cout &lt;&lt; (<span class="built_in">min</span>(dp[x], dp1[x]) &gt; n ? <span class="number">-1</span> : <span class="built_in">min</span>(dp[x], dp1[x])) &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h2><p>ä¸€ä¸ªæ­£æ•´æ•™<code>x</code>ï¼Œåœ¨åŒºé—´<code>[l, r]</code>ä¸­é€‰æ ·ä¸€ä¸ªæ•°<code>y</code>ï¼Œæ»¡å®š<code>x*y</code>æ˜¯å®Œå…¨å¹³ä¸‡æ•°ã€‚æƒ³çŸ¥é“æœ‰å¤šå°‘ç§é€‰æ‹©æ–¹æ¡ˆ?<br>ä¸€å…±æœ‰<code>q</code>æ¬¡è¯¢é—®</p><p><code>1 &lt;= q &lt;= 1e4</code><br><code>1 &lt;= x &lt;= 1e14</code><br><code>1 &lt;= l, r &lt;= 1e14</code></p><h3 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h3><ul><li>æˆ‘ä»¬è¦æ‰¾æ‰€æœ‰<code>y*x == t*t</code>çš„æ•°<code>y</code>ï¼Œä¹Ÿå°±æ˜¯æ‰¾æ‰€æœ‰çš„<code>y=t*t/x</code> ä¸” <code>t*t%x == 0</code></li><li>æ‰€æœ‰æ»¡è¶³<code>t*t%x == 0</code>çš„æ•°<code>(t*t/x)</code>ï¼Œ<code>(t*t/x)</code>åœ¨<code>[1, 1e14]</code>èŒƒå›´å†…</li><li>ä¹Ÿå°±æ˜¯<code>t*t=q*x</code> å› ä¸º<code>t,q,x</code>éƒ½æ˜¯æ•´æ•°ï¼Œæ‰€ä»¥<code>sqrt(q*x)</code>æ˜¯æ•´æ•°ä¹Ÿå°±æ˜¯qå¯ä»¥å†™æˆ<code>i*i*x</code>çš„å½¢å¼</li><li>ä¹Ÿå°±æ˜¯<code>t=i*x</code></li><li>ä¹Ÿå°±æ˜¯æ‰¾åˆ°æ‰€æœ‰<code>i*i*x</code>ï¼Œä¸”åœ¨<code>[1, 1e14]</code>èŒƒå›´å†…</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        <span class="keyword">while</span>(scanner.hasNext()) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">q</span> <span class="operator">=</span> scanner.nextInt();</span><br><span class="line">            <span class="type">long</span> <span class="variable">x</span> <span class="operator">=</span> scanner.nextLong();</span><br><span class="line">            List&lt;Long&gt; isSquare = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">long</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i*i*x &lt;= <span class="number">1e14</span>; i++) &#123;</span><br><span class="line">                isSquare.add(i*i*x);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; q; i++) &#123;</span><br><span class="line">                <span class="type">long</span> <span class="variable">l</span> <span class="operator">=</span> scanner.nextLong();</span><br><span class="line">                <span class="type">long</span> <span class="variable">r</span> <span class="operator">=</span> scanner.nextLong();</span><br><span class="line">                <span class="type">int</span> <span class="variable">leftIndex</span> <span class="operator">=</span> Collections.binarySearch(isSquare, l);</span><br><span class="line">                <span class="type">int</span> <span class="variable">rightIndex</span> <span class="operator">=</span> Collections.binarySearch(isSquare, r);</span><br><span class="line">                <span class="keyword">if</span>(leftIndex &lt; <span class="number">0</span>) leftIndex = -leftIndex-<span class="number">1</span>;</span><br><span class="line">                <span class="keyword">if</span>(rightIndex &lt; <span class="number">0</span>) rightIndex = -rightIndex-<span class="number">1</span>;</span><br><span class="line">                <span class="keyword">else</span> rightIndex++;</span><br><span class="line">                System.out.println(rightIndex - leftIndex);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2024-3-31"><a href="#2024-3-31" class="headerlink" title="2024.3.31"></a>2024.3.31</h2><!-- è…¾è®¯ --><h3 id="é—®é¢˜5"><a href="#é—®é¢˜5" class="headerlink" title="é—®é¢˜5"></a>é—®é¢˜5</h3><p>æ–¹é˜µé‡Œé¢ä¸Šä¸‹å·¦å³èµ°æ‰¾tencent</p><h3 id="é—®é¢˜4"><a href="#é—®é¢˜4" class="headerlink" title="é—®é¢˜4"></a>é—®é¢˜4</h3><p>æ•°ç»„åˆ†æˆkç»„ï¼Œæ¯ç»„å†…éƒ¨å¼‚æˆ–ï¼Œæ±‚kç»„å¼‚æˆ–å’Œæœ€å¤§</p><h3 id="é—®é¢˜3"><a href="#é—®é¢˜3" class="headerlink" title="é—®é¢˜3"></a>é—®é¢˜3</h3><p>ä¸€ä¸ªå›¾ï¼ŒåŠ ä¸€ä¸ªè¾¹æ°å¥½å¯ä»¥è¿é€šæœ‰å‡ ç§åŠ æ³•</p><h3 id="é—®é¢˜2"><a href="#é—®é¢˜2" class="headerlink" title="é—®é¢˜2"></a>é—®é¢˜2</h3><p>ä¸€ä¸ªæ•°ç»„ï¼Œåˆ†æˆä¸¤æ®µï¼ˆå¯ç©ºï¼‰ï¼Œæ˜¯å¦æ°å¥½å¯ä»¥é‡æ–°æ’åˆ—æˆé€’å¢</p><h3 id="é—®é¢˜1"><a href="#é—®é¢˜1" class="headerlink" title="é—®é¢˜1"></a>é—®é¢˜1</h3><p>è¾¹æœ‰RWä¸¤è‰²<br>å¦‚æœä¸€ä¸ªç‚¹å‘¨å›´çš„è¾¹å…¨éƒ½æ˜¯Rï¼Œåˆ™æ˜¯å¥½ç‚¹ï¼Œç»Ÿè®¡å¥½ç‚¹çš„ä¸ªæ•°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.IntStream;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Stream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Scanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">match</span> <span class="operator">=</span> <span class="string">&quot;tencent&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span>[] pos = &#123;<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, -<span class="number">1</span>, <span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">dfs5</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j, <span class="type">int</span> n, <span class="type">int</span> m, <span class="type">int</span> len, String[] map)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(i &gt;= n || j &gt;= m || i &lt; <span class="number">0</span> || j &lt; <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(match.charAt(len) != map[i].charAt(j)) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(len == <span class="number">6</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> <span class="number">0</span>; k &lt; pos.length - <span class="number">1</span>; k++) &#123;</span><br><span class="line">            ans += dfs5(i + pos[k], j + pos[k+<span class="number">1</span>], n, m, len + <span class="number">1</span>, map);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">problem5</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> scanner.nextInt();</span><br><span class="line">        <span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> scanner.nextInt();</span><br><span class="line">        String[] map = <span class="keyword">new</span> <span class="title class_">String</span>[n];</span><br><span class="line">        scanner.nextLine();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            map[i] = scanner.nextLine();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; m; j++) &#123;</span><br><span class="line">                ans += dfs5(i, j, n, m, <span class="number">0</span>,map);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(ans);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">UnionSet</span>  &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span>[] set;</span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">UnionSet</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">            set = IntStream.iterate(<span class="number">0</span>, (prev)-&gt;prev+<span class="number">1</span>).limit(n).toArray();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">find</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> i == set[i] ? i : (set[i] = find(set[i]));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">union</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line">            set[find(i)] = find(j);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">problem3</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> scanner.nextInt();</span><br><span class="line">        <span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> scanner.nextInt();</span><br><span class="line">        <span class="type">UnionSet</span> <span class="variable">unionSet</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UnionSet</span>(n);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">u</span> <span class="operator">=</span> scanner.nextInt();</span><br><span class="line">            <span class="type">int</span> <span class="variable">v</span> <span class="operator">=</span> scanner.nextInt();</span><br><span class="line">            unionSet.union(u-<span class="number">1</span>, v-<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        Map&lt;Integer, Integer&gt; setCnt = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">part</span> <span class="operator">=</span> unionSet.find(i);</span><br><span class="line">            <span class="keyword">if</span>(!setCnt.containsKey(part)) &#123;</span><br><span class="line">                setCnt.put(part, <span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            setCnt.put(part, setCnt.get(part) + <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(setCnt.size() != <span class="number">2</span>) &#123;</span><br><span class="line">            System.out.println(<span class="number">0</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">            <span class="type">int</span> <span class="variable">diff</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> entry : setCnt.entrySet()) &#123;</span><br><span class="line">                diff += entry.getValue();</span><br><span class="line">                ans += (n - diff) * entry.getValue();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// a1 a2 a3 ... an</span></span><br><span class="line">            <span class="comment">// a1*(a2 + a3 + a4 + ... + an)</span></span><br><span class="line">            <span class="comment">// a2*(a3 + a4 + a5 + ... + an)</span></span><br><span class="line">            System.out.println(ans);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">problem2</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">char</span>[] input = scanner.nextLine().toCharArray();</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(i &lt; input.length) &#123;</span><br><span class="line">            <span class="keyword">if</span>(input[i] == <span class="string">&#x27;[&#x27;</span> || input[i] == <span class="string">&#x27;]&#x27;</span>) &#123;</span><br><span class="line">                System.out.print(input[i]);</span><br><span class="line">                i++;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            List&lt;Integer&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">            <span class="keyword">if</span>(input[i] == <span class="string">&#x27;&#123;&#x27;</span>) &#123;</span><br><span class="line">                i++;</span><br><span class="line">                <span class="keyword">while</span> (i &lt; input.length) &#123;</span><br><span class="line">                    <span class="type">int</span> <span class="variable">cur</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">                    <span class="keyword">while</span>(i &lt; input.length &amp;&amp; input[i] &gt;= <span class="string">&#x27;0&#x27;</span> &amp;&amp; input[i] &lt;= <span class="string">&#x27;9&#x27;</span>) &#123;</span><br><span class="line">                        cur *= <span class="number">10</span>;</span><br><span class="line">                        cur += input[i] - <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">                        i++;</span><br><span class="line">                    &#125;</span><br><span class="line">                    list.add(cur);</span><br><span class="line">                    <span class="keyword">if</span>(i &lt; input.length) &#123;</span><br><span class="line">                        i++;</span><br><span class="line">                        <span class="keyword">if</span>(input[i-<span class="number">1</span>] == <span class="string">&#x27;&#125;&#x27;</span>) &#123;</span><br><span class="line">                            <span class="keyword">if</span>(input[i] == <span class="string">&#x27;,&#x27;</span>) i++;</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">int</span> <span class="variable">seg1</span> <span class="operator">=</span> <span class="number">1</span>, seg2;</span><br><span class="line">            <span class="keyword">while</span>(seg1 &lt; list.size() &amp;&amp; list.get(seg1) &gt; list.get(seg1-<span class="number">1</span>)) &#123;</span><br><span class="line">                seg1++;</span><br><span class="line">            &#125;</span><br><span class="line">            seg2 = seg1 + <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">while</span>(seg2 &lt; list.size() &amp;&amp; list.get(seg2) &gt; list.get(seg2-<span class="number">1</span>)) &#123;</span><br><span class="line">                seg2++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(seg1 == list.size()) &#123;</span><br><span class="line">                System.out.print(<span class="string">&quot;true&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (seg2 != list.size())&#123;</span><br><span class="line">                System.out.print(<span class="string">&quot;false&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span>(list.get(list.size() - <span class="number">1</span>) &lt; list.get(<span class="number">0</span>)) &#123;</span><br><span class="line">                    System.out.print(<span class="string">&quot;true&quot;</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    System.out.print(<span class="string">&quot;false&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(i &lt; input.length) &#123;</span><br><span class="line">                <span class="keyword">if</span>(input[i] != <span class="string">&#x27;]&#x27;</span>) &#123;</span><br><span class="line">                    System.out.print(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">problem1</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">node</span> <span class="operator">=</span> scanner.nextInt();</span><br><span class="line">        <span class="type">int</span> <span class="variable">edge</span> <span class="operator">=</span> scanner.nextInt();</span><br><span class="line">        <span class="type">boolean</span>[] res = <span class="keyword">new</span> <span class="title class_">boolean</span>[node];</span><br><span class="line">        Arrays.fill(res, <span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; edge; i++) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">u</span> <span class="operator">=</span> scanner.nextInt();</span><br><span class="line">            <span class="type">int</span> <span class="variable">v</span> <span class="operator">=</span> scanner.nextInt();</span><br><span class="line">            <span class="type">String</span> <span class="variable">c</span> <span class="operator">=</span> scanner.next();</span><br><span class="line">            <span class="keyword">if</span>(c.equals(<span class="string">&quot;R&quot;</span>)) &#123;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                res[u-<span class="number">1</span>] = res[v-<span class="number">1</span>] = <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; res.length; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(res[i]) ans++;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(ans);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">problem4</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> scanner.nextInt();</span><br><span class="line">        <span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> scanner.nextInt();</span><br><span class="line">        <span class="type">int</span>[] arr = <span class="keyword">new</span> <span class="title class_">int</span>[n];</span><br><span class="line">        <span class="type">int</span>[][] dp = <span class="keyword">new</span> <span class="title class_">int</span>[n+<span class="number">1</span>][k+<span class="number">1</span>];</span><br><span class="line">        <span class="type">int</span>[] xorSum = <span class="keyword">new</span> <span class="title class_">int</span>[n+<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            arr[i] = scanner.nextInt();</span><br><span class="line">            xorSum[i+<span class="number">1</span>] = arr[i] ^ xorSum[i];</span><br><span class="line">            dp[i+<span class="number">1</span>][<span class="number">1</span>] = xorSum[i+<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">2</span>; j &lt;= k; j++) &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> j; i &lt;= n; i++) &#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> j-<span class="number">1</span>; m &lt; i; m++) &#123;</span><br><span class="line">                    dp[i][j] = Math.max(dp[i][j], dp[m][j-<span class="number">1</span>] + (xorSum[i] ^ xorSum[m]));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> k; i &lt;= n; i++) &#123;</span><br><span class="line">            ans = Math.max(ans, dp[i][k]);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(ans);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">while</span>(scanner.hasNext()) &#123;</span><br><span class="line">            problem5();</span><br><span class="line">            problem4();</span><br><span class="line">            problem3();</span><br><span class="line">            problem2();</span><br><span class="line">            problem1();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;å°ç±³2019ç§‹æ‹›å®‰å“å¼€å‘ç¬”è¯•é¢˜ï¼ˆBï¼‰&quot;&gt;&lt;a href=&quot;#å°ç±³2019ç§‹æ‹›å®‰å“å¼€å‘ç¬”è¯•é¢˜ï¼ˆBï¼‰&quot; class=&quot;headerlink&quot; title=&quot;å°ç±³2019ç§‹æ‹›å®‰å“å¼€å‘ç¬”è¯•é¢˜ï¼ˆBï¼‰&quot;&gt;&lt;/a&gt;å°ç±³2019ç§‹æ‹›å®‰å“å¼€å‘ç¬”è¯•é¢˜ï¼ˆBï¼‰&lt;/h2&gt;&lt;h3 id=&quot;21-æœ€å°‘ç«‹æ–¹æ•°ä¹‹å’Œ&quot;&gt;&lt;a href=&quot;#21-æœ€å°‘ç«‹æ–¹æ•°ä¹‹å’Œ&quot; class=&quot;headerlink&quot; title=&quot;21. æœ€å°‘ç«‹æ–¹æ•°ä¹‹å’Œ&quot;&gt;&lt;/a&gt;21. æœ€å°‘ç«‹æ–¹æ•°ä¹‹å’Œ&lt;/h3&gt;&lt;p&gt;ç»™å‡ºä¸€ä¸ªæ•°å­—Nï¼ˆ&lt;code&gt;0&amp;lt;N&amp;lt;1000000&lt;/code&gt;ï¼‰,å°†Nå†™æˆç«‹æ–¹æ•°å’Œçš„å½¢å¼ï¼Œæ±‚å‡ºéœ€è¦çš„æœ€å°‘ç«‹æ–¹æ•°ä¸ªæ•°ã€‚&lt;br&gt;ä¾‹å¦‚N&amp;#x3D;17ï¼Œ1+8+8 &amp;#x3D; 17ï¼Œæœ€å°‘éœ€è¦3ä¸ªç«‹æ–¹æ•°ï¼Œåˆ™è¾“å‡º3ã€‚&lt;br&gt;N&amp;#x3D; 28,1+1+1+1+8+8+8&amp;#x3D;28, éœ€è¦7ä¸ªç«‹æ–¹æ•°ï¼Œ1+27&amp;#x3D;28,éœ€è¦2ä¸ªç«‹æ–¹æ•°ï¼Œæ‰€ä»¥æœ€å°‘ç«‹æ–¹æ•°ä¸º2ï¼Œåˆ™è¾“å‡º2ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; java.util.*;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// æ³¨æ„ç±»åå¿…é¡»ä¸º Main, ä¸è¦æœ‰ä»»ä½• package xxx ä¿¡æ¯&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title class_&quot;&gt;Main&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; List&amp;lt;Integer&amp;gt; cubs;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; cubNum;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        cubs = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;title class_&quot;&gt;ArrayList&lt;/span&gt;&amp;lt;Integer&amp;gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;; i*i*i &amp;lt;= &lt;span class=&quot;number&quot;&gt;1000000&lt;/span&gt;; i++) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            cubs.add(i*i*i);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        cubNum = cubs.size();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title function_&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(String[] args)&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;type&quot;&gt;Scanner&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;title class_&quot;&gt;Scanner&lt;/span&gt;(System.in);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// æ³¨æ„ hasNext å’Œ hasNextLine çš„åŒºåˆ«&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;while&lt;/span&gt; (in.hasNextInt()) &amp;#123; &lt;span class=&quot;comment&quot;&gt;// æ³¨æ„ while å¤„ç†å¤šä¸ª case&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; in.nextInt();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;index&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; Collections.binarySearch(cubs, n);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(index &amp;lt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                index = -index - &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(index &amp;lt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;title class_&quot;&gt;RuntimeException&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;quot;unreachable&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt;[] dp = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;title class_&quot;&gt;int&lt;/span&gt;[n+&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            Arrays.fill(dp, Integer.MAX_VALUE);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            dp[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;] = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;j&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;; j &amp;lt;= index+&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;; j++) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; cubs.get(j-&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;); i &amp;lt;= n; i++) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    dp[i] = Math.min(dp[i], dp[i - cubs.get(j-&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;)] + &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            System.out.println(dp[n]);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;å®Œå…¨èƒŒåŒ…ï¼Œä»æ‰€æœ‰ç«‹æ–¹æ•°é‡Œé€‰æ•°ï¼Œå–æ•°ç›®æœ€å°çš„æƒ…å†µ&lt;/p&gt;
&lt;h3 id=&quot;èµ„äº§åŒ…æ‰“åŒ…&quot;&gt;&lt;a href=&quot;#èµ„äº§åŒ…æ‰“åŒ…&quot; class=&quot;headerlink&quot; title=&quot;èµ„äº§åŒ…æ‰“åŒ…&quot;&gt;&lt;/a&gt;èµ„äº§åŒ…æ‰“åŒ…&lt;/h3&gt;</summary>
    
    
    
    <category term="ç‰›å®¢" scheme="https://jingtianer.github.io/home/categories/%E7%89%9B%E5%AE%A2/"/>
    
    <category term="åˆ·é¢˜" scheme="https://jingtianer.github.io/home/categories/%E7%89%9B%E5%AE%A2/%E5%88%B7%E9%A2%98/"/>
    
    
    <category term="ç‰›å®¢" scheme="https://jingtianer.github.io/home/tags/%E7%89%9B%E5%AE%A2/"/>
    
    <category term="åˆ·é¢˜" scheme="https://jingtianer.github.io/home/tags/%E5%88%B7%E9%A2%98/"/>
    
  </entry>
  
</feed>
